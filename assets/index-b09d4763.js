(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function s(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function l(a){if(a.ep)return;a.ep=!0;const h=s(a);fetch(a.href,h)}})();const style="";class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,s,l){let a=[];return this.decompose(0,e,a,2),l.length&&l.decompose(0,l.length,a,3),this.decompose(s,this.length,a,1),TextNode.from(a,this.length-(s-e)+l.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,s=this.length){let l=[];return this.decompose(e,s,l,0),TextNode.from(l,s-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let s=this.scanIdentical(e,1),l=this.length-this.scanIdentical(e,-1),a=new RawTextCursor(this),h=new RawTextCursor(e);for(let f=s,u=s;;){if(a.next(f),h.next(f),f=0,a.lineBreak!=h.lineBreak||a.done!=h.done||a.value!=h.value)return!1;if(u+=a.value.length,a.done||u>=l)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,s=this.length){return new PartialTextCursor(this,e,s)}iterLines(e,s){let l;if(e==null)l=this.iter();else{s==null&&(s=this.lines+1);let a=this.line(e).from;l=this.iterRange(a,Math.max(a,s==this.lines+1?this.length:s<=1?0:this.line(s-1).to))}return new LineCursor(l)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Text.empty:e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[]))}}class TextLeaf extends Text{constructor(e,s=textLength(e)){super(),this.text=e,this.length=s}get lines(){return this.text.length}get children(){return null}lineInner(e,s,l,a){for(let h=0;;h++){let f=this.text[h],u=a+f.length;if((s?l:u)>=e)return new Line(a,u,l,f);a=u+1,l++}}decompose(e,s,l,a){let h=e<=0&&s>=this.length?this:new TextLeaf(sliceText(this.text,e,s),Math.min(s,this.length)-Math.max(0,e));if(a&1){let f=l.pop(),u=appendText(h.text,f.text.slice(),0,h.length);if(u.length<=32)l.push(new TextLeaf(u,f.length+h.length));else{let p=u.length>>1;l.push(new TextLeaf(u.slice(0,p)),new TextLeaf(u.slice(p)))}}else l.push(h)}replace(e,s,l){if(!(l instanceof TextLeaf))return super.replace(e,s,l);let a=appendText(this.text,appendText(l.text,sliceText(this.text,0,e)),s),h=this.length+l.length-(s-e);return a.length<=32?new TextLeaf(a,h):TextNode.from(TextLeaf.split(a,[]),h)}sliceString(e,s=this.length,l=`
`){let a="";for(let h=0,f=0;h<=s&&f<this.text.length;f++){let u=this.text[f],p=h+u.length;h>e&&f&&(a+=l),e<p&&s>h&&(a+=u.slice(Math.max(0,e-h),s-h)),h=p+1}return a}flatten(e){for(let s of this.text)e.push(s)}scanIdentical(){return 0}static split(e,s){let l=[],a=-1;for(let h of e)l.push(h),a+=h.length+1,l.length==32&&(s.push(new TextLeaf(l,a)),l=[],a=-1);return a>-1&&s.push(new TextLeaf(l,a)),s}}class TextNode extends Text{constructor(e,s){super(),this.children=e,this.length=s,this.lines=0;for(let l of e)this.lines+=l.lines}lineInner(e,s,l,a){for(let h=0;;h++){let f=this.children[h],u=a+f.length,p=l+f.lines-1;if((s?p:u)>=e)return f.lineInner(e,s,l,a);a=u+1,l=p+1}}decompose(e,s,l,a){for(let h=0,f=0;f<=s&&h<this.children.length;h++){let u=this.children[h],p=f+u.length;if(e<=p&&s>=f){let m=a&((f<=e?1:0)|(p>=s?2:0));f>=e&&p<=s&&!m?l.push(u):u.decompose(e-f,s-f,l,m)}f=p+1}}replace(e,s,l){if(l.lines<this.lines)for(let a=0,h=0;a<this.children.length;a++){let f=this.children[a],u=h+f.length;if(e>=h&&s<=u){let p=f.replace(e-h,s-h,l),m=this.lines-f.lines+p.lines;if(p.lines<m>>5-1&&p.lines>m>>5+1){let g=this.children.slice();return g[a]=p,new TextNode(g,this.length-(s-e)+l.length)}return super.replace(h,u,p)}h=u+1}return super.replace(e,s,l)}sliceString(e,s=this.length,l=`
`){let a="";for(let h=0,f=0;h<this.children.length&&f<=s;h++){let u=this.children[h],p=f+u.length;f>e&&h&&(a+=l),e<p&&s>f&&(a+=u.sliceString(e-f,s-f,l)),f=p+1}return a}flatten(e){for(let s of this.children)s.flatten(e)}scanIdentical(e,s){if(!(e instanceof TextNode))return 0;let l=0,[a,h,f,u]=s>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;a+=s,h+=s){if(a==f||h==u)return l;let p=this.children[a],m=e.children[h];if(p!=m)return l+p.scanIdentical(m,s);l+=p.length+1}}static from(e,s=e.reduce((l,a)=>l+a.length+1,-1)){let l=0;for(let x of e)l+=x.lines;if(l<32){let x=[];for(let b of e)b.flatten(x);return new TextLeaf(x,s)}let a=Math.max(32,l>>5),h=a<<1,f=a>>1,u=[],p=0,m=-1,g=[];function y(x){let b;if(x.lines>h&&x instanceof TextNode)for(let k of x.children)y(k);else x.lines>f&&(p>f||!p)?(w(),u.push(x)):x instanceof TextLeaf&&p&&(b=g[g.length-1])instanceof TextLeaf&&x.lines+b.lines<=32?(p+=x.lines,m+=x.length+1,g[g.length-1]=new TextLeaf(b.text.concat(x.text),b.length+1+x.length)):(p+x.lines>a&&w(),p+=x.lines,m+=x.length+1,g.push(x))}function w(){p!=0&&(u.push(g.length==1?g[0]:TextNode.from(g,m)),m=-1,p=g.length=0)}for(let x of e)y(x);return w(),u.length==1?u[0]:new TextNode(u,s)}}Text.empty=new TextLeaf([""],0);function textLength(o){let e=-1;for(let s of o)e+=s.length+1;return e}function appendText(o,e,s=0,l=1e9){for(let a=0,h=0,f=!0;h<o.length&&a<=l;h++){let u=o[h],p=a+u.length;p>=s&&(p>l&&(u=u.slice(0,l-a)),a<s&&(u=u.slice(s-a)),f?(e[e.length-1]+=u,f=!1):e.push(u)),a=p+1}return e}function sliceText(o,e,s){return appendText(o,[""],e,s)}class RawTextCursor{constructor(e,s=1){this.dir=s,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[s>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,s){for(this.done=this.lineBreak=!1;;){let l=this.nodes.length-1,a=this.nodes[l],h=this.offsets[l],f=h>>1,u=a instanceof TextLeaf?a.text.length:a.children.length;if(f==(s>0?u:0)){if(l==0)return this.done=!0,this.value="",this;s>0&&this.offsets[l-1]++,this.nodes.pop(),this.offsets.pop()}else if((h&1)==(s>0?0:1)){if(this.offsets[l]+=s,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(a instanceof TextLeaf){let p=a.text[f+(s<0?-1:0)];if(this.offsets[l]+=s,p.length>Math.max(0,e))return this.value=e==0?p:s>0?p.slice(e):p.slice(0,p.length-e),this;e-=p.length}else{let p=a.children[f+(s<0?-1:0)];e>p.length?(e-=p.length,this.offsets[l]+=s):(s<0&&this.offsets[l]--,this.nodes.push(p),this.offsets.push(s>0?1:(p instanceof TextLeaf?p.text.length:p.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,s,l){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,s>l?-1:1),this.pos=s>l?e.length:0,this.from=Math.min(s,l),this.to=Math.max(s,l)}nextInner(e,s){if(s<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,s<0?this.pos-this.to:this.from-this.pos);let l=s<0?this.pos-this.from:this.to-this.pos;e>l&&(e=l),l-=e;let{value:a}=this.cursor.next(e);return this.pos+=(a.length+e)*s,this.value=a.length<=l?a:s<0?a.slice(a.length-l):a.slice(0,l),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:s,lineBreak:l,value:a}=this.inner.next(e);return s?(this.done=!0,this.value=""):l?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=a,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,s,l,a){this.from=e,this.to=s,this.number=l,this.text=a}get length(){return this.to-this.from}}let extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(o=>o?parseInt(o,36):1);for(let o=1;o<extend.length;o++)extend[o]+=extend[o-1];function isExtendingChar(o){for(let e=1;e<extend.length;e+=2)if(extend[e]>o)return extend[e-1]<=o;return!1}function isRegionalIndicator(o){return o>=127462&&o<=127487}const ZWJ=8205;function findClusterBreak(o,e,s=!0,l=!0){return(s?nextClusterBreak:prevClusterBreak)(o,e,l)}function nextClusterBreak(o,e,s){if(e==o.length)return e;e&&surrogateLow(o.charCodeAt(e))&&surrogateHigh(o.charCodeAt(e-1))&&e--;let l=codePointAt(o,e);for(e+=codePointSize(l);e<o.length;){let a=codePointAt(o,e);if(l==ZWJ||a==ZWJ||s&&isExtendingChar(a))e+=codePointSize(a),l=a;else if(isRegionalIndicator(a)){let h=0,f=e-2;for(;f>=0&&isRegionalIndicator(codePointAt(o,f));)h++,f-=2;if(h%2==0)break;e+=2}else break}return e}function prevClusterBreak(o,e,s){for(;e>0;){let l=nextClusterBreak(o,e-2,s);if(l<e)return l;e--}return 0}function surrogateLow(o){return o>=56320&&o<57344}function surrogateHigh(o){return o>=55296&&o<56320}function codePointAt(o,e){let s=o.charCodeAt(e);if(!surrogateHigh(s)||e+1==o.length)return s;let l=o.charCodeAt(e+1);return surrogateLow(l)?(s-55296<<10)+(l-56320)+65536:s}function fromCodePoint(o){return o<=65535?String.fromCharCode(o):(o-=65536,String.fromCharCode((o>>10)+55296,(o&1023)+56320))}function codePointSize(o){return o<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(o){return o[o.Simple=0]="Simple",o[o.TrackDel=1]="TrackDel",o[o.TrackBefore=2]="TrackBefore",o[o.TrackAfter=3]="TrackAfter",o}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let s=0;s<this.sections.length;s+=2)e+=this.sections[s];return e}get newLength(){let e=0;for(let s=0;s<this.sections.length;s+=2){let l=this.sections[s+1];e+=l<0?this.sections[s]:l}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let s=0,l=0,a=0;s<this.sections.length;){let h=this.sections[s++],f=this.sections[s++];f<0?(e(l,a,h),a+=h):a+=f,l+=h}}iterChangedRanges(e,s=!1){iterChanges(this,e,s)}get invertedDesc(){let e=[];for(let s=0;s<this.sections.length;){let l=this.sections[s++],a=this.sections[s++];a<0?e.push(l,a):e.push(a,l)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,s=!1){return e.empty?this:mapSet(this,e,s)}mapPos(e,s=-1,l=MapMode.Simple){let a=0,h=0;for(let f=0;f<this.sections.length;){let u=this.sections[f++],p=this.sections[f++],m=a+u;if(p<0){if(m>e)return h+(e-a);h+=u}else{if(l!=MapMode.Simple&&m>=e&&(l==MapMode.TrackDel&&a<e&&m>e||l==MapMode.TrackBefore&&a<e||l==MapMode.TrackAfter&&m>e))return null;if(m>e||m==e&&s<0&&!u)return e==a||s<0?h:h+p;h+=p}a=m}if(e>a)throw new RangeError(`Position ${e} is out of range for changeset of length ${a}`);return h}touchesRange(e,s=e){for(let l=0,a=0;l<this.sections.length&&a<=s;){let h=this.sections[l++],f=this.sections[l++],u=a+h;if(f>=0&&a<=s&&u>=e)return a<e&&u>s?"cover":!0;a=u}return!1}toString(){let e="";for(let s=0;s<this.sections.length;){let l=this.sections[s++],a=this.sections[s++];e+=(e?" ":"")+l+(a>=0?":"+a:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(s=>typeof s!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,s){super(e),this.inserted=s}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(s,l,a,h,f)=>e=e.replace(a,a+(l-s),f),!1),e}mapDesc(e,s=!1){return mapSet(this,e,s,!0)}invert(e){let s=this.sections.slice(),l=[];for(let a=0,h=0;a<s.length;a+=2){let f=s[a],u=s[a+1];if(u>=0){s[a]=u,s[a+1]=f;let p=a>>1;for(;l.length<p;)l.push(Text.empty);l.push(f?e.slice(h,h+f):Text.empty)}h+=f}return new ChangeSet(s,l)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,s=!1){return e.empty?this:mapSet(this,e,s,!0)}iterChanges(e,s=!1){iterChanges(this,e,s)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let s=[],l=[],a=[],h=new SectionIter(this);e:for(let f=0,u=0;;){let p=f==e.length?1e9:e[f++];for(;u<p||u==p&&h.len==0;){if(h.done)break e;let g=Math.min(h.len,p-u);addSection(a,g,-1);let y=h.ins==-1?-1:h.off==0?h.ins:0;addSection(s,g,y),y>0&&addInsert(l,s,h.text),h.forward(g),u+=g}let m=e[f++];for(;u<m;){if(h.done)break e;let g=Math.min(h.len,m-u);addSection(s,g,-1),addSection(a,g,h.ins==-1?-1:h.off==0?h.ins:0),h.forward(g),u+=g}}return{changes:new ChangeSet(s,l),filtered:ChangeDesc.create(a)}}toJSON(){let e=[];for(let s=0;s<this.sections.length;s+=2){let l=this.sections[s],a=this.sections[s+1];a<0?e.push(l):a==0?e.push([l]):e.push([l].concat(this.inserted[s>>1].toJSON()))}return e}static of(e,s,l){let a=[],h=[],f=0,u=null;function p(g=!1){if(!g&&!a.length)return;f<s&&addSection(a,s-f,-1);let y=new ChangeSet(a,h);u=u?u.compose(y.map(u)):y,a=[],h=[],f=0}function m(g){if(Array.isArray(g))for(let y of g)m(y);else if(g instanceof ChangeSet){if(g.length!=s)throw new RangeError(`Mismatched change set length (got ${g.length}, expected ${s})`);p(),u=u?u.compose(g.map(u)):g}else{let{from:y,to:w=y,insert:x}=g;if(y>w||y<0||w>s)throw new RangeError(`Invalid change range ${y} to ${w} (in doc of length ${s})`);let b=x?typeof x=="string"?Text.of(x.split(l||DefaultSplit)):x:Text.empty,k=b.length;if(y==w&&k==0)return;y<f&&p(),y>f&&addSection(a,y-f,-1),addSection(a,w-y,k),addInsert(h,a,b),f=w}}return m(e),p(!u),u}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let s=[],l=[];for(let a=0;a<e.length;a++){let h=e[a];if(typeof h=="number")s.push(h,-1);else{if(!Array.isArray(h)||typeof h[0]!="number"||h.some((f,u)=>u&&typeof f!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(h.length==1)s.push(h[0],0);else{for(;l.length<a;)l.push(Text.empty);l[a]=Text.of(h.slice(1)),s.push(h[0],l[a].length)}}}return new ChangeSet(s,l)}static createSet(e,s){return new ChangeSet(e,s)}}function addSection(o,e,s,l=!1){if(e==0&&s<=0)return;let a=o.length-2;a>=0&&s<=0&&s==o[a+1]?o[a]+=e:e==0&&o[a]==0?o[a+1]+=s:l?(o[a]+=e,o[a+1]+=s):o.push(e,s)}function addInsert(o,e,s){if(s.length==0)return;let l=e.length-2>>1;if(l<o.length)o[o.length-1]=o[o.length-1].append(s);else{for(;o.length<l;)o.push(Text.empty);o.push(s)}}function iterChanges(o,e,s){let l=o.inserted;for(let a=0,h=0,f=0;f<o.sections.length;){let u=o.sections[f++],p=o.sections[f++];if(p<0)a+=u,h+=u;else{let m=a,g=h,y=Text.empty;for(;m+=u,g+=p,p&&l&&(y=y.append(l[f-2>>1])),!(s||f==o.sections.length||o.sections[f+1]<0);)u=o.sections[f++],p=o.sections[f++];e(a,m,h,g,y),a=m,h=g}}}function mapSet(o,e,s,l=!1){let a=[],h=l?[]:null,f=new SectionIter(o),u=new SectionIter(e);for(let p=-1;;)if(f.ins==-1&&u.ins==-1){let m=Math.min(f.len,u.len);addSection(a,m,-1),f.forward(m),u.forward(m)}else if(u.ins>=0&&(f.ins<0||p==f.i||f.off==0&&(u.len<f.len||u.len==f.len&&!s))){let m=u.len;for(addSection(a,u.ins,-1);m;){let g=Math.min(f.len,m);f.ins>=0&&p<f.i&&f.len<=g&&(addSection(a,0,f.ins),h&&addInsert(h,a,f.text),p=f.i),f.forward(g),m-=g}u.next()}else if(f.ins>=0){let m=0,g=f.len;for(;g;)if(u.ins==-1){let y=Math.min(g,u.len);m+=y,g-=y,u.forward(y)}else if(u.ins==0&&u.len<g)g-=u.len,u.next();else break;addSection(a,m,p<f.i?f.ins:0),h&&p<f.i&&addInsert(h,a,f.text),p=f.i,f.forward(f.len-g)}else{if(f.done&&u.done)return h?ChangeSet.createSet(a,h):ChangeDesc.create(a);throw new Error("Mismatched change set lengths")}}function composeSets(o,e,s=!1){let l=[],a=s?[]:null,h=new SectionIter(o),f=new SectionIter(e);for(let u=!1;;){if(h.done&&f.done)return a?ChangeSet.createSet(l,a):ChangeDesc.create(l);if(h.ins==0)addSection(l,h.len,0,u),h.next();else if(f.len==0&&!f.done)addSection(l,0,f.ins,u),a&&addInsert(a,l,f.text),f.next();else{if(h.done||f.done)throw new Error("Mismatched change set lengths");{let p=Math.min(h.len2,f.len),m=l.length;if(h.ins==-1){let g=f.ins==-1?-1:f.off?0:f.ins;addSection(l,p,g,u),a&&g&&addInsert(a,l,f.text)}else f.ins==-1?(addSection(l,h.off?0:h.len,p,u),a&&addInsert(a,l,h.textBit(p))):(addSection(l,h.off?0:h.len,f.off?0:f.ins,u),a&&!f.off&&addInsert(a,l,f.text));u=(h.ins>p||f.ins>=0&&f.len>p)&&(u||l.length>m),h.forward2(p),f.forward(p)}}}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,s=this.i-2>>1;return s>=e.length?Text.empty:e[s]}textBit(e){let{inserted:s}=this.set,l=this.i-2>>1;return l>=s.length&&!e?Text.empty:s[l].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,s,l){this.from=e,this.to=s,this.flags=l}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,s=-1){let l,a;return this.empty?l=a=e.mapPos(this.from,s):(l=e.mapPos(this.from,1),a=e.mapPos(this.to,-1)),l==this.from&&a==this.to?this:new SelectionRange(l,a,this.flags)}extend(e,s=e){if(e<=this.anchor&&s>=this.anchor)return EditorSelection.range(e,s);let l=Math.abs(e-this.anchor)>Math.abs(s-this.anchor)?e:s;return EditorSelection.range(this.anchor,l)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,s,l){return new SelectionRange(e,s,l)}}class EditorSelection{constructor(e,s){this.ranges=e,this.mainIndex=s}map(e,s=-1){return e.empty?this:EditorSelection.create(this.ranges.map(l=>l.map(e,s)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let s=0;s<this.ranges.length;s++)if(!this.ranges[s].eq(e.ranges[s]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(e,s=!0){return EditorSelection.create([e].concat(this.ranges),s?0:this.mainIndex+1)}replaceRange(e,s=this.mainIndex){let l=this.ranges.slice();return l[s]=e,EditorSelection.create(l,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map(s=>SelectionRange.fromJSON(s)),e.main)}static single(e,s=e){return new EditorSelection([EditorSelection.range(e,s)],0)}static create(e,s=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let l=0,a=0;a<e.length;a++){let h=e[a];if(h.empty?h.from<=l:h.from<l)return EditorSelection.normalized(e.slice(),s);l=h.to}return new EditorSelection(e,s)}static cursor(e,s=0,l,a){return SelectionRange.create(e,e,(s==0?0:s<0?4:8)|(l==null?3:Math.min(2,l))|(a??33554431)<<5)}static range(e,s,l,a){let h=(l??33554431)<<5|(a==null?3:Math.min(2,a));return s<e?SelectionRange.create(s,e,24|h):SelectionRange.create(e,s,(s>e?4:0)|h)}static normalized(e,s=0){let l=e[s];e.sort((a,h)=>a.from-h.from),s=e.indexOf(l);for(let a=1;a<e.length;a++){let h=e[a],f=e[a-1];if(h.empty?h.from<=f.to:h.from<f.to){let u=f.from,p=Math.max(h.to,f.to);a<=s&&s--,e.splice(--a,2,h.anchor>h.head?EditorSelection.range(p,u):EditorSelection.range(u,p))}}return new EditorSelection(e,s)}}function checkSelection(o,e){for(let s of o.ranges)if(s.to>e)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,s,l,a,h){this.combine=e,this.compareInput=s,this.compare=l,this.isStatic=a,this.id=nextID++,this.default=e([]),this.extensions=typeof h=="function"?h(this):h}static define(e={}){return new Facet(e.combine||(s=>s),e.compareInput||((s,l)=>s===l),e.compare||(e.combine?(s,l)=>s===l:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,s){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,s)}computeN(e,s){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,s)}from(e,s){return s||(s=l=>l),this.compute([e],l=>s(l.field(e)))}}function sameArray$1(o,e){return o==e||o.length==e.length&&o.every((s,l)=>s===e[l])}class FacetProvider{constructor(e,s,l,a){this.dependencies=e,this.facet=s,this.type=l,this.value=a,this.id=nextID++}dynamicSlot(e){var s;let l=this.value,a=this.facet.compareInput,h=this.id,f=e[h]>>1,u=this.type==2,p=!1,m=!1,g=[];for(let y of this.dependencies)y=="doc"?p=!0:y=="selection"?m=!0:((s=e[y.id])!==null&&s!==void 0?s:1)&1||g.push(e[y.id]);return{create(y){return y.values[f]=l(y),1},update(y,w){if(p&&w.docChanged||m&&(w.docChanged||w.selection)||ensureAll(y,g)){let x=l(y);if(u?!compareArray(x,y.values[f],a):!a(x,y.values[f]))return y.values[f]=x,1}return 0},reconfigure:(y,w)=>{let x,b=w.config.address[h];if(b!=null){let k=getAddr(w,b);if(this.dependencies.every(S=>S instanceof Facet?w.facet(S)===y.facet(S):S instanceof StateField?w.field(S,!1)==y.field(S,!1):!0)||(u?compareArray(x=l(y),k,a):a(x=l(y),k)))return y.values[f]=k,0}else x=l(y);return y.values[f]=x,1}}}}function compareArray(o,e,s){if(o.length!=e.length)return!1;for(let l=0;l<o.length;l++)if(!s(o[l],e[l]))return!1;return!0}function ensureAll(o,e){let s=!1;for(let l of e)ensureAddr(o,l)&1&&(s=!0);return s}function dynamicFacetSlot(o,e,s){let l=s.map(p=>o[p.id]),a=s.map(p=>p.type),h=l.filter(p=>!(p&1)),f=o[e.id]>>1;function u(p){let m=[];for(let g=0;g<l.length;g++){let y=getAddr(p,l[g]);if(a[g]==2)for(let w of y)m.push(w);else m.push(y)}return e.combine(m)}return{create(p){for(let m of l)ensureAddr(p,m);return p.values[f]=u(p),1},update(p,m){if(!ensureAll(p,h))return 0;let g=u(p);return e.compare(g,p.values[f])?0:(p.values[f]=g,1)},reconfigure(p,m){let g=ensureAll(p,l),y=m.config.facets[e.id],w=m.facet(e);if(y&&!g&&sameArray$1(s,y))return p.values[f]=w,0;let x=u(p);return e.compare(x,w)?(p.values[f]=w,0):(p.values[f]=x,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,s,l,a,h){this.id=e,this.createF=s,this.updateF=l,this.compareF=a,this.spec=h,this.provides=void 0}static define(e){let s=new StateField(nextID++,e.create,e.update,e.compare||((l,a)=>l===a),e);return e.provide&&(s.provides=e.provide(s)),s}create(e){let s=e.facet(initField).find(l=>l.field==this);return((s==null?void 0:s.create)||this.createF)(e)}slot(e){let s=e[this.id]>>1;return{create:l=>(l.values[s]=this.create(l),1),update:(l,a)=>{let h=l.values[s],f=this.updateF(h,a);return this.compareF(h,f)?0:(l.values[s]=f,1)},reconfigure:(l,a)=>a.config.address[this.id]!=null?(l.values[s]=a.field(this),0):(l.values[s]=this.create(l),1)}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(o){return e=>new PrecExtension(e,o)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,s){this.inner=e,this.prec=s}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,s){this.compartment=e,this.inner=s}}class Configuration{constructor(e,s,l,a,h,f){for(this.base=e,this.compartments=s,this.dynamicSlots=l,this.address=a,this.staticValues=h,this.facets=f,this.statusTemplate=[];this.statusTemplate.length<l.length;)this.statusTemplate.push(0)}staticFacet(e){let s=this.address[e.id];return s==null?e.default:this.staticValues[s>>1]}static resolve(e,s,l){let a=[],h=Object.create(null),f=new Map;for(let w of flatten(e,s,f))w instanceof StateField?a.push(w):(h[w.facet.id]||(h[w.facet.id]=[])).push(w);let u=Object.create(null),p=[],m=[];for(let w of a)u[w.id]=m.length<<1,m.push(x=>w.slot(x));let g=l==null?void 0:l.config.facets;for(let w in h){let x=h[w],b=x[0].facet,k=g&&g[w]||[];if(x.every(S=>S.type==0))if(u[b.id]=p.length<<1|1,sameArray$1(k,x))p.push(l.facet(b));else{let S=b.combine(x.map(P=>P.value));p.push(l&&b.compare(S,l.facet(b))?l.facet(b):S)}else{for(let S of x)S.type==0?(u[S.id]=p.length<<1|1,p.push(S.value)):(u[S.id]=m.length<<1,m.push(P=>S.dynamicSlot(P)));u[b.id]=m.length<<1,m.push(S=>dynamicFacetSlot(S,b,x))}}let y=m.map(w=>w(u));return new Configuration(e,f,y,u,p,h)}}function flatten(o,e,s){let l=[[],[],[],[],[]],a=new Map;function h(f,u){let p=a.get(f);if(p!=null){if(p<=u)return;let m=l[p].indexOf(f);m>-1&&l[p].splice(m,1),f instanceof CompartmentInstance&&s.delete(f.compartment)}if(a.set(f,u),Array.isArray(f))for(let m of f)h(m,u);else if(f instanceof CompartmentInstance){if(s.has(f.compartment))throw new RangeError("Duplicate use of compartment in extensions");let m=e.get(f.compartment)||f.inner;s.set(f.compartment,m),h(m,u)}else if(f instanceof PrecExtension)h(f.inner,f.prec);else if(f instanceof StateField)l[u].push(f),f.provides&&h(f.provides,u);else if(f instanceof FacetProvider)l[u].push(f),f.facet.extensions&&h(f.facet.extensions,Prec_.default);else{let m=f.extension;if(!m)throw new Error(`Unrecognized extension value in extension set (${f}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);h(m,u)}}return h(o,Prec_.default),l.reduce((f,u)=>f.concat(u))}function ensureAddr(o,e){if(e&1)return 2;let s=e>>1,l=o.status[s];if(l==4)throw new Error("Cyclic dependency between fields and/or facets");if(l&2)return l;o.status[s]=4;let a=o.computeSlot(o,o.config.dynamicSlots[s]);return o.status[s]=2|a}function getAddr(o,e){return e&1?o.config.staticValues[e>>1]:o.values[e>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:o=>o.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:o=>o.length?o[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:o=>o.length?o[0]:!1});class Annotation{constructor(e,s){this.type=e,this.value=s}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,s){this.type=e,this.value=s}map(e){let s=this.type.map(this.value,e);return s===void 0?void 0:s==this.value?this:new StateEffect(this.type,s)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(s=>s))}static mapEffects(e,s){if(!e.length)return e;let l=[];for(let a of e){let h=a.map(s);h&&l.push(h)}return l}}StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,s,l,a,h,f){this.startState=e,this.changes=s,this.selection=l,this.effects=a,this.annotations=h,this.scrollIntoView=f,this._doc=null,this._state=null,l&&checkSelection(l,s.newLength),h.some(u=>u.type==Transaction.time)||(this.annotations=h.concat(Transaction.time.of(Date.now())))}static create(e,s,l,a,h,f){return new Transaction(e,s,l,a,h,f)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let s of this.annotations)if(s.type==e)return s.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let s=this.annotation(Transaction.userEvent);return!!(s&&(s==e||s.length>e.length&&s.slice(0,e.length)==e&&s[e.length]=="."))}}Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(o,e){let s=[];for(let l=0,a=0;;){let h,f;if(l<o.length&&(a==e.length||e[a]>=o[l]))h=o[l++],f=o[l++];else if(a<e.length)h=e[a++],f=e[a++];else return s;!s.length||s[s.length-1]<h?s.push(h,f):s[s.length-1]<f&&(s[s.length-1]=f)}}function mergeTransaction(o,e,s){var l;let a,h,f;return s?(a=e.changes,h=ChangeSet.empty(e.changes.length),f=o.changes.compose(e.changes)):(a=e.changes.map(o.changes),h=o.changes.mapDesc(e.changes,!0),f=o.changes.compose(a)),{changes:f,selection:e.selection?e.selection.map(h):(l=o.selection)===null||l===void 0?void 0:l.map(a),effects:StateEffect.mapEffects(o.effects,a).concat(StateEffect.mapEffects(e.effects,h)),annotations:o.annotations.length?o.annotations.concat(e.annotations):e.annotations,scrollIntoView:o.scrollIntoView||e.scrollIntoView}}function resolveTransactionInner(o,e,s){let l=e.selection,a=asArray$1(e.annotations);return e.userEvent&&(a=a.concat(Transaction.userEvent.of(e.userEvent))),{changes:e.changes instanceof ChangeSet?e.changes:ChangeSet.of(e.changes||[],s,o.facet(lineSeparator)),selection:l&&(l instanceof EditorSelection?l:EditorSelection.single(l.anchor,l.head)),effects:asArray$1(e.effects),annotations:a,scrollIntoView:!!e.scrollIntoView}}function resolveTransaction(o,e,s){let l=resolveTransactionInner(o,e.length?e[0]:{},o.doc.length);e.length&&e[0].filter===!1&&(s=!1);for(let h=1;h<e.length;h++){e[h].filter===!1&&(s=!1);let f=!!e[h].sequential;l=mergeTransaction(l,resolveTransactionInner(o,e[h],f?l.changes.newLength:o.doc.length),f)}let a=Transaction.create(o,l.changes,l.selection,l.effects,l.annotations,l.scrollIntoView);return extendTransaction(s?filterTransaction(a):a)}function filterTransaction(o){let e=o.startState,s=!0;for(let a of e.facet(changeFilter)){let h=a(o);if(h===!1){s=!1;break}Array.isArray(h)&&(s=s===!0?h:joinRanges(s,h))}if(s!==!0){let a,h;if(s===!1)h=o.changes.invertedDesc,a=ChangeSet.empty(e.doc.length);else{let f=o.changes.filter(s);a=f.changes,h=f.filtered.mapDesc(f.changes).invertedDesc}o=Transaction.create(e,a,o.selection&&o.selection.map(h),StateEffect.mapEffects(o.effects,h),o.annotations,o.scrollIntoView)}let l=e.facet(transactionFilter);for(let a=l.length-1;a>=0;a--){let h=l[a](o);h instanceof Transaction?o=h:Array.isArray(h)&&h.length==1&&h[0]instanceof Transaction?o=h[0]:o=resolveTransaction(e,asArray$1(h),!1)}return o}function extendTransaction(o){let e=o.startState,s=e.facet(transactionExtender),l=o;for(let a=s.length-1;a>=0;a--){let h=s[a](o);h&&Object.keys(h).length&&(l=mergeTransaction(l,resolveTransactionInner(e,h,o.changes.newLength),!0))}return l==o?o:Transaction.create(e,o.changes,o.selection,l.effects,l.annotations,l.scrollIntoView)}const none$2=[];function asArray$1(o){return o==null?none$2:Array.isArray(o)?o:[o]}var CharCategory=function(o){return o[o.Word=0]="Word",o[o.Space=1]="Space",o[o.Other=2]="Other",o}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hasWordChar(o){if(wordChar)return wordChar.test(o);for(let e=0;e<o.length;e++){let s=o[e];if(/\w/.test(s)||s>"Â€"&&(s.toUpperCase()!=s.toLowerCase()||nonASCIISingleCaseWordChar.test(s)))return!0}return!1}function makeCategorizer(o){return e=>{if(!/\S/.test(e))return CharCategory.Space;if(hasWordChar(e))return CharCategory.Word;for(let s=0;s<o.length;s++)if(e.indexOf(o[s])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,s,l,a,h,f){this.config=e,this.doc=s,this.selection=l,this.values=a,this.status=e.statusTemplate.slice(),this.computeSlot=h,f&&(f._state=this);for(let u=0;u<this.config.dynamicSlots.length;u++)ensureAddr(this,u<<1);this.computeSlot=null}field(e,s=!0){let l=this.config.address[e.id];if(l==null){if(s)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,l),getAddr(this,l)}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let s=this.config,{base:l,compartments:a}=s;for(let f of e.effects)f.is(Compartment.reconfigure)?(s&&(a=new Map,s.compartments.forEach((u,p)=>a.set(p,u)),s=null),a.set(f.value.compartment,f.value.extension)):f.is(StateEffect.reconfigure)?(s=null,l=f.value):f.is(StateEffect.appendConfig)&&(s=null,l=asArray$1(l).concat(f.value));let h;s?h=e.startState.values.slice():(s=Configuration.resolve(l,a,this),h=new EditorState(s,this.doc,this.selection,s.dynamicSlots.map(()=>null),(u,p)=>p.reconfigure(u,this),null).values),new EditorState(s,e.newDoc,e.newSelection,h,(f,u)=>u.update(f,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(s=>({changes:{from:s.from,to:s.to,insert:e},range:EditorSelection.cursor(s.from+e.length)}))}changeByRange(e){let s=this.selection,l=e(s.ranges[0]),a=this.changes(l.changes),h=[l.range],f=asArray$1(l.effects);for(let u=1;u<s.ranges.length;u++){let p=e(s.ranges[u]),m=this.changes(p.changes),g=m.map(a);for(let w=0;w<u;w++)h[w]=h[w].map(g);let y=a.mapDesc(m,!0);h.push(p.range.map(y)),a=a.compose(g),f=StateEffect.mapEffects(f,g).concat(StateEffect.mapEffects(asArray$1(p.effects),y))}return{changes:a,selection:EditorSelection.create(h,s.mainIndex),effects:f}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,s=this.doc.length){return this.doc.sliceString(e,s,this.lineBreak)}facet(e){let s=this.config.address[e.id];return s==null?e.default:(ensureAddr(this,s),getAddr(this,s))}toJSON(e){let s={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let l in e){let a=e[l];a instanceof StateField&&this.config.address[a.id]!=null&&(s[l]=a.spec.toJSON(this.field(e[l]),this))}return s}static fromJSON(e,s={},l){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let a=[];if(l){for(let h in l)if(Object.prototype.hasOwnProperty.call(e,h)){let f=l[h],u=e[h];a.push(f.init(p=>f.spec.fromJSON(u,p)))}}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:s.extensions?a.concat([s.extensions]):a})}static create(e={}){let s=Configuration.resolve(e.extensions||[],new Map),l=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(s.staticFacet(EditorState.lineSeparator)||DefaultSplit)),a=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(a,l.length),s.staticFacet(allowMultipleSelections)||(a=a.asSingle()),new EditorState(s,l,a,s.dynamicSlots.map(()=>null),(h,f)=>f.create(h),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(e,...s){for(let l of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(l,e)){e=l[e];break}return s.length&&(e=e.replace(/\$(\$|\d*)/g,(l,a)=>{if(a=="$")return"$";let h=+(a||1);return!h||h>s.length?l:s[h-1]})),e}languageDataAt(e,s,l=-1){let a=[];for(let h of this.facet(languageData))for(let f of h(this,s,l))Object.prototype.hasOwnProperty.call(f,e)&&a.push(f[e]);return a}charCategorizer(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:s,from:l,length:a}=this.doc.lineAt(e),h=this.charCategorizer(e),f=e-l,u=e-l;for(;f>0;){let p=findClusterBreak(s,f,!1);if(h(s.slice(p,f))!=CharCategory.Word)break;f=p}for(;u<a;){let p=findClusterBreak(s,u);if(h(s.slice(u,p))!=CharCategory.Word)break;u=p}return f==u?null:EditorSelection.range(f+l,u+l)}}EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:o=>o.length?o[0]:4});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare(o,e){let s=Object.keys(o),l=Object.keys(e);return s.length==l.length&&s.every(a=>o[a]==e[a])}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(o,e,s={}){let l={};for(let a of o)for(let h of Object.keys(a)){let f=a[h],u=l[h];if(u===void 0)l[h]=f;else if(!(u===f||f===void 0))if(Object.hasOwnProperty.call(s,h))l[h]=s[h](u,f);else throw new Error("Config merge conflict for field "+h)}for(let a in e)l[a]===void 0&&(l[a]=e[a]);return l}class RangeValue{eq(e){return this==e}range(e,s=e){return Range$1.create(e,s,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=!1;RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class J{constructor(e,s,l){this.from=e,this.to=s,this.value=l}static create(e,s,l){return new J(e,s,l)}};function cmpRange(o,e){return o.from-e.from||o.value.startSide-e.value.startSide}class Chunk{constructor(e,s,l,a){this.from=e,this.to=s,this.value=l,this.maxPoint=a}get length(){return this.to[this.to.length-1]}findIndex(e,s,l,a=0){let h=l?this.to:this.from;for(let f=a,u=h.length;;){if(f==u)return f;let p=f+u>>1,m=h[p]-e||(l?this.value[p].endSide:this.value[p].startSide)-s;if(p==f)return m>=0?f:u;m>=0?u=p:f=p+1}}between(e,s,l,a){for(let h=this.findIndex(s,-1e9,!0),f=this.findIndex(l,1e9,!1,h);h<f;h++)if(a(this.from[h]+e,this.to[h]+e,this.value[h])===!1)return!1}map(e,s){let l=[],a=[],h=[],f=-1,u=-1;for(let p=0;p<this.value.length;p++){let m=this.value[p],g=this.from[p]+e,y=this.to[p]+e,w,x;if(g==y){let b=s.mapPos(g,m.startSide,m.mapMode);if(b==null||(w=x=b,m.startSide!=m.endSide&&(x=s.mapPos(g,m.endSide),x<w)))continue}else if(w=s.mapPos(g,m.startSide),x=s.mapPos(y,m.endSide),w>x||w==x&&m.startSide>0&&m.endSide<=0)continue;(x-w||m.endSide-m.startSide)<0||(f<0&&(f=w),m.point&&(u=Math.max(u,x-w)),l.push(m),a.push(w-f),h.push(x-f))}return{mapped:l.length?new Chunk(a,h,l,u):null,pos:f}}}class RangeSet{constructor(e,s,l,a){this.chunkPos=e,this.chunk=s,this.nextLayer=l,this.maxPoint=a}static create(e,s,l,a){return new RangeSet(e,s,l,a)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let s of this.chunk)e+=s.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:s=[],sort:l=!1,filterFrom:a=0,filterTo:h=this.length}=e,f=e.filter;if(s.length==0&&!f)return this;if(l&&(s=s.slice().sort(cmpRange)),this.isEmpty)return s.length?RangeSet.of(s):this;let u=new LayerCursor(this,null,-1).goto(0),p=0,m=[],g=new RangeSetBuilder;for(;u.value||p<s.length;)if(p<s.length&&(u.from-s[p].from||u.startSide-s[p].value.startSide)>=0){let y=s[p++];g.addInner(y.from,y.to,y.value)||m.push(y)}else u.rangeIndex==1&&u.chunkIndex<this.chunk.length&&(p==s.length||this.chunkEnd(u.chunkIndex)<s[p].from)&&(!f||a>this.chunkEnd(u.chunkIndex)||h<this.chunkPos[u.chunkIndex])&&g.addChunk(this.chunkPos[u.chunkIndex],this.chunk[u.chunkIndex])?u.nextChunk():((!f||a>u.to||h<u.from||f(u.from,u.to,u.value))&&(g.addInner(u.from,u.to,u.value)||m.push(Range$1.create(u.from,u.to,u.value))),u.next());return g.finishInner(this.nextLayer.isEmpty&&!m.length?RangeSet.empty:this.nextLayer.update({add:m,filter:f,filterFrom:a,filterTo:h}))}map(e){if(e.empty||this.isEmpty)return this;let s=[],l=[],a=-1;for(let f=0;f<this.chunk.length;f++){let u=this.chunkPos[f],p=this.chunk[f],m=e.touchesRange(u,u+p.length);if(m===!1)a=Math.max(a,p.maxPoint),s.push(p),l.push(e.mapPos(u));else if(m===!0){let{mapped:g,pos:y}=p.map(u,e);g&&(a=Math.max(a,g.maxPoint),s.push(g),l.push(y))}}let h=this.nextLayer.map(e);return s.length==0?h:new RangeSet(l,s,h||RangeSet.empty,a)}between(e,s,l){if(!this.isEmpty){for(let a=0;a<this.chunk.length;a++){let h=this.chunkPos[a],f=this.chunk[a];if(s>=h&&e<=h+f.length&&f.between(h,e-h,s-h,l)===!1)return}this.nextLayer.between(e,s,l)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,s=0){return HeapCursor.from(e).goto(s)}static compare(e,s,l,a,h=-1){let f=e.filter(y=>y.maxPoint>0||!y.isEmpty&&y.maxPoint>=h),u=s.filter(y=>y.maxPoint>0||!y.isEmpty&&y.maxPoint>=h),p=findSharedChunks(f,u,l),m=new SpanCursor(f,p,h),g=new SpanCursor(u,p,h);l.iterGaps((y,w,x)=>compare(m,y,g,w,x,a)),l.empty&&l.length==0&&compare(m,0,g,0,0,a)}static eq(e,s,l=0,a){a==null&&(a=1e9-1);let h=e.filter(g=>!g.isEmpty&&s.indexOf(g)<0),f=s.filter(g=>!g.isEmpty&&e.indexOf(g)<0);if(h.length!=f.length)return!1;if(!h.length)return!0;let u=findSharedChunks(h,f),p=new SpanCursor(h,u,0).goto(l),m=new SpanCursor(f,u,0).goto(l);for(;;){if(p.to!=m.to||!sameValues(p.active,m.active)||p.point&&(!m.point||!p.point.eq(m.point)))return!1;if(p.to>a)return!0;p.next(),m.next()}}static spans(e,s,l,a,h=-1){let f=new SpanCursor(e,null,h).goto(s),u=s,p=f.openStart;for(;;){let m=Math.min(f.to,l);if(f.point){let g=f.activeForPoint(f.to),y=f.pointFrom<s?g.length+1:Math.min(g.length,p);a.point(u,m,f.point,g,y,f.pointRank),p=Math.min(f.openEnd(m),g.length)}else m>u&&(a.span(u,m,f.active,p),p=f.openEnd(m));if(f.to>l)return p+(f.point&&f.to>l?1:0);u=f.to,f.next()}}static of(e,s=!1){let l=new RangeSetBuilder;for(let a of e instanceof Range$1?[e]:s?lazySort(e):e)l.add(a.from,a.to,a.value);return l.finish()}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(o){if(o.length>1)for(let e=o[0],s=1;s<o.length;s++){let l=o[s];if(cmpRange(e,l)>0)return o.slice().sort(cmpRange);e=l}return o}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,s,l){this.addInner(e,s,l)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,s,l)}addInner(e,s,l){let a=e-this.lastTo||l.startSide-this.last.endSide;if(a<=0&&(e-this.lastFrom||l.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return a<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(s-this.chunkStart),this.last=l,this.lastFrom=e,this.lastTo=s,this.value.push(l),l.point&&(this.maxPoint=Math.max(this.maxPoint,s-e)),!0)}addChunk(e,s){if((e-this.lastTo||s.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,s.maxPoint),this.chunks.push(s),this.chunkPos.push(e);let l=s.value.length-1;return this.last=s.value[l],this.lastFrom=s.from[l]+e,this.lastTo=s.to[l]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let s=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,s}}function findSharedChunks(o,e,s){let l=new Map;for(let h of o)for(let f=0;f<h.chunk.length;f++)h.chunk[f].maxPoint<=0&&l.set(h.chunk[f],h.chunkPos[f]);let a=new Set;for(let h of e)for(let f=0;f<h.chunk.length;f++){let u=l.get(h.chunk[f]);u!=null&&(s?s.mapPos(u):u)==h.chunkPos[f]&&!(s!=null&&s.touchesRange(u,u+h.chunk[f].length))&&a.add(h.chunk[f])}return a}class LayerCursor{constructor(e,s,l,a=0){this.layer=e,this.skip=s,this.minPoint=l,this.rank=a}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,s=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,s,!1),this}gotoInner(e,s,l){for(;this.chunkIndex<this.layer.chunk.length;){let a=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(a)||this.layer.chunkEnd(this.chunkIndex)<e||a.maxPoint<this.minPoint))break;this.chunkIndex++,l=!1}if(this.chunkIndex<this.layer.chunk.length){let a=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],s,!0);(!l||this.rangeIndex<a)&&this.setRangeIndex(a)}this.next()}forward(e,s){(this.to-e||this.endSide-s)<0&&this.gotoInner(e,s,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],s=this.layer.chunk[this.chunkIndex],l=e+s.from[this.rangeIndex];if(this.from=l,this.to=e+s.to[this.rangeIndex],this.value=s.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,s=null,l=-1){let a=[];for(let h=0;h<e.length;h++)for(let f=e[h];!f.isEmpty;f=f.nextLayer)f.maxPoint>=l&&a.push(new LayerCursor(f,s,l,h));return a.length==1?a[0]:new HeapCursor(a)}get startSide(){return this.value?this.value.startSide:0}goto(e,s=-1e9){for(let l of this.heap)l.goto(e,s);for(let l=this.heap.length>>1;l>=0;l--)heapBubble(this.heap,l);return this.next(),this}forward(e,s){for(let l of this.heap)l.forward(e,s);for(let l=this.heap.length>>1;l>=0;l--)heapBubble(this.heap,l);(this.to-e||this.value.endSide-s)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(o,e){for(let s=o[e];;){let l=(e<<1)+1;if(l>=o.length)break;let a=o[l];if(l+1<o.length&&a.compare(o[l+1])>=0&&(a=o[l+1],l++),s.compare(a)<0)break;o[l]=s,o[e]=a,e=l}}class SpanCursor{constructor(e,s,l){this.minPoint=l,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,s,l)}goto(e,s=-1e9){return this.cursor.goto(e,s),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=s,this.openStart=-1,this.next(),this}forward(e,s){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-s)<0;)this.removeActive(this.minActive);this.cursor.forward(e,s)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let s=0,{value:l,to:a,rank:h}=this.cursor;for(;s<this.activeRank.length&&this.activeRank[s]<=h;)s++;insert(this.active,s,l),insert(this.activeTo,s,a),insert(this.activeRank,s,h),e&&insert(e,s,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,s=this.point;this.point=null;let l=this.openStart<0?[]:null;for(;;){let a=this.minActive;if(a>-1&&(this.activeTo[a]-this.cursor.from||this.active[a].endSide-this.cursor.startSide)<0){if(this.activeTo[a]>e){this.to=this.activeTo[a],this.endSide=this.active[a].endSide;break}this.removeActive(a),l&&remove(l,a)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let h=this.cursor.value;if(!h.point)this.addActive(l),this.cursor.next();else if(s&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=h,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=h.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(l){this.openStart=0;for(let a=l.length-1;a>=0&&l[a]<e;a--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let s=[];for(let l=this.active.length-1;l>=0&&!(this.activeRank[l]<this.pointRank);l--)(this.activeTo[l]>e||this.activeTo[l]==e&&this.active[l].endSide>=this.point.endSide)&&s.push(this.active[l]);return s.reverse()}openEnd(e){let s=0;for(let l=this.activeTo.length-1;l>=0&&this.activeTo[l]>e;l--)s++;return s}}function compare(o,e,s,l,a,h){o.goto(e),s.goto(l);let f=l+a,u=l,p=l-e;for(;;){let m=o.to+p-s.to||o.endSide-s.endSide,g=m<0?o.to+p:s.to,y=Math.min(g,f);if(o.point||s.point?o.point&&s.point&&(o.point==s.point||o.point.eq(s.point))&&sameValues(o.activeForPoint(o.to),s.activeForPoint(s.to))||h.comparePoint(u,y,o.point,s.point):y>u&&!sameValues(o.active,s.active)&&h.compareRange(u,y,o.active,s.active),g>f)break;u=g,m<=0&&o.next(),m>=0&&s.next()}}function sameValues(o,e){if(o.length!=e.length)return!1;for(let s=0;s<o.length;s++)if(o[s]!=e[s]&&!o[s].eq(e[s]))return!1;return!0}function remove(o,e){for(let s=e,l=o.length-1;s<l;s++)o[s]=o[s+1];o.pop()}function insert(o,e,s){for(let l=o.length-1;l>=e;l--)o[l+1]=o[l];o[e]=s}function findMinIndex(o,e){let s=-1,l=1e9;for(let a=0;a<e.length;a++)(e[a]-l||o[a].endSide-o[s].endSide)<0&&(s=a,l=e[a]);return s}function countColumn(o,e,s=o.length){let l=0;for(let a=0;a<s;)o.charCodeAt(a)==9?(l+=e-l%e,a++):(l++,a=findClusterBreak(o,a));return l}function findColumn(o,e,s,l){for(let a=0,h=0;;){if(h>=e)return a;if(a==o.length)break;h+=o.charCodeAt(a)==9?s-h%s:1,a=findClusterBreak(o,a)}return l===!0?-1:o.length}const C="Í¼",COUNT=typeof Symbol>"u"?"__"+C:Symbol.for(C),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(e,s){this.rules=[];let{finish:l}=s||{};function a(f){return/^@/.test(f)?[f]:f.split(/,\s*/)}function h(f,u,p,m){let g=[],y=/^@(\w+)\b/.exec(f[0]),w=y&&y[1]=="keyframes";if(y&&u==null)return p.push(f[0]+";");for(let x in u){let b=u[x];if(/&/.test(x))h(x.split(/,\s*/).map(k=>f.map(S=>k.replace(/&/,S))).reduce((k,S)=>k.concat(S)),b,p);else if(b&&typeof b=="object"){if(!y)throw new RangeError("The value of a property ("+x+") should be a primitive value.");h(a(x),b,g,w)}else b!=null&&g.push(x.replace(/_.*/,"").replace(/[A-Z]/g,k=>"-"+k.toLowerCase())+": "+b+";")}(g.length||w)&&p.push((l&&!y&&!m?f.map(l):f).join(", ")+" {"+g.join(" ")+"}")}for(let f in e)h(a(f),e[f],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C+e.toString(36)}static mount(e,s,l){let a=e[SET],h=l&&l.nonce;a?h&&a.setNonce(h):a=new StyleSet(e,h),a.mount(Array.isArray(s)?s:[s])}}let adoptedSet=new Map;class StyleSet{constructor(e,s){let l=e.ownerDocument||e,a=l.defaultView;if(!e.head&&e.adoptedStyleSheets&&a.CSSStyleSheet){let h=adoptedSet.get(l);if(h)return e.adoptedStyleSheets=[h.sheet,...e.adoptedStyleSheets],e[SET]=h;this.sheet=new a.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],adoptedSet.set(l,this)}else{this.styleTag=l.createElement("style"),s&&this.styleTag.setAttribute("nonce",s);let h=e.head||e;h.insertBefore(this.styleTag,h.firstChild)}this.modules=[],e[SET]=this}mount(e){let s=this.sheet,l=0,a=0;for(let h=0;h<e.length;h++){let f=e[h],u=this.modules.indexOf(f);if(u<a&&u>-1&&(this.modules.splice(u,1),a--,u=-1),u==-1){if(this.modules.splice(a++,0,f),s)for(let p=0;p<f.rules.length;p++)s.insertRule(f.rules[p],l++)}else{for(;a<u;)l+=this.modules[a++].rules.length;l+=f.rules.length,a++}}if(!s){let h="";for(let f=0;f<this.modules.length;f++)h+=this.modules[f].getRules()+`
`;this.styleTag.textContent=h}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i$1=0;i$1<10;i$1++)base[48+i$1]=base[96+i$1]=String(i$1);for(var i$1=1;i$1<=24;i$1++)base[i$1+111]="F"+i$1;for(var i$1=65;i$1<=90;i$1++)base[i$1]=String.fromCharCode(i$1+32),shift[i$1]=String.fromCharCode(i$1);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(o){var e=mac&&o.metaKey&&o.shiftKey&&!o.ctrlKey&&!o.altKey||ie$1&&o.shiftKey&&o.key&&o.key.length==1||o.key=="Unidentified",s=!e&&o.key||(o.shiftKey?shift:base)[o.keyCode]||o.key||"Unidentified";return s=="Esc"&&(s="Escape"),s=="Del"&&(s="Delete"),s=="Left"&&(s="ArrowLeft"),s=="Up"&&(s="ArrowUp"),s=="Right"&&(s="ArrowRight"),s=="Down"&&(s="ArrowDown"),s}function getSelection(o){let e;return o.nodeType==11?e=o.getSelection?o:o.ownerDocument:e=o,e.getSelection()}function contains(o,e){return e?o==e||o.contains(e.nodeType!=1?e.parentNode:e):!1}function deepActiveElement(o){let e=o.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function hasSelection(o,e){if(!e.anchorNode)return!1;try{return contains(o,e.anchorNode)}catch{return!1}}function clientRectsFor(o){return o.nodeType==3?textRange(o,0,o.nodeValue.length).getClientRects():o.nodeType==1?o.getClientRects():[]}function isEquivalentPosition(o,e,s,l){return s?scanFor(o,e,s,l,-1)||scanFor(o,e,s,l,1):!1}function domIndex(o){for(var e=0;;e++)if(o=o.previousSibling,!o)return e}function scanFor(o,e,s,l,a){for(;;){if(o==s&&e==l)return!0;if(e==(a<0?0:maxOffset(o))){if(o.nodeName=="DIV")return!1;let h=o.parentNode;if(!h||h.nodeType!=1)return!1;e=domIndex(o)+(a<0?0:1),o=h}else if(o.nodeType==1){if(o=o.childNodes[e+(a<0?-1:0)],o.nodeType==1&&o.contentEditable=="false")return!1;e=a<0?maxOffset(o):0}else return!1}}function maxOffset(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function flattenRect(o,e){let s=e?o.left:o.right;return{left:s,right:s,top:o.top,bottom:o.bottom}}function windowRect(o){return{left:0,right:o.innerWidth,top:0,bottom:o.innerHeight}}function scrollRectIntoView(o,e,s,l,a,h,f,u){let p=o.ownerDocument,m=p.defaultView||window;for(let g=o,y=!1;g&&!y;)if(g.nodeType==1){let w,x=g==p.body,b=1,k=1;if(x)w=windowRect(m);else{if(/^(fixed|sticky)$/.test(getComputedStyle(g).position)&&(y=!0),g.scrollHeight<=g.clientHeight&&g.scrollWidth<=g.clientWidth){g=g.assignedSlot||g.parentNode;continue}let E=g.getBoundingClientRect();b=E.width/g.offsetWidth,k=E.height/g.offsetHeight,w={left:E.left,right:E.left+g.clientWidth*b,top:E.top,bottom:E.top+g.clientHeight*k}}let S=0,P=0;if(a=="nearest")e.top<w.top?(P=-(w.top-e.top+f),s>0&&e.bottom>w.bottom+P&&(P=e.bottom-w.bottom+P+f)):e.bottom>w.bottom&&(P=e.bottom-w.bottom+f,s<0&&e.top-P<w.top&&(P=-(w.top+P-e.top+f)));else{let E=e.bottom-e.top,R=w.bottom-w.top;P=(a=="center"&&E<=R?e.top+E/2-R/2:a=="start"||a=="center"&&s<0?e.top-f:e.bottom-R+f)-w.top}if(l=="nearest"?e.left<w.left?(S=-(w.left-e.left+h),s>0&&e.right>w.right+S&&(S=e.right-w.right+S+h)):e.right>w.right&&(S=e.right-w.right+h,s<0&&e.left<w.left+S&&(S=-(w.left+S-e.left+h))):S=(l=="center"?e.left+(e.right-e.left)/2-(w.right-w.left)/2:l=="start"==u?e.left-h:e.right-(w.right-w.left)+h)-w.left,S||P)if(x)m.scrollBy(S,P);else{let E=0,R=0;if(P){let O=g.scrollTop;g.scrollTop+=P/k,R=(g.scrollTop-O)*k}if(S){let O=g.scrollLeft;g.scrollLeft+=S/b,E=(g.scrollLeft-O)*b}e={left:e.left-E,top:e.top-R,right:e.right-E,bottom:e.bottom-R},E&&Math.abs(E-S)<1&&(l="nearest"),R&&Math.abs(R-P)<1&&(a="nearest")}if(x)break;g=g.assignedSlot||g.parentNode}else if(g.nodeType==11)g=g.host;else break}function scrollableParent(o){let e=o.ownerDocument;for(let s=o.parentNode;s&&s!=e.body;)if(s.nodeType==1){if(s.scrollHeight>s.clientHeight||s.scrollWidth>s.clientWidth)return s;s=s.assignedSlot||s.parentNode}else if(s.nodeType==11)s=s.host;else break;return null}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:s,focusNode:l}=e;this.set(s,Math.min(e.anchorOffset,s?maxOffset(s):0),l,Math.min(e.focusOffset,l?maxOffset(l):0))}set(e,s,l,a){this.anchorNode=e,this.anchorOffset=s,this.focusNode=l,this.focusOffset=a}}let preventScrollSupported=null;function focusPreventScroll(o){if(o.setActive)return o.setActive();if(preventScrollSupported)return o.focus(preventScrollSupported);let e=[];for(let s=o;s&&(e.push(s,s.scrollTop,s.scrollLeft),s!=s.ownerDocument);s=s.parentNode);if(o.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let s=0;s<e.length;){let l=e[s++],a=e[s++],h=e[s++];l.scrollTop!=a&&(l.scrollTop=a),l.scrollLeft!=h&&(l.scrollLeft=h)}}}let scratchRange;function textRange(o,e,s=e){let l=scratchRange||(scratchRange=document.createRange());return l.setEnd(o,s),l.setStart(o,e),l}function dispatchKey(o,e,s){let l={key:e,code:e,keyCode:s,which:s,cancelable:!0},a=new KeyboardEvent("keydown",l);a.synthetic=!0,o.dispatchEvent(a);let h=new KeyboardEvent("keyup",l);return h.synthetic=!0,o.dispatchEvent(h),a.defaultPrevented||h.defaultPrevented}function getRoot(o){for(;o;){if(o&&(o.nodeType==9||o.nodeType==11&&o.host))return o;o=o.assignedSlot||o.parentNode}return null}function clearAttributes(o){for(;o.attributes.length;)o.removeAttributeNode(o.attributes[0])}function atElementStart(o,e){let s=e.focusNode,l=e.focusOffset;if(!s||e.anchorNode!=s||e.anchorOffset!=l)return!1;for(l=Math.min(l,maxOffset(s));;)if(l){if(s.nodeType!=1)return!1;let a=s.childNodes[l-1];a.contentEditable=="false"?l--:(s=a,l=maxOffset(s))}else{if(s==o)return!0;l=domIndex(s),s=s.parentNode}}function isScrolledToBottom(o){return o.scrollTop>Math.max(1,o.scrollHeight-o.clientHeight-4)}class DOMPos{constructor(e,s,l=!0){this.node=e,this.offset=s,this.precise=l}static before(e,s){return new DOMPos(e.parentNode,domIndex(e),s)}static after(e,s){return new DOMPos(e.parentNode,domIndex(e)+1,s)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let s=this.posAtStart;for(let l of this.children){if(l==e)return s;s+=l.length+l.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,s){if(this.flags&2){let l=this.dom,a=null,h;for(let f of this.children){if(f.flags&7){if(!f.dom&&(h=a?a.nextSibling:l.firstChild)){let u=ContentView.get(h);(!u||!u.parent&&u.canReuseDOM(f))&&f.reuseDOM(h)}f.sync(e,s),f.flags&=-8}if(h=a?a.nextSibling:l.firstChild,s&&!s.written&&s.node==l&&h!=f.dom&&(s.written=!0),f.dom.parentNode==l)for(;h&&h!=f.dom;)h=rm$1(h);else l.insertBefore(f.dom,h);a=f.dom}for(h=a?a.nextSibling:l.firstChild,h&&s&&s.node==l&&(s.written=!0);h;)h=rm$1(h)}else if(this.flags&1)for(let l of this.children)l.flags&7&&(l.sync(e,s),l.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,s){let l;if(e==this.dom)l=this.dom.childNodes[s];else{let a=maxOffset(e)==0?0:s==0?-1:1;for(;;){let h=e.parentNode;if(h==this.dom)break;a==0&&h.firstChild!=h.lastChild&&(e==h.firstChild?a=-1:a=1),e=h}a<0?l=e:l=e.nextSibling}if(l==this.dom.firstChild)return 0;for(;l&&!ContentView.get(l);)l=l.nextSibling;if(!l)return this.length;for(let a=0,h=0;;a++){let f=this.children[a];if(f.dom==l)return h;h+=f.length+f.breakAfter}}domBoundsAround(e,s,l=0){let a=-1,h=-1,f=-1,u=-1;for(let p=0,m=l,g=l;p<this.children.length;p++){let y=this.children[p],w=m+y.length;if(m<e&&w>s)return y.domBoundsAround(e,s,m);if(w>=e&&a==-1&&(a=p,h=m),m>s&&y.dom.parentNode==this.dom){f=p,u=g;break}g=w,m=w+y.breakAfter}return{from:h,to:u<0?l+this.length:u,startDOM:(a?this.children[a-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:f<this.children.length&&f>=0?this.children[f].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let s=this.parent;s;s=s.parent){if(e&&(s.flags|=2),s.flags&1)return;s.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let s=e.parent;if(!s)return e;e=s}}replaceChildren(e,s,l=noChildren){this.markDirty();for(let a=e;a<s;a++){let h=this.children[a];h.parent==this&&h.destroy()}this.children.splice(e,s-e,...l);for(let a=0;a<l.length;a++)l[a].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,s=1){return this.childCursor().findPos(e,s)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,s,l,a,h,f){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){this.parent=null}}ContentView.prototype.breakAfter=0;function rm$1(o){let e=o.nextSibling;return o.parentNode.removeChild(o),e}class ChildCursor{constructor(e,s,l){this.children=e,this.pos=s,this.i=l,this.off=0}findPos(e,s=1){for(;;){if(e>this.pos||e==this.pos&&(s>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let l=this.children[--this.i];this.pos-=l.length+l.breakAfter}}}function replaceRange(o,e,s,l,a,h,f,u,p){let{children:m}=o,g=m.length?m[e]:null,y=h.length?h[h.length-1]:null,w=y?y.breakAfter:f;if(!(e==l&&g&&!f&&!w&&h.length<2&&g.merge(s,a,h.length?y:null,s==0,u,p))){if(l<m.length){let x=m[l];x&&a<x.length?(e==l&&(x=x.split(a),a=0),!w&&y&&x.merge(0,a,y,!0,0,p)?h[h.length-1]=x:(a&&x.merge(0,a,null,!1,0,p),h.push(x))):x!=null&&x.breakAfter&&(y?y.breakAfter=1:f=1),l++}for(g&&(g.breakAfter=f,s>0&&(!f&&h.length&&g.merge(s,g.length,h[0],!1,u,0)?g.breakAfter=h.shift().breakAfter:(s<g.length||g.children.length&&g.children[g.children.length-1].length==0)&&g.merge(s,g.length,null,!1,u,0),e++));e<l&&h.length;)if(m[l-1].become(h[h.length-1]))l--,h.pop(),p=h.length?0:u;else if(m[e].become(h[0]))e++,h.shift(),u=h.length?0:p;else break;!h.length&&e&&l<m.length&&!m[e-1].breakAfter&&m[l].merge(0,0,m[e-1],!1,u,p)&&e--,(e<l||h.length)&&o.replaceChildren(e,l,h)}}function mergeChildrenInto(o,e,s,l,a,h){let f=o.childCursor(),{i:u,off:p}=f.findPos(s,1),{i:m,off:g}=f.findPos(e,-1),y=e-s;for(let w of l)y+=w.length;o.length+=y,replaceRange(o,m,g,u,p,l,0,a,h)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,s){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(s&&s.node==this.dom&&(s.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,s,l){return this.flags&8||l&&(!(l instanceof TextView)||this.length-(s-e)+l.length>MaxJoinLen||l.flags&8)?!1:(this.text=this.text.slice(0,e)+(l?l.text:"")+this.text.slice(s),this.markDirty(),!0)}split(e){let s=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),s.flags|=this.flags&8,s}localPosFromDOM(e,s){return e==this.dom?s:s?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,s,l){return{from:l,to:l+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,s){return textCoords(this.dom,e,s)}}class MarkView extends ContentView{constructor(e,s=[],l=0){super(),this.mark=e,this.children=s,this.length=l;for(let a of s)a.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let s in this.mark.attrs)e.setAttribute(s,this.mark.attrs[s]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,s){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,s)}merge(e,s,l,a,h,f){return l&&(!(l instanceof MarkView&&l.mark.eq(this.mark))||e&&h<=0||s<this.length&&f<=0)?!1:(mergeChildrenInto(this,e,s,l?l.children:[],h-1,f-1),this.markDirty(),!0)}split(e){let s=[],l=0,a=-1,h=0;for(let u of this.children){let p=l+u.length;p>e&&s.push(l<e?u.split(e-l):u),a<0&&l>=e&&(a=h),l=p,h++}let f=this.length-e;return this.length=e,a>-1&&(this.children.length=a,this.markDirty()),new MarkView(this.mark,s,f)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,s){return coordsInChildren(this,e,s)}}function textCoords(o,e,s){let l=o.nodeValue.length;e>l&&(e=l);let a=e,h=e,f=0;e==0&&s<0||e==l&&s>=0?browser.chrome||browser.gecko||(e?(a--,f=1):h<l&&(h++,f=-1)):s<0?a--:h<l&&h++;let u=textRange(o,a,h).getClientRects();if(!u.length)return null;let p=u[(f?f<0:s>=0)?0:u.length-1];return browser.safari&&!f&&p.width==0&&(p=Array.prototype.find.call(u,m=>m.width)||p),f?flattenRect(p,f<0):p||null}class WidgetView extends ContentView{static create(e,s,l){return new WidgetView(e,s,l)}constructor(e,s,l){super(),this.widget=e,this.length=s,this.side=l,this.prevWidget=null}split(e){let s=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,s}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,s,l,a,h,f){return l&&(!(l instanceof WidgetView)||!this.widget.compare(l.widget)||e>0&&h<=0||s<this.length&&f<=0)?!1:(this.length=e+(l?l.length:0)+(this.length-s),!0)}become(e){return e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let{view:s}=e,l=s&&s.state.doc,a=this.posAtStart;return l?l.slice(a,a+this.length):Text.empty}domAtPos(e){return(this.length?e==0:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,s){let l=this.widget.coordsAt(this.dom,e,s);if(l)return l;let a=this.dom.getClientRects(),h=null;if(!a.length)return null;let f=this.side?this.side<0:e>0;for(let u=f?a.length-1:0;h=a[u],!(e>0?u==0:u==a.length-1||h.top<h.bottom);u+=f?-1:1);return flattenRect(h,!f)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineDOMAtPos(o,e){let s=o.dom,{children:l}=o,a=0;for(let h=0;a<l.length;a++){let f=l[a],u=h+f.length;if(!(u==h&&f.getSide()<=0)){if(e>h&&e<u&&f.dom.parentNode==s)return f.domAtPos(e-h);if(e<=h)break;h=u}}for(let h=a;h>0;h--){let f=l[h-1];if(f.dom.parentNode==s)return f.domAtPos(f.length)}for(let h=a;h<l.length;h++){let f=l[h];if(f.dom.parentNode==s)return f.domAtPos(0)}return new DOMPos(s,0)}function joinInlineInto(o,e,s){let l,{children:a}=o;s>0&&e instanceof MarkView&&a.length&&(l=a[a.length-1])instanceof MarkView&&l.mark.eq(e.mark)?joinInlineInto(l,e.children[0],s-1):(a.push(e),e.setParent(o)),o.length+=e.length}function coordsInChildren(o,e,s){let l=null,a=-1,h=null,f=-1;function u(m,g){for(let y=0,w=0;y<m.children.length&&w<=g;y++){let x=m.children[y],b=w+x.length;b>=g&&(x.children.length?u(x,g-w):(!h||h.isHidden&&s>0)&&(b>g||w==b&&x.getSide()>0)?(h=x,f=g-w):(w<g||w==b&&x.getSide()<0&&!x.isHidden)&&(l=x,a=g-w)),w=b}}u(o,e);let p=(s<0?l:h)||l||h;return p?p.coordsAt(Math.max(0,p==l?a:f),s):fallbackRect(o)}function fallbackRect(o){let e=o.dom.lastChild;if(!e)return o.dom.getBoundingClientRect();let s=clientRectsFor(e);return s[s.length-1]||null}function combineAttrs(o,e){for(let s in o)s=="class"&&e.class?e.class+=" "+o.class:s=="style"&&e.style?e.style+=";"+o.style:e[s]=o[s];return e}const noAttrs=Object.create(null);function attrsEq(o,e,s){if(o==e)return!0;o||(o=noAttrs),e||(e=noAttrs);let l=Object.keys(o),a=Object.keys(e);if(l.length-(s&&l.indexOf(s)>-1?1:0)!=a.length-(s&&a.indexOf(s)>-1?1:0))return!1;for(let h of l)if(h!=s&&(a.indexOf(h)==-1||o[h]!==e[h]))return!1;return!0}function updateAttrs(o,e,s){let l=!1;if(e)for(let a in e)s&&a in s||(l=!0,a=="style"?o.style.cssText="":o.removeAttribute(a));if(s)for(let a in s)e&&e[a]==s[a]||(l=!0,a=="style"?o.style.cssText=s[a]:o.setAttribute(a,s[a]));return l}function getAttrs(o){let e=Object.create(null);for(let s=0;s<o.attributes.length;s++){let l=o.attributes[s];e[l.name]=l.value}return e}class WidgetType{eq(e){return!1}updateDOM(e,s){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,s,l){return null}get isHidden(){return!1}destroy(e){}}var BlockType=function(o){return o[o.Text=0]="Text",o[o.WidgetBefore=1]="WidgetBefore",o[o.WidgetAfter=2]="WidgetAfter",o[o.WidgetRange=3]="WidgetRange",o}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,s,l,a){super(),this.startSide=e,this.endSide=s,this.widget=l,this.spec=a}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let s=Math.max(-1e4,Math.min(1e4,e.side||0)),l=!!e.block;return s+=l&&!e.inlineOrder?s>0?3e8:-4e8:s>0?1e8:-1e8,new PointDecoration(e,s,s,l,e.widget||null,!1)}static replace(e){let s=!!e.block,l,a;if(e.isBlockGap)l=-5e8,a=4e8;else{let{start:h,end:f}=getInclusive(e,s);l=(h?s?-3e8:-1:5e8)-1,a=(f?s?2e8:1:-6e8)+1}return new PointDecoration(e,l,a,s,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,s=!1){return RangeSet.of(e,s)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:s,end:l}=getInclusive(e);super(s?-1:5e8,l?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var s,l;return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&(this.class||((s=this.attrs)===null||s===void 0?void 0:s.class))==(e.class||((l=e.attrs)===null||l===void 0?void 0:l.class))&&attrsEq(this.attrs,e.attrs,"class")}range(e,s=e){if(e>=s)throw new RangeError("Mark decorations may not be empty");return super.range(e,s)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,s=e){if(s!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,s)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,s,l,a,h,f){super(s,l,h,e),this.block=a,this.isReplace=f,this.mapMode=a?s<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,s=e){if(this.isReplace&&(e>s||e==s&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&s!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,s)}}PointDecoration.prototype.point=!0;function getInclusive(o,e=!1){let{inclusiveStart:s,inclusiveEnd:l}=o;return s==null&&(s=o.inclusive),l==null&&(l=o.inclusive),{start:s??e,end:l??e}}function widgetsEq(o,e){return o==e||!!(o&&e&&o.compare(e))}function addRange(o,e,s,l=0){let a=s.length-1;a>=0&&s[a]+l>=o?s[a]=Math.max(s[a],e):s.push(o,e)}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,s,l,a,h,f){if(l){if(!(l instanceof LineView))return!1;this.dom||l.transferDOM(this)}return a&&this.setDeco(l?l.attrs:null),mergeChildrenInto(this,e,s,l?l.children:[],h,f),!0}split(e){let s=new LineView;if(s.breakAfter=this.breakAfter,this.length==0)return s;let{i:l,off:a}=this.childPos(e);a&&(s.append(this.children[l].split(a),0),this.children[l].merge(a,this.children[l].length,null,!1,0,0),l++);for(let h=l;h<this.children.length;h++)s.append(this.children[h],0);for(;l>0&&this.children[l-1].length==0;)this.children[--l].destroy();return this.children.length=l,this.markDirty(),this.length=e,s}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,s){joinInlineInto(this,e,s)}addLineDeco(e){let s=e.spec.attributes,l=e.spec.class;s&&(this.attrs=combineAttrs(s,this.attrs||{})),l&&(this.attrs=combineAttrs({class:l},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,s){var l;this.dom?this.flags&4&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,s);let a=this.dom.lastChild;for(;a&&ContentView.get(a)instanceof MarkView;)a=a.lastChild;if(!a||!this.length||a.nodeName!="BR"&&((l=ContentView.get(a))===null||l===void 0?void 0:l.isEditable)==!1&&(!browser.ios||!this.children.some(h=>h instanceof TextView))){let h=document.createElement("BR");h.cmIgnore=!0,this.dom.appendChild(h)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,s;for(let l of this.children){if(!(l instanceof TextView)||/[^ -~]/.test(l.text))return null;let a=clientRectsFor(l.dom);if(a.length!=1)return null;e+=a[0].width,s=a[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:s}:null}coordsAt(e,s){let l=coordsInChildren(this,e,s);if(!this.children.length&&l&&this.parent){let{heightOracle:a}=this.parent.view.viewState,h=l.bottom-l.top;if(Math.abs(h-a.lineHeight)<2&&a.textHeight<h){let f=(h-a.textHeight)/2;return{top:l.top+f,bottom:l.bottom-f,left:l.left,right:l.left}}}return l}become(e){return!1}get type(){return BlockType.Text}static find(e,s){for(let l=0,a=0;l<e.children.length;l++){let h=e.children[l],f=a+h.length;if(f>=s){if(h instanceof LineView)return h;if(f>s)break}a=f+h.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,s,l){super(),this.widget=e,this.length=s,this.type=l,this.breakAfter=0,this.prevWidget=null}merge(e,s,l,a,h,f){return l&&(!(l instanceof BlockWidgetView)||!this.widget.compare(l.widget)||e>0&&h<=0||s<this.length&&f<=0)?!1:(this.length=e+(l?l.length:0)+(this.length-s),!0)}domAtPos(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let s=this.length-e;this.length=e;let l=new BlockWidgetView(this.widget,s,this.type);return l.breakAfter=this.breakAfter,l}get children(){return noChildren}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.type=e.type,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,s){return this.widget.coordsAt(this.dom,e,s)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ContentBuilder{constructor(e,s,l,a){this.doc=e,this.pos=s,this.end=l,this.disallowBlockEffectsFor=a,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=s}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof BlockWidgetView&&e.type==BlockType.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(e,s,l){for(;e>0;){if(this.textOff==this.text.length){let{value:h,lineBreak:f,done:u}=this.cursor.next(this.skip);if(this.skip=0,u)throw new Error("Ran out of text content when drawing inline views");if(f){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=h,this.textOff=0}let a=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(s.slice(s.length-l)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+a)),s),l),this.atCursorPos=!0,this.textOff+=a,e-=a,l=0}}span(e,s,l,a){this.buildText(s-e,l,a),this.pos=s,this.openStart<0&&(this.openStart=a)}point(e,s,l,a,h,f){if(this.disallowBlockEffectsFor[f]&&l instanceof PointDecoration){if(l.block)throw new RangeError("Block decorations may not be specified via plugins");if(s>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let u=s-e;if(l instanceof PointDecoration)if(l.block){let{type:p}=l;p==BlockType.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(l.widget||new NullWidget("div"),u,p))}else{let p=WidgetView.create(l.widget||new NullWidget("span"),u,u?0:l.startSide),m=this.atCursorPos&&!p.isEditable&&h<=a.length&&(e<s||l.startSide>0),g=!p.isEditable&&(e<s||h>a.length||l.startSide<=0),y=this.getLine();this.pendingBuffer==2&&!m&&!p.isEditable&&(this.pendingBuffer=0),this.flushBuffer(a),m&&(y.append(wrapMarks(new WidgetBufferView(1),a),h),h=a.length+Math.max(0,h-a.length)),y.append(wrapMarks(p,a),h),this.atCursorPos=g,this.pendingBuffer=g?e<s||h>a.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=a.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(l);u&&(this.textOff+u<=this.text.length?this.textOff+=u:(this.skip+=u-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=s),this.openStart<0&&(this.openStart=h)}static build(e,s,l,a,h){let f=new ContentBuilder(e,s,l,h);return f.openEnd=RangeSet.spans(a,s,l,f),f.openStart<0&&(f.openStart=f.openEnd),f.finish(f.openEnd),f}}function wrapMarks(o,e){for(let s of e)o=new MarkView(s,[o],o.length);return o}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),perLineTextDirection=Facet.define({combine:o=>o.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:o=>o.some(e=>e)});class ScrollTarget{constructor(e,s="nearest",l="nearest",a=5,h=5){this.range=e,this.y=s,this.x=l,this.yMargin=a,this.xMargin=h}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const scrollIntoView$1=StateEffect.define({map:(o,e)=>o.map(e)});function logException(o,e,s){let l=o.facet(exceptionSink);l.length?l[0](e):window.onerror?window.onerror(String(e),s,void 0,void 0,e):s?console.error(s+":",e):console.error(e)}const editable=Facet.define({combine:o=>o.length?o[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(e,s,l,a){this.id=e,this.create=s,this.domEventHandlers=l,this.extension=a(this)}static define(e,s){const{eventHandlers:l,provide:a,decorations:h}=s||{};return new ViewPlugin(nextPluginID++,e,l,f=>{let u=[viewPlugin.of(f)];return h&&u.push(decorations.of(p=>{let m=p.plugin(f);return m?h(m):Decoration.none})),a&&u.push(a(f)),u})}static fromClass(e,s){return ViewPlugin.define(l=>new e(l),s)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let s=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(s)}catch(l){if(logException(s.state,l,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(s){logException(e.state,s,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var s;if(!((s=this.value)===null||s===void 0)&&s.destroy)try{this.value.destroy()}catch(l){logException(e.state,l,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(o,e,s){let l=o.state.facet(bidiIsolatedRanges);if(!l.length)return l;let a=l.map(f=>f instanceof Function?f(o):f),h=[];return RangeSet.spans(a,e,s,{point(){},span(f,u,p,m){let g=h;for(let y=p.length-1;y>=0;y--,m--){let w=p[y].spec.bidiIsolate,x;if(w!=null)if(m>0&&g.length&&(x=g[g.length-1]).to==f&&x.direction==w)x.to=u,g=x.inner;else{let b={from:f,to:u,direction:w,inner:[]};g.push(b),g=b.inner}}}}),h}const scrollMargins=Facet.define();function getScrollMargins(o){let e=0,s=0,l=0,a=0;for(let h of o.state.facet(scrollMargins)){let f=h(o);f&&(f.left!=null&&(e=Math.max(e,f.left)),f.right!=null&&(s=Math.max(s,f.right)),f.top!=null&&(l=Math.max(l,f.top)),f.bottom!=null&&(a=Math.max(a,f.bottom)))}return{left:e,right:s,top:l,bottom:a}}const styleModule=Facet.define();class ChangedRange{constructor(e,s,l,a){this.fromA=e,this.toA=s,this.fromB=l,this.toB=a}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let s=e.length,l=this;for(;s>0;s--){let a=e[s-1];if(!(a.fromA>l.toA)){if(a.toA<l.fromA)break;l=l.join(a),e.splice(s-1,1)}}return e.splice(s,0,l),e}static extendWithRanges(e,s){if(s.length==0)return e;let l=[];for(let a=0,h=0,f=0,u=0;;a++){let p=a==e.length?null:e[a],m=f-u,g=p?p.fromB:1e9;for(;h<s.length&&s[h]<g;){let y=s[h],w=s[h+1],x=Math.max(u,y),b=Math.min(g,w);if(x<=b&&new ChangedRange(x+m,b+m,x,b).addToSet(l),w>g)break;h+=2}if(!p)return l;new ChangedRange(p.fromA,p.toA,p.fromB,p.toB).addToSet(l),f=p.toA,u=p.toB}}}class ViewUpdate{constructor(e,s,l){this.view=e,this.state=s,this.transactions=l,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let h of l)this.changes=this.changes.compose(h.changes);let a=[];this.changes.iterChangedRanges((h,f,u,p)=>a.push(new ChangedRange(h,f,u,p))),this.changedRanges=a}static create(e,s,l){return new ViewUpdate(e,s,l)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var Direction=function(o){return o[o.LTR=0]="LTR",o[o.RTL=1]="RTL",o}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec$1(o){let e=[];for(let s=0;s<o.length;s++)e.push(1<<+o[s]);return e}const LowTypes=dec$1("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec$1("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let o of["()","[]","{}"]){let e=o.charCodeAt(0),s=o.charCodeAt(1);Brackets[e]=s,Brackets[s]=-e}function charType(o){return o<=247?LowTypes[o]:1424<=o&&o<=1524?2:1536<=o&&o<=1785?ArabicTypes[o-1536]:1774<=o&&o<=2220?4:8192<=o&&o<=8203?256:64336<=o&&o<=65023?4:o==8204?256:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(e,s,l){this.from=e,this.to=s,this.level=l}side(e,s){return this.dir==s==e?this.to:this.from}static find(e,s,l,a){let h=-1;for(let f=0;f<e.length;f++){let u=e[f];if(u.from<=s&&u.to>=s){if(u.level==l)return f;(h<0||(a!=0?a<0?u.from<s:u.to>s:e[h].level>u.level))&&(h=f)}}if(h<0)throw new RangeError("Index out of range");return h}}function isolatesEq(o,e){if(o.length!=e.length)return!1;for(let s=0;s<o.length;s++){let l=o[s],a=e[s];if(l.from!=a.from||l.to!=a.to||l.direction!=a.direction||!isolatesEq(l.inner,a.inner))return!1}return!0}const types=[];function computeCharTypes(o,e,s,l,a){for(let h=0;h<=l.length;h++){let f=h?l[h-1].to:e,u=h<l.length?l[h].from:s,p=h?256:a;for(let m=f,g=p,y=p;m<u;m++){let w=charType(o.charCodeAt(m));w==512?w=g:w==8&&y==4&&(w=16),types[m]=w==4?2:w,w&7&&(y=w),g=w}for(let m=f,g=p,y=p;m<u;m++){let w=types[m];if(w==128)m<u-1&&g==types[m+1]&&g&24?w=types[m]=g:types[m]=256;else if(w==64){let x=m+1;for(;x<u&&types[x]==64;)x++;let b=m&&g==8||x<s&&types[x]==8?y==1?1:8:256;for(let k=m;k<x;k++)types[k]=b;m=x-1}else w==8&&y==1&&(types[m]=1);g=w,w&7&&(y=w)}}}function processBracketPairs(o,e,s,l,a){let h=a==1?2:1;for(let f=0,u=0,p=0;f<=l.length;f++){let m=f?l[f-1].to:e,g=f<l.length?l[f].from:s;for(let y=m,w,x,b;y<g;y++)if(x=Brackets[w=o.charCodeAt(y)])if(x<0){for(let k=u-3;k>=0;k-=3)if(BracketStack[k+1]==-x){let S=BracketStack[k+2],P=S&2?a:S&4?S&1?h:a:0;P&&(types[y]=types[BracketStack[k]]=P),u=k;break}}else{if(BracketStack.length==189)break;BracketStack[u++]=y,BracketStack[u++]=w,BracketStack[u++]=p}else if((b=types[y])==2||b==1){let k=b==a;p=k?0:1;for(let S=u-3;S>=0;S-=3){let P=BracketStack[S+2];if(P&2)break;if(k)BracketStack[S+2]|=2;else{if(P&4)break;BracketStack[S+2]|=4}}}}}function processNeutrals(o,e,s,l){for(let a=0,h=l;a<=s.length;a++){let f=a?s[a-1].to:o,u=a<s.length?s[a].from:e;for(let p=f;p<u;){let m=types[p];if(m==256){let g=p+1;for(;;)if(g==u){if(a==s.length)break;g=s[a++].to,u=a<s.length?s[a].from:e}else if(types[g]==256)g++;else break;let y=h==1,w=(g<e?types[g]:l)==1,x=y==w?y?1:2:l;for(let b=g,k=a,S=k?s[k-1].to:o;b>p;)b==S&&(b=s[--k].from,S=k?s[k-1].to:o),types[--b]=x;p=g}else h=m,p++}}}function emitSpans(o,e,s,l,a,h,f){let u=l%2?2:1;if(l%2==a%2)for(let p=e,m=0;p<s;){let g=!0,y=!1;if(m==h.length||p<h[m].from){let k=types[p];k!=u&&(g=!1,y=k==16)}let w=!g&&u==1?[]:null,x=g?l:l+1,b=p;e:for(;;)if(m<h.length&&b==h[m].from){if(y)break e;let k=h[m];if(!g)for(let S=k.to,P=m+1;;){if(S==s)break e;if(P<h.length&&h[P].from==S)S=h[P++].to;else{if(types[S]==u)break e;break}}if(m++,w)w.push(k);else{k.from>p&&f.push(new BidiSpan(p,k.from,x));let S=k.direction==LTR!=!(x%2);computeSectionOrder(o,S?l+1:l,a,k.inner,k.from,k.to,f),p=k.to}b=k.to}else{if(b==s||(g?types[b]!=u:types[b]==u))break;b++}w?emitSpans(o,p,b,l+1,a,w,f):p<b&&f.push(new BidiSpan(p,b,x)),p=b}else for(let p=s,m=h.length;p>e;){let g=!0,y=!1;if(!m||p>h[m-1].to){let k=types[p-1];k!=u&&(g=!1,y=k==16)}let w=!g&&u==1?[]:null,x=g?l:l+1,b=p;e:for(;;)if(m&&b==h[m-1].to){if(y)break e;let k=h[--m];if(!g)for(let S=k.from,P=m;;){if(S==e)break e;if(P&&h[P-1].to==S)S=h[--P].from;else{if(types[S-1]==u)break e;break}}if(w)w.push(k);else{k.to<p&&f.push(new BidiSpan(k.to,p,x));let S=k.direction==LTR!=!(x%2);computeSectionOrder(o,S?l+1:l,a,k.inner,k.from,k.to,f),p=k.from}b=k.from}else{if(b==e||(g?types[b-1]!=u:types[b-1]==u))break;b--}w?emitSpans(o,b,p,l+1,a,w,f):b<p&&f.push(new BidiSpan(b,p,x)),p=b}}function computeSectionOrder(o,e,s,l,a,h,f){let u=e%2?2:1;computeCharTypes(o,a,h,l,u),processBracketPairs(o,a,h,l,u),processNeutrals(a,h,l,u),emitSpans(o,a,h,e,s,l,f)}function computeOrder(o,e,s){if(!o)return[new BidiSpan(0,0,e==RTL?1:0)];if(e==LTR&&!s.length&&!BidiRE.test(o))return trivialOrder(o.length);if(s.length)for(;o.length>types.length;)types[types.length]=256;let l=[],a=e==LTR?0:1;return computeSectionOrder(o,a,a,s,0,o.length,l),l}function trivialOrder(o){return[new BidiSpan(0,o,0)]}let movedOver="";function moveVisually(o,e,s,l,a){var h;let f=l.head-o.from,u=-1;if(f==0){if(!a||!o.length)return null;e[0].level!=s&&(f=e[0].side(!1,s),u=0)}else if(f==o.length){if(a)return null;let w=e[e.length-1];w.level!=s&&(f=w.side(!0,s),u=e.length-1)}u<0&&(u=BidiSpan.find(e,f,(h=l.bidiLevel)!==null&&h!==void 0?h:-1,l.assoc));let p=e[u];f==p.side(a,s)&&(p=e[u+=a?1:-1],f=p.side(!a,s));let m=a==(p.dir==s),g=findClusterBreak(o.text,f,m);if(movedOver=o.text.slice(Math.min(f,g),Math.max(f,g)),g!=p.side(a,s))return EditorSelection.cursor(g+o.from,m?-1:1,p.level);let y=u==(a?e.length-1:0)?null:e[u+(a?1:-1)];return!y&&p.level!=s?EditorSelection.cursor(a?o.to:o.from,a?-1:1,s):y&&y.level<p.level?EditorSelection.cursor(y.side(!a,s)+o.from,a?1:-1,y.level):EditorSelection.cursor(g+o.from,a?-1:1,p.level)}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0,null)}update(e){var s;let l=e.changedRanges;this.minWidth>0&&l.length&&(l.every(({fromA:m,toA:g})=>g<this.minWidthFrom||m>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);let a=-1;this.view.inputState.composing>=0&&(!((s=this.domChanged)===null||s===void 0)&&s.newSel?a=this.domChanged.newSel.head:!touchesComposition(e.changes,this.hasComposition)&&!e.selectionSet&&(a=e.state.selection.main.head));let h=a>-1?findCompositionRange(this.view,e.changes,a):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:m,to:g}=this.hasComposition;l=new ChangedRange(m,g,e.changes.mapPos(m,-1),e.changes.mapPos(g,1)).addToSet(l.slice())}this.hasComposition=h?{from:h.range.fromB,to:h.range.toB}:null,(browser.ie||browser.chrome)&&!h&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let f=this.decorations,u=this.updateDeco(),p=findChangedDeco(f,u,e.changes);return l=ChangedRange.extendWithRanges(l,p),!(this.flags&7)&&l.length==0?!1:(this.updateInner(l,e.startState.doc.length,h),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,s,l){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,s,l);let{observer:a}=this.view;a.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let f=browser.chrome||browser.ios?{node:a.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,f),this.flags&=-8,f&&(f.written||a.selectionRange.focusNode!=f.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(f=>f.flags&=-9);let h=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let f of this.children)f instanceof BlockWidgetView&&f.widget instanceof BlockGapWidget&&h.push(f.dom);a.updateGaps(h)}updateChildren(e,s,l){let a=l?l.range.addToSet(e.slice()):e,h=this.childCursor(s);for(let f=a.length-1;;f--){let u=f>=0?a[f]:null;if(!u)break;let{fromA:p,toA:m,fromB:g,toB:y}=u,w,x,b,k;if(l&&l.range.fromB<y&&l.range.toB>g){let O=ContentBuilder.build(this.view.state.doc,g,l.range.fromB,this.decorations,this.dynamicDecorationMap),T=ContentBuilder.build(this.view.state.doc,l.range.toB,y,this.decorations,this.dynamicDecorationMap);x=O.breakAtStart,b=O.openStart,k=T.openEnd;let M=this.compositionView(l);T.breakAtStart?M.breakAfter=1:T.content.length&&M.merge(M.length,M.length,T.content[0],!1,T.openStart,0)&&(M.breakAfter=T.content[0].breakAfter,T.content.shift()),O.content.length&&M.merge(0,0,O.content[O.content.length-1],!0,0,O.openEnd)&&O.content.pop(),w=O.content.concat(M).concat(T.content)}else({content:w,breakAtStart:x,openStart:b,openEnd:k}=ContentBuilder.build(this.view.state.doc,g,y,this.decorations,this.dynamicDecorationMap));let{i:S,off:P}=h.findPos(m,1),{i:E,off:R}=h.findPos(p,-1);replaceRange(this,E,R,S,P,w,x,b,k)}l&&this.fixCompositionDOM(l)}compositionView(e){let s=new TextView(e.text.nodeValue);s.flags|=8;for(let{deco:a}of e.marks)s=new MarkView(a,[s],s.length);let l=new LineView;return l.append(s,0),l}fixCompositionDOM(e){let s=(h,f)=>{f.flags|=8|(f.children.some(p=>p.flags&7)?1:0),this.markedForComposition.add(f);let u=ContentView.get(h);u&&u!=f&&(u.dom=null),f.setDOM(h)},l=this.childPos(e.range.fromB,1),a=this.children[l.i];s(e.line,a);for(let h=e.marks.length-1;h>=-1;h--)l=a.childPos(l.off,1),a=a.children[l.i],s(h>=0?e.marks[h].node:e.text,a)}updateSelection(e=!1,s=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let l=this.view.root.activeElement,a=l==this.dom,h=!a&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(l&&this.dom.contains(l));if(!(a||s||h))return;let f=this.forceSelection;this.forceSelection=!1;let u=this.view.state.selection.main,p=this.moveToLine(this.domAtPos(u.anchor)),m=u.empty?p:this.moveToLine(this.domAtPos(u.head));if(browser.gecko&&u.empty&&!this.hasComposition&&betweenUneditable(p)){let y=document.createTextNode("");this.view.observer.ignore(()=>p.node.insertBefore(y,p.node.childNodes[p.offset]||null)),p=m=new DOMPos(y,0),f=!0}let g=this.view.observer.selectionRange;(f||!g.focusNode||!isEquivalentPosition(p.node,p.offset,g.anchorNode,g.anchorOffset)||!isEquivalentPosition(m.node,m.offset,g.focusNode,g.focusOffset))&&(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&this.dom.contains(g.focusNode)&&inUneditable(g.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let y=getSelection(this.view.root);if(y)if(u.empty){if(browser.gecko){let w=nextToUneditable(p.node,p.offset);if(w&&w!=3){let x=nearbyTextNode(p.node,p.offset,w==1?1:-1);x&&(p=new DOMPos(x.node,x.offset))}}y.collapse(p.node,p.offset),u.bidiLevel!=null&&y.caretBidiLevel!==void 0&&(y.caretBidiLevel=u.bidiLevel)}else if(y.extend){y.collapse(p.node,p.offset);try{y.extend(m.node,m.offset)}catch{}}else{let w=document.createRange();u.anchor>u.head&&([p,m]=[m,p]),w.setEnd(m.node,m.offset),w.setStart(p.node,p.offset),y.removeAllRanges(),y.addRange(w)}h&&this.view.root.activeElement==this.dom&&(this.dom.blur(),l&&l.focus())}),this.view.observer.setSelectionRange(p,m)),this.impreciseAnchor=p.precise?null:new DOMPos(g.anchorNode,g.anchorOffset),this.impreciseHead=m.precise?null:new DOMPos(g.focusNode,g.focusOffset)}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,s=e.state.selection.main,l=getSelection(e.root),{anchorNode:a,anchorOffset:h}=e.observer.selectionRange;if(!l||!s.empty||!s.assoc||!l.modify)return;let f=LineView.find(this,s.head);if(!f)return;let u=f.posAtStart;if(s.head==u||s.head==u+f.length)return;let p=this.coordsAt(s.head,-1),m=this.coordsAt(s.head,1);if(!p||!m||p.bottom>m.top)return;let g=this.domAtPos(s.head+s.assoc);l.collapse(g.node,g.offset),l.modify("move",s.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let y=e.observer.selectionRange;e.docView.posFromDOM(y.anchorNode,y.anchorOffset)!=s.from&&l.collapse(a,h)}moveToLine(e){let s=this.dom,l;if(e.node!=s)return e;for(let a=e.offset;!l&&a<s.childNodes.length;a++){let h=ContentView.get(s.childNodes[a]);h instanceof LineView&&(l=h.domAtPos(0))}for(let a=e.offset-1;!l&&a>=0;a--){let h=ContentView.get(s.childNodes[a]);h instanceof LineView&&(l=h.domAtPos(h.length))}return l?new DOMPos(l.node,l.offset,!0):e}nearest(e){for(let s=e;s;){let l=ContentView.get(s);if(l&&l.rootView==this)return l;s=s.parentNode}return null}posFromDOM(e,s){let l=this.nearest(e);if(!l)throw new RangeError("Trying to find position for a DOM position outside of the document");return l.localPosFromDOM(e,s)+l.posAtStart}domAtPos(e){let{i:s,off:l}=this.childCursor().findPos(e,-1);for(;s<this.children.length-1;){let a=this.children[s];if(l<a.length||a instanceof LineView)break;s++,l=0}return this.children[s].domAtPos(l)}coordsAt(e,s){for(let l=this.length,a=this.children.length-1;;a--){let h=this.children[a],f=l-h.breakAfter-h.length;if(e>f||e==f&&h.type!=BlockType.WidgetBefore&&h.type!=BlockType.WidgetAfter&&(!a||s==2||this.children[a-1].breakAfter||this.children[a-1].type==BlockType.WidgetBefore&&s>-2))return h.coordsAt(e-f,s);l=f}}coordsForChar(e){let{i:s,off:l}=this.childPos(e,1),a=this.children[s];if(!(a instanceof LineView))return null;for(;a.children.length;){let{i:u,off:p}=a.childPos(l,1);for(;;u++){if(u==a.children.length)return null;if((a=a.children[u]).length)break}l=p}if(!(a instanceof TextView))return null;let h=findClusterBreak(a.text,l);if(h==l)return null;let f=textRange(a.dom,l,h).getClientRects();return!f.length||f[0].top>=f[0].bottom?null:f[0]}measureVisibleLineHeights(e){let s=[],{from:l,to:a}=e,h=this.view.contentDOM.clientWidth,f=h>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,u=-1,p=this.view.textDirection==Direction.LTR;for(let m=0,g=0;g<this.children.length;g++){let y=this.children[g],w=m+y.length;if(w>a)break;if(m>=l){let x=y.dom.getBoundingClientRect();if(s.push(x.height),f){let b=y.dom.lastChild,k=b?clientRectsFor(b):[];if(k.length){let S=k[k.length-1],P=p?S.right-x.left:x.right-S.left;P>u&&(u=P,this.minWidth=h,this.minWidthFrom=m,this.minWidthTo=w)}}}m=w+y.breakAfter}return s}textDirectionAt(e){let{i:s}=this.childPos(e,1);return getComputedStyle(this.children[s].dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){for(let h of this.children)if(h instanceof LineView){let f=h.measureTextSize();if(f)return f}let e=document.createElement("div"),s,l,a;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let h=clientRectsFor(e.firstChild)[0];s=e.getBoundingClientRect().height,l=h?h.width/27:7,a=h?h.height:s,e.remove()}),{lineHeight:s,charWidth:l,textHeight:a}}childCursor(e=this.length){let s=this.children.length;return s&&(e-=this.children[--s].length),new ChildCursor(this.children,e,s)}computeBlockGapDeco(){let e=[],s=this.view.viewState;for(let l=0,a=0;;a++){let h=a==s.viewports.length?null:s.viewports[a],f=h?h.from-1:this.length;if(f>l){let u=(s.lineBlockAt(f).bottom-s.lineBlockAt(l).top)/this.view.scaleY;e.push(Decoration.replace({widget:new BlockGapWidget(u),block:!0,inclusive:!0,isBlockGap:!0}).range(l,f))}if(!h)break;l=h.to+1}return Decoration.set(e)}updateDeco(){let e=this.view.state.facet(decorations).map((s,l)=>(this.dynamicDecorationMap[l]=typeof s=="function")?s(this.view):s);for(let s=e.length;s<e.length+3;s++)this.dynamicDecorationMap[s]=!1;return this.decorations=[...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:s}=e,l=this.coordsAt(s.head,s.empty?s.assoc:s.head>s.anchor?-1:1),a;if(!l)return;!s.empty&&(a=this.coordsAt(s.anchor,s.anchor>s.head?-1:1))&&(l={left:Math.min(l.left,a.left),top:Math.min(l.top,a.top),right:Math.max(l.right,a.right),bottom:Math.max(l.bottom,a.bottom)});let h=getScrollMargins(this.view),f={left:l.left-h.left,top:l.top-h.top,right:l.right+h.right,bottom:l.bottom+h.bottom};scrollRectIntoView(this.view.scrollDOM,f,s.head<s.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Direction.LTR)}}function betweenUneditable(o){return o.node.nodeType==1&&o.node.firstChild&&(o.offset==0||o.node.childNodes[o.offset-1].contentEditable=="false")&&(o.offset==o.node.childNodes.length||o.node.childNodes[o.offset].contentEditable=="false")}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function findCompositionNode(o,e){let s=o.observer.selectionRange,l=s.focusNode&&nearbyTextNode(s.focusNode,s.focusOffset,0);if(!l)return null;let a=e-l.offset;return{from:a,to:a+l.node.nodeValue.length,node:l.node}}function findCompositionRange(o,e,s){let l=findCompositionNode(o,s);if(!l)return null;let{node:a,from:h,to:f}=l,u=a.nodeValue;if(/[\n\r]/.test(u)||o.state.doc.sliceString(l.from,l.to)!=u)return null;let p=e.invertedDesc,m=new ChangedRange(p.mapPos(h),p.mapPos(f),h,f),g=[];for(let y=a.parentNode;;y=y.parentNode){let w=ContentView.get(y);if(w instanceof MarkView)g.push({node:y,deco:w.mark});else{if(w instanceof LineView||y.nodeName=="DIV"&&y.parentNode==o.contentDOM)return{range:m,text:a,marks:g,line:y};if(y!=o.contentDOM)g.push({node:y,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs(y),tagName:y.tagName.toLowerCase()})});else return null}}}function nearbyTextNode(o,e,s){if(s<=0)for(let l=o,a=e;;){if(l.nodeType==3)return{node:l,offset:a};if(l.nodeType==1&&a>0)l=l.childNodes[a-1],a=maxOffset(l);else break}if(s>=0)for(let l=o,a=e;;){if(l.nodeType==3)return{node:l,offset:a};if(l.nodeType==1&&a<l.childNodes.length&&s>=0)l=l.childNodes[a],a=0;else break}return null}function nextToUneditable(o,e){return o.nodeType!=1?0:(e&&o.childNodes[e-1].contentEditable=="false"?1:0)|(e<o.childNodes.length&&o.childNodes[e].contentEditable=="false"?2:0)}let DecorationComparator$1=class{constructor(){this.changes=[]}compareRange(e,s){addRange(e,s,this.changes)}comparePoint(e,s){addRange(e,s,this.changes)}};function findChangedDeco(o,e,s){let l=new DecorationComparator$1;return RangeSet.compare(o,e,s,l),l.changes}function inUneditable(o,e){for(let s=o;s&&s!=e;s=s.assignedSlot||s.parentNode)if(s.nodeType==1&&s.contentEditable=="false")return!0;return!1}function touchesComposition(o,e){let s=!1;return e&&o.iterChangedRanges((l,a)=>{l<e.to&&a>e.from&&(s=!0)}),s}function groupAt(o,e,s=1){let l=o.charCategorizer(e),a=o.doc.lineAt(e),h=e-a.from;if(a.length==0)return EditorSelection.cursor(e);h==0?s=1:h==a.length&&(s=-1);let f=h,u=h;s<0?f=findClusterBreak(a.text,h,!1):u=findClusterBreak(a.text,h);let p=l(a.text.slice(f,u));for(;f>0;){let m=findClusterBreak(a.text,f,!1);if(l(a.text.slice(m,f))!=p)break;f=m}for(;u<a.length;){let m=findClusterBreak(a.text,u);if(l(a.text.slice(u,m))!=p)break;u=m}return EditorSelection.range(f+a.from,u+a.from)}function getdx(o,e){return e.left>o?e.left-o:Math.max(0,o-e.right)}function getdy(o,e){return e.top>o?e.top-o:Math.max(0,o-e.bottom)}function yOverlap(o,e){return o.top<e.bottom-1&&o.bottom>e.top+1}function upTop(o,e){return e<o.top?{top:e,left:o.left,right:o.right,bottom:o.bottom}:o}function upBot(o,e){return e>o.bottom?{top:o.top,left:o.left,right:o.right,bottom:e}:o}function domPosAtCoords(o,e,s){let l,a,h,f,u=!1,p,m,g,y;for(let b=o.firstChild;b;b=b.nextSibling){let k=clientRectsFor(b);for(let S=0;S<k.length;S++){let P=k[S];a&&yOverlap(a,P)&&(P=upTop(upBot(P,a.bottom),a.top));let E=getdx(e,P),R=getdy(s,P);if(E==0&&R==0)return b.nodeType==3?domPosInText(b,e,s):domPosAtCoords(b,e,s);if(!l||f>R||f==R&&h>E){l=b,a=P,h=E,f=R;let O=R?s<P.top?-1:1:E?e<P.left?-1:1:0;u=!O||(O>0?S<k.length-1:S>0)}E==0?s>P.bottom&&(!g||g.bottom<P.bottom)?(p=b,g=P):s<P.top&&(!y||y.top>P.top)&&(m=b,y=P):g&&yOverlap(g,P)?g=upBot(g,P.bottom):y&&yOverlap(y,P)&&(y=upTop(y,P.top))}}if(g&&g.bottom>=s?(l=p,a=g):y&&y.top<=s&&(l=m,a=y),!l)return{node:o,offset:0};let w=Math.max(a.left,Math.min(a.right,e));if(l.nodeType==3)return domPosInText(l,w,s);if(u&&l.contentEditable!="false")return domPosAtCoords(l,w,s);let x=Array.prototype.indexOf.call(o.childNodes,l)+(e>=(a.left+a.right)/2?1:0);return{node:o,offset:x}}function domPosInText(o,e,s){let l=o.nodeValue.length,a=-1,h=1e9,f=0;for(let u=0;u<l;u++){let p=textRange(o,u,u+1).getClientRects();for(let m=0;m<p.length;m++){let g=p[m];if(g.top==g.bottom)continue;f||(f=e-g.left);let y=(g.top>s?g.top-s:s-g.bottom)-1;if(g.left-1<=e&&g.right+1>=e&&y<h){let w=e>=(g.left+g.right)/2,x=w;if((browser.chrome||browser.gecko)&&textRange(o,u).getBoundingClientRect().left==g.right&&(x=!w),y<=0)return{node:o,offset:u+(x?1:0)};a=u+(x?1:0),h=y}}}return{node:o,offset:a>-1?a:f>0?o.nodeValue.length:0}}function posAtCoords(o,e,s,l=-1){var a,h;let f=o.contentDOM.getBoundingClientRect(),u=f.top+o.viewState.paddingTop,p,{docHeight:m}=o.viewState,{x:g,y}=e,w=y-u;if(w<0)return 0;if(w>m)return o.state.doc.length;for(let O=o.viewState.heightOracle.textHeight/2,T=!1;p=o.elementAtHeight(w),p.type!=BlockType.Text;)for(;w=l>0?p.bottom+O:p.top-O,!(w>=0&&w<=m);){if(T)return s?null:0;T=!0,l=-l}y=u+w;let x=p.from;if(x<o.viewport.from)return o.viewport.from==0?0:s?null:posAtCoordsImprecise(o,f,p,g,y);if(x>o.viewport.to)return o.viewport.to==o.state.doc.length?o.state.doc.length:s?null:posAtCoordsImprecise(o,f,p,g,y);let b=o.dom.ownerDocument,k=o.root.elementFromPoint?o.root:b,S=k.elementFromPoint(g,y);S&&!o.contentDOM.contains(S)&&(S=null),S||(g=Math.max(f.left+1,Math.min(f.right-1,g)),S=k.elementFromPoint(g,y),S&&!o.contentDOM.contains(S)&&(S=null));let P,E=-1;if(S&&((a=o.docView.nearest(S))===null||a===void 0?void 0:a.isEditable)!=!1){if(b.caretPositionFromPoint){let O=b.caretPositionFromPoint(g,y);O&&({offsetNode:P,offset:E}=O)}else if(b.caretRangeFromPoint){let O=b.caretRangeFromPoint(g,y);O&&({startContainer:P,startOffset:E}=O,(!o.contentDOM.contains(P)||browser.safari&&isSuspiciousSafariCaretResult(P,E,g)||browser.chrome&&isSuspiciousChromeCaretResult(P,E,g))&&(P=void 0))}}if(!P||!o.docView.dom.contains(P)){let O=LineView.find(o.docView,x);if(!O)return w>p.top+p.height/2?p.to:p.from;({node:P,offset:E}=domPosAtCoords(O.dom,g,y))}let R=o.docView.nearest(P);if(!R)return null;if(R.isWidget&&((h=R.dom)===null||h===void 0?void 0:h.nodeType)==1){let O=R.dom.getBoundingClientRect();return e.y<O.top||e.y<=O.bottom&&e.x<=(O.left+O.right)/2?R.posAtStart:R.posAtEnd}else return R.localPosFromDOM(P,E)+R.posAtStart}function posAtCoordsImprecise(o,e,s,l,a){let h=Math.round((l-e.left)*o.defaultCharacterWidth);if(o.lineWrapping&&s.height>o.defaultLineHeight*1.5){let u=o.viewState.heightOracle.textHeight,p=Math.floor((a-s.top-(o.defaultLineHeight-u)*.5)/u);h+=p*o.viewState.heightOracle.lineLength}let f=o.state.sliceDoc(s.from,s.to);return s.from+findColumn(f,h,o.state.tabSize)}function isSuspiciousSafariCaretResult(o,e,s){let l;if(o.nodeType!=3||e!=(l=o.nodeValue.length))return!1;for(let a=o.nextSibling;a;a=a.nextSibling)if(a.nodeType!=1||a.nodeName!="BR")return!1;return textRange(o,l-1,l).getBoundingClientRect().left>s}function isSuspiciousChromeCaretResult(o,e,s){if(e!=0)return!1;for(let a=o;;){let h=a.parentNode;if(!h||h.nodeType!=1||h.firstChild!=a)return!1;if(h.classList.contains("cm-line"))break;a=h}let l=o.nodeType==1?o.getBoundingClientRect():textRange(o,0,Math.max(o.nodeValue.length,1)).getBoundingClientRect();return s-l.left>5}function blockAt(o,e){let s=o.lineBlockAt(e);if(Array.isArray(s.type)){for(let l of s.type)if(l.to>e||l.to==e&&(l.to==s.to||l.type==BlockType.Text))return l}return s}function moveToLineBoundary(o,e,s,l){let a=blockAt(o,e.head),h=!l||a.type!=BlockType.Text||!(o.lineWrapping||a.widgetLineBreaks)?null:o.coordsAtPos(e.assoc<0&&e.head>a.from?e.head-1:e.head);if(h){let f=o.dom.getBoundingClientRect(),u=o.textDirectionAt(a.from),p=o.posAtCoords({x:s==(u==Direction.LTR)?f.right-1:f.left+1,y:(h.top+h.bottom)/2});if(p!=null)return EditorSelection.cursor(p,s?-1:1)}return EditorSelection.cursor(s?a.to:a.from,s?-1:1)}function moveByChar(o,e,s,l){let a=o.state.doc.lineAt(e.head),h=o.bidiSpans(a),f=o.textDirectionAt(a.from);for(let u=e,p=null;;){let m=moveVisually(a,h,f,u,s),g=movedOver;if(!m){if(a.number==(s?o.state.doc.lines:1))return u;g=`
`,a=o.state.doc.line(a.number+(s?1:-1)),h=o.bidiSpans(a),m=EditorSelection.cursor(s?a.from:a.to)}if(p){if(!p(g))return u}else{if(!l)return m;p=l(g)}u=m}}function byGroup(o,e,s){let l=o.state.charCategorizer(e),a=l(s);return h=>{let f=l(h);return a==CharCategory.Space&&(a=f),a==f}}function moveVertically(o,e,s,l){let a=e.head,h=s?1:-1;if(a==(s?o.state.doc.length:0))return EditorSelection.cursor(a,e.assoc);let f=e.goalColumn,u,p=o.contentDOM.getBoundingClientRect(),m=o.coordsAtPos(a),g=o.documentTop;if(m)f==null&&(f=m.left-p.left),u=h<0?m.top:m.bottom;else{let x=o.viewState.lineBlockAt(a);f==null&&(f=Math.min(p.right-p.left,o.defaultCharacterWidth*(a-x.from))),u=(h<0?x.top:x.bottom)+g}let y=p.left+f,w=l??o.viewState.heightOracle.textHeight>>1;for(let x=0;;x+=10){let b=u+(w+x)*h,k=posAtCoords(o,{x:y,y:b},!1,h);if(b<p.top||b>p.bottom||(h<0?k<a:k>a))return EditorSelection.cursor(k,e.assoc,void 0,f)}}function skipAtomicRanges(o,e,s){for(;;){let l=0;for(let a of o)a.between(e-1,e+1,(h,f,u)=>{if(e>h&&e<f){let p=l||s||(e-h<f-e?-1:1);e=p<0?h:f,l=p}});if(!l)return e}}function skipAtoms(o,e,s){let l=skipAtomicRanges(o.state.facet(atomicRanges).map(a=>a(o)),s.from,e.head>s.from?-1:1);return l==s.from?s:EditorSelection.cursor(l,l<s.from?1:-1)}class InputState{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null;let s=(l,a)=>{this.ignoreDuringComposition(a)||a.type=="keydown"&&this.keydown(e,a)||(this.mustFlushObserver(a)&&e.observer.forceFlush(),this.runCustomHandlers(a.type,e,a)?a.preventDefault():l(e,a))};for(let l in handlers){let a=handlers[l];e.contentDOM.addEventListener(l,h=>{eventBelongsToEditor(e,h)&&s(a,h)},handlerOptions[l]),this.registeredEvents.push(l)}e.scrollDOM.addEventListener("mousedown",l=>{if(l.target==e.scrollDOM&&l.clientY>e.contentDOM.getBoundingClientRect().bottom&&(s(handlers.mousedown,l),!l.defaultPrevented&&l.button==2)){let a=e.contentDOM.style.minHeight;e.contentDOM.style.minHeight="100%",setTimeout(()=>e.contentDOM.style.minHeight=a,200)}}),e.scrollDOM.addEventListener("drop",l=>{l.target==e.scrollDOM&&l.clientY>e.contentDOM.getBoundingClientRect().bottom&&s(handlers.drop,l)}),browser.chrome&&browser.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",()=>null),browser.gecko&&firefoxCopyCutHack(e.contentDOM.ownerDocument)}ensureHandlers(e,s){var l;let a;this.customHandlers=[];for(let h of s)if(a=(l=h.update(e).spec)===null||l===void 0?void 0:l.domEventHandlers){this.customHandlers.push({plugin:h.value,handlers:a});for(let f in a)this.registeredEvents.indexOf(f)<0&&f!="scroll"&&(this.registeredEvents.push(f),e.contentDOM.addEventListener(f,u=>{eventBelongsToEditor(e,u)&&this.runCustomHandlers(f,e,u)&&u.preventDefault()}))}}runCustomHandlers(e,s,l){for(let a of this.customHandlers){let h=a.handlers[e];if(h)try{if(h.call(a.plugin,l,s)||l.defaultPrevented)return!0}catch(f){logException(s.state,f)}}return!1}runScrollHandlers(e,s){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let l of this.customHandlers){let a=l.handlers.scroll;if(a)try{a.call(l.plugin,s,e)}catch(h){logException(e.state,h)}}}keydown(e,s){if(this.lastKeyCode=s.keyCode,this.lastKeyTime=Date.now(),s.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(s.keyCode!=27&&modifierCodes.indexOf(s.keyCode)<0&&(e.inputState.lastEscPress=0),browser.android&&browser.chrome&&!s.synthetic&&(s.keyCode==13||s.keyCode==8))return e.observer.delayAndroidKey(s.key,s.keyCode),!0;let l;return browser.ios&&!s.synthetic&&!s.altKey&&!s.metaKey&&((l=PendingKeys.find(a=>a.keyCode==s.keyCode))&&!s.ctrlKey||EmacsyPendingKeys.indexOf(s.key)>-1&&s.ctrlKey&&!s.shiftKey)?(this.pendingIOSKey=l||s,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let s=this.pendingIOSKey;return s?(this.pendingIOSKey=void 0,dispatchKey(e.contentDOM,s.key,s.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(o){return Math.max(0,o)*.7+8}function dist(o,e){return Math.max(Math.abs(o.clientX-e.clientX),Math.abs(o.clientY-e.clientY))}class MouseSelection{constructor(e,s,l,a){this.view=e,this.startEvent=s,this.style=l,this.mustSelect=a,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=s,this.scrollParent=scrollableParent(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map(f=>f(e));let h=e.contentDOM.ownerDocument;h.addEventListener("mousemove",this.move=this.move.bind(this)),h.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=s.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,s),this.dragging=isInPrimarySelection(e,s)&&getClickType(s)==1?null:!1}start(e){this.dragging===!1&&(e.preventDefault(),this.select(e))}move(e){var s;if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&dist(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let l=0,a=0,h=((s=this.scrollParent)===null||s===void 0?void 0:s.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},f=getScrollMargins(this.view);e.clientX-f.left<=h.left+dragScrollMargin?l=-dragScrollSpeed(h.left-e.clientX):e.clientX+f.right>=h.right-dragScrollMargin&&(l=dragScrollSpeed(e.clientX-h.right)),e.clientY-f.top<=h.top+dragScrollMargin?a=-dragScrollSpeed(h.top-e.clientY):e.clientY+f.bottom>=h.bottom-dragScrollMargin&&(a=dragScrollSpeed(e.clientY-h.bottom)),this.setScrollSpeed(l,a)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,s){this.scrollSpeed={x:e,y:s},e||s?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let s=null;for(let l=0;l<e.ranges.length;l++){let a=e.ranges[l],h=null;if(a.empty){let f=skipAtomicRanges(this.atoms,a.from,0);f!=a.from&&(h=EditorSelection.cursor(f,-1))}else{let f=skipAtomicRanges(this.atoms,a.from,-1),u=skipAtomicRanges(this.atoms,a.to,1);(f!=a.from||u!=a.to)&&(h=EditorSelection.range(a.from==a.anchor?f:u,a.from==a.head?f:u))}h&&(s||(s=e.ranges.slice()),s[l]=h)}return s?EditorSelection.create(s,e.mainIndex):e}select(e){let{view:s}=this,l=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!l.eq(s.state.selection)||l.main.assoc!=s.state.selection.main.assoc&&this.dragging===!1)&&this.view.dispatch({selection:l,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(o,e){let s=o.state.facet(clickAddsSelectionRange);return s.length?s[0](e):browser.mac?e.metaKey:e.ctrlKey}function dragMovesSelection(o,e){let s=o.state.facet(dragMovesSelection$1);return s.length?s[0](e):browser.mac?!e.altKey:!e.ctrlKey}function isInPrimarySelection(o,e){let{main:s}=o.state.selection;if(s.empty)return!1;let l=getSelection(o.root);if(!l||l.rangeCount==0)return!0;let a=l.getRangeAt(0).getClientRects();for(let h=0;h<a.length;h++){let f=a[h];if(f.left<=e.clientX&&f.right>=e.clientX&&f.top<=e.clientY&&f.bottom>=e.clientY)return!0}return!1}function eventBelongsToEditor(o,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let s=e.target,l;s!=o.contentDOM;s=s.parentNode)if(!s||s.nodeType==11||(l=ContentView.get(s))&&l.ignoreEvent(e))return!1;return!0}const handlers=Object.create(null),handlerOptions=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(o){let e=o.dom.parentNode;if(!e)return;let s=e.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus(),setTimeout(()=>{o.focus(),s.remove(),doPaste(o,s.value)},50)}function doPaste(o,e){let{state:s}=o,l,a=1,h=s.toText(e),f=h.lines==s.selection.ranges.length;if(lastLinewiseCopy!=null&&s.selection.ranges.every(p=>p.empty)&&lastLinewiseCopy==h.toString()){let p=-1;l=s.changeByRange(m=>{let g=s.doc.lineAt(m.from);if(g.from==p)return{range:m};p=g.from;let y=s.toText((f?h.line(a++).text:e)+s.lineBreak);return{changes:{from:g.from,insert:y},range:EditorSelection.cursor(m.from+y.length)}})}else f?l=s.changeByRange(p=>{let m=h.line(a++);return{changes:{from:p.from,to:p.to,insert:m.text},range:EditorSelection.cursor(p.from+m.length)}}):l=s.replaceSelection(h);o.dispatch(l,{userEvent:"input.paste",scrollIntoView:!0})}handlers.keydown=(o,e)=>{o.inputState.setSelectionOrigin("select"),e.keyCode==27&&(o.inputState.lastEscPress=Date.now())};handlers.touchstart=(o,e)=>{o.inputState.lastTouchTime=Date.now(),o.inputState.setSelectionOrigin("select.pointer")};handlers.touchmove=o=>{o.inputState.setSelectionOrigin("select.pointer")};handlerOptions.touchstart=handlerOptions.touchmove={passive:!0};handlers.mousedown=(o,e)=>{if(o.observer.flush(),o.inputState.lastTouchTime>Date.now()-2e3)return;let s=null;for(let l of o.state.facet(mouseSelectionStyle))if(s=l(o,e),s)break;if(!s&&e.button==0&&(s=basicMouseSelection(o,e)),s){let l=!o.hasFocus;o.inputState.startMouseSelection(new MouseSelection(o,e,s,l)),l&&o.observer.ignore(()=>focusPreventScroll(o.contentDOM)),o.inputState.mouseSelection&&o.inputState.mouseSelection.start(e)}};function rangeForClick(o,e,s,l){if(l==1)return EditorSelection.cursor(e,s);if(l==2)return groupAt(o.state,e,s);{let a=LineView.find(o.docView,e),h=o.state.doc.lineAt(a?a.posAtEnd:e),f=a?a.posAtStart:h.from,u=a?a.posAtEnd:h.to;return u<o.state.doc.length&&u==h.to&&u++,EditorSelection.range(f,u)}}let insideY=(o,e)=>o>=e.top&&o<=e.bottom,inside=(o,e,s)=>insideY(e,s)&&o>=s.left&&o<=s.right;function findPositionSide(o,e,s,l){let a=LineView.find(o.docView,e);if(!a)return 1;let h=e-a.posAtStart;if(h==0)return 1;if(h==a.length)return-1;let f=a.coordsAt(h,-1);if(f&&inside(s,l,f))return-1;let u=a.coordsAt(h,1);return u&&inside(s,l,u)?1:f&&insideY(l,f)?-1:1}function queryPos(o,e){let s=o.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:s,bias:findPositionSide(o,s,e.clientX,e.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(o){if(!BadMouseDetail)return o.detail;let e=lastMouseDown,s=lastMouseDownTime;return lastMouseDown=o,lastMouseDownTime=Date.now(),lastMouseDownCount=!e||s>Date.now()-400&&Math.abs(e.clientX-o.clientX)<2&&Math.abs(e.clientY-o.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(o,e){let s=queryPos(o,e),l=getClickType(e),a=o.state.selection;return{update(h){h.docChanged&&(s.pos=h.changes.mapPos(s.pos),a=a.map(h.changes))},get(h,f,u){let p=queryPos(o,h),m,g=rangeForClick(o,p.pos,p.bias,l);if(s.pos!=p.pos&&!f){let y=rangeForClick(o,s.pos,s.bias,l),w=Math.min(y.from,g.from),x=Math.max(y.to,g.to);g=w<g.from?EditorSelection.range(w,x):EditorSelection.range(x,w)}return f?a.replaceRange(a.main.extend(g.from,g.to)):u&&l==1&&a.ranges.length>1&&(m=removeRangeAround(a,p.pos))?m:u?a.addRange(g):EditorSelection.create([g])}}}function removeRangeAround(o,e){for(let s=0;s<o.ranges.length;s++){let{from:l,to:a}=o.ranges[s];if(l<=e&&a>=e)return EditorSelection.create(o.ranges.slice(0,s).concat(o.ranges.slice(s+1)),o.mainIndex==s?0:o.mainIndex-(o.mainIndex>s?1:0))}return null}handlers.dragstart=(o,e)=>{let{selection:{main:s}}=o.state,{mouseSelection:l}=o.inputState;l&&(l.dragging=s),e.dataTransfer&&(e.dataTransfer.setData("Text",o.state.sliceDoc(s.from,s.to)),e.dataTransfer.effectAllowed="copyMove")};function dropText(o,e,s,l){if(!s)return;let a=o.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:h}=o.inputState,f=l&&h&&h.dragging&&dragMovesSelection(o,e)?{from:h.dragging.from,to:h.dragging.to}:null,u={from:a,insert:s},p=o.state.changes(f?[f,u]:u);o.focus(),o.dispatch({changes:p,selection:{anchor:p.mapPos(a,-1),head:p.mapPos(a,1)},userEvent:f?"move.drop":"input.drop"})}handlers.drop=(o,e)=>{if(!e.dataTransfer)return;if(o.state.readOnly)return e.preventDefault();let s=e.dataTransfer.files;if(s&&s.length){e.preventDefault();let l=Array(s.length),a=0,h=()=>{++a==s.length&&dropText(o,e,l.filter(f=>f!=null).join(o.state.lineBreak),!1)};for(let f=0;f<s.length;f++){let u=new FileReader;u.onerror=h,u.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(u.result)||(l[f]=u.result),h()},u.readAsText(s[f])}}else dropText(o,e,e.dataTransfer.getData("Text"),!0)};handlers.paste=(o,e)=>{if(o.state.readOnly)return e.preventDefault();o.observer.flush();let s=brokenClipboardAPI?null:e.clipboardData;s?(doPaste(o,s.getData("text/plain")||s.getData("text/uri-text")),e.preventDefault()):capturePaste(o)};function captureCopy(o,e){let s=o.dom.parentNode;if(!s)return;let l=s.appendChild(document.createElement("textarea"));l.style.cssText="position: fixed; left: -10000px; top: 10px",l.value=e,l.focus(),l.selectionEnd=e.length,l.selectionStart=0,setTimeout(()=>{l.remove(),o.focus()},50)}function copiedRange(o){let e=[],s=[],l=!1;for(let a of o.selection.ranges)a.empty||(e.push(o.sliceDoc(a.from,a.to)),s.push(a));if(!e.length){let a=-1;for(let{from:h}of o.selection.ranges){let f=o.doc.lineAt(h);f.number>a&&(e.push(f.text),s.push({from:f.from,to:Math.min(o.doc.length,f.to+1)})),a=f.number}l=!0}return{text:e.join(o.lineBreak),ranges:s,linewise:l}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(o,e)=>{let{text:s,ranges:l,linewise:a}=copiedRange(o.state);if(!s&&!a)return;lastLinewiseCopy=a?s:null;let h=brokenClipboardAPI?null:e.clipboardData;h?(e.preventDefault(),h.clearData(),h.setData("text/plain",s)):captureCopy(o,s),e.type=="cut"&&!o.state.readOnly&&o.dispatch({changes:l,scrollIntoView:!0,userEvent:"delete.cut"})};const isFocusChange=Annotation.define();function focusChangeTransaction(o,e){let s=[];for(let l of o.facet(focusChangeEffect)){let a=l(o,e);a&&s.push(a)}return s?o.update({effects:s,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(o){setTimeout(()=>{let e=o.hasFocus;if(e!=o.inputState.notifiedFocused){let s=focusChangeTransaction(o.state,e);s?o.dispatch(s):o.update([])}},10)}handlers.focus=o=>{o.inputState.lastFocusTime=Date.now(),!o.scrollDOM.scrollTop&&(o.inputState.lastScrollTop||o.inputState.lastScrollLeft)&&(o.scrollDOM.scrollTop=o.inputState.lastScrollTop,o.scrollDOM.scrollLeft=o.inputState.lastScrollLeft),updateForFocusChange(o)};handlers.blur=o=>{o.observer.clearSelectionRange(),updateForFocusChange(o)};handlers.compositionstart=handlers.compositionupdate=o=>{o.inputState.compositionFirstChange==null&&(o.inputState.compositionFirstChange=!0),o.inputState.composing<0&&(o.inputState.composing=0)};handlers.compositionend=o=>{o.inputState.composing=-1,o.inputState.compositionEndedAt=Date.now(),o.inputState.compositionPendingKey=!0,o.inputState.compositionPendingChange=o.observer.pendingRecords().length>0,o.inputState.compositionFirstChange=null,browser.chrome&&browser.android?o.observer.flushSoon():o.inputState.compositionPendingChange?Promise.resolve().then(()=>o.observer.flush()):setTimeout(()=>{o.inputState.composing<0&&o.docView.hasComposition&&o.update([])},50)};handlers.contextmenu=o=>{o.inputState.lastContextMenu=Date.now()};handlers.beforeinput=(o,e)=>{var s;let l;if(browser.chrome&&browser.android&&(l=PendingKeys.find(a=>a.inputType==e.inputType))&&(o.observer.delayAndroidKey(l.key,l.keyCode),l.key=="Backspace"||l.key=="Delete")){let a=((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0;setTimeout(()=>{var h;(((h=window.visualViewport)===null||h===void 0?void 0:h.height)||0)>a+10&&o.hasFocus&&(o.contentDOM.blur(),o.focus())},100)}};const appliedFirefoxHack=new Set;function firefoxCopyCutHack(o){appliedFirefoxHack.has(o)||(appliedFirefoxHack.add(o),o.addEventListener("copy",()=>{}),o.addEventListener("cut",()=>{}))}const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,s){let l=this.doc.lineAt(s).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(l+=Math.max(0,Math.ceil((s-e-l*this.lineLength*.5)/this.lineLength))),this.lineHeight*l}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let s=!1;for(let l=0;l<e.length;l++){let a=e[l];a<0?l++:this.heightSamples[Math.floor(a*10)]||(s=!0,this.heightSamples[Math.floor(a*10)]=!0)}return s}refresh(e,s,l,a,h,f){let u=wrappingWhiteSpace.indexOf(e)>-1,p=Math.round(s)!=Math.round(this.lineHeight)||this.lineWrapping!=u;if(this.lineWrapping=u,this.lineHeight=s,this.charWidth=l,this.textHeight=a,this.lineLength=h,p){this.heightSamples={};for(let m=0;m<f.length;m++){let g=f[m];g<0?m++:this.heightSamples[Math.floor(g*10)]=!0}}return p}}class MeasuredHeights{constructor(e,s){this.from=e,this.heights=s,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,s,l,a,h){this.from=e,this.length=s,this.top=l,this.height=a,this._content=h}get type(){return typeof this._content=="number"?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let s=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,s)}}var QueryType$1=function(o){return o[o.ByPos=0]="ByPos",o[o.ByHeight=1]="ByHeight",o[o.ByPosNoHeight=2]="ByPosNoHeight",o}(QueryType$1||(QueryType$1={}));const Epsilon=.001;class HeightMap{constructor(e,s,l=2){this.length=e,this.height=s,this.flags=l}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,s){this.height!=s&&(Math.abs(this.height-s)>Epsilon&&(e.heightChanged=!0),this.height=s)}replace(e,s,l){return HeightMap.of(l)}decomposeLeft(e,s){s.push(this)}decomposeRight(e,s){s.push(this)}applyChanges(e,s,l,a){let h=this,f=l.doc;for(let u=a.length-1;u>=0;u--){let{fromA:p,toA:m,fromB:g,toB:y}=a[u],w=h.lineAt(p,QueryType$1.ByPosNoHeight,l.setDoc(s),0,0),x=w.to>=m?w:h.lineAt(m,QueryType$1.ByPosNoHeight,l,0,0);for(y+=x.to-m,m=x.to;u>0&&w.from<=a[u-1].toA;)p=a[u-1].fromA,g=a[u-1].fromB,u--,p<w.from&&(w=h.lineAt(p,QueryType$1.ByPosNoHeight,l,0,0));g+=w.from-p,p=w.from;let b=NodeBuilder.build(l.setDoc(f),e,g,y);h=h.replace(p,m,b)}return h.updateHeight(l,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(e.length==1)return e[0];let s=0,l=e.length,a=0,h=0;for(;;)if(s==l)if(a>h*2){let u=e[s-1];u.break?e.splice(--s,1,u.left,null,u.right):e.splice(--s,1,u.left,u.right),l+=1+u.break,a-=u.size}else if(h>a*2){let u=e[l];u.break?e.splice(l,1,u.left,null,u.right):e.splice(l,1,u.left,u.right),l+=2+u.break,h-=u.size}else break;else if(a<h){let u=e[s++];u&&(a+=u.size)}else{let u=e[--l];u&&(h+=u.size)}let f=0;return e[s-1]==null?(f=1,s--):e[s]==null&&(f=1,l++),new HeightMapBranch(HeightMap.of(e.slice(0,s)),f,HeightMap.of(e.slice(l)))}}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,s,l){super(e,s),this.deco=l}blockAt(e,s,l,a){return new BlockInfo(a,this.length,l,this.height,this.deco||0)}lineAt(e,s,l,a,h){return this.blockAt(0,l,a,h)}forEachLine(e,s,l,a,h,f){e<=h+this.length&&s>=h&&f(this.blockAt(0,l,a,h))}updateHeight(e,s=0,l=!1,a){return a&&a.from<=s&&a.more&&this.setHeight(e,a.heights[a.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,s){super(e,s,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,s,l,a){return new BlockInfo(a,this.length,l,this.height,this.breaks)}replace(e,s,l){let a=l[0];return l.length==1&&(a instanceof HeightMapText||a instanceof HeightMapGap&&a.flags&4)&&Math.abs(this.length-a.length)<10?(a instanceof HeightMapGap?a=new HeightMapText(a.length,this.height):a.height=this.height,this.outdated||(a.outdated=!1),a):HeightMap.of(l)}updateHeight(e,s=0,l=!1,a){return a&&a.from<=s&&a.more?this.setHeight(e,a.heights[a.index++]):(l||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,s){let l=e.doc.lineAt(s).number,a=e.doc.lineAt(s+this.length).number,h=a-l+1,f,u=0;if(e.lineWrapping){let p=Math.min(this.height,e.lineHeight*h);f=p/h,this.length>h+1&&(u=(this.height-p)/(this.length-h-1))}else f=this.height/h;return{firstLine:l,lastLine:a,perLine:f,perChar:u}}blockAt(e,s,l,a){let{firstLine:h,lastLine:f,perLine:u,perChar:p}=this.heightMetrics(s,a);if(s.lineWrapping){let m=a+Math.round(Math.max(0,Math.min(1,(e-l)/this.height))*this.length),g=s.doc.lineAt(m),y=u+g.length*p,w=Math.max(l,e-y/2);return new BlockInfo(g.from,g.length,w,y,0)}else{let m=Math.max(0,Math.min(f-h,Math.floor((e-l)/u))),{from:g,length:y}=s.doc.line(h+m);return new BlockInfo(g,y,l+u*m,u,0)}}lineAt(e,s,l,a,h){if(s==QueryType$1.ByHeight)return this.blockAt(e,l,a,h);if(s==QueryType$1.ByPosNoHeight){let{from:x,to:b}=l.doc.lineAt(e);return new BlockInfo(x,b-x,0,0,0)}let{firstLine:f,perLine:u,perChar:p}=this.heightMetrics(l,h),m=l.doc.lineAt(e),g=u+m.length*p,y=m.number-f,w=a+u*y+p*(m.from-h-y);return new BlockInfo(m.from,m.length,Math.max(a,Math.min(w,a+this.height-g)),g,0)}forEachLine(e,s,l,a,h,f){e=Math.max(e,h),s=Math.min(s,h+this.length);let{firstLine:u,perLine:p,perChar:m}=this.heightMetrics(l,h);for(let g=e,y=a;g<=s;){let w=l.doc.lineAt(g);if(g==e){let b=w.number-u;y+=p*b+m*(e-h-b)}let x=p+m*w.length;f(new BlockInfo(w.from,w.length,y,x,0)),y+=x,g=w.to+1}}replace(e,s,l){let a=this.length-s;if(a>0){let h=l[l.length-1];h instanceof HeightMapGap?l[l.length-1]=new HeightMapGap(h.length+a):l.push(null,new HeightMapGap(a-1))}if(e>0){let h=l[0];h instanceof HeightMapGap?l[0]=new HeightMapGap(e+h.length):l.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(l)}decomposeLeft(e,s){s.push(new HeightMapGap(e-1),null)}decomposeRight(e,s){s.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,s=0,l=!1,a){let h=s+this.length;if(a&&a.from<=s+this.length&&a.more){let f=[],u=Math.max(s,a.from),p=-1;for(a.from>s&&f.push(new HeightMapGap(a.from-s-1).updateHeight(e,s));u<=h&&a.more;){let g=e.doc.lineAt(u).length;f.length&&f.push(null);let y=a.heights[a.index++];p==-1?p=y:Math.abs(y-p)>=Epsilon&&(p=-2);let w=new HeightMapText(g,y);w.outdated=!1,f.push(w),u+=g+1}u<=h&&f.push(null,new HeightMapGap(h-u).updateHeight(e,u));let m=HeightMap.of(f);return(p<0||Math.abs(m.height-this.height)>=Epsilon||Math.abs(p-this.heightMetrics(e,s).perLine)>=Epsilon)&&(e.heightChanged=!0),m}else(l||this.outdated)&&(this.setHeight(e,e.heightForGap(s,s+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,s,l){super(e.length+s+l.length,e.height+l.height,s|(e.outdated||l.outdated?2:0)),this.left=e,this.right=l,this.size=e.size+l.size}get break(){return this.flags&1}blockAt(e,s,l,a){let h=l+this.left.height;return e<h?this.left.blockAt(e,s,l,a):this.right.blockAt(e,s,h,a+this.left.length+this.break)}lineAt(e,s,l,a,h){let f=a+this.left.height,u=h+this.left.length+this.break,p=s==QueryType$1.ByHeight?e<f:e<u,m=p?this.left.lineAt(e,s,l,a,h):this.right.lineAt(e,s,l,f,u);if(this.break||(p?m.to<u:m.from>u))return m;let g=s==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;return p?m.join(this.right.lineAt(u,g,l,f,u)):this.left.lineAt(u,g,l,a,h).join(m)}forEachLine(e,s,l,a,h,f){let u=a+this.left.height,p=h+this.left.length+this.break;if(this.break)e<p&&this.left.forEachLine(e,s,l,a,h,f),s>=p&&this.right.forEachLine(e,s,l,u,p,f);else{let m=this.lineAt(p,QueryType$1.ByPos,l,a,h);e<m.from&&this.left.forEachLine(e,m.from-1,l,a,h,f),m.to>=e&&m.from<=s&&f(m),s>m.to&&this.right.forEachLine(m.to+1,s,l,u,p,f)}}replace(e,s,l){let a=this.left.length+this.break;if(s<a)return this.balanced(this.left.replace(e,s,l),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-a,s-a,l));let h=[];e>0&&this.decomposeLeft(e,h);let f=h.length;for(let u of l)h.push(u);if(e>0&&mergeGaps(h,f-1),s<this.length){let u=h.length;this.decomposeRight(s,h),mergeGaps(h,u)}return HeightMap.of(h)}decomposeLeft(e,s){let l=this.left.length;if(e<=l)return this.left.decomposeLeft(e,s);s.push(this.left),this.break&&(l++,e>=l&&s.push(null)),e>l&&this.right.decomposeLeft(e-l,s)}decomposeRight(e,s){let l=this.left.length,a=l+this.break;if(e>=a)return this.right.decomposeRight(e-a,s);e<l&&this.left.decomposeRight(e,s),this.break&&e<a&&s.push(null),s.push(this.right)}balanced(e,s){return e.size>2*s.size||s.size>2*e.size?HeightMap.of(this.break?[e,null,s]:[e,s]):(this.left=e,this.right=s,this.height=e.height+s.height,this.outdated=e.outdated||s.outdated,this.size=e.size+s.size,this.length=e.length+this.break+s.length,this)}updateHeight(e,s=0,l=!1,a){let{left:h,right:f}=this,u=s+h.length+this.break,p=null;return a&&a.from<=s+h.length&&a.more?p=h=h.updateHeight(e,s,l,a):h.updateHeight(e,s,l),a&&a.from<=u+f.length&&a.more?p=f=f.updateHeight(e,u,l,a):f.updateHeight(e,u,l),p?this.balanced(h,f):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(o,e){let s,l;o[e]==null&&(s=o[e-1])instanceof HeightMapGap&&(l=o[e+1])instanceof HeightMapGap&&o.splice(e-1,3,new HeightMapGap(s.length+1+l.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,s){this.pos=e,this.oracle=s,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,s){if(this.lineStart>-1){let l=Math.min(s,this.lineEnd),a=this.nodes[this.nodes.length-1];a instanceof HeightMapText?a.length+=l-this.pos:(l>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(l-this.pos,-1)),this.writtenTo=l,s>l&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=s}point(e,s,l){if(e<s||l.heightRelevant){let a=l.widget?l.widget.estimatedHeight:0,h=l.widget?l.widget.lineBreaks:0;a<0&&(a=this.oracle.lineHeight);let f=s-e;l.block?this.addBlock(new HeightMapBlock(f,a,l)):(f||h||a>=relevantWidgetHeight)&&this.addLineDeco(a,h,f)}else s>e&&this.span(e,s);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:s}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=s,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,s){let l=new HeightMapGap(s-e);return this.oracle.doc.lineAt(e).to==s&&(l.flags|=4),l}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let s=new HeightMapText(0,-1);return this.nodes.push(s),s}addBlock(e){var s;this.enterLine();let l=(s=e.deco)===null||s===void 0?void 0:s.type;l==BlockType.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,l!=BlockType.WidgetBefore&&(this.covering=e)}addLineDeco(e,s,l){let a=this.ensureLine();a.length+=l,a.collapsed+=l,a.widgetHeight=Math.max(a.widgetHeight,e),a.breaks+=s,this.writtenTo=this.pos=this.pos+l}finish(e){let s=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(s instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1)):(this.writtenTo<this.pos||s==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let l=e;for(let a of this.nodes)a instanceof HeightMapText&&a.updateHeight(this.oracle,l),l+=a?a.length:1;return this.nodes}static build(e,s,l,a){let h=new NodeBuilder(l,e);return RangeSet.spans(s,l,a,h,0),h.finish(l)}}function heightRelevantDecoChanges(o,e,s){let l=new DecorationComparator;return RangeSet.compare(o,e,s,l,0),l.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,s,l,a){(e<s||l&&l.heightRelevant||a&&a.heightRelevant)&&addRange(e,s,this.changes,5)}}function visiblePixelRange(o,e){let s=o.getBoundingClientRect(),l=o.ownerDocument,a=l.defaultView||window,h=Math.max(0,s.left),f=Math.min(a.innerWidth,s.right),u=Math.max(0,s.top),p=Math.min(a.innerHeight,s.bottom);for(let m=o.parentNode;m&&m!=l.body;)if(m.nodeType==1){let g=m,y=window.getComputedStyle(g);if((g.scrollHeight>g.clientHeight||g.scrollWidth>g.clientWidth)&&y.overflow!="visible"){let w=g.getBoundingClientRect();h=Math.max(h,w.left),f=Math.min(f,w.right),u=Math.max(u,w.top),p=m==o.parentNode?w.bottom:Math.min(p,w.bottom)}m=y.position=="absolute"||y.position=="fixed"?g.offsetParent:g.parentNode}else if(m.nodeType==11)m=m.host;else break;return{left:h-s.left,right:Math.max(h,f)-s.left,top:u-(s.top+e),bottom:Math.max(u,p)-(s.top+e)}}function fullPixelRange(o,e){let s=o.getBoundingClientRect();return{left:0,right:s.right-s.left,top:e,bottom:s.bottom-(s.top+e)}}class LineGap{constructor(e,s,l){this.from=e,this.to=s,this.size=l}static same(e,s){if(e.length!=s.length)return!1;for(let l=0;l<e.length;l++){let a=e[l],h=s[l];if(a.from!=h.from||a.to!=h.to||a.size!=h.size)return!1}return!0}draw(e,s){return Decoration.replace({widget:new LineGapWidget(this.size*(s?e.scaleY:e.scaleX),s)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,s){super(),this.size=e,this.vertical=s}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let s=e.facet(contentAttributes).some(l=>typeof l!="function"&&l.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(s),this.stateDeco=e.facet(decorations).filter(l=>typeof l!="function"),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(l=>l.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:s}=this.state.selection;for(let l=0;l<=1;l++){let a=l?s.head:s.anchor;if(!e.some(({from:h,to:f})=>a>=h&&a<=f)){let{from:h,to:f}=this.lineBlockAt(a);e.push(new Viewport(h,f))}}this.viewports=e.sort((l,a)=>l.from-a.from),this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:scaleBlock(e,this.scaler))})}update(e,s=null){this.state=e.state;let l=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(g=>typeof g!="function");let a=e.changedRanges,h=ChangedRange.extendWithRanges(a,heightRelevantDecoChanges(l,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),f=this.heightMap.height,u=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),h),this.heightMap.height!=f&&(e.flags|=2),u?(this.scrollAnchorPos=e.changes.mapPos(u.from,-1),this.scrollAnchorHeight=u.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let p=h.length?this.mapViewport(this.viewport,e.changes):this.viewport;(s&&(s.range.head<p.from||s.range.head>p.to)||!this.viewportIsAppropriate(p))&&(p=this.getViewport(0,s));let m=!e.changes.empty||e.flags&2||p.from!=this.viewport.from||p.to!=this.viewport.to;this.viewport=p,this.updateForViewport(),m&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),s&&(this.scrollTarget=s),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let s=e.contentDOM,l=window.getComputedStyle(s),a=this.heightOracle,h=l.whiteSpace;this.defaultTextDirection=l.direction=="rtl"?Direction.RTL:Direction.LTR;let f=this.heightOracle.mustRefreshForWrapping(h),u=s.getBoundingClientRect(),p=f||this.mustMeasureContent||this.contentDOMHeight!=u.height;this.contentDOMHeight=u.height,this.mustMeasureContent=!1;let m=0,g=0;if(u.width&&u.height){let O=u.width/s.offsetWidth,T=u.height/s.offsetHeight;O>.995&&O<1.005&&(O=1),T>.995&&T<1.005&&(T=1),(this.scaleX!=O||this.scaleY!=T)&&(this.scaleX=O,this.scaleY=T,m|=8,f=p=!0)}let y=(parseInt(l.paddingTop)||0)*this.scaleY,w=(parseInt(l.paddingBottom)||0)*this.scaleY;(this.paddingTop!=y||this.paddingBottom!=w)&&(this.paddingTop=y,this.paddingBottom=w,m|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(a.lineWrapping&&(p=!0),this.editorWidth=e.scrollDOM.clientWidth,m|=8);let x=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=x&&(this.scrollAnchorHeight=-1,this.scrollTop=x),this.scrolledToBottom=isScrolledToBottom(e.scrollDOM);let b=(this.printing?fullPixelRange:visiblePixelRange)(s,this.paddingTop),k=b.top-this.pixelViewport.top,S=b.bottom-this.pixelViewport.bottom;this.pixelViewport=b;let P=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(P!=this.inView&&(this.inView=P,P&&(p=!0)),!this.inView&&!this.scrollTarget)return 0;let E=u.width;if((this.contentDOMWidth!=E||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=u.width,this.editorHeight=e.scrollDOM.clientHeight,m|=8),p){let O=e.docView.measureVisibleLineHeights(this.viewport);if(a.mustRefreshForHeights(O)&&(f=!0),f||a.lineWrapping&&Math.abs(E-this.contentDOMWidth)>a.charWidth){let{lineHeight:T,charWidth:M,textHeight:$}=e.docView.measureTextSize();f=T>0&&a.refresh(h,T,M,$,E/M,O),f&&(e.docView.minWidth=0,m|=8)}k>0&&S>0?g=Math.max(k,S):k<0&&S<0&&(g=Math.min(k,S)),a.heightChanged=!1;for(let T of this.viewports){let M=T.from==this.viewport.from?O:e.docView.measureVisibleLineHeights(T);this.heightMap=(f?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(a,0,f,new MeasuredHeights(T.from,M))}a.heightChanged&&(m|=2)}let R=!this.viewportIsAppropriate(this.viewport,g)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return R&&(this.viewport=this.getViewport(g,this.scrollTarget)),this.updateForViewport(),(m&2||R)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(f?[]:this.lineGaps,e)),m|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),m}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,s){let l=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),a=this.heightMap,h=this.heightOracle,{visibleTop:f,visibleBottom:u}=this,p=new Viewport(a.lineAt(f-l*1e3,QueryType$1.ByHeight,h,0,0).from,a.lineAt(u+(1-l)*1e3,QueryType$1.ByHeight,h,0,0).to);if(s){let{head:m}=s.range;if(m<p.from||m>p.to){let g=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),y=a.lineAt(m,QueryType$1.ByPos,h,0,0),w;s.y=="center"?w=(y.top+y.bottom)/2-g/2:s.y=="start"||s.y=="nearest"&&m<p.from?w=y.top:w=y.bottom-g,p=new Viewport(a.lineAt(w-1e3/2,QueryType$1.ByHeight,h,0,0).from,a.lineAt(w+g+1e3/2,QueryType$1.ByHeight,h,0,0).to)}}return p}mapViewport(e,s){let l=s.mapPos(e.from,-1),a=s.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(l,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(a,QueryType$1.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:s},l=0){if(!this.inView)return!0;let{top:a}=this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),{bottom:h}=this.heightMap.lineAt(s,QueryType$1.ByPos,this.heightOracle,0,0),{visibleTop:f,visibleBottom:u}=this;return(e==0||a<=f-Math.max(10,Math.min(-l,250)))&&(s==this.state.doc.length||h>=u+Math.max(10,Math.min(l,250)))&&a>f-2*1e3&&h<u+2*1e3}mapLineGaps(e,s){if(!e.length||s.empty)return e;let l=[];for(let a of e)s.touchesRange(a.from,a.to)||l.push(new LineGap(s.mapPos(a.from),s.mapPos(a.to),a.size));return l}ensureLineGaps(e,s){let l=this.heightOracle.lineWrapping,a=l?1e4:2e3,h=a>>1,f=a<<1;if(this.defaultTextDirection!=Direction.LTR&&!l)return[];let u=[],p=(m,g,y,w)=>{if(g-m<h)return;let x=this.state.selection.main,b=[x.from];x.empty||b.push(x.to);for(let S of b)if(S>m&&S<g){p(m,S-10,y,w),p(S+10,g,y,w);return}let k=find(e,S=>S.from>=y.from&&S.to<=y.to&&Math.abs(S.from-m)<h&&Math.abs(S.to-g)<h&&!b.some(P=>S.from<P&&S.to>P));if(!k){if(g<y.to&&s&&l&&s.visibleRanges.some(S=>S.from<=g&&S.to>=g)){let S=s.moveToLineBoundary(EditorSelection.cursor(g),!1,!0).head;S>m&&(g=S)}k=new LineGap(m,g,this.gapSize(y,m,g,w))}u.push(k)};for(let m of this.viewportLines){if(m.length<f)continue;let g=lineStructure(m.from,m.to,this.stateDeco);if(g.total<f)continue;let y=this.scrollTarget?this.scrollTarget.range.head:null,w,x;if(l){let b=a/this.heightOracle.lineLength*this.heightOracle.lineHeight,k,S;if(y!=null){let P=findFraction(g,y),E=((this.visibleBottom-this.visibleTop)/2+b)/m.height;k=P-E,S=P+E}else k=(this.visibleTop-m.top-b)/m.height,S=(this.visibleBottom-m.top+b)/m.height;w=findPosition(g,k),x=findPosition(g,S)}else{let b=g.total*this.heightOracle.charWidth,k=a*this.heightOracle.charWidth,S,P;if(y!=null){let E=findFraction(g,y),R=((this.pixelViewport.right-this.pixelViewport.left)/2+k)/b;S=E-R,P=E+R}else S=(this.pixelViewport.left-k)/b,P=(this.pixelViewport.right+k)/b;w=findPosition(g,S),x=findPosition(g,P)}w>m.from&&p(m.from,w,m,g),x<m.to&&p(x,m.to,m,g)}return u}gapSize(e,s,l,a){let h=findFraction(a,l)-findFraction(a,s);return this.heightOracle.lineWrapping?e.height*h:a.total*this.heightOracle.charWidth*h}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(s=>s.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let s=[];RangeSet.spans(e,this.viewport.from,this.viewport.to,{span(a,h){s.push({from:a,to:h})},point(){}},20);let l=s.length!=this.visibleRanges.length||this.visibleRanges.some((a,h)=>a.from!=s[h].from||a.to!=s[h].to);return this.visibleRanges=s,l?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(s=>s.from<=e&&s.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let s=this.lineBlockAtHeight(e+8);return s.from>=this.viewport.from||this.viewportLines[0].top-e>200?s:this.viewportLines[0]}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,s){this.from=e,this.to=s}}function lineStructure(o,e,s){let l=[],a=o,h=0;return RangeSet.spans(s,o,e,{span(){},point(f,u){f>a&&(l.push({from:a,to:f}),h+=f-a),a=u}},20),a<e&&(l.push({from:a,to:e}),h+=e-a),{total:h,ranges:l}}function findPosition({total:o,ranges:e},s){if(s<=0)return e[0].from;if(s>=1)return e[e.length-1].to;let l=Math.floor(o*s);for(let a=0;;a++){let{from:h,to:f}=e[a],u=f-h;if(l<=u)return h+l;l-=u}}function findFraction(o,e){let s=0;for(let{from:l,to:a}of o.ranges){if(e<=a){s+=e-l;break}s+=a-l}return s/o.total}function find(o,e){for(let s of o)if(e(s))return s}const IdScaler={toDOM(o){return o},fromDOM(o){return o},scale:1};class BigScaler{constructor(e,s,l){let a=0,h=0,f=0;this.viewports=l.map(({from:u,to:p})=>{let m=s.lineAt(u,QueryType$1.ByPos,e,0,0).top,g=s.lineAt(p,QueryType$1.ByPos,e,0,0).bottom;return a+=g-m,{from:u,to:p,top:m,bottom:g,domTop:0,domBottom:0}}),this.scale=(7e6-a)/(s.height-a);for(let u of this.viewports)u.domTop=f+(u.top-h)*this.scale,f=u.domBottom=u.domTop+(u.bottom-u.top),h=u.bottom}toDOM(e){for(let s=0,l=0,a=0;;s++){let h=s<this.viewports.length?this.viewports[s]:null;if(!h||e<h.top)return a+(e-l)*this.scale;if(e<=h.bottom)return h.domTop+(e-h.top);l=h.bottom,a=h.domBottom}}fromDOM(e){for(let s=0,l=0,a=0;;s++){let h=s<this.viewports.length?this.viewports[s]:null;if(!h||e<h.domTop)return l+(e-a)/this.scale;if(e<=h.domBottom)return h.top+(e-h.domTop);l=h.bottom,a=h.domBottom}}}function scaleBlock(o,e){if(e.scale==1)return o;let s=e.toDOM(o.top),l=e.toDOM(o.bottom);return new BlockInfo(o.from,o.length,s,l-s,Array.isArray(o._content)?o._content.map(a=>scaleBlock(a,e)):o._content)}const theme=Facet.define({combine:o=>o.join(" ")}),darkTheme=Facet.define({combine:o=>o.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(o,e,s){return new StyleModule(e,{finish(l){return/&/.test(l)?l.replace(/&\w*/,a=>{if(a=="&")return o;if(!s||!s[a])throw new RangeError(`Unsupported selector: ${a}`);return s[a]}):o+" "+l}})}const baseTheme$1$3=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),LineBreakPlaceholder="ï¿¿";class DOMReader{constructor(e,s){this.points=e,this.text="",this.lineSeparator=s.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,s){if(!e)return this;let l=e.parentNode;for(let a=e;;){this.findPointBefore(l,a);let h=this.text.length;this.readNode(a);let f=a.nextSibling;if(f==s)break;let u=ContentView.get(a),p=ContentView.get(f);(u&&p?u.breakAfter:(u?u.breakAfter:isBlockElement(a))||isBlockElement(f)&&(a.nodeName!="BR"||a.cmIgnore)&&this.text.length>h)&&this.lineBreak(),a=f}return this.findPointBefore(l,s),this}readTextNode(e){let s=e.nodeValue;for(let l of this.points)l.node==e&&(l.pos=this.text.length+Math.min(l.offset,s.length));for(let l=0,a=this.lineSeparator?null:/\r\n?|\n/g;;){let h=-1,f=1,u;if(this.lineSeparator?(h=s.indexOf(this.lineSeparator,l),f=this.lineSeparator.length):(u=a.exec(s))&&(h=u.index,f=u[0].length),this.append(s.slice(l,h<0?s.length:h)),h<0)break;if(this.lineBreak(),f>1)for(let p of this.points)p.node==e&&p.pos>this.text.length&&(p.pos-=f-1);l=h+f}}readNode(e){if(e.cmIgnore)return;let s=ContentView.get(e),l=s&&s.overrideDOMText;if(l!=null){this.findPointInside(e,l.length);for(let a=l.iter();!a.next().done;)a.lineBreak?this.lineBreak():this.append(a.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,s){for(let l of this.points)l.node==e&&e.childNodes[l.offset]==s&&(l.pos=this.text.length)}findPointInside(e,s){for(let l of this.points)(e.nodeType==3?l.node==e:e.contains(l.node))&&(l.pos=this.text.length+Math.min(s,l.offset))}}function isBlockElement(o){return o.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(o.nodeName)}class DOMPoint{constructor(e,s){this.node=e,this.offset=s,this.pos=-1}}class DOMChange{constructor(e,s,l,a){this.typeOver=a,this.bounds=null,this.text="";let{impreciseHead:h,impreciseAnchor:f}=e.docView;if(e.state.readOnly&&s>-1)this.newSel=null;else if(s>-1&&(this.bounds=e.docView.domBoundsAround(s,l,0))){let u=h||f?[]:selectionPoints(e),p=new DOMReader(u,e.state);p.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=p.text,this.newSel=selectionFromPoints(u,this.bounds.from)}else{let u=e.observer.selectionRange,p=h&&h.node==u.focusNode&&h.offset==u.focusOffset||!contains(e.contentDOM,u.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(u.focusNode,u.focusOffset),m=f&&f.node==u.anchorNode&&f.offset==u.anchorOffset||!contains(e.contentDOM,u.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(u.anchorNode,u.anchorOffset);this.newSel=EditorSelection.single(m,p)}}}function applyDOMChange(o,e){let s,{newSel:l}=e,a=o.state.selection.main,h=o.inputState.lastKeyTime>Date.now()-100?o.inputState.lastKeyCode:-1;if(e.bounds){let{from:f,to:u}=e.bounds,p=a.from,m=null;(h===8||browser.android&&e.text.length<u-f)&&(p=a.to,m="end");let g=findDiff(o.state.doc.sliceString(f,u,LineBreakPlaceholder),e.text,p-f,m);g&&(browser.chrome&&h==13&&g.toB==g.from+2&&e.text.slice(g.from,g.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&g.toB--,s={from:f+g.from,to:f+g.toA,insert:Text.of(e.text.slice(g.from,g.toB).split(LineBreakPlaceholder))})}else l&&(!o.hasFocus&&o.state.facet(editable)||l.main.eq(a))&&(l=null);if(!s&&!l)return!1;if(!s&&e.typeOver&&!a.empty&&l&&l.main.empty?s={from:a.from,to:a.to,insert:o.state.doc.slice(a.from,a.to)}:s&&s.from>=a.from&&s.to<=a.to&&(s.from!=a.from||s.to!=a.to)&&a.to-a.from-(s.to-s.from)<=4?s={from:a.from,to:a.to,insert:o.state.doc.slice(a.from,s.from).append(s.insert).append(o.state.doc.slice(s.to,a.to))}:(browser.mac||browser.android)&&s&&s.from==s.to&&s.from==a.head-1&&/^\. ?$/.test(s.insert.toString())&&o.contentDOM.getAttribute("autocorrect")=="off"?(l&&s.insert.length==2&&(l=EditorSelection.single(l.main.anchor-1,l.main.head-1)),s={from:a.from,to:a.to,insert:Text.of([" "])}):browser.chrome&&s&&s.from==s.to&&s.from==a.head&&s.insert.toString()==`
 `&&o.lineWrapping&&(l&&(l=EditorSelection.single(l.main.anchor-1,l.main.head-1)),s={from:a.from,to:a.to,insert:Text.of([" "])}),s){if(browser.ios&&o.inputState.flushIOSKey(o)||browser.android&&(s.from==a.from&&s.to==a.to&&s.insert.length==1&&s.insert.lines==2&&dispatchKey(o.contentDOM,"Enter",13)||(s.from==a.from-1&&s.to==a.to&&s.insert.length==0||h==8&&s.insert.length<s.to-s.from&&s.to>a.head)&&dispatchKey(o.contentDOM,"Backspace",8)||s.from==a.from&&s.to==a.to+1&&s.insert.length==0&&dispatchKey(o.contentDOM,"Delete",46)))return!0;let f=s.insert.toString();o.inputState.composing>=0&&o.inputState.composing++;let u,p=()=>u||(u=applyDefaultInsert(o,s,l));return o.state.facet(inputHandler$1).some(m=>m(o,s.from,s.to,f,p))||o.dispatch(p()),!0}else if(l&&!l.main.eq(a)){let f=!1,u="select";return o.inputState.lastSelectionTime>Date.now()-50&&(o.inputState.lastSelectionOrigin=="select"&&(f=!0),u=o.inputState.lastSelectionOrigin),o.dispatch({selection:l,scrollIntoView:f,userEvent:u}),!0}else return!1}function applyDefaultInsert(o,e,s){let l,a=o.state,h=a.selection.main;if(e.from>=h.from&&e.to<=h.to&&e.to-e.from>=(h.to-h.from)/3&&(!s||s.main.empty&&s.main.from==e.from+e.insert.length)&&o.inputState.composing<0){let u=h.from<e.from?a.sliceDoc(h.from,e.from):"",p=h.to>e.to?a.sliceDoc(e.to,h.to):"";l=a.replaceSelection(o.state.toText(u+e.insert.sliceString(0,void 0,o.state.lineBreak)+p))}else{let u=a.changes(e),p=s&&s.main.to<=u.newLength?s.main:void 0;if(a.selection.ranges.length>1&&o.inputState.composing>=0&&e.to<=h.to&&e.to>=h.to-10){let m=o.state.sliceDoc(e.from,e.to),g,y=s&&findCompositionNode(o,s.main.head);if(y){let b=e.insert.length-(e.to-e.from);g={from:y.from,to:y.to-b}}else g=o.state.doc.lineAt(h.head);let w=h.to-e.to,x=h.to-h.from;l=a.changeByRange(b=>{if(b.from==h.from&&b.to==h.to)return{changes:u,range:p||b.map(u)};let k=b.to-w,S=k-m.length;if(b.to-b.from!=x||o.state.sliceDoc(S,k)!=m||b.to>=g.from&&b.from<=g.to)return{range:b};let P=a.changes({from:S,to:k,insert:e.insert}),E=b.to-h.to;return{changes:P,range:p?EditorSelection.range(Math.max(0,p.anchor+E),Math.max(0,p.head+E)):b.map(P)}})}else l={changes:u,selection:p&&a.selection.replaceRange(p)}}let f="input.type";return(o.composing||o.inputState.compositionPendingChange&&o.inputState.compositionEndedAt>Date.now()-50)&&(o.inputState.compositionPendingChange=!1,f+=".compose",o.inputState.compositionFirstChange&&(f+=".start",o.inputState.compositionFirstChange=!1)),a.update(l,{userEvent:f,scrollIntoView:!0})}function findDiff(o,e,s,l){let a=Math.min(o.length,e.length),h=0;for(;h<a&&o.charCodeAt(h)==e.charCodeAt(h);)h++;if(h==a&&o.length==e.length)return null;let f=o.length,u=e.length;for(;f>0&&u>0&&o.charCodeAt(f-1)==e.charCodeAt(u-1);)f--,u--;if(l=="end"){let p=Math.max(0,h-Math.min(f,u));s-=f+p-h}if(f<h&&o.length<e.length){let p=s<=h&&s>=f?h-s:0;h-=p,u=h+(u-f),f=h}else if(u<h){let p=s<=h&&s>=u?h-s:0;h-=p,f=h+(f-u),u=h}return{from:h,toA:f,toB:u}}function selectionPoints(o){let e=[];if(o.root.activeElement!=o.contentDOM)return e;let{anchorNode:s,anchorOffset:l,focusNode:a,focusOffset:h}=o.observer.selectionRange;return s&&(e.push(new DOMPoint(s,l)),(a!=s||h!=l)&&e.push(new DOMPoint(a,h))),e}function selectionFromPoints(o,e){if(o.length==0)return null;let s=o[0].pos,l=o.length==2?o[1].pos:s;return s>-1&&l>-1?EditorSelection.single(s+e,l+e):null}const observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(s=>{for(let l of s)this.queue.push(l);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&s.some(l=>l.type=="childList"&&l.removedNodes.length||l.type=="characterData"&&l.oldValue.length>l.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var s;((s=this.view.docView)===null||s===void 0?void 0:s.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(s=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),s.length>0&&s[s.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(s=>{s.length>0&&s[s.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((s,l)=>s!=e[l]))){this.gapIntersection.disconnect();for(let s of e)this.gapIntersection.observe(s);this.gaps=e}}onSelectionChange(e){let s=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:l}=this,a=this.selectionRange;if(l.state.facet(editable)?l.root.activeElement!=this.dom:!hasSelection(l.dom,a))return;let h=a.anchorNode&&l.docView.nearest(a.anchorNode);if(h&&h.ignoreEvent(e)){s||(this.selectionChanged=!1);return}(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!l.state.selection.main.empty&&a.focusNode&&isEquivalentPosition(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,s=browser.safari&&e.root.nodeType==11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariSelectionRangeHack(this.view)||getSelection(e.root);if(!s||this.selectionRange.eq(s))return!1;let l=hasSelection(this.dom,s);return l&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,s)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(s),l&&(this.selectionChanged=!0),!0)}setSelectionRange(e,s){this.selectionRange.set(e.node,e.offset,s.node,s.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,s=null;for(let l=this.dom;l;)if(l.nodeType==1)!s&&e<this.scrollTargets.length&&this.scrollTargets[e]==l?e++:s||(s=this.scrollTargets.slice(0,e)),s&&s.push(l),l=l.assignedSlot||l.parentNode;else if(l.nodeType==11)l=l.host;else break;if(e<this.scrollTargets.length&&!s&&(s=this.scrollTargets.slice(0,e)),s){for(let l of this.scrollTargets)l.removeEventListener("scroll",this.onScroll);for(let l of this.scrollTargets=s)l.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,s){var l;if(!this.delayedAndroidKey){let a=()=>{let h=this.delayedAndroidKey;h&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=h.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&h.force&&dispatchKey(this.dom,h.key,h.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(a)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:s,force:this.lastChange<Date.now()-50||!!(!((l=this.delayedAndroidKey)===null||l===void 0)&&l.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let s=-1,l=-1,a=!1;for(let h of e){let f=this.readMutation(h);f&&(f.typeOver&&(a=!0),s==-1?{from:s,to:l}=f:(s=Math.min(f.from,s),l=Math.max(f.to,l)))}return{from:s,to:l,typeOver:a}}readChange(){let{from:e,to:s,typeOver:l}=this.processRecords(),a=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(e<0&&!a)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let h=new DOMChange(this.view,e,s,l);return this.view.docView.domChanged={newSel:h.newSel?h.newSel.main:null},h}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let s=this.readChange();if(!s)return!1;let l=this.view.state,a=applyDOMChange(this.view,s);return this.view.state==l&&this.view.update([]),a}readMutation(e){let s=this.view.docView.nearest(e.target);if(!s||s.ignoreMutation(e))return null;if(s.markDirty(e.type=="attributes"),e.type=="attributes"&&(s.flags|=4),e.type=="childList"){let l=findChild(s,e.previousSibling||e.target.previousSibling,-1),a=findChild(s,e.nextSibling||e.target.nextSibling,1);return{from:l?s.posAfter(l):s.posAtStart,to:a?s.posBefore(a):s.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,s,l,a;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(s=this.gapIntersection)===null||s===void 0||s.disconnect(),(l=this.resizeScroll)===null||l===void 0||l.disconnect(),(a=this.resizeContent)===null||a===void 0||a.disconnect();for(let h of this.scrollTargets)h.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function findChild(o,e,s){for(;e;){let l=ContentView.get(e);if(l&&l.parent==o)return l;let a=e.parentNode;e=a!=o.dom?a:s>0?e.nextSibling:e.previousSibling}return null}function safariSelectionRangeHack(o){let e=null;function s(p){p.preventDefault(),p.stopImmediatePropagation(),e=p.getTargetRanges()[0]}if(o.contentDOM.addEventListener("beforeinput",s,!0),o.dom.ownerDocument.execCommand("indent"),o.contentDOM.removeEventListener("beforeinput",s,!0),!e)return null;let l=e.startContainer,a=e.startOffset,h=e.endContainer,f=e.endOffset,u=o.docView.domAtPos(o.state.selection.main.anchor);return isEquivalentPosition(u.node,u.offset,h,f)&&([l,a,h,f]=[h,f,l,a]),{anchorNode:l,anchorOffset:a,focusNode:h,focusOffset:f}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM);let{dispatch:s}=e;this.dispatchTransactions=e.dispatchTransactions||s&&(l=>l.forEach(a=>s(a,this)))||(l=>this.update(l)),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),this.plugins=this.state.facet(viewPlugin).map(l=>new PluginInstance(l));for(let l of this.plugins)l.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}dispatch(...e){let s=e.length==1&&e[0]instanceof Transaction?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(s,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let s=!1,l=!1,a,h=this.state;for(let w of e){if(w.startState!=h)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");h=w.state}if(this.destroyed){this.viewState.state=h;return}let f=this.hasFocus,u=0,p=null;e.some(w=>w.annotation(isFocusChange))?(this.inputState.notifiedFocused=f,u=1):f!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=f,p=focusChangeTransaction(h,f),p||(u=1));let m=this.observer.delayedAndroidKey,g=null;if(m?(this.observer.clearDelayedAndroidKey(),g=this.observer.readChange(),(g&&!this.state.doc.eq(h.doc)||!this.state.selection.eq(h.selection))&&(g=null)):this.observer.clear(),h.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(h);a=ViewUpdate.create(this,h,e),a.flags|=u;let y=this.viewState.scrollTarget;try{this.updateState=2;for(let w of e){if(y&&(y=y.map(w.changes)),w.scrollIntoView){let{main:x}=w.state.selection;y=new ScrollTarget(x.empty?x:EditorSelection.cursor(x.head,x.head>x.anchor?-1:1))}for(let x of w.effects)x.is(scrollIntoView$1)&&(y=x.value)}this.viewState.update(a,y),this.bidiCache=CachedOrder.update(this.bidiCache,a.changes),a.empty||(this.updatePlugins(a),this.inputState.update(a)),s=this.docView.update(a),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),l=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(s,e.some(w=>w.isUserEvent("select.pointer")))}finally{this.updateState=0}if(a.startState.facet(theme)!=a.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(s||l||y||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!a.empty)for(let w of this.state.facet(updateListener))w(a);(p||g)&&Promise.resolve().then(()=>{p&&this.state==p.startState&&this.dispatch(p),g&&!applyDOMChange(this,g)&&m.force&&dispatchKey(this.contentDOM,m.key,m.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let s=this.hasFocus;try{for(let l of this.plugins)l.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map(l=>new PluginInstance(l)),this.pluginMap.clear();for(let l of this.plugins)l.update(this);this.docView=new DocView(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}s&&this.focus(),this.requestMeasure()}updatePlugins(e){let s=e.startState.facet(viewPlugin),l=e.state.facet(viewPlugin);if(s!=l){let a=[];for(let h of l){let f=s.indexOf(h);if(f<0)a.push(new PluginInstance(h));else{let u=this.plugins[f];u.mustUpdate=e,a.push(u)}}for(let h of this.plugins)h.mustUpdate!=e&&h.destroy(this);this.plugins=a,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let a of this.plugins)a.mustUpdate=e;for(let a=0;a<this.plugins.length;a++)this.plugins[a].update(this)}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let s=null,l=this.scrollDOM,a=l.scrollTop*this.scaleY,{scrollAnchorPos:h,scrollAnchorHeight:f}=this.viewState;Math.abs(a-this.viewState.scrollTop)>1&&(f=-1),this.viewState.scrollAnchorHeight=-1;try{for(let u=0;;u++){if(f<0)if(isScrolledToBottom(l))h=-1,f=this.viewState.heightMap.height;else{let x=this.viewState.scrollAnchorAt(a);h=x.from,f=x.top}this.updateState=1;let p=this.viewState.measure(this);if(!p&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(u>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let m=[];p&4||([this.measureRequests,m]=[m,this.measureRequests]);let g=m.map(x=>{try{return x.read(this)}catch(b){return logException(this.state,b),BadMeasure}}),y=ViewUpdate.create(this,this.state,[]),w=!1;y.flags|=p,s?s.flags|=p:s=y,this.updateState=2,y.empty||(this.updatePlugins(y),this.inputState.update(y),this.updateAttrs(),w=this.docView.update(y));for(let x=0;x<m.length;x++)if(g[x]!=BadMeasure)try{let b=m[x];b.write&&b.write(g[x],this)}catch(b){logException(this.state,b)}if(w&&this.docView.updateSelection(!0),!y.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null;continue}else{let b=(h<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(h).top)-f;if(b>1||b<-1){a=a+b,l.scrollTop=a/this.scaleY,f=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(s&&!s.empty)for(let u of this.state.facet(updateListener))u(s)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),s={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(s["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,s);let l=this.observer.ignore(()=>{let a=updateAttrs(this.contentDOM,this.contentAttrs,s),h=updateAttrs(this.dom,this.editorAttrs,e);return a||h});return this.editorAttrs=e,this.contentAttrs=s,l}showAnnouncements(e){let s=!0;for(let l of e)for(let a of l.effects)if(a.is(EditorView.announce)){s&&(this.announceDOM.textContent=""),s=!1;let h=this.announceDOM.appendChild(document.createElement("div"));h.textContent=a.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let e=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$3).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let s=0;s<this.measureRequests.length;s++)if(this.measureRequests[s].key===e.key){this.measureRequests[s]=e;return}}this.measureRequests.push(e)}}plugin(e){let s=this.pluginMap.get(e);return(s===void 0||s&&s.spec!=e)&&this.pluginMap.set(e,s=this.plugins.find(l=>l.spec==e)||null),s&&s.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,s,l){return skipAtoms(this,e,moveByChar(this,e,s,l))}moveByGroup(e,s){return skipAtoms(this,e,moveByChar(this,e,s,l=>byGroup(this,e.head,l)))}moveToLineBoundary(e,s,l=!0){return moveToLineBoundary(this,e,s,l)}moveVertically(e,s,l){return skipAtoms(this,e,moveVertically(this,e,s,l))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,s=0){return this.docView.posFromDOM(e,s)}posAtCoords(e,s=!0){return this.readMeasured(),posAtCoords(this,e,s)}coordsAtPos(e,s=1){this.readMeasured();let l=this.docView.coordsAt(e,s);if(!l||l.left==l.right)return l;let a=this.state.doc.lineAt(e),h=this.bidiSpans(a),f=h[BidiSpan.find(h,e-a.from,-1,s)];return flattenRect(l,f.dir==Direction.LTR==s>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let s=this.textDirectionAt(e.from),l;for(let h of this.bidiCache)if(h.from==e.from&&h.dir==s&&(h.fresh||isolatesEq(h.isolates,l=getIsolatedRanges(this,e.from,e.to))))return h.order;l||(l=getIsolatedRanges(this,e.from,e.to));let a=computeOrder(e.text,s,l);return this.bidiCache.push(new CachedOrder(e.from,e.to,s,l,!0,a)),a}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,s={}){return scrollIntoView$1.of(new ScrollTarget(typeof e=="number"?EditorSelection.cursor(e):e,s.y,s.x,s.yMargin,s.xMargin))}static domEventHandlers(e){return ViewPlugin.define(()=>({}),{eventHandlers:e})}static theme(e,s){let l=StyleModule.newName(),a=[theme.of(l),styleModule.of(buildTheme(`.${l}`,e))];return s&&s.dark&&a.push(darkTheme.of(!0)),a}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var s;let l=e.querySelector(".cm-content"),a=l&&ContentView.get(l)||ContentView.get(e);return((s=a==null?void 0:a.rootView)===null||s===void 0?void 0:s.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler$1;EditorView.focusChangeEffect=focusChangeEffect;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.atomicRanges=atomicRanges;EditorView.bidiIsolatedRanges=bidiIsolatedRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.cspNonce=Facet.define({combine:o=>o.length?o[0]:""});EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,s,l,a,h,f){this.from=e,this.to=s,this.dir=l,this.isolates=a,this.fresh=h,this.order=f}static update(e,s){if(s.empty&&!e.some(h=>h.fresh))return e;let l=[],a=e.length?e[e.length-1].dir:Direction.LTR;for(let h=Math.max(0,e.length-10);h<e.length;h++){let f=e[h];f.dir==a&&!s.touchesRange(f.from,f.to)&&l.push(new CachedOrder(s.mapPos(f.from,1),s.mapPos(f.to,-1),f.dir,f.isolates,!1,f.order))}return l}}function attrsFromFacet(o,e,s){for(let l=o.state.facet(e),a=l.length-1;a>=0;a--){let h=l[a],f=typeof h=="function"?h(o):h;f&&combineAttrs(f,s)}return s}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(o,e){const s=o.split(/-(?!$)/);let l=s[s.length-1];l=="Space"&&(l=" ");let a,h,f,u;for(let p=0;p<s.length-1;++p){const m=s[p];if(/^(cmd|meta|m)$/i.test(m))u=!0;else if(/^a(lt)?$/i.test(m))a=!0;else if(/^(c|ctrl|control)$/i.test(m))h=!0;else if(/^s(hift)?$/i.test(m))f=!0;else if(/^mod$/i.test(m))e=="mac"?u=!0:h=!0;else throw new Error("Unrecognized modifier name: "+m)}return a&&(l="Alt-"+l),h&&(l="Ctrl-"+l),u&&(l="Meta-"+l),f&&(l="Shift-"+l),l}function modifiers(o,e,s){return e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o),e.metaKey&&(o="Meta-"+o),s!==!1&&e.shiftKey&&(o="Shift-"+o),o}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(o,e){return runHandlers(getKeymap(e.state),o,e,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(o){let e=o.facet(keymap),s=Keymaps.get(e);return s||Keymaps.set(e,s=buildKeymap(e.reduce((l,a)=>l.concat(a),[]))),s}function runScopeHandlers(o,e,s){return runHandlers(getKeymap(o.state),e,o,s)}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(o,e=currentPlatform){let s=Object.create(null),l=Object.create(null),a=(f,u)=>{let p=l[f];if(p==null)l[f]=u;else if(p!=u)throw new Error("Key binding "+f+" is used both as a regular binding and as a multi-stroke prefix")},h=(f,u,p,m,g)=>{var y,w;let x=s[f]||(s[f]=Object.create(null)),b=u.split(/ (?!$)/).map(P=>normalizeKeyName(P,e));for(let P=1;P<b.length;P++){let E=b.slice(0,P).join(" ");a(E,!0),x[E]||(x[E]={preventDefault:!0,stopPropagation:!1,run:[R=>{let O=storedPrefix={view:R,prefix:E,scope:f};return setTimeout(()=>{storedPrefix==O&&(storedPrefix=null)},PrefixTimeout),!0}]})}let k=b.join(" ");a(k,!1);let S=x[k]||(x[k]={preventDefault:!1,stopPropagation:!1,run:((w=(y=x._any)===null||y===void 0?void 0:y.run)===null||w===void 0?void 0:w.slice())||[]});p&&S.run.push(p),m&&(S.preventDefault=!0),g&&(S.stopPropagation=!0)};for(let f of o){let u=f.scope?f.scope.split(" "):["editor"];if(f.any)for(let m of u){let g=s[m]||(s[m]=Object.create(null));g._any||(g._any={preventDefault:!1,stopPropagation:!1,run:[]});for(let y in g)g[y].run.push(f.any)}let p=f[e]||f.key;if(p)for(let m of u)h(m,p,f.run,f.preventDefault,f.stopPropagation),f.shift&&h(m,"Shift-"+p,f.shift,f.preventDefault,f.stopPropagation)}return s}function runHandlers(o,e,s,l){let a=keyName(e),h=codePointAt(a,0),f=codePointSize(h)==a.length&&a!=" ",u="",p=!1,m=!1,g=!1;storedPrefix&&storedPrefix.view==s&&storedPrefix.scope==l&&(u=storedPrefix.prefix+" ",modifierCodes.indexOf(e.keyCode)<0&&(m=!0,storedPrefix=null));let y=new Set,w=S=>{if(S){for(let P of S.run)if(!y.has(P)&&(y.add(P),P(s,e)))return S.stopPropagation&&(g=!0),!0;S.preventDefault&&(S.stopPropagation&&(g=!0),m=!0)}return!1},x=o[l],b,k;return x&&(w(x[u+modifiers(a,e,!f)])?p=!0:f&&(e.altKey||e.metaKey||e.ctrlKey)&&!(browser.windows&&e.ctrlKey&&e.altKey)&&(b=base[e.keyCode])&&b!=a?(w(x[u+modifiers(b,e,!0)])||e.shiftKey&&(k=shift[e.keyCode])!=a&&k!=b&&w(x[u+modifiers(k,e,!1)]))&&(p=!0):f&&e.shiftKey&&w(x[u+modifiers(a,e,!0)])&&(p=!0),!p&&w(x._any)&&(p=!0)),m&&(p=!0),p&&g&&e.stopPropagation(),p}class RectangleMarker{constructor(e,s,l,a,h){this.className=e,this.left=s,this.top=l,this.width=a,this.height=h}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,s){return s.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,s,l){if(l.empty){let a=e.coordsAtPos(l.head,l.assoc||1);if(!a)return[];let h=getBase(e);return[new RectangleMarker(s,a.left-h.left,a.top-h.top,null,a.bottom-a.top)]}else return rectanglesForRange(e,s,l)}}function getBase(o){let e=o.scrollDOM.getBoundingClientRect();return{left:(o.textDirection==Direction.LTR?e.left:e.right-o.scrollDOM.clientWidth*o.scaleX)-o.scrollDOM.scrollLeft*o.scaleX,top:e.top-o.scrollDOM.scrollTop*o.scaleY}}function wrappedLine(o,e,s){let l=EditorSelection.cursor(e);return{from:Math.max(s.from,o.moveToLineBoundary(l,!1,!0).from),to:Math.min(s.to,o.moveToLineBoundary(l,!0,!0).from),type:BlockType.Text}}function rectanglesForRange(o,e,s){if(s.to<=o.viewport.from||s.from>=o.viewport.to)return[];let l=Math.max(s.from,o.viewport.from),a=Math.min(s.to,o.viewport.to),h=o.textDirection==Direction.LTR,f=o.contentDOM,u=f.getBoundingClientRect(),p=getBase(o),m=f.querySelector(".cm-line"),g=m&&window.getComputedStyle(m),y=u.left+(g?parseInt(g.paddingLeft)+Math.min(0,parseInt(g.textIndent)):0),w=u.right-(g?parseInt(g.paddingRight):0),x=blockAt(o,l),b=blockAt(o,a),k=x.type==BlockType.Text?x:null,S=b.type==BlockType.Text?b:null;if(k&&(o.lineWrapping||x.widgetLineBreaks)&&(k=wrappedLine(o,l,k)),S&&(o.lineWrapping||b.widgetLineBreaks)&&(S=wrappedLine(o,a,S)),k&&S&&k.from==S.from)return E(R(s.from,s.to,k));{let T=k?R(s.from,null,k):O(x,!1),M=S?R(null,s.to,S):O(b,!0),$=[];return(k||x).to<(S||b).from-(k&&S?1:0)||x.widgetLineBreaks>1&&T.bottom+o.defaultLineHeight/2<M.top?$.push(P(y,T.bottom,w,M.top)):T.bottom<M.top&&o.elementAtHeight((T.bottom+M.top)/2).type==BlockType.Text&&(T.bottom=M.top=(T.bottom+M.top)/2),E(T).concat($).concat(E(M))}function P(T,M,$,D){return new RectangleMarker(e,T-p.left,M-p.top-.01,$-T,D-M+.01)}function E({top:T,bottom:M,horizontal:$}){let D=[];for(let _=0;_<$.length;_+=2)D.push(P($[_],T,$[_+1],M));return D}function R(T,M,$){let D=1e9,_=-1e9,B=[];function I(H,V,F,j,W){let L=o.coordsAtPos(H,H==$.to?-2:2),q=o.coordsAtPos(F,F==$.from?2:-2);!L||!q||(D=Math.min(L.top,q.top,D),_=Math.max(L.bottom,q.bottom,_),W==Direction.LTR?B.push(h&&V?y:L.left,h&&j?w:q.right):B.push(!h&&j?y:q.left,!h&&V?w:L.right))}let N=T??$.from,Q=M??$.to;for(let H of o.visibleRanges)if(H.to>N&&H.from<Q)for(let V=Math.max(H.from,N),F=Math.min(H.to,Q);;){let j=o.state.doc.lineAt(V);for(let W of o.bidiSpans(j)){let L=W.from+j.from,q=W.to+j.from;if(L>=F)break;q>V&&I(Math.max(L,V),T==null&&L<=N,Math.min(q,F),M==null&&q>=Q,W.dir)}if(V=j.to+1,V>=F)break}return B.length==0&&I(N,T==null,Q,M==null,o.textDirection),{top:D,bottom:_,horizontal:B}}function O(T,M){let $=u.top+(M?T.top:T.bottom);return{top:$,bottom:$,horizontal:[]}}}function sameMarker(o,e){return o.constructor==e.constructor&&o.eq(e)}class LayerView{constructor(e,s){this.view=e,this.layer=s,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),s.above&&this.dom.classList.add("cm-layer-above"),s.class&&this.dom.classList.add(s.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),s.mount&&s.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}setOrder(e){let s=0,l=e.facet(layerOrder);for(;s<l.length&&l[s]!=this.layer;)s++;this.dom.style.zIndex=String((this.layer.above?150:-1)-s)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:s}=this.view;(e!=this.scaleX||s!=this.scaleY)&&(this.scaleX=e,this.scaleY=s,this.dom.style.transform=`scale(${1/e}, ${1/s})`)}draw(e){if(e.length!=this.drawn.length||e.some((s,l)=>!sameMarker(s,this.drawn[l]))){let s=this.dom.firstChild,l=0;for(let a of e)a.update&&s&&a.constructor&&this.drawn[l].constructor&&a.update(s,this.drawn[l])?(s=s.nextSibling,l++):this.dom.insertBefore(a.draw(),s);for(;s;){let a=s.nextSibling;s.remove(),s=a}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(o){return[ViewPlugin.define(e=>new LayerView(e,o)),layerOrder.of(o)]}const CanHidePrimary=!browser.ios,selectionConfig=Facet.define({combine(o){return combineConfig(o,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,s)=>Math.min(e,s),drawRangeCursor:(e,s)=>e||s})}});function drawSelection(o={}){return[selectionConfig.of(o),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(o){return o.startState.facet(selectionConfig)!=o.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(o){let{state:e}=o,s=e.facet(selectionConfig),l=[];for(let a of e.selection.ranges){let h=a==e.selection.main;if(a.empty?!h||CanHidePrimary:s.drawRangeCursor){let f=h?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",u=a.empty?a:EditorSelection.cursor(a.head,a.head>a.anchor?-1:1);for(let p of RectangleMarker.forRange(o,f,u))l.push(p)}}return l},update(o,e){o.transactions.some(l=>l.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let s=configChanged(o);return s&&setBlinkRate(o.state,e),o.docChanged||o.selectionSet||s},mount(o,e){setBlinkRate(e.state,o)},class:"cm-cursorLayer"});function setBlinkRate(o,e){e.style.animationDuration=o.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers(o){return o.state.selection.ranges.map(e=>e.empty?[]:RectangleMarker.forRange(o,"cm-selectionBackground",e)).reduce((e,s)=>e.concat(s))},update(o,e){return o.docChanged||o.selectionSet||o.viewportChanged||configChanged(o)},class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor="transparent !important");const hideNativeSelection=Prec.highest(EditorView.theme(themeSpec)),setDropCursorPos=StateEffect.define({map(o,e){return o==null?null:e.mapPos(o)}}),dropCursorPos=StateField.define({create(){return null},update(o,e){return o!=null&&(o=e.changes.mapPos(o)),e.effects.reduce((s,l)=>l.is(setDropCursorPos)?l.value:s,o)}}),drawDropCursor=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(o){var e;let s=o.state.field(dropCursorPos);s==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(o.startState.field(dropCursorPos)!=s||o.docChanged||o.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:o}=this,e=o.state.field(dropCursorPos),s=e!=null&&o.coordsAtPos(e);if(!s)return null;let l=o.scrollDOM.getBoundingClientRect();return{left:s.left-l.left+o.scrollDOM.scrollLeft*o.scaleX,top:s.top-l.top+o.scrollDOM.scrollTop*o.scaleY,height:s.bottom-s.top}}drawCursor(o){if(this.cursor){let{scaleX:e,scaleY:s}=this.view;o?(this.cursor.style.left=o.left/e+"px",this.cursor.style.top=o.top/s+"px",this.cursor.style.height=o.height/s+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(o){this.view.state.field(dropCursorPos)!=o&&this.view.dispatch({effects:setDropCursorPos.of(o)})}},{eventHandlers:{dragover(o){this.setDropPos(this.view.posAtCoords({x:o.clientX,y:o.clientY}))},dragleave(o){(o.target==this.view.contentDOM||!this.view.contentDOM.contains(o.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(o,e,s,l,a){e.lastIndex=0;for(let h=o.iterRange(s,l),f=s,u;!h.next().done;f+=h.value.length)if(!h.lineBreak)for(;u=e.exec(h.value);)a(f+u.index,u)}function matchRanges(o,e){let s=o.visibleRanges;if(s.length==1&&s[0].from==o.viewport.from&&s[0].to==o.viewport.to)return s;let l=[];for(let{from:a,to:h}of s)a=Math.max(o.state.doc.lineAt(a).from,a-e),h=Math.min(o.state.doc.lineAt(h).to,h+e),l.length&&l[l.length-1].to>=a?l[l.length-1].to=h:l.push({from:a,to:h});return l}class MatchDecorator{constructor(e){const{regexp:s,decoration:l,decorate:a,boundary:h,maxLength:f=1e3}=e;if(!s.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=s,a)this.addMatch=(u,p,m,g)=>a(g,m,m+u[0].length,u,p);else if(typeof l=="function")this.addMatch=(u,p,m,g)=>{let y=l(u,p,m);y&&g(m,m+u[0].length,y)};else if(l)this.addMatch=(u,p,m,g)=>g(m,m+u[0].length,l);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=h,this.maxLength=f}createDeco(e){let s=new RangeSetBuilder,l=s.add.bind(s);for(let{from:a,to:h}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,a,h,(f,u)=>this.addMatch(u,e,f,l));return s.finish()}updateDeco(e,s){let l=1e9,a=-1;return e.docChanged&&e.changes.iterChanges((h,f,u,p)=>{p>e.view.viewport.from&&u<e.view.viewport.to&&(l=Math.min(u,l),a=Math.max(p,a))}),e.viewportChanged||a-l>1e3?this.createDeco(e.view):a>-1?this.updateRange(e.view,s.map(e.changes),l,a):s}updateRange(e,s,l,a){for(let h of e.visibleRanges){let f=Math.max(h.from,l),u=Math.min(h.to,a);if(u>f){let p=e.state.doc.lineAt(f),m=p.to<u?e.state.doc.lineAt(u):p,g=Math.max(h.from,p.from),y=Math.min(h.to,m.to);if(this.boundary){for(;f>p.from;f--)if(this.boundary.test(p.text[f-1-p.from])){g=f;break}for(;u<m.to;u++)if(this.boundary.test(m.text[u-m.from])){y=u;break}}let w=[],x,b=(k,S,P)=>w.push(P.range(k,S));if(p==m)for(this.regexp.lastIndex=g-p.from;(x=this.regexp.exec(p.text))&&x.index<y-p.from;)this.addMatch(x,e,x.index+p.from,b);else iterMatches(e.state.doc,this.regexp,g,y,(k,S)=>this.addMatch(S,e,k,b));s=s.update({filterFrom:g,filterTo:y,filter:(k,S)=>k<g||S>y,add:w})}}return s}}const UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g",Specials=new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`,UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var o;if(_supportsTabSize==null&&typeof document<"u"&&document.body){let e=document.body.style;_supportsTabSize=((o=e.tabSize)!==null&&o!==void 0?o:e.MozTabSize)!=null}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(o){let e=combineConfig(o,{render:null,specialChars:Specials,addSpecialChars:null});return(e.replaceTabs=!supportsTabSize())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,UnicodeRegexpSupport)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,UnicodeRegexpSupport)),e}});function highlightSpecialChars(o={}){return[specialCharConfig.of(o),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(o.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(o)}makeDecorator(o){return new MatchDecorator({regexp:o.specialChars,decoration:(e,s,l)=>{let{doc:a}=s.state,h=codePointAt(e[0],0);if(h==9){let f=a.lineAt(l),u=s.state.tabSize,p=countColumn(f.text,u,l-f.from);return Decoration.replace({widget:new TabWidget((u-p%u)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[h]||(this.decorationCache[h]=Decoration.replace({widget:new SpecialCharWidget(o,h)}))},boundary:o.replaceTabs?void 0:/[^]/})}update(o){let e=o.state.facet(specialCharConfig);o.startState.facet(specialCharConfig)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(o.view)):this.decorations=this.decorator.updateDeco(o,this.decorations)}},{decorations:o=>o.decorations}))}const DefaultPlaceholder="â€¢";function placeholder$1(o){return o>=32?DefaultPlaceholder:o==10?"â¤":String.fromCharCode(9216+o)}class SpecialCharWidget extends WidgetType{constructor(e,s){super(),this.options=e,this.code=s}eq(e){return e.code==this.code}toDOM(e){let s=placeholder$1(this.code),l=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),a=this.options.render&&this.options.render(this.code,l,s);if(a)return a;let h=document.createElement("span");return h.textContent=s,h.title=l,h.setAttribute("aria-label",l),h.className="cm-specialChar",h}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(o){this.decorations=this.getDeco(o)}update(o){(o.docChanged||o.selectionSet)&&(this.decorations=this.getDeco(o.view))}getDeco(o){let e=-1,s=[];for(let l of o.state.selection.ranges){let a=o.lineBlockAt(l.head);a.from>e&&(s.push(lineDeco.range(a.from)),e=a.from)}return Decoration.set(s)}},{decorations:o=>o.decorations}),MaxOff=2e3;function rectangleFor(o,e,s){let l=Math.min(e.line,s.line),a=Math.max(e.line,s.line),h=[];if(e.off>MaxOff||s.off>MaxOff||e.col<0||s.col<0){let f=Math.min(e.off,s.off),u=Math.max(e.off,s.off);for(let p=l;p<=a;p++){let m=o.doc.line(p);m.length<=u&&h.push(EditorSelection.range(m.from+f,m.to+u))}}else{let f=Math.min(e.col,s.col),u=Math.max(e.col,s.col);for(let p=l;p<=a;p++){let m=o.doc.line(p),g=findColumn(m.text,f,o.tabSize,!0);if(g<0)h.push(EditorSelection.cursor(m.to));else{let y=findColumn(m.text,u,o.tabSize);h.push(EditorSelection.range(m.from+g,m.from+y))}}}return h}function absoluteColumn(o,e){let s=o.coordsAtPos(o.viewport.from);return s?Math.round(Math.abs((s.left-e)/o.defaultCharacterWidth)):-1}function getPos(o,e){let s=o.posAtCoords({x:e.clientX,y:e.clientY},!1),l=o.state.doc.lineAt(s),a=s-l.from,h=a>MaxOff?-1:a==l.length?absoluteColumn(o,e.clientX):countColumn(l.text,o.state.tabSize,s-l.from);return{line:l.number,col:h,off:a}}function rectangleSelectionStyle(o,e){let s=getPos(o,e),l=o.state.selection;return s?{update(a){if(a.docChanged){let h=a.changes.mapPos(a.startState.doc.line(s.line).from),f=a.state.doc.lineAt(h);s={line:f.number,col:s.col,off:Math.min(s.off,f.length)},l=l.map(a.changes)}},get(a,h,f){let u=getPos(o,a);if(!u)return l;let p=rectangleFor(o.state,s,u);return p.length?f?EditorSelection.create(p.concat(l.ranges)):EditorSelection.create(p):l}}:null}function rectangularSelection(o){let e=(o==null?void 0:o.eventFilter)||(s=>s.altKey&&s.button==0);return EditorView.mouseSelectionStyle.of((s,l)=>e(l)?rectangleSelectionStyle(s,l):null)}const keys$1={Alt:[18,o=>!!o.altKey],Control:[17,o=>!!o.ctrlKey],Shift:[16,o=>!!o.shiftKey],Meta:[91,o=>!!o.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(o={}){let[e,s]=keys$1[o.key||"Alt"],l=ViewPlugin.fromClass(class{constructor(a){this.view=a,this.isDown=!1}set(a){this.isDown!=a&&(this.isDown=a,this.view.update([]))}},{eventHandlers:{keydown(a){this.set(a.keyCode==e||s(a))},keyup(a){(a.keyCode==e||!s(a))&&this.set(!1)},mousemove(a){this.set(s(a))}}});return[l,EditorView.contentAttributes.of(a=>{var h;return!((h=a.plugin(l))===null||h===void 0)&&h.isDown?showCrosshair:null})]}const Outside="-10000px";class TooltipViewManager{constructor(e,s,l){this.facet=s,this.createTooltipView=l,this.input=e.state.facet(s),this.tooltips=this.input.filter(a=>a),this.tooltipViews=this.tooltips.map(l)}update(e){var s;let l=e.state.facet(this.facet),a=l.filter(f=>f);if(l===this.input){for(let f of this.tooltipViews)f.update&&f.update(e);return!1}let h=[];for(let f=0;f<a.length;f++){let u=a[f],p=-1;if(u){for(let m=0;m<this.tooltips.length;m++){let g=this.tooltips[m];g&&g.create==u.create&&(p=m)}if(p<0)h[f]=this.createTooltipView(u);else{let m=h[f]=this.tooltipViews[p];m.update&&m.update(e)}}}for(let f of this.tooltipViews)h.indexOf(f)<0&&(f.dom.remove(),(s=f.destroy)===null||s===void 0||s.call(f));return this.input=l,this.tooltips=a,this.tooltipViews=h,!0}}function windowSpace(o){let{win:e}=o;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const tooltipConfig=Facet.define({combine:o=>{var e,s,l;return{position:browser.ios?"absolute":((e=o.find(a=>a.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((s=o.find(a=>a.parent))===null||s===void 0?void 0:s.parent)||null,tooltipSpace:((l=o.find(a=>a.tooltipSpace))===null||l===void 0?void 0:l.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=o.state.facet(tooltipConfig);this.position=e.position,this.parent=e.parent,this.classes=o.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new TooltipViewManager(o,showTooltip,s=>this.createTooltip(s)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(s=>{Date.now()>this.lastTransaction-50&&s.length>0&&s[s.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),o.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let o of this.manager.tooltipViews)this.intersectionObserver.observe(o.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(o){o.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(o);e&&this.observeIntersection();let s=e||o.geometryChanged,l=o.state.facet(tooltipConfig);if(l.position!=this.position&&!this.madeAbsolute){this.position=l.position;for(let a of this.manager.tooltipViews)a.dom.style.position=this.position;s=!0}if(l.parent!=this.parent){this.parent&&this.container.remove(),this.parent=l.parent,this.createContainer();for(let a of this.manager.tooltipViews)this.container.appendChild(a.dom);s=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);s&&this.maybeMeasure()}createTooltip(o){let e=o.create(this.view);if(e.dom.classList.add("cm-tooltip"),o.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let s=document.createElement("div");s.className="cm-tooltip-arrow",e.dom.appendChild(s)}return e.dom.style.position=this.position,e.dom.style.top=Outside,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var o,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let s of this.manager.tooltipViews)s.dom.remove(),(o=s.destroy)===null||o===void 0||o.call(s);(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let o=this.view.dom.getBoundingClientRect(),e=1,s=1,l=!1;if(this.position=="fixed"){let a=this.manager.tooltipViews;l=a.length>0&&a[0].dom.offsetParent!=this.container.ownerDocument.body}if(l||this.position=="absolute")if(this.parent){let a=this.parent.getBoundingClientRect();a.width&&a.height&&(e=a.width/this.parent.offsetWidth,s=a.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:s}=this.view.viewState);return{editor:o,parent:this.parent?this.container.getBoundingClientRect():o,pos:this.manager.tooltips.map((a,h)=>{let f=this.manager.tooltipViews[h];return f.getCoords?f.getCoords(a.pos):this.view.coordsAtPos(a.pos)}),size:this.manager.tooltipViews.map(({dom:a})=>a.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX:e,scaleY:s,makeAbsolute:l}}writeMeasure(o){var e;if(o.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let u of this.manager.tooltipViews)u.dom.style.position="absolute"}let{editor:s,space:l,scaleX:a,scaleY:h}=o,f=[];for(let u=0;u<this.manager.tooltips.length;u++){let p=this.manager.tooltips[u],m=this.manager.tooltipViews[u],{dom:g}=m,y=o.pos[u],w=o.size[u];if(!y||y.bottom<=Math.max(s.top,l.top)||y.top>=Math.min(s.bottom,l.bottom)||y.right<Math.max(s.left,l.left)-.1||y.left>Math.min(s.right,l.right)+.1){g.style.top=Outside;continue}let x=p.arrow?m.dom.querySelector(".cm-tooltip-arrow"):null,b=x?7:0,k=w.right-w.left,S=(e=knownHeight.get(m))!==null&&e!==void 0?e:w.bottom-w.top,P=m.offset||noOffset,E=this.view.textDirection==Direction.LTR,R=w.width>l.right-l.left?E?l.left:l.right-w.width:E?Math.min(y.left-(x?14:0)+P.x,l.right-k):Math.max(l.left,y.left-k+(x?14:0)-P.x),O=!!p.above;!p.strictSide&&(O?y.top-(w.bottom-w.top)-P.y<l.top:y.bottom+(w.bottom-w.top)+P.y>l.bottom)&&O==l.bottom-y.bottom>y.top-l.top&&(O=!O);let T=(O?y.top-l.top:l.bottom-y.bottom)-b;if(T<S&&m.resize!==!1){if(T<this.view.defaultLineHeight){g.style.top=Outside;continue}knownHeight.set(m,S),g.style.height=(S=T)/h+"px"}else g.style.height&&(g.style.height="");let M=O?y.top-S-b-P.y:y.bottom+b+P.y,$=R+k;if(m.overlap!==!0)for(let D of f)D.left<$&&D.right>R&&D.top<M+S&&D.bottom>M&&(M=O?D.top-S-2-b:D.bottom+b+2);if(this.position=="absolute"?(g.style.top=(M-o.parent.top)/h+"px",g.style.left=(R-o.parent.left)/a+"px"):(g.style.top=M/h+"px",g.style.left=R/a+"px"),x){let D=y.left+(E?P.x:-P.x)-(R+14-7);x.style.left=D/a+"px"}m.overlap!==!0&&f.push({left:R,top:M,right:$,bottom:M+S}),g.classList.toggle("cm-tooltip-above",O),g.classList.toggle("cm-tooltip-below",!O),m.positioned&&m.positioned(o.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let o of this.manager.tooltipViews)o.dom.style.top=Outside}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),baseTheme$4=EditorView.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$4]}),showHoverTooltip=Facet.define();class HoverTooltipHost{static create(e){return new HoverTooltipHost(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new TooltipViewManager(e,showHoverTooltip,s=>this.createHostedView(s))}createHostedView(e){let s=e.create(this.view);return s.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(s.dom),this.mounted&&s.mount&&s.mount(this.view),s}mount(e){for(let s of this.manager.tooltipViews)s.mount&&s.mount(e);this.mounted=!0}positioned(e){for(let s of this.manager.tooltipViews)s.positioned&&s.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let s of this.manager.tooltipViews)(e=s.destroy)===null||e===void 0||e.call(s)}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],o=>{let e=o.facet(showHoverTooltip).filter(s=>s);return e.length===0?null:{pos:Math.min(...e.map(s=>s.pos)),end:Math.max(...e.filter(s=>s.end!=null).map(s=>s.end)),create:HoverTooltipHost.create,above:e[0].above,arrow:e.some(s=>s.arrow)}});class HoverPlugin{constructor(e,s,l,a,h){this.view=e,this.source=s,this.field=l,this.setHover=a,this.hoverTime=h,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:s}=this,l=e.docView.nearest(s.target);if(!l)return;let a,h=1;if(l instanceof WidgetView)a=l.posAtStart;else{if(a=e.posAtCoords(s),a==null)return;let u=e.coordsAtPos(a);if(!u||s.y<u.top||s.y>u.bottom||s.x<u.left-e.defaultCharacterWidth||s.x>u.right+e.defaultCharacterWidth)return;let p=e.bidiSpans(e.state.doc.lineAt(a)).find(g=>g.from<=a&&g.to>=a),m=p&&p.dir==Direction.RTL?-1:1;h=s.x<u.left?-m:m}let f=this.source(e,a,h);if(f!=null&&f.then){let u=this.pending={pos:a};f.then(p=>{this.pending==u&&(this.pending=null,p&&e.dispatch({effects:this.setHover.of(p)}))},p=>logException(e.state,p,"hover tooltip"))}else f&&e.dispatch({effects:this.setHover.of(f)})}mousemove(e){var s;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let l=this.active;if(l&&!isInTooltip(this.lastMove.target)||this.pending){let{pos:a}=l||this.pending,h=(s=l==null?void 0:l.end)!==null&&s!==void 0?s:a;(a==h?this.view.posAtCoords(this.lastMove)!=a:!isOverRange(this.view,a,h,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!isInTooltip(e.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function isInTooltip(o){for(let e=o;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function isOverRange(o,e,s,l,a,h){let f=o.scrollDOM.getBoundingClientRect(),u=o.documentTop+o.documentPadding.top+o.contentHeight;if(f.left>l||f.right<l||f.top>a||Math.min(f.bottom,u)<a)return!1;let p=o.posAtCoords({x:l,y:a},!1);return p>=e&&p<=s}function hoverTooltip(o,e={}){let s=StateEffect.define(),l=StateField.define({create(){return null},update(a,h){if(a&&(e.hideOnChange&&(h.docChanged||h.selection)||e.hideOn&&e.hideOn(h,a)))return null;if(a&&h.docChanged){let f=h.changes.mapPos(a.pos,-1,MapMode.TrackDel);if(f==null)return null;let u=Object.assign(Object.create(null),a);u.pos=f,a.end!=null&&(u.end=h.changes.mapPos(a.end)),a=u}for(let f of h.effects)f.is(s)&&(a=f.value),f.is(closeHoverTooltipEffect)&&(a=null);return a},provide:a=>showHoverTooltip.from(a)});return[l,ViewPlugin.define(a=>new HoverPlugin(a,o,l,s,e.hoverTime||300)),showHoverTooltipHost]}function getTooltip(o,e){let s=o.plugin(tooltipPlugin);if(!s)return null;let l=s.manager.tooltips.indexOf(e);return l<0?null:s.manager.tooltipViews[l]}const closeHoverTooltipEffect=StateEffect.define(),panelConfig=Facet.define({combine(o){let e,s;for(let l of o)e=e||l.topContainer,s=s||l.bottomContainer;return{topContainer:e,bottomContainer:s}}});function getPanel(o,e){let s=o.plugin(panelPlugin),l=s?s.specs.indexOf(e):-1;return l>-1?s.panels[l]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(o){this.input=o.state.facet(showPanel),this.specs=this.input.filter(s=>s),this.panels=this.specs.map(s=>s(o));let e=o.state.facet(panelConfig);this.top=new PanelGroup(o,!0,e.topContainer),this.bottom=new PanelGroup(o,!1,e.bottomContainer),this.top.sync(this.panels.filter(s=>s.top)),this.bottom.sync(this.panels.filter(s=>!s.top));for(let s of this.panels)s.dom.classList.add("cm-panel"),s.mount&&s.mount()}update(o){let e=o.state.facet(panelConfig);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new PanelGroup(o.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(o.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let s=o.state.facet(showPanel);if(s!=this.input){let l=s.filter(p=>p),a=[],h=[],f=[],u=[];for(let p of l){let m=this.specs.indexOf(p),g;m<0?(g=p(o.view),u.push(g)):(g=this.panels[m],g.update&&g.update(o)),a.push(g),(g.top?h:f).push(g)}this.specs=l,this.panels=a,this.top.sync(h),this.bottom.sync(f);for(let p of u)p.dom.classList.add("cm-panel"),p.mount&&p.mount()}else for(let l of this.panels)l.update&&l.update(o)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:o=>EditorView.scrollMargins.of(e=>{let s=e.plugin(o);return s&&{top:s.top.scrollMargin(),bottom:s.bottom.scrollMargin()}})});class PanelGroup{constructor(e,s,l){this.view=e,this.top=s,this.container=l,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let s of this.panels)s.destroy&&e.indexOf(s)<0&&s.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let s=this.container||this.view.dom;s.insertBefore(this.dom,this.top?s.firstChild:null)}let e=this.dom.firstChild;for(let s of this.panels)if(s.dom.parentNode==this.dom){for(;e!=s.dom;)e=rm(e);e=e.nextSibling}else this.dom.insertBefore(s.dom,e);for(;e;)e=rm(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function rm(o){let e=o.nextSibling;return o.remove(),e}const showPanel=Facet.define({enables:panelPlugin});class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),defaults$1={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=Facet.define();function gutter(o){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults$1),o))]}const unfixGutters=Facet.define({combine:o=>o.some(e=>e)});function gutters(o){let e=[gutterView];return o&&o.fixed===!1&&e.push(unfixGutters.of(!0)),e}const gutterView=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.prevViewport=o.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=o.state.facet(activeGutters).map(e=>new SingleGutterView(o,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!o.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),o.scrollDOM.insertBefore(this.dom,o.contentDOM)}update(o){if(this.updateGutters(o)){let e=this.prevViewport,s=o.view.viewport,l=Math.min(e.to,s.to)-Math.max(e.from,s.from);this.syncGutters(l<(s.to-s.from)*.8)}o.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=o.view.viewport}syncGutters(o){let e=this.dom.nextSibling;o&&this.dom.remove();let s=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),l=[],a=this.gutters.map(h=>new UpdateContext(h,this.view.viewport,-this.view.documentPadding.top));for(let h of this.view.viewportLineBlocks)if(l.length&&(l=[]),Array.isArray(h.type)){let f=!0;for(let u of h.type)if(u.type==BlockType.Text&&f){advanceCursor(s,l,u.from);for(let p of a)p.line(this.view,u,l);f=!1}else if(u.widget)for(let p of a)p.widget(this.view,u)}else if(h.type==BlockType.Text){advanceCursor(s,l,h.from);for(let f of a)f.line(this.view,h,l)}else if(h.widget)for(let f of a)f.widget(this.view,h);for(let h of a)h.finish();o&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(o){let e=o.startState.facet(activeGutters),s=o.state.facet(activeGutters),l=o.docChanged||o.heightChanged||o.viewportChanged||!RangeSet.eq(o.startState.facet(gutterLineClass),o.state.facet(gutterLineClass),o.view.viewport.from,o.view.viewport.to);if(e==s)for(let a of this.gutters)a.update(o)&&(l=!0);else{l=!0;let a=[];for(let h of s){let f=e.indexOf(h);f<0?a.push(new SingleGutterView(this.view,h)):(this.gutters[f].update(o),a.push(this.gutters[f]))}for(let h of this.gutters)h.dom.remove(),a.indexOf(h)<0&&h.destroy();for(let h of a)this.dom.appendChild(h.dom);this.gutters=a}return l}destroy(){for(let o of this.gutters)o.destroy();this.dom.remove()}},{provide:o=>EditorView.scrollMargins.of(e=>{let s=e.plugin(o);return!s||s.gutters.length==0||!s.fixed?null:e.textDirection==Direction.LTR?{left:s.dom.offsetWidth*e.scaleX}:{right:s.dom.offsetWidth*e.scaleX}})});function asArray(o){return Array.isArray(o)?o:[o]}function advanceCursor(o,e,s){for(;o.value&&o.from<=s;)o.from==s&&e.push(o.value),o.next()}class UpdateContext{constructor(e,s,l){this.gutter=e,this.height=l,this.i=0,this.cursor=RangeSet.iter(e.markers,s.from)}addElement(e,s,l){let{gutter:a}=this,h=s.top-this.height;if(this.i==a.elements.length){let f=new GutterElement(e,s.height,h,l);a.elements.push(f),a.dom.appendChild(f.dom)}else a.elements[this.i].update(e,s.height,h,l);this.height=s.bottom,this.i++}line(e,s,l){let a=[];advanceCursor(this.cursor,a,s.from),l.length&&(a=a.concat(l));let h=this.gutter.config.lineMarker(e,s,a);h&&a.unshift(h);let f=this.gutter;a.length==0&&!f.config.renderEmptyElements||this.addElement(e,s,a)}widget(e,s){let l=this.gutter.config.widgetMarker(e,s.widget,s);l&&this.addElement(e,s,[l])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let s=e.elements.pop();e.dom.removeChild(s.dom),s.destroy()}}}class SingleGutterView{constructor(e,s){this.view=e,this.config=s,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let l in s.domEventHandlers)this.dom.addEventListener(l,a=>{let h=a.target,f;if(h!=this.dom&&this.dom.contains(h)){for(;h.parentNode!=this.dom;)h=h.parentNode;let p=h.getBoundingClientRect();f=(p.top+p.bottom)/2}else f=a.clientY;let u=e.lineBlockAtHeight(f-e.documentTop);s.domEventHandlers[l](e,u,a)&&a.preventDefault()});this.markers=asArray(s.markers(e)),s.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[s.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let s=this.markers;if(this.markers=asArray(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let a=this.config.updateSpacer(this.spacer.markers[0],e);a!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[a])}let l=e.view.viewport;return!RangeSet.eq(this.markers,s,l.from,l.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,s,l,a){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,s,l,a)}update(e,s,l,a){this.height!=s&&(this.height=s,this.dom.style.height=s/e.scaleY+"px"),this.above!=l&&(this.dom.style.marginTop=(this.above=l)?l/e.scaleY+"px":""),sameMarkers(this.markers,a)||this.setMarkers(e,a)}setMarkers(e,s){let l="cm-gutterElement",a=this.dom.firstChild;for(let h=0,f=0;;){let u=f,p=h<s.length?s[h++]:null,m=!1;if(p){let g=p.elementClass;g&&(l+=" "+g);for(let y=f;y<this.markers.length;y++)if(this.markers[y].compare(p)){u=y,m=!0;break}}else u=this.markers.length;for(;f<u;){let g=this.markers[f++];if(g.toDOM){g.destroy(a);let y=a.nextSibling;a.remove(),a=y}}if(!p)break;p.toDOM&&(m?a=a.nextSibling:this.dom.insertBefore(p.toDOM(e),a)),m&&f++}this.dom.className=l,this.markers=s}destroy(){this.setMarkers(null,[])}}function sameMarkers(o,e){if(o.length!=e.length)return!1;for(let s=0;s<o.length;s++)if(!o[s].compare(e[s]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberConfig=Facet.define({combine(o){return combineConfig(o,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,s){let l=Object.assign({},e);for(let a in s){let h=l[a],f=s[a];l[a]=h?(u,p,m)=>h(u,p,m)||f(u,p,m):f}return l}})}});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(o,e){return o.state.facet(lineNumberConfig).formatNumber(e,o.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],o=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(lineNumberMarkers)},lineMarker(e,s,l){return l.some(a=>a.toDOM)?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(s.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer(e,s){let l=formatNumber(s.view,maxLineNumber(s.view.state.doc.lines));return l==e.number?e:new NumberMarker(l)},domEventHandlers:o.facet(lineNumberConfig).domEventHandlers}));function lineNumbers(o={}){return[lineNumberConfig.of(o),gutters(),lineNumberGutter]}function maxLineNumber(o){let e=9;for(;e<o;)e=e*10+9;return e}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],o=>{let e=[],s=-1;for(let l of o.selection.ranges){let a=o.doc.lineAt(l.head).from;a>s&&(s=a,e.push(activeLineGutterMarker.range(a)))}return RangeSet.of(e)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,s){this.from=e,this.to=s}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=NodeType.match(e)),s=>{let l=e(s);return l===void 0?null:[this,l]}}}NodeProp.closedBy=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.openedBy=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.group=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.contextHash=new NodeProp({perNode:!0});NodeProp.lookAhead=new NodeProp({perNode:!0});NodeProp.mounted=new NodeProp({perNode:!0});const noProps=Object.create(null);class NodeType{constructor(e,s,l,a=0){this.name=e,this.props=s,this.id=l,this.flags=a}static define(e){let s=e.props&&e.props.length?Object.create(null):noProps,l=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),a=new NodeType(e.name||"",s,e.id,l);if(e.props){for(let h of e.props)if(Array.isArray(h)||(h=h(a)),h){if(h[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");s[h[0].id]=h[1]}}return a}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let s=this.prop(NodeProp.group);return s?s.indexOf(e)>-1:!1}return this.id==e}static match(e){let s=Object.create(null);for(let l in e)for(let a of l.split(" "))s[a]=e[l];return l=>{for(let a=l.prop(NodeProp.group),h=-1;h<(a?a.length:0);h++){let f=s[h<0?l.name:a[h]];if(f)return f}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(e){this.types=e;for(let s=0;s<e.length;s++)if(e[s].id!=s)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let s=[];for(let l of this.types){let a=null;for(let h of e){let f=h(l);f&&(a||(a=Object.assign({},l.props)),a[f[0].id]=f[1])}s.push(a?new NodeType(l.name,a,l.id,l.flags):l)}return new NodeSet(s)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(o){o[o.ExcludeBuffers=1]="ExcludeBuffers",o[o.IncludeAnonymous=2]="IncludeAnonymous",o[o.IgnoreMounts=4]="IgnoreMounts",o[o.IgnoreOverlays=8]="IgnoreOverlays"})(IterMode||(IterMode={}));class Tree{constructor(e,s,l,a,h){if(this.type=e,this.children=s,this.positions=l,this.length=a,this.props=null,h&&h.length){this.props=Object.create(null);for(let[f,u]of h)this.props[typeof f=="number"?f:f.id]=u}}toString(){let e=this.prop(NodeProp.mounted);if(e&&!e.overlay)return e.tree.toString();let s="";for(let l of this.children){let a=l.toString();a&&(s&&(s+=","),s+=a)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(s.length?"("+s+")":""):s}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,s=0,l=0){let a=CachedNode.get(this)||this.topNode,h=new TreeCursor(a);return h.moveTo(e,s),CachedNode.set(this,h._tree),h}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,s=0){let l=resolveNode(CachedNode.get(this)||this.topNode,e,s,!1);return CachedNode.set(this,l),l}resolveInner(e,s=0){let l=resolveNode(CachedInnerNode.get(this)||this.topNode,e,s,!0);return CachedInnerNode.set(this,l),l}iterate(e){let{enter:s,leave:l,from:a=0,to:h=this.length}=e,f=e.mode||0,u=(f&IterMode.IncludeAnonymous)>0;for(let p=this.cursor(f|IterMode.IncludeAnonymous);;){let m=!1;if(p.from<=h&&p.to>=a&&(!u&&p.type.isAnonymous||s(p)!==!1)){if(p.firstChild())continue;m=!0}for(;m&&l&&(u||!p.type.isAnonymous)&&l(p),!p.nextSibling();){if(!p.parent())return;m=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let s in this.props)e.push([+s,this.props[s]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(s,l,a)=>new Tree(this.type,s,l,a,this.propValues),e.makeTree||((s,l,a)=>new Tree(NodeType.none,s,l,a)))}static build(e){return buildTree(e)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,s){this.buffer=e,this.index=s}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,s,l){this.buffer=e,this.length=s,this.set=l}get type(){return NodeType.none}toString(){let e=[];for(let s=0;s<this.buffer.length;)e.push(this.childString(s)),s=this.buffer[s+3];return e.join(",")}childString(e){let s=this.buffer[e],l=this.buffer[e+3],a=this.set.types[s],h=a.name;if(/\W/.test(h)&&!a.isError&&(h=JSON.stringify(h)),e+=4,l==e)return h;let f=[];for(;e<l;)f.push(this.childString(e)),e=this.buffer[e+3];return h+"("+f.join(",")+")"}findChild(e,s,l,a,h){let{buffer:f}=this,u=-1;for(let p=e;p!=s&&!(checkSide(h,a,f[p+1],f[p+2])&&(u=p,l>0));p=f[p+3]);return u}slice(e,s,l){let a=this.buffer,h=new Uint16Array(s-e),f=0;for(let u=e,p=0;u<s;){h[p++]=a[u++],h[p++]=a[u++]-l;let m=h[p++]=a[u++]-l;h[p++]=a[u++]-e,f=Math.max(f,m)}return new TreeBuffer(h,f,this.set)}}function checkSide(o,e,s,l){switch(o){case-2:return s<e;case-1:return l>=e&&s<e;case 0:return s<e&&l>e;case 1:return s<=e&&l>e;case 2:return l>e;case 4:return!0}}function enterUnfinishedNodesBefore(o,e){let s=o.childBefore(e);for(;s;){let l=s.lastChild;if(!l||l.to!=s.to)break;l.type.isError&&l.from==l.to?(o=s,s=l.prevSibling):s=l}return o}function resolveNode(o,e,s,l){for(var a;o.from==o.to||(s<1?o.from>=e:o.from>e)||(s>-1?o.to<=e:o.to<e);){let f=!l&&o instanceof TreeNode&&o.index<0?null:o.parent;if(!f)return o;o=f}let h=l?0:IterMode.IgnoreOverlays;if(l)for(let f=o,u=f.parent;u;f=u,u=f.parent)f instanceof TreeNode&&f.index<0&&((a=u.enter(e,s,h))===null||a===void 0?void 0:a.from)!=f.from&&(o=u);for(;;){let f=o.enter(e,s,h);if(!f)return o;o=f}}class TreeNode{constructor(e,s,l,a){this._tree=e,this.from=s,this.index=l,this._parent=a}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,s,l,a,h=0){for(let f=this;;){for(let{children:u,positions:p}=f._tree,m=s>0?u.length:-1;e!=m;e+=s){let g=u[e],y=p[e]+f.from;if(checkSide(a,l,y,y+g.length)){if(g instanceof TreeBuffer){if(h&IterMode.ExcludeBuffers)continue;let w=g.findChild(0,g.buffer.length,s,l-y,a);if(w>-1)return new BufferNode(new BufferContext(f,g,e,y),null,w)}else if(h&IterMode.IncludeAnonymous||!g.type.isAnonymous||hasChild(g)){let w;if(!(h&IterMode.IgnoreMounts)&&g.props&&(w=g.prop(NodeProp.mounted))&&!w.overlay)return new TreeNode(w.tree,y,e,f);let x=new TreeNode(g,y,e,f);return h&IterMode.IncludeAnonymous||!x.type.isAnonymous?x:x.nextChild(s<0?g.children.length-1:0,s,l,a)}}}if(h&IterMode.IncludeAnonymous||!f.type.isAnonymous||(f.index>=0?e=f.index+s:e=s<0?-1:f._parent._tree.children.length,f=f._parent,!f))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,s,l=0){let a;if(!(l&IterMode.IgnoreOverlays)&&(a=this._tree.prop(NodeProp.mounted))&&a.overlay){let h=e-this.from;for(let{from:f,to:u}of a.overlay)if((s>0?f<=h:f<h)&&(s<0?u>=h:u>h))return new TreeNode(a.tree,a.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,s,l)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new TreeCursor(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,s=0){return resolveNode(this,e,s,!1)}resolveInner(e,s=0){return resolveNode(this,e,s,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}getChild(e,s=null,l=null){let a=getChildren(this,e,s,l);return a.length?a[0]:null}getChildren(e,s=null,l=null){return getChildren(this,e,s,l)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}function getChildren(o,e,s,l){let a=o.cursor(),h=[];if(!a.firstChild())return h;if(s!=null){for(;!a.type.is(s);)if(!a.nextSibling())return h}for(;;){if(l!=null&&a.type.is(l))return h;if(a.type.is(e)&&h.push(a.node),!a.nextSibling())return l==null?h:[]}}function matchNodeContext(o,e,s=e.length-1){for(let l=o.parent;s>=0;l=l.parent){if(!l)return!1;if(!l.type.isAnonymous){if(e[s]&&e[s]!=l.name)return!1;s--}}return!0}class BufferContext{constructor(e,s,l,a){this.parent=e,this.buffer=s,this.index=l,this.start=a}}class BufferNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,s,l){this.context=e,this._parent=s,this.index=l,this.type=e.buffer.set.types[e.buffer.buffer[l]]}child(e,s,l){let{buffer:a}=this.context,h=a.findChild(this.index+4,a.buffer[this.index+3],e,s-this.context.start,l);return h<0?null:new BufferNode(this.context,this,h)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,s,l=0){if(l&IterMode.ExcludeBuffers)return null;let{buffer:a}=this.context,h=a.findChild(this.index+4,a.buffer[this.index+3],s>0?1:-1,e-this.context.start,s);return h<0?null:new BufferNode(this.context,this,h)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,s=e.buffer[this.index+3];return s<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,s):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,s=this._parent?this._parent.index+4:0;return this.index==s?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(s,this.index,-1,0,4))}cursor(e=0){return new TreeCursor(this,e)}get tree(){return null}toTree(){let e=[],s=[],{buffer:l}=this.context,a=this.index+4,h=l.buffer[this.index+3];if(h>a){let f=l.buffer[this.index+1];e.push(l.slice(a,h,f)),s.push(0)}return new Tree(this.type,e,s,this.to-this.from)}resolve(e,s=0){return resolveNode(this,e,s,!1)}resolveInner(e,s=0){return resolveNode(this,e,s,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,s=null,l=null){let a=getChildren(this,e,s,l);return a.length?a[0]:null}getChildren(e,s=null,l=null){return getChildren(this,e,s,l)}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}class TreeCursor{get name(){return this.type.name}constructor(e,s=0){if(this.mode=s,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let l=e._parent;l;l=l._parent)this.stack.unshift(l.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,s){this.index=e;let{start:l,buffer:a}=this.buffer;return this.type=s||a.set.types[a.buffer[e]],this.from=l+a.buffer[e+1],this.to=l+a.buffer[e+2],!0}yield(e){return e?e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,s,l){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,s,l,this.mode));let{buffer:a}=this.buffer,h=a.findChild(this.index+4,a.buffer[this.index+3],e,s-this.buffer.start,l);return h<0?!1:(this.stack.push(this.index),this.yieldBuf(h))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,s,l=this.mode){return this.buffer?l&IterMode.ExcludeBuffers?!1:this.enterChild(1,e,s):this.yield(this._tree.enter(e,s,l))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:s}=this.buffer,l=this.stack.length-1;if(e<0){let a=l<0?0:this.stack[l]+4;if(this.index!=a)return this.yieldBuf(s.findChild(a,this.index,-1,0,4))}else{let a=s.buffer[this.index+3];if(a<(l<0?s.buffer.length:s.buffer[this.stack[l]+3]))return this.yieldBuf(a)}return l<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let s,l,{buffer:a}=this;if(a){if(e>0){if(this.index<a.buffer.buffer.length)return!1}else for(let h=0;h<this.index;h++)if(a.buffer.buffer[h+3]<this.index)return!1;({index:s,parent:l}=a)}else({index:s,_parent:l}=this._tree);for(;l;{index:s,_parent:l}=l)if(s>-1)for(let h=s+e,f=e<0?-1:l._tree.children.length;h!=f;h+=e){let u=l._tree.children[h];if(this.mode&IterMode.IncludeAnonymous||u instanceof TreeBuffer||!u.type.isAnonymous||hasChild(u))return!1}return!0}move(e,s){if(s&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,s=0){for(;(this.from==this.to||(s<1?this.from>=e:this.from>e)||(s>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,s););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,s=null,l=0;if(e&&e.context==this.buffer)e:for(let a=this.index,h=this.stack.length;h>=0;){for(let f=e;f;f=f._parent)if(f.index==a){if(a==this.index)return f;s=f,l=h+1;break e}a=this.stack[--h]}for(let a=l;a<this.stack.length;a++)s=new BufferNode(this.buffer,s,this.stack[a]);return this.bufferNode=new BufferNode(this.buffer,s,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,s){for(let l=0;;){let a=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){l++;continue}this.type.isAnonymous||(a=!0)}for(;a&&s&&s(this),a=this.type.isAnonymous,!this.nextSibling();){if(!l)return;this.parent(),l--,a=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node,e);let{buffer:s}=this.buffer,{types:l}=s.set;for(let a=e.length-1,h=this.stack.length-1;a>=0;h--){if(h<0)return matchNodeContext(this.node,e,a);let f=l[s.buffer[this.stack[h]]];if(!f.isAnonymous){if(e[a]&&e[a]!=f.name)return!1;a--}}return!0}}function hasChild(o){return o.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree(o){var e;let{buffer:s,nodeSet:l,maxBufferLength:a=DefaultBufferLength,reused:h=[],minRepeatType:f=l.types.length}=o,u=Array.isArray(s)?new FlatBufferCursor(s,s.length):s,p=l.types,m=0,g=0;function y(O,T,M,$,D){let{id:_,start:B,end:I,size:N}=u,Q=g;for(;N<0;)if(u.next(),N==-1){let W=h[_];M.push(W),$.push(B-O);return}else if(N==-3){m=_;return}else if(N==-4){g=_;return}else throw new RangeError(`Unrecognized record size: ${N}`);let H=p[_],V,F,j=B-O;if(I-B<=a&&(F=k(u.pos-T,D))){let W=new Uint16Array(F.size-F.skip),L=u.pos-F.size,q=W.length;for(;u.pos>L;)q=S(F.start,W,q);V=new TreeBuffer(W,I-F.start,l),j=F.start-O}else{let W=u.pos-N;u.next();let L=[],q=[],U=_>=f?_:-1,Z=0,G=I;for(;u.pos>W;)U>=0&&u.id==U&&u.size>=0?(u.end<=G-a&&(x(L,q,B,Z,u.end,G,U,Q),Z=L.length,G=u.end),u.next()):y(B,W,L,q,U);if(U>=0&&Z>0&&Z<L.length&&x(L,q,B,Z,B,G,U,Q),L.reverse(),q.reverse(),U>-1&&Z>0){let K=w(H);V=balanceRange(H,L,q,0,L.length,0,I-B,K,K)}else V=b(H,L,q,I-B,Q-I)}M.push(V),$.push(j)}function w(O){return(T,M,$)=>{let D=0,_=T.length-1,B,I;if(_>=0&&(B=T[_])instanceof Tree){if(!_&&B.type==O&&B.length==$)return B;(I=B.prop(NodeProp.lookAhead))&&(D=M[_]+B.length+I)}return b(O,T,M,$,D)}}function x(O,T,M,$,D,_,B,I){let N=[],Q=[];for(;O.length>$;)N.push(O.pop()),Q.push(T.pop()+M-D);O.push(b(l.types[B],N,Q,_-D,I-_)),T.push(D-M)}function b(O,T,M,$,D=0,_){if(m){let B=[NodeProp.contextHash,m];_=_?[B].concat(_):[B]}if(D>25){let B=[NodeProp.lookAhead,D];_=_?[B].concat(_):[B]}return new Tree(O,T,M,$,_)}function k(O,T){let M=u.fork(),$=0,D=0,_=0,B=M.end-a,I={size:0,start:0,skip:0};e:for(let N=M.pos-O;M.pos>N;){let Q=M.size;if(M.id==T&&Q>=0){I.size=$,I.start=D,I.skip=_,_+=4,$+=4,M.next();continue}let H=M.pos-Q;if(Q<0||H<N||M.start<B)break;let V=M.id>=f?4:0,F=M.start;for(M.next();M.pos>H;){if(M.size<0)if(M.size==-3)V+=4;else break e;else M.id>=f&&(V+=4);M.next()}D=F,$+=Q,_+=V}return(T<0||$==O)&&(I.size=$,I.start=D,I.skip=_),I.size>4?I:void 0}function S(O,T,M){let{id:$,start:D,end:_,size:B}=u;if(u.next(),B>=0&&$<f){let I=M;if(B>4){let N=u.pos-(B-4);for(;u.pos>N;)M=S(O,T,M)}T[--M]=I,T[--M]=_-O,T[--M]=D-O,T[--M]=$}else B==-3?m=$:B==-4&&(g=$);return M}let P=[],E=[];for(;u.pos>0;)y(o.start||0,o.bufferStart||0,P,E,-1);let R=(e=o.length)!==null&&e!==void 0?e:P.length?E[0]+P[0].length:0;return new Tree(p[o.topID],P.reverse(),E.reverse(),R)}const nodeSizeCache=new WeakMap;function nodeSize(o,e){if(!o.isAnonymous||e instanceof TreeBuffer||e.type!=o)return 1;let s=nodeSizeCache.get(e);if(s==null){s=1;for(let l of e.children){if(l.type!=o||!(l instanceof Tree)){s=1;break}s+=nodeSize(o,l)}nodeSizeCache.set(e,s)}return s}function balanceRange(o,e,s,l,a,h,f,u,p){let m=0;for(let b=l;b<a;b++)m+=nodeSize(o,e[b]);let g=Math.ceil(m*1.5/8),y=[],w=[];function x(b,k,S,P,E){for(let R=S;R<P;){let O=R,T=k[R],M=nodeSize(o,b[R]);for(R++;R<P;R++){let $=nodeSize(o,b[R]);if(M+$>=g)break;M+=$}if(R==O+1){if(M>g){let $=b[O];x($.children,$.positions,0,$.children.length,k[O]+E);continue}y.push(b[O])}else{let $=k[R-1]+b[R-1].length-T;y.push(balanceRange(o,b,k,O,R,T,$,null,p))}w.push(T+E-h)}}return x(e,s,l,a,0),(u||p)(y,w,f)}class TreeFragment{constructor(e,s,l,a,h=!1,f=!1){this.from=e,this.to=s,this.tree=l,this.offset=a,this.open=(h?1:0)|(f?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,s=[],l=!1){let a=[new TreeFragment(0,e.length,e,0,!1,l)];for(let h of s)h.to>e.length&&a.push(h);return a}static applyChanges(e,s,l=128){if(!s.length)return e;let a=[],h=1,f=e.length?e[0]:null;for(let u=0,p=0,m=0;;u++){let g=u<s.length?s[u]:null,y=g?g.fromA:1e9;if(y-p>=l)for(;f&&f.from<y;){let w=f;if(p>=w.from||y<=w.to||m){let x=Math.max(w.from,p)-m,b=Math.min(w.to,y)-m;w=x>=b?null:new TreeFragment(x,b,w.tree,w.offset+m,u>0,!!g)}if(w&&a.push(w),f.to>y)break;f=h<e.length?e[h++]:null}if(!g)break;p=g.toA,m=g.toA-g.toB}return a}}class Parser{startParse(e,s,l){return typeof e=="string"&&(e=new StringInput(e)),l=l?l.length?l.map(a=>new Range(a.from,a.to)):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,s||[],l)}parse(e,s,l){let a=this.startParse(e,s,l);for(;;){let h=a.advance();if(h)return h}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,s){return this.string.slice(e,s)}}new NodeProp({perNode:!0});let nextTagID=0;class Tag{constructor(e,s,l){this.set=e,this.base=s,this.modified=l,this.id=nextTagID++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let s=new Tag([],null,[]);if(s.set.push(s),e)for(let l of e.set)s.set.push(l);return s}static defineModifier(){let e=new Modifier;return s=>s.modified.indexOf(e)>-1?s:Modifier.get(s.base||s,s.modified.concat(e).sort((l,a)=>l.id-a.id))}}let nextModifierID=0;class Modifier{constructor(){this.instances=[],this.id=nextModifierID++}static get(e,s){if(!s.length)return e;let l=s[0].instances.find(u=>u.base==e&&sameArray(s,u.modified));if(l)return l;let a=[],h=new Tag(a,e,s);for(let u of s)u.instances.push(h);let f=powerSet(s);for(let u of e.set)if(!u.modified.length)for(let p of f)a.push(Modifier.get(u,p));return h}}function sameArray(o,e){return o.length==e.length&&o.every((s,l)=>s==e[l])}function powerSet(o){let e=[[]];for(let s=0;s<o.length;s++)for(let l=0,a=e.length;l<a;l++)e.push(e[l].concat(o[s]));return e.sort((s,l)=>l.length-s.length)}function styleTags(o){let e=Object.create(null);for(let s in o){let l=o[s];Array.isArray(l)||(l=[l]);for(let a of s.split(" "))if(a){let h=[],f=2,u=a;for(let y=0;;){if(u=="..."&&y>0&&y+3==a.length){f=1;break}let w=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(u);if(!w)throw new RangeError("Invalid path: "+a);if(h.push(w[0]=="*"?"":w[0][0]=='"'?JSON.parse(w[0]):w[0]),y+=w[0].length,y==a.length)break;let x=a[y++];if(y==a.length&&x=="!"){f=0;break}if(x!="/")throw new RangeError("Invalid path: "+a);u=a.slice(y)}let p=h.length-1,m=h[p];if(!m)throw new RangeError("Invalid path: "+a);let g=new Rule(l,f,p>0?h.slice(0,p):null);e[m]=g.sort(e[m])}}return ruleNodeProp.add(e)}const ruleNodeProp=new NodeProp;class Rule{constructor(e,s,l,a){this.tags=e,this.mode=s,this.context=l,this.next=a}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(o,e){let s=Object.create(null);for(let h of o)if(!Array.isArray(h.tag))s[h.tag.id]=h.class;else for(let f of h.tag)s[f.id]=h.class;let{scope:l,all:a=null}=e||{};return{style:h=>{let f=a;for(let u of h)for(let p of u.set){let m=s[p.id];if(m){f=f?f+" "+m:m;break}}return f},scope:l}}function highlightTags(o,e){let s=null;for(let l of o){let a=l.style(e);a&&(s=s?s+" "+a:a)}return s}function highlightTree(o,e,s,l=0,a=o.length){let h=new HighlightBuilder(l,Array.isArray(e)?e:[e],s);h.highlightRange(o.cursor(),l,a,"",h.highlighters),h.flush(a)}class HighlightBuilder{constructor(e,s,l){this.at=e,this.highlighters=s,this.span=l,this.class=""}startSpan(e,s){s!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=s)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,s,l,a,h){let{type:f,from:u,to:p}=e;if(u>=l||p<=s)return;f.isTop&&(h=this.highlighters.filter(x=>!x.scope||x.scope(f)));let m=a,g=getStyleTags(e)||Rule.empty,y=highlightTags(h,g.tags);if(y&&(m&&(m+=" "),m+=y,g.mode==1&&(a+=(a?" ":"")+y)),this.startSpan(Math.max(s,u),m),g.opaque)return;let w=e.tree&&e.tree.prop(NodeProp.mounted);if(w&&w.overlay){let x=e.node.enter(w.overlay[0].from+u,1),b=this.highlighters.filter(S=>!S.scope||S.scope(w.tree.type)),k=e.firstChild();for(let S=0,P=u;;S++){let E=S<w.overlay.length?w.overlay[S]:null,R=E?E.from+u:p,O=Math.max(s,P),T=Math.min(l,R);if(O<T&&k)for(;e.from<T&&(this.highlightRange(e,O,T,a,h),this.startSpan(Math.min(T,e.to),m),!(e.to>=R||!e.nextSibling())););if(!E||R>l)break;P=E.to+u,P>s&&(this.highlightRange(x.cursor(),Math.max(s,E.from+u),Math.min(l,P),"",b),this.startSpan(Math.min(l,P),m))}k&&e.parent()}else if(e.firstChild()){w&&(a="");do if(!(e.to<=s)){if(e.from>=l)break;this.highlightRange(e,s,l,a,h),this.startSpan(Math.min(l,e.to),m)}while(e.nextSibling());e.parent()}}}function getStyleTags(o){let e=o.type.prop(ruleNodeProp);for(;e&&e.context&&!o.matchContext(e.context);)e=e.next;return e||null}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta$1=t(),tags$1={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name,variableName:t(name),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta$1,documentMeta:t(meta$1),annotation:t(meta$1),processingInstruction:t(meta$1),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};tagHighlighter([{tag:tags$1.link,class:"tok-link"},{tag:tags$1.heading,class:"tok-heading"},{tag:tags$1.emphasis,class:"tok-emphasis"},{tag:tags$1.strong,class:"tok-strong"},{tag:tags$1.keyword,class:"tok-keyword"},{tag:tags$1.atom,class:"tok-atom"},{tag:tags$1.bool,class:"tok-bool"},{tag:tags$1.url,class:"tok-url"},{tag:tags$1.labelName,class:"tok-labelName"},{tag:tags$1.inserted,class:"tok-inserted"},{tag:tags$1.deleted,class:"tok-deleted"},{tag:tags$1.literal,class:"tok-literal"},{tag:tags$1.string,class:"tok-string"},{tag:tags$1.number,class:"tok-number"},{tag:[tags$1.regexp,tags$1.escape,tags$1.special(tags$1.string)],class:"tok-string2"},{tag:tags$1.variableName,class:"tok-variableName"},{tag:tags$1.local(tags$1.variableName),class:"tok-variableName tok-local"},{tag:tags$1.definition(tags$1.variableName),class:"tok-variableName tok-definition"},{tag:tags$1.special(tags$1.variableName),class:"tok-variableName2"},{tag:tags$1.definition(tags$1.propertyName),class:"tok-propertyName tok-definition"},{tag:tags$1.typeName,class:"tok-typeName"},{tag:tags$1.namespace,class:"tok-namespace"},{tag:tags$1.className,class:"tok-className"},{tag:tags$1.macroName,class:"tok-macroName"},{tag:tags$1.propertyName,class:"tok-propertyName"},{tag:tags$1.operator,class:"tok-operator"},{tag:tags$1.comment,class:"tok-comment"},{tag:tags$1.meta,class:"tok-meta"},{tag:tags$1.invalid,class:"tok-invalid"},{tag:tags$1.punctuation,class:"tok-punctuation"}]);var _a;const languageDataProp=new NodeProp;function defineLanguageFacet(o){return Facet.define({combine:o?e=>e.concat(o):void 0})}const sublanguageProp=new NodeProp;class Language{constructor(e,s,l=[],a=""){this.data=e,this.name=a,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=s,this.extension=[language.of(this),EditorState.languageData.of((h,f,u)=>{let p=topNodeAt(h,f,u),m=p.type.prop(languageDataProp);if(!m)return[];let g=h.facet(m),y=p.type.prop(sublanguageProp);if(y){let w=p.resolve(f-p.from,u);for(let x of y)if(x.test(w,h)){let b=h.facet(x.facet);return x.type=="replace"?b:b.concat(g)}}return g})].concat(l)}isActiveAt(e,s,l=-1){return topNodeAt(e,s,l).type.prop(languageDataProp)==this.data}findRegions(e){let s=e.facet(language);if((s==null?void 0:s.data)==this.data)return[{from:0,to:e.doc.length}];if(!s||!s.allowsNesting)return[];let l=[],a=(h,f)=>{if(h.prop(languageDataProp)==this.data){l.push({from:f,to:f+h.length});return}let u=h.prop(NodeProp.mounted);if(u){if(u.tree.prop(languageDataProp)==this.data){if(u.overlay)for(let p of u.overlay)l.push({from:p.from+f,to:p.to+f});else l.push({from:f,to:f+h.length});return}else if(u.overlay){let p=l.length;if(a(u.tree,u.overlay[0].from+f),l.length>p)return}}for(let p=0;p<h.children.length;p++){let m=h.children[p];m instanceof Tree&&a(m,h.positions[p]+f)}};return a(syntaxTree(e),0),l}get allowsNesting(){return!0}}Language.setState=StateEffect.define();function topNodeAt(o,e,s){let l=o.facet(language),a=syntaxTree(o).topNode;if(!l||l.allowsNesting)for(let h=a;h;h=h.enter(e,s,IterMode.ExcludeBuffers))h.type.isTop&&(a=h);return a}class LRLanguage extends Language{constructor(e,s,l){super(e,s,[],l),this.parser=s}static define(e){let s=defineLanguageFacet(e.languageData);return new LRLanguage(s,e.parser.configure({props:[languageDataProp.add(l=>l.isTop?s:void 0)]}),e.name)}configure(e,s){return new LRLanguage(this.data,this.parser.configure(e),s||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function syntaxTree(o){let e=o.field(Language.state,!1);return e?e.tree:Tree.empty}class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,s){let l=this.cursorPos-this.string.length;return e<l||s>=this.cursorPos?this.doc.sliceString(e,s):this.string.slice(e-l,s-l)}}let currentContext=null;class ParseContext{constructor(e,s,l=[],a,h,f,u,p){this.parser=e,this.state=s,this.fragments=l,this.tree=a,this.treeLen=h,this.viewport=f,this.skipped=u,this.scheduleOn=p,this.parse=null,this.tempSkipped=[]}static create(e,s,l){return new ParseContext(e,s,[],Tree.empty,0,l,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,s){return s!=null&&s>=this.state.doc.length&&(s=void 0),this.tree!=Tree.empty&&this.isDone(s??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var l;if(typeof e=="number"){let a=Date.now()+e;e=()=>Date.now()>a}for(this.parse||(this.parse=this.startParse()),s!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>s)&&s<this.state.doc.length&&this.parse.stopAt(s);;){let a=this.parse.advance();if(a)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(a,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(l=this.parse.stoppedAt)!==null&&l!==void 0?l:this.state.doc.length,this.tree=a,this.parse=null,this.treeLen<(s??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,s;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(s=this.parse.advance()););}),this.treeLen=e,this.tree=s,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let s=currentContext;currentContext=this;try{return e()}finally{currentContext=s}}withoutTempSkipped(e){for(let s;s=this.tempSkipped.pop();)e=cutFragments(e,s.from,s.to);return e}changes(e,s){let{fragments:l,tree:a,treeLen:h,viewport:f,skipped:u}=this;if(this.takeTree(),!e.empty){let p=[];if(e.iterChangedRanges((m,g,y,w)=>p.push({fromA:m,toA:g,fromB:y,toB:w})),l=TreeFragment.applyChanges(l,p),a=Tree.empty,h=0,f={from:e.mapPos(f.from,-1),to:e.mapPos(f.to,1)},this.skipped.length){u=[];for(let m of this.skipped){let g=e.mapPos(m.from,1),y=e.mapPos(m.to,-1);g<y&&u.push({from:g,to:y})}}}return new ParseContext(this.parser,s,l,a,h,f,u,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let s=this.skipped.length;for(let l=0;l<this.skipped.length;l++){let{from:a,to:h}=this.skipped[l];a<e.to&&h>e.from&&(this.fragments=cutFragments(this.fragments,a,h),this.skipped.splice(l--,1))}return this.skipped.length>=s?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,s){this.skipped.push({from:e,to:s})}static getSkippingParser(e){return new class extends Parser{createParse(s,l,a){let h=a[0].from,f=a[a.length-1].to;return{parsedPos:h,advance(){let p=currentContext;if(p){for(let m of a)p.tempSkipped.push(m);e&&(p.scheduleOn=p.scheduleOn?Promise.all([p.scheduleOn,e]):e)}return this.parsedPos=f,new Tree(NodeType.none,[],[],f-h)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let s=this.fragments;return this.treeLen>=e&&s.length&&s[0].from==0&&s[0].to>=e}static get(){return currentContext}}function cutFragments(o,e,s){return TreeFragment.applyChanges(o,[{fromA:e,toA:s,fromB:e,toB:s}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let s=this.context.changes(e.changes,e.state),l=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),s.viewport.to);return s.work(20,l)||s.takeTree(),new LanguageState(s)}static init(e){let s=Math.min(3e3,e.doc.length),l=ParseContext.create(e.facet(language).parser,e,{from:0,to:s});return l.work(20,s)||l.takeTree(),new LanguageState(l)}}Language.state=StateField.define({create:LanguageState.init,update(o,e){for(let s of e.effects)if(s.is(Language.setState))return s.value;return e.startState.facet(language)!=e.state.facet(language)?LanguageState.init(e.state):o.apply(e)}});let requestIdle=o=>{let e=setTimeout(()=>o(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(requestIdle=o=>{let e=-1,s=setTimeout(()=>{e=requestIdleCallback(o,{timeout:500-100})},100);return()=>e<0?clearTimeout(s):cancelIdleCallback(e)});const isInputPending=typeof navigator<"u"&&(!((_a=navigator.scheduling)===null||_a===void 0)&&_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let s=this.view.state.field(Language.state).context;(s.updateViewport(e.view.viewport)||this.view.viewport.to>s.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(s)}scheduleWork(){if(this.working)return;let{state:e}=this.view,s=e.field(Language.state);(s.tree!=s.context.tree||!s.context.isDone(e.doc.length))&&(this.working=requestIdle(this.work))}work(e){this.working=null;let s=Date.now();if(this.chunkEnd<s&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=s+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:l,viewport:{to:a}}=this.view,h=l.field(Language.state);if(h.tree==h.context.tree&&h.context.isDone(a+1e5))return;let f=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),u=h.context.treeLen<a&&l.doc.length>a+1e3,p=h.context.work(()=>isInputPending&&isInputPending()||Date.now()>f,a+(u?0:1e5));this.chunkBudget-=Date.now()-s,(p||this.chunkBudget<=0)&&(h.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(h.context))})),this.chunkBudget>0&&!(p&&!u)&&this.scheduleWork(),this.checkAsyncSchedule(h.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(s=>logException(this.view.state,s)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(o){return o.length?o[0]:null},enables:o=>[Language.state,parseWorker,EditorView.contentAttributes.compute([o],e=>{let s=e.facet(o);return s&&s.name?{"data-language":s.name}:{}})]});class LanguageSupport{constructor(e,s=[]){this.language=e,this.support=s,this.extension=[e,s]}}const indentService=Facet.define(),indentUnit=Facet.define({combine:o=>{if(!o.length)return"  ";let e=o[0];if(!e||/\S/.test(e)||Array.from(e).some(s=>s!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(o[0]));return e}});function getIndentUnit(o){let e=o.facet(indentUnit);return e.charCodeAt(0)==9?o.tabSize*e.length:e.length}function indentString(o,e){let s="",l=o.tabSize,a=o.facet(indentUnit)[0];if(a=="	"){for(;e>=l;)s+="	",e-=l;a=" "}for(let h=0;h<e;h++)s+=a;return s}function getIndentation(o,e){o instanceof EditorState&&(o=new IndentContext(o));for(let l of o.state.facet(indentService)){let a=l(o,e);if(a!==void 0)return a}let s=syntaxTree(o.state);return s.length>=e?syntaxIndentation(o,s,e):null}class IndentContext{constructor(e,s={}){this.state=e,this.options=s,this.unit=getIndentUnit(e)}lineAt(e,s=1){let l=this.state.doc.lineAt(e),{simulateBreak:a,simulateDoubleBreak:h}=this.options;return a!=null&&a>=l.from&&a<=l.to?h&&a==e?{text:"",from:e}:(s<0?a<e:a<=e)?{text:l.text.slice(a-l.from),from:a}:{text:l.text.slice(0,a-l.from),from:l.from}:l}textAfterPos(e,s=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:l,from:a}=this.lineAt(e,s);return l.slice(e-a,Math.min(l.length,e+100-a))}column(e,s=1){let{text:l,from:a}=this.lineAt(e,s),h=this.countColumn(l,e-a),f=this.options.overrideIndentation?this.options.overrideIndentation(a):-1;return f>-1&&(h+=f-this.countColumn(l,l.search(/\S|$/))),h}countColumn(e,s=e.length){return countColumn(e,this.state.tabSize,s)}lineIndent(e,s=1){let{text:l,from:a}=this.lineAt(e,s),h=this.options.overrideIndentation;if(h){let f=h(a);if(f>-1)return f}return this.countColumn(l,l.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(o,e,s){return indentFrom(e.resolveInner(s).enterUnfinishedNodesBefore(s),s,o)}function ignoreClosed(o){return o.pos==o.options.simulateBreak&&o.options.simulateDoubleBreak}function indentStrategy(o){let e=o.type.prop(indentNodeProp);if(e)return e;let s=o.firstChild,l;if(s&&(l=s.type.prop(NodeProp.closedBy))){let a=o.lastChild,h=a&&l.indexOf(a.name)>-1;return f=>delimitedStrategy(f,!0,1,void 0,h&&!ignoreClosed(f)?a.from:void 0)}return o.parent==null?topIndent:null}function indentFrom(o,e,s){for(;o;o=o.parent){let l=indentStrategy(o);if(l)return l(TreeIndentContext.create(s,e,o))}return null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,s,l){super(e.state,e.options),this.base=e,this.pos=s,this.node=l}static create(e,s,l){return new TreeIndentContext(e,s,l)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let s=this.state.doc.lineAt(e.from);for(;;){let l=e.resolve(s.from);for(;l.parent&&l.parent.from==l.from;)l=l.parent;if(isParent(l,e))break;s=this.state.doc.lineAt(l.from)}return this.lineIndent(s.from)}continue(){let e=this.node.parent;return e?indentFrom(e,this.pos,this.base):0}}function isParent(o,e){for(let s=e;s;s=s.parent)if(o==s)return!0;return!1}function bracketedAligned(o){let e=o.node,s=e.childAfter(e.from),l=e.lastChild;if(!s)return null;let a=o.options.simulateBreak,h=o.state.doc.lineAt(s.from),f=a==null||a<=h.from?h.to:Math.min(h.to,a);for(let u=s.to;;){let p=e.childAfter(u);if(!p||p==l)return null;if(!p.type.isSkipped)return p.from<f?s:null;u=p.to}}function delimitedStrategy(o,e,s,l,a){let h=o.textAfter,f=h.match(/^\s*/)[0].length,u=l&&h.slice(f,f+l.length)==l||a==o.pos+f,p=e?bracketedAligned(o):null;return p?u?o.column(p.from):o.column(p.to):o.baseIndent+(u?0:o.unit*s)}const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(o=>{if(!o.docChanged||!o.isUserEvent("input.type")&&!o.isUserEvent("input.complete"))return o;let e=o.startState.languageDataAt("indentOnInput",o.startState.selection.main.head);if(!e.length)return o;let s=o.newDoc,{head:l}=o.newSelection.main,a=s.lineAt(l);if(l>a.from+DontIndentBeyond)return o;let h=s.sliceString(a.from,l);if(!e.some(m=>m.test(h)))return o;let{state:f}=o,u=-1,p=[];for(let{head:m}of f.selection.ranges){let g=f.doc.lineAt(m);if(g.from==u)continue;u=g.from;let y=getIndentation(f,g.from);if(y==null)continue;let w=/^\s*/.exec(g.text)[0],x=indentString(f,y);w!=x&&p.push({from:g.from,to:g.from+w.length,insert:x})}return p.length?[o,{changes:p,sequential:!0}]:o})}const foldService=Facet.define(),foldNodeProp=new NodeProp;function foldInside(o){let e=o.firstChild,s=o.lastChild;return e&&e.to<s.from?{from:e.to,to:s.type.isError?o.to:s.from}:null}function syntaxFolding(o,e,s){let l=syntaxTree(o);if(l.length<s)return null;let a=l.resolveInner(s,1),h=null;for(let f=a;f;f=f.parent){if(f.to<=s||f.from>s)continue;if(h&&f.from<e)break;let u=f.type.prop(foldNodeProp);if(u&&(f.to<l.length-50||l.length==o.doc.length||!isUnfinished(f))){let p=u(f,o);p&&p.from<=s&&p.from>=e&&p.to>s&&(h=p)}}return h}function isUnfinished(o){let e=o.lastChild;return e&&e.to==o.to&&e.type.isError}function foldable(o,e,s){for(let l of o.facet(foldService)){let a=l(o,e,s);if(a)return a}return syntaxFolding(o,e,s)}function mapRange(o,e){let s=e.mapPos(o.from,1),l=e.mapPos(o.to,-1);return s>=l?void 0:{from:s,to:l}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(o){let e=[];for(let{head:s}of o.state.selection.ranges)e.some(l=>l.from<=s&&l.to>=s)||e.push(o.lineBlockAt(s));return e}const foldState=StateField.define({create(){return Decoration.none},update(o,e){o=o.map(e.changes);for(let s of e.effects)if(s.is(foldEffect)&&!foldExists(o,s.value.from,s.value.to)){let{preparePlaceholder:l}=e.state.facet(foldConfig),a=l?Decoration.replace({widget:new PreparedFoldWidget(l(e.state,s.value))}):foldWidget;o=o.update({add:[a.range(s.value.from,s.value.to)]})}else s.is(unfoldEffect)&&(o=o.update({filter:(l,a)=>s.value.from!=l||s.value.to!=a,filterFrom:s.value.from,filterTo:s.value.to}));if(e.selection){let s=!1,{head:l}=e.selection.main;o.between(l,l,(a,h)=>{a<l&&h>l&&(s=!0)}),s&&(o=o.update({filterFrom:l,filterTo:l,filter:(a,h)=>h<=l||a>=l}))}return o},provide:o=>EditorView.decorations.from(o),toJSON(o,e){let s=[];return o.between(0,e.doc.length,(l,a)=>{s.push(l,a)}),s},fromJSON(o){if(!Array.isArray(o)||o.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let s=0;s<o.length;){let l=o[s++],a=o[s++];if(typeof l!="number"||typeof a!="number")throw new RangeError("Invalid JSON for fold state");e.push(foldWidget.range(l,a))}return Decoration.set(e,!0)}});function findFold(o,e,s){var l;let a=null;return(l=o.field(foldState,!1))===null||l===void 0||l.between(e,s,(h,f)=>{(!a||a.from>h)&&(a={from:h,to:f})}),a}function foldExists(o,e,s){let l=!1;return o.between(e,e,(a,h)=>{a==e&&h==s&&(l=!0)}),l}function maybeEnable(o,e){return o.field(foldState,!1)?e:e.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=o=>{for(let e of selectedLines(o)){let s=foldable(o.state,e.from,e.to);if(s)return o.dispatch({effects:maybeEnable(o.state,[foldEffect.of(s),announceFold(o,s)])}),!0}return!1},unfoldCode=o=>{if(!o.state.field(foldState,!1))return!1;let e=[];for(let s of selectedLines(o)){let l=findFold(o.state,s.from,s.to);l&&e.push(unfoldEffect.of(l),announceFold(o,l,!1))}return e.length&&o.dispatch({effects:e}),e.length>0};function announceFold(o,e,s=!0){let l=o.state.doc.lineAt(e.from).number,a=o.state.doc.lineAt(e.to).number;return EditorView.announce.of(`${o.state.phrase(s?"Folded lines":"Unfolded lines")} ${l} ${o.state.phrase("to")} ${a}.`)}const foldAll=o=>{let{state:e}=o,s=[];for(let l=0;l<e.doc.length;){let a=o.lineBlockAt(l),h=foldable(e,a.from,a.to);h&&s.push(foldEffect.of(h)),l=(h?o.lineBlockAt(h.to):a).to+1}return s.length&&o.dispatch({effects:maybeEnable(o.state,s)}),!!s.length},unfoldAll=o=>{let e=o.state.field(foldState,!1);if(!e||!e.size)return!1;let s=[];return e.between(0,o.state.doc.length,(l,a)=>{s.push(unfoldEffect.of({from:l,to:a}))}),o.dispatch({effects:s}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:"â€¦"},foldConfig=Facet.define({combine(o){return combineConfig(o,defaultConfig)}});function codeFolding(o){let e=[foldState,baseTheme$1$2];return o&&e.push(foldConfig.of(o)),e}function widgetToDOM(o,e){let{state:s}=o,l=s.facet(foldConfig),a=f=>{let u=o.lineBlockAt(o.posAtDOM(f.target)),p=findFold(o.state,u.from,u.to);p&&o.dispatch({effects:unfoldEffect.of(p)}),f.preventDefault()};if(l.placeholderDOM)return l.placeholderDOM(o,a,e);let h=document.createElement("span");return h.textContent=l.placeholderText,h.setAttribute("aria-label",s.phrase("folded code")),h.title=s.phrase("unfold"),h.className="cm-foldPlaceholder",h.onclick=a,h}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(o){return widgetToDOM(o,null)}}});class PreparedFoldWidget extends WidgetType{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return widgetToDOM(e,this.value)}}const foldGutterDefaults={openText:"âŒ„",closedText:"â€º",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(e,s){super(),this.config=e,this.open=s}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let s=document.createElement("span");return s.textContent=this.open?this.config.openText:this.config.closedText,s.title=e.state.phrase(this.open?"Fold line":"Unfold line"),s}}function foldGutter(o={}){let e=Object.assign(Object.assign({},foldGutterDefaults),o),s=new FoldMarker(e,!0),l=new FoldMarker(e,!1),a=ViewPlugin.fromClass(class{constructor(f){this.from=f.viewport.from,this.markers=this.buildMarkers(f)}update(f){(f.docChanged||f.viewportChanged||f.startState.facet(language)!=f.state.facet(language)||f.startState.field(foldState,!1)!=f.state.field(foldState,!1)||syntaxTree(f.startState)!=syntaxTree(f.state)||e.foldingChanged(f))&&(this.markers=this.buildMarkers(f.view))}buildMarkers(f){let u=new RangeSetBuilder;for(let p of f.viewportLineBlocks){let m=findFold(f.state,p.from,p.to)?l:foldable(f.state,p.from,p.to)?s:null;m&&u.add(p.from,p.from,m)}return u.finish()}}),{domEventHandlers:h}=e;return[a,gutter({class:"cm-foldGutter",markers(f){var u;return((u=f.plugin(a))===null||u===void 0?void 0:u.markers)||RangeSet.empty},initialSpacer(){return new FoldMarker(e,!1)},domEventHandlers:Object.assign(Object.assign({},h),{click:(f,u,p)=>{if(h.click&&h.click(f,u,p))return!0;let m=findFold(f.state,u.from,u.to);if(m)return f.dispatch({effects:unfoldEffect.of(m)}),!0;let g=foldable(f.state,u.from,u.to);return g?(f.dispatch({effects:foldEffect.of(g)}),!0):!1}})}),codeFolding()]}const baseTheme$1$2=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(e,s){this.specs=e;let l;function a(u){let p=StyleModule.newName();return(l||(l=Object.create(null)))["."+p]=u,p}const h=typeof s.all=="string"?s.all:s.all?a(s.all):void 0,f=s.scope;this.scope=f instanceof Language?u=>u.prop(languageDataProp)==f.data:f?u=>u==f:void 0,this.style=tagHighlighter(e.map(u=>({tag:u.tag,class:u.class||a(Object.assign({},u,{tag:null}))})),{all:h}).style,this.module=l?new StyleModule(l):null,this.themeType=s.themeType}static define(e,s){return new HighlightStyle(e,s||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine(o){return o.length?[o[0]]:null}});function getHighlighters(o){let e=o.facet(highlighterFacet);return e.length?e:o.facet(fallbackHighlighter)}function syntaxHighlighting(o,e){let s=[treeHighlighter],l;return o instanceof HighlightStyle&&(o.module&&s.push(EditorView.styleModule.of(o.module)),l=o.themeType),e!=null&&e.fallback?s.push(fallbackHighlighter.of(o)):l?s.push(highlighterFacet.computeN([EditorView.darkTheme],a=>a.facet(EditorView.darkTheme)==(l=="dark")?[o]:[])):s.push(highlighterFacet.of(o)),s}class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=syntaxTree(e.state),this.decorations=this.buildDeco(e,getHighlighters(e.state))}update(e){let s=syntaxTree(e.state),l=getHighlighters(e.state),a=l!=getHighlighters(e.startState);s.length<e.view.viewport.to&&!a&&s.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(s!=this.tree||e.viewportChanged||a)&&(this.tree=s,this.decorations=this.buildDeco(e.view,l))}buildDeco(e,s){if(!s||!this.tree.length)return Decoration.none;let l=new RangeSetBuilder;for(let{from:a,to:h}of e.visibleRanges)highlightTree(this.tree,s,(f,u,p)=>{l.add(f,u,this.markCache[p]||(this.markCache[p]=Decoration.mark({class:p})))},a,h);return l.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:o=>o.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags$1.meta,color:"#404740"},{tag:tags$1.link,textDecoration:"underline"},{tag:tags$1.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags$1.emphasis,fontStyle:"italic"},{tag:tags$1.strong,fontWeight:"bold"},{tag:tags$1.strikethrough,textDecoration:"line-through"},{tag:tags$1.keyword,color:"#708"},{tag:[tags$1.atom,tags$1.bool,tags$1.url,tags$1.contentSeparator,tags$1.labelName],color:"#219"},{tag:[tags$1.literal,tags$1.inserted],color:"#164"},{tag:[tags$1.string,tags$1.deleted],color:"#a11"},{tag:[tags$1.regexp,tags$1.escape,tags$1.special(tags$1.string)],color:"#e40"},{tag:tags$1.definition(tags$1.variableName),color:"#00f"},{tag:tags$1.local(tags$1.variableName),color:"#30a"},{tag:[tags$1.typeName,tags$1.namespace],color:"#085"},{tag:tags$1.className,color:"#167"},{tag:[tags$1.special(tags$1.variableName),tags$1.macroName],color:"#256"},{tag:tags$1.definition(tags$1.propertyName),color:"#00c"},{tag:tags$1.comment,color:"#940"},{tag:tags$1.invalid,color:"#f00"}]),baseTheme$3=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine(o){return combineConfig(o,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(o){let e=[],s=o.matched?matchingMark:nonmatchingMark;return e.push(s.range(o.start.from,o.start.to)),o.end&&e.push(s.range(o.end.from,o.end.to)),e}const bracketMatchingState=StateField.define({create(){return Decoration.none},update(o,e){if(!e.docChanged&&!e.selection)return o;let s=[],l=e.state.facet(bracketMatchingConfig);for(let a of e.state.selection.ranges){if(!a.empty)continue;let h=matchBrackets(e.state,a.head,-1,l)||a.head>0&&matchBrackets(e.state,a.head-1,1,l)||l.afterCursor&&(matchBrackets(e.state,a.head,1,l)||a.head<e.state.doc.length&&matchBrackets(e.state,a.head+1,-1,l));h&&(s=s.concat(l.renderMatch(h,e.state)))}return Decoration.set(s,!0)},provide:o=>EditorView.decorations.from(o)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$3];function bracketMatching(o={}){return[bracketMatchingConfig.of(o),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(o,e,s){let l=o.prop(e<0?NodeProp.openedBy:NodeProp.closedBy);if(l)return l;if(o.name.length==1){let a=s.indexOf(o.name);if(a>-1&&a%2==(e<0?1:0))return[s[a+e]]}return null}function findHandle(o){let e=o.type.prop(bracketMatchingHandle);return e?e(o.node):o}function matchBrackets(o,e,s,l={}){let a=l.maxScanDistance||DefaultScanDist,h=l.brackets||DefaultBrackets,f=syntaxTree(o),u=f.resolveInner(e,s);for(let p=u;p;p=p.parent){let m=matchingNodes(p.type,s,h);if(m&&p.from<p.to){let g=findHandle(p);if(g&&(s>0?e>=g.from&&e<g.to:e>g.from&&e<=g.to))return matchMarkedBrackets(o,e,s,p,g,m,h)}}return matchPlainBrackets(o,e,s,f,u.type,a,h)}function matchMarkedBrackets(o,e,s,l,a,h,f){let u=l.parent,p={from:a.from,to:a.to},m=0,g=u==null?void 0:u.cursor();if(g&&(s<0?g.childBefore(l.from):g.childAfter(l.to)))do if(s<0?g.to<=l.from:g.from>=l.to){if(m==0&&h.indexOf(g.type.name)>-1&&g.from<g.to){let y=findHandle(g);return{start:p,end:y?{from:y.from,to:y.to}:void 0,matched:!0}}else if(matchingNodes(g.type,s,f))m++;else if(matchingNodes(g.type,-s,f)){if(m==0){let y=findHandle(g);return{start:p,end:y&&y.from<y.to?{from:y.from,to:y.to}:void 0,matched:!1}}m--}}while(s<0?g.prevSibling():g.nextSibling());return{start:p,matched:!1}}function matchPlainBrackets(o,e,s,l,a,h,f){let u=s<0?o.sliceDoc(e-1,e):o.sliceDoc(e,e+1),p=f.indexOf(u);if(p<0||p%2==0!=s>0)return null;let m={from:s<0?e-1:e,to:s>0?e+1:e},g=o.doc.iterRange(e,s>0?o.doc.length:0),y=0;for(let w=0;!g.next().done&&w<=h;){let x=g.value;s<0&&(w+=x.length);let b=e+w*s;for(let k=s>0?0:x.length-1,S=s>0?x.length:-1;k!=S;k+=s){let P=f.indexOf(x[k]);if(!(P<0||l.resolveInner(b+k,1).type!=a))if(P%2==0==s>0)y++;else{if(y==1)return{start:m,end:{from:b+k,to:b+k+1},matched:P>>1==p>>1};y--}}s>0&&(w+=x.length)}return g.done?{start:m,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],defaultTable=Object.create(null);for(let[o,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[o]=createTokenType(noTokens,e);function warnForPart(o,e){warned.indexOf(o)>-1||(warned.push(o),console.warn(e))}function createTokenType(o,e){let s=null;for(let h of e.split(".")){let f=o[h]||tags$1[h];f?typeof f=="function"?s?s=f(s):warnForPart(h,`Modifier ${h} used at start of tag`):s?warnForPart(h,`Tag ${h} used as modifier`):s=f:warnForPart(h,`Unknown highlighting tag ${h}`)}if(!s)return 0;let l=e.replace(/ /g,"_"),a=NodeType.define({id:typeArray.length,name:l,props:[styleTags({[l]:s})]});return typeArray.push(a),a.id}const toggleComment=o=>{let{state:e}=o,s=e.doc.lineAt(e.selection.main.from),l=getConfig(o.state,s.from);return l.line?toggleLineComment(o):l.block?toggleBlockCommentByLine(o):!1};function command(o,e){return({state:s,dispatch:l})=>{if(s.readOnly)return!1;let a=o(e,s);return a?(l(s.update(a)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((o,e)=>changeBlockComment(o,e,selectedLineRanges(e)),0);function getConfig(o,e){let s=o.languageDataAt("commentTokens",e);return s.length?s[0]:{}}const SearchMargin=50;function findBlockComment(o,{open:e,close:s},l,a){let h=o.sliceDoc(l-SearchMargin,l),f=o.sliceDoc(a,a+SearchMargin),u=/\s*$/.exec(h)[0].length,p=/^\s*/.exec(f)[0].length,m=h.length-u;if(h.slice(m-e.length,m)==e&&f.slice(p,p+s.length)==s)return{open:{pos:l-u,margin:u&&1},close:{pos:a+p,margin:p&&1}};let g,y;a-l<=2*SearchMargin?g=y=o.sliceDoc(l,a):(g=o.sliceDoc(l,l+SearchMargin),y=o.sliceDoc(a-SearchMargin,a));let w=/^\s*/.exec(g)[0].length,x=/\s*$/.exec(y)[0].length,b=y.length-x-s.length;return g.slice(w,w+e.length)==e&&y.slice(b,b+s.length)==s?{open:{pos:l+w+e.length,margin:/\s/.test(g.charAt(w+e.length))?1:0},close:{pos:a-x-s.length,margin:/\s/.test(y.charAt(b-1))?1:0}}:null}function selectedLineRanges(o){let e=[];for(let s of o.selection.ranges){let l=o.doc.lineAt(s.from),a=s.to<=l.to?l:o.doc.lineAt(s.to),h=e.length-1;h>=0&&e[h].to>l.from?e[h].to=a.to:e.push({from:l.from+/^\s*/.exec(l.text)[0].length,to:a.to})}return e}function changeBlockComment(o,e,s=e.selection.ranges){let l=s.map(h=>getConfig(e,h.from).block);if(!l.every(h=>h))return null;let a=s.map((h,f)=>findBlockComment(e,l[f],h.from,h.to));if(o!=2&&!a.every(h=>h))return{changes:e.changes(s.map((h,f)=>a[f]?[]:[{from:h.from,insert:l[f].open+" "},{from:h.to,insert:" "+l[f].close}]))};if(o!=1&&a.some(h=>h)){let h=[];for(let f=0,u;f<a.length;f++)if(u=a[f]){let p=l[f],{open:m,close:g}=u;h.push({from:m.pos-p.open.length,to:m.pos+m.margin},{from:g.pos-g.margin,to:g.pos+p.close.length})}return{changes:h}}return null}function changeLineComment(o,e,s=e.selection.ranges){let l=[],a=-1;for(let{from:h,to:f}of s){let u=l.length,p=1e9,m=getConfig(e,h).line;if(m){for(let g=h;g<=f;){let y=e.doc.lineAt(g);if(y.from>a&&(h==f||f>y.from)){a=y.from;let w=/^\s*/.exec(y.text)[0].length,x=w==y.length,b=y.text.slice(w,w+m.length)==m?w:-1;w<y.text.length&&w<p&&(p=w),l.push({line:y,comment:b,token:m,indent:w,empty:x,single:!1})}g=y.to+1}if(p<1e9)for(let g=u;g<l.length;g++)l[g].indent<l[g].line.text.length&&(l[g].indent=p);l.length==u+1&&(l[u].single=!0)}}if(o!=2&&l.some(h=>h.comment<0&&(!h.empty||h.single))){let h=[];for(let{line:u,token:p,indent:m,empty:g,single:y}of l)(y||!g)&&h.push({from:u.from+m,insert:p+" "});let f=e.changes(h);return{changes:f,selection:e.selection.map(f,1)}}else if(o!=1&&l.some(h=>h.comment>=0)){let h=[];for(let{line:f,comment:u,token:p}of l)if(u>=0){let m=f.from+u,g=m+p.length;f.text[g-f.from]==" "&&g++,h.push({from:m,to:g})}return{changes:h}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine(o){return combineConfig(o,{minDepth:100,newGroupDelay:500,joinToEvent:(e,s)=>s},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,s)=>(l,a)=>e(l,a)||s(l,a)})}});function changeEnd(o){let e=0;return o.iterChangedRanges((s,l)=>e=l),e}const historyField_=StateField.define({create(){return HistoryState.empty},update(o,e){let s=e.state.facet(historyConfig),l=e.annotation(fromHistory);if(l){let p=e.docChanged?EditorSelection.single(changeEnd(e.changes)):void 0,m=HistEvent.fromTransaction(e,p),g=l.side,y=g==0?o.undone:o.done;return m?y=updateBranch(y,y.length,s.minDepth,m):y=addSelection(y,e.startState.selection),new HistoryState(g==0?l.rest:y,g==0?y:l.rest)}let a=e.annotation(isolateHistory);if((a=="full"||a=="before")&&(o=o.isolate()),e.annotation(Transaction.addToHistory)===!1)return e.changes.empty?o:o.addMapping(e.changes.desc);let h=HistEvent.fromTransaction(e),f=e.annotation(Transaction.time),u=e.annotation(Transaction.userEvent);return h?o=o.addChanges(h,f,u,s,e):e.selection&&(o=o.addSelection(e.startState.selection,f,u,s.newGroupDelay)),(a=="full"||a=="after")&&(o=o.isolate()),o},toJSON(o){return{done:o.done.map(e=>e.toJSON()),undone:o.undone.map(e=>e.toJSON())}},fromJSON(o){return new HistoryState(o.done.map(HistEvent.fromJSON),o.undone.map(HistEvent.fromJSON))}});function history(o={}){return[historyField_,historyConfig.of(o),EditorView.domEventHandlers({beforeinput(e,s){let l=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;return l?(e.preventDefault(),l(s)):!1}})]}function cmd(o,e){return function({state:s,dispatch:l}){if(!e&&s.readOnly)return!1;let a=s.field(historyField_,!1);if(!a)return!1;let h=a.pop(o,s,e);return h?(l(h),!0):!1}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,s,l,a,h){this.changes=e,this.effects=s,this.mapped=l,this.startSelection=a,this.selectionsAfter=h}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,s,l;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(s=this.mapped)===null||s===void 0?void 0:s.toJSON(),startSelection:(l=this.startSelection)===null||l===void 0?void 0:l.toJSON(),selectionsAfter:this.selectionsAfter.map(a=>a.toJSON())}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,s){let l=none$1;for(let a of e.startState.facet(invertedEffects)){let h=a(e);h.length&&(l=l.concat(h))}return!l.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),l,void 0,s||e.startState.selection,none$1)}static selection(e){return new HistEvent(void 0,none$1,void 0,void 0,e)}}function updateBranch(o,e,s,l){let a=e+1>s+20?e-s-1:0,h=o.slice(a,e);return h.push(l),h}function isAdjacent(o,e){let s=[],l=!1;return o.iterChangedRanges((a,h)=>s.push(a,h)),e.iterChangedRanges((a,h,f,u)=>{for(let p=0;p<s.length;){let m=s[p++],g=s[p++];u>=m&&f<=g&&(l=!0)}}),l}function eqSelectionShape(o,e){return o.ranges.length==e.ranges.length&&o.ranges.filter((s,l)=>s.empty!=e.ranges[l].empty).length===0}function conc(o,e){return o.length?e.length?o.concat(e):o:e}const none$1=[],MaxSelectionsPerEvent=200;function addSelection(o,e){if(o.length){let s=o[o.length-1],l=s.selectionsAfter.slice(Math.max(0,s.selectionsAfter.length-MaxSelectionsPerEvent));return l.length&&l[l.length-1].eq(e)?o:(l.push(e),updateBranch(o,o.length-1,1e9,s.setSelAfter(l)))}else return[HistEvent.selection([e])]}function popSelection(o){let e=o[o.length-1],s=o.slice();return s[o.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),s}function addMappingToBranch(o,e){if(!o.length)return o;let s=o.length,l=none$1;for(;s;){let a=mapEvent(o[s-1],e,l);if(a.changes&&!a.changes.empty||a.effects.length){let h=o.slice(0,s);return h[s-1]=a,h}else e=a.mapped,s--,l=a.selectionsAfter}return l.length?[HistEvent.selection(l)]:none$1}function mapEvent(o,e,s){let l=conc(o.selectionsAfter.length?o.selectionsAfter.map(u=>u.map(e)):none$1,s);if(!o.changes)return HistEvent.selection(l);let a=o.changes.map(e),h=e.mapDesc(o.changes,!0),f=o.mapped?o.mapped.composeDesc(h):h;return new HistEvent(a,StateEffect.mapEffects(o.effects,e),f,o.startSelection.map(h),l)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,s,l=0,a=void 0){this.done=e,this.undone=s,this.prevTime=l,this.prevUserEvent=a}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,s,l,a,h){let f=this.done,u=f[f.length-1];return u&&u.changes&&!u.changes.empty&&e.changes&&(!l||joinableUserEvent.test(l))&&(!u.selectionsAfter.length&&s-this.prevTime<a.newGroupDelay&&a.joinToEvent(h,isAdjacent(u.changes,e.changes))||l=="input.type.compose")?f=updateBranch(f,f.length-1,a.minDepth,new HistEvent(e.changes.compose(u.changes),conc(e.effects,u.effects),u.mapped,u.startSelection,none$1)):f=updateBranch(f,f.length,a.minDepth,e),new HistoryState(f,none$1,s,l)}addSelection(e,s,l,a){let h=this.done.length?this.done[this.done.length-1].selectionsAfter:none$1;return h.length>0&&s-this.prevTime<a&&l==this.prevUserEvent&&l&&/^select($|\.)/.test(l)&&eqSelectionShape(h[h.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,s,l)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,s,l){let a=e==0?this.done:this.undone;if(a.length==0)return null;let h=a[a.length-1];if(l&&h.selectionsAfter.length)return s.update({selection:h.selectionsAfter[h.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(a)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(h.changes){let f=a.length==1?none$1:a.slice(0,a.length-1);return h.mapped&&(f=addMappingToBranch(f,h.mapped)),s.update({changes:h.changes,selection:h.startSelection,effects:h.effects,annotations:fromHistory.of({side:e,rest:f}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}HistoryState.empty=new HistoryState(none$1,none$1);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(o,e){return EditorSelection.create(o.ranges.map(e),o.mainIndex)}function setSel(o,e){return o.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:o,dispatch:e},s){let l=updateSel(o.selection,s);return l.eq(o.selection)?!1:(e(setSel(o,l)),!0)}function rangeEnd(o,e){return EditorSelection.cursor(e?o.to:o.from)}function cursorByChar(o,e){return moveSel(o,s=>s.empty?o.moveByChar(s,e):rangeEnd(s,e))}function ltrAtCursor(o){return o.textDirectionAt(o.state.selection.main.head)==Direction.LTR}const cursorCharLeft=o=>cursorByChar(o,!ltrAtCursor(o)),cursorCharRight=o=>cursorByChar(o,ltrAtCursor(o));function cursorByGroup(o,e){return moveSel(o,s=>s.empty?o.moveByGroup(s,e):rangeEnd(s,e))}const cursorGroupLeft=o=>cursorByGroup(o,!ltrAtCursor(o)),cursorGroupRight=o=>cursorByGroup(o,ltrAtCursor(o));function interestingNode(o,e,s){if(e.type.prop(s))return!0;let l=e.to-e.from;return l&&(l>2||/[^\s,.;:]/.test(o.sliceDoc(e.from,e.to)))||e.firstChild}function moveBySyntax(o,e,s){let l=syntaxTree(o).resolveInner(e.head),a=s?NodeProp.closedBy:NodeProp.openedBy;for(let p=e.head;;){let m=s?l.childAfter(p):l.childBefore(p);if(!m)break;interestingNode(o,m,a)?l=m:p=s?m.to:m.from}let h=l.type.prop(a),f,u;return h&&(f=s?matchBrackets(o,l.from,1):matchBrackets(o,l.to,-1))&&f.matched?u=s?f.end.to:f.end.from:u=s?l.to:l.from,EditorSelection.cursor(u,s?-1:1)}const cursorSyntaxLeft=o=>moveSel(o,e=>moveBySyntax(o.state,e,!ltrAtCursor(o))),cursorSyntaxRight=o=>moveSel(o,e=>moveBySyntax(o.state,e,ltrAtCursor(o)));function cursorByLine(o,e){return moveSel(o,s=>{if(!s.empty)return rangeEnd(s,e);let l=o.moveVertically(s,e);return l.head!=s.head?l:o.moveToLineBoundary(s,e)})}const cursorLineUp=o=>cursorByLine(o,!1),cursorLineDown=o=>cursorByLine(o,!0);function pageInfo(o){let e=o.scrollDOM.clientHeight<o.scrollDOM.scrollHeight-2,s=0,l=0,a;if(e){for(let h of o.state.facet(EditorView.scrollMargins)){let f=h(o);f!=null&&f.top&&(s=Math.max(f==null?void 0:f.top,s)),f!=null&&f.bottom&&(l=Math.max(f==null?void 0:f.bottom,l))}a=o.scrollDOM.clientHeight-s-l}else a=(o.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:s,marginBottom:l,selfScroll:e,height:Math.max(o.defaultLineHeight,a-5)}}function cursorByPage(o,e){let s=pageInfo(o),{state:l}=o,a=updateSel(l.selection,f=>f.empty?o.moveVertically(f,e,s.height):rangeEnd(f,e));if(a.eq(l.selection))return!1;let h;if(s.selfScroll){let f=o.coordsAtPos(l.selection.main.head),u=o.scrollDOM.getBoundingClientRect(),p=u.top+s.marginTop,m=u.bottom-s.marginBottom;f&&f.top>p&&f.bottom<m&&(h=EditorView.scrollIntoView(a.main.head,{y:"start",yMargin:f.top-p}))}return o.dispatch(setSel(l,a),{effects:h}),!0}const cursorPageUp=o=>cursorByPage(o,!1),cursorPageDown=o=>cursorByPage(o,!0);function moveByLineBoundary(o,e,s){let l=o.lineBlockAt(e.head),a=o.moveToLineBoundary(e,s);if(a.head==e.head&&a.head!=(s?l.to:l.from)&&(a=o.moveToLineBoundary(e,s,!1)),!s&&a.head==l.from&&l.length){let h=/^\s*/.exec(o.state.sliceDoc(l.from,Math.min(l.from+100,l.to)))[0].length;h&&e.head!=l.from+h&&(a=EditorSelection.cursor(l.from+h))}return a}const cursorLineBoundaryForward=o=>moveSel(o,e=>moveByLineBoundary(o,e,!0)),cursorLineBoundaryBackward=o=>moveSel(o,e=>moveByLineBoundary(o,e,!1)),cursorLineBoundaryLeft=o=>moveSel(o,e=>moveByLineBoundary(o,e,!ltrAtCursor(o))),cursorLineBoundaryRight=o=>moveSel(o,e=>moveByLineBoundary(o,e,ltrAtCursor(o))),cursorLineStart=o=>moveSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).from,1)),cursorLineEnd=o=>moveSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).to,-1));function toMatchingBracket(o,e,s){let l=!1,a=updateSel(o.selection,h=>{let f=matchBrackets(o,h.head,-1)||matchBrackets(o,h.head,1)||h.head>0&&matchBrackets(o,h.head-1,1)||h.head<o.doc.length&&matchBrackets(o,h.head+1,-1);if(!f||!f.end)return h;l=!0;let u=f.start.from==h.head?f.end.to:f.end.from;return s?EditorSelection.range(h.anchor,u):EditorSelection.cursor(u)});return l?(e(setSel(o,a)),!0):!1}const cursorMatchingBracket=({state:o,dispatch:e})=>toMatchingBracket(o,e,!1);function extendSel(o,e){let s=updateSel(o.state.selection,l=>{let a=e(l);return EditorSelection.range(l.anchor,a.head,a.goalColumn,a.bidiLevel||void 0)});return s.eq(o.state.selection)?!1:(o.dispatch(setSel(o.state,s)),!0)}function selectByChar(o,e){return extendSel(o,s=>o.moveByChar(s,e))}const selectCharLeft=o=>selectByChar(o,!ltrAtCursor(o)),selectCharRight=o=>selectByChar(o,ltrAtCursor(o));function selectByGroup(o,e){return extendSel(o,s=>o.moveByGroup(s,e))}const selectGroupLeft=o=>selectByGroup(o,!ltrAtCursor(o)),selectGroupRight=o=>selectByGroup(o,ltrAtCursor(o)),selectSyntaxLeft=o=>extendSel(o,e=>moveBySyntax(o.state,e,!ltrAtCursor(o))),selectSyntaxRight=o=>extendSel(o,e=>moveBySyntax(o.state,e,ltrAtCursor(o)));function selectByLine(o,e){return extendSel(o,s=>o.moveVertically(s,e))}const selectLineUp=o=>selectByLine(o,!1),selectLineDown=o=>selectByLine(o,!0);function selectByPage(o,e){return extendSel(o,s=>o.moveVertically(s,e,pageInfo(o).height))}const selectPageUp=o=>selectByPage(o,!1),selectPageDown=o=>selectByPage(o,!0),selectLineBoundaryForward=o=>extendSel(o,e=>moveByLineBoundary(o,e,!0)),selectLineBoundaryBackward=o=>extendSel(o,e=>moveByLineBoundary(o,e,!1)),selectLineBoundaryLeft=o=>extendSel(o,e=>moveByLineBoundary(o,e,!ltrAtCursor(o))),selectLineBoundaryRight=o=>extendSel(o,e=>moveByLineBoundary(o,e,ltrAtCursor(o))),selectLineStart=o=>extendSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).from)),selectLineEnd=o=>extendSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).to)),cursorDocStart=({state:o,dispatch:e})=>(e(setSel(o,{anchor:0})),!0),cursorDocEnd=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.doc.length})),!0),selectDocStart=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.selection.main.anchor,head:0})),!0),selectDocEnd=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.selection.main.anchor,head:o.doc.length})),!0),selectAll=({state:o,dispatch:e})=>(e(o.update({selection:{anchor:0,head:o.doc.length},userEvent:"select"})),!0),selectLine=({state:o,dispatch:e})=>{let s=selectedLineBlocks(o).map(({from:l,to:a})=>EditorSelection.range(l,Math.min(a+1,o.doc.length)));return e(o.update({selection:EditorSelection.create(s),userEvent:"select"})),!0},selectParentSyntax=({state:o,dispatch:e})=>{let s=updateSel(o.selection,l=>{var a;let h=syntaxTree(o).resolveInner(l.head,1);for(;!(h.from<l.from&&h.to>=l.to||h.to>l.to&&h.from<=l.from||!(!((a=h.parent)===null||a===void 0)&&a.parent));)h=h.parent;return EditorSelection.range(h.to,h.from)});return e(setSel(o,s)),!0},simplifySelection=({state:o,dispatch:e})=>{let s=o.selection,l=null;return s.ranges.length>1?l=EditorSelection.create([s.main]):s.main.empty||(l=EditorSelection.create([EditorSelection.cursor(s.main.head)])),l?(e(setSel(o,l)),!0):!1};function deleteBy(o,e){if(o.state.readOnly)return!1;let s="delete.selection",{state:l}=o,a=l.changeByRange(h=>{let{from:f,to:u}=h;if(f==u){let p=e(f);p<f?(s="delete.backward",p=skipAtomic(o,p,!1)):p>f&&(s="delete.forward",p=skipAtomic(o,p,!0)),f=Math.min(f,p),u=Math.max(u,p)}else f=skipAtomic(o,f,!1),u=skipAtomic(o,u,!0);return f==u?{range:h}:{changes:{from:f,to:u},range:EditorSelection.cursor(f)}});return a.changes.empty?!1:(o.dispatch(l.update(a,{scrollIntoView:!0,userEvent:s,effects:s=="delete.selection"?EditorView.announce.of(l.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(o,e,s){if(o instanceof EditorView)for(let l of o.state.facet(EditorView.atomicRanges).map(a=>a(o)))l.between(e,e,(a,h)=>{a<e&&h>e&&(e=s?h:a)});return e}const deleteByChar=(o,e)=>deleteBy(o,s=>{let{state:l}=o,a=l.doc.lineAt(s),h,f;if(!e&&s>a.from&&s<a.from+200&&!/[^ \t]/.test(h=a.text.slice(0,s-a.from))){if(h[h.length-1]=="	")return s-1;let u=countColumn(h,l.tabSize),p=u%getIndentUnit(l)||getIndentUnit(l);for(let m=0;m<p&&h[h.length-1-m]==" ";m++)s--;f=s}else f=findClusterBreak(a.text,s-a.from,e,e)+a.from,f==s&&a.number!=(e?l.doc.lines:1)&&(f+=e?1:-1);return f}),deleteCharBackward=o=>deleteByChar(o,!1),deleteCharForward=o=>deleteByChar(o,!0),deleteByGroup=(o,e)=>deleteBy(o,s=>{let l=s,{state:a}=o,h=a.doc.lineAt(l),f=a.charCategorizer(l);for(let u=null;;){if(l==(e?h.to:h.from)){l==s&&h.number!=(e?a.doc.lines:1)&&(l+=e?1:-1);break}let p=findClusterBreak(h.text,l-h.from,e)+h.from,m=h.text.slice(Math.min(l,p)-h.from,Math.max(l,p)-h.from),g=f(m);if(u!=null&&g!=u)break;(m!=" "||l!=s)&&(u=g),l=p}return l}),deleteGroupBackward=o=>deleteByGroup(o,!1),deleteGroupForward=o=>deleteByGroup(o,!0),deleteToLineEnd=o=>deleteBy(o,e=>{let s=o.lineBlockAt(e).to;return e<s?s:Math.min(o.state.doc.length,e+1)}),deleteToLineStart=o=>deleteBy(o,e=>{let s=o.lineBlockAt(e).from;return e>s?s:Math.max(0,e-1)}),splitLine=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let s=o.changeByRange(l=>({changes:{from:l.from,to:l.to,insert:Text.of(["",""])},range:EditorSelection.cursor(l.from)}));return e(o.update(s,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let s=o.changeByRange(l=>{if(!l.empty||l.from==0||l.from==o.doc.length)return{range:l};let a=l.from,h=o.doc.lineAt(a),f=a==h.from?a-1:findClusterBreak(h.text,a-h.from,!1)+h.from,u=a==h.to?a+1:findClusterBreak(h.text,a-h.from,!0)+h.from;return{changes:{from:f,to:u,insert:o.doc.slice(a,u).append(o.doc.slice(f,a))},range:EditorSelection.cursor(u)}});return s.changes.empty?!1:(e(o.update(s,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(o){let e=[],s=-1;for(let l of o.selection.ranges){let a=o.doc.lineAt(l.from),h=o.doc.lineAt(l.to);if(!l.empty&&l.to==h.from&&(h=o.doc.lineAt(l.to-1)),s>=a.number){let f=e[e.length-1];f.to=h.to,f.ranges.push(l)}else e.push({from:a.from,to:h.to,ranges:[l]});s=h.number+1}return e}function moveLine(o,e,s){if(o.readOnly)return!1;let l=[],a=[];for(let h of selectedLineBlocks(o)){if(s?h.to==o.doc.length:h.from==0)continue;let f=o.doc.lineAt(s?h.to+1:h.from-1),u=f.length+1;if(s){l.push({from:h.to,to:f.to},{from:h.from,insert:f.text+o.lineBreak});for(let p of h.ranges)a.push(EditorSelection.range(Math.min(o.doc.length,p.anchor+u),Math.min(o.doc.length,p.head+u)))}else{l.push({from:f.from,to:h.from},{from:h.to,insert:o.lineBreak+f.text});for(let p of h.ranges)a.push(EditorSelection.range(p.anchor-u,p.head-u))}}return l.length?(e(o.update({changes:l,scrollIntoView:!0,selection:EditorSelection.create(a,o.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:o,dispatch:e})=>moveLine(o,e,!1),moveLineDown=({state:o,dispatch:e})=>moveLine(o,e,!0);function copyLine(o,e,s){if(o.readOnly)return!1;let l=[];for(let a of selectedLineBlocks(o))s?l.push({from:a.from,insert:o.doc.slice(a.from,a.to)+o.lineBreak}):l.push({from:a.to,insert:o.lineBreak+o.doc.slice(a.from,a.to)});return e(o.update({changes:l,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:o,dispatch:e})=>copyLine(o,e,!1),copyLineDown=({state:o,dispatch:e})=>copyLine(o,e,!0),deleteLine=o=>{if(o.state.readOnly)return!1;let{state:e}=o,s=e.changes(selectedLineBlocks(e).map(({from:a,to:h})=>(a>0?a--:h<e.doc.length&&h++,{from:a,to:h}))),l=updateSel(e.selection,a=>o.moveVertically(a,!0)).map(s);return o.dispatch({changes:s,selection:l,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(o,e){if(/\(\)|\[\]|\{\}/.test(o.sliceDoc(e-1,e+1)))return{from:e,to:e};let s=syntaxTree(o).resolveInner(e),l=s.childBefore(e),a=s.childAfter(e),h;return l&&a&&l.to<=e&&a.from>=e&&(h=l.type.prop(NodeProp.closedBy))&&h.indexOf(a.name)>-1&&o.doc.lineAt(l.to).from==o.doc.lineAt(a.from).from&&!/\S/.test(o.sliceDoc(l.to,a.from))?{from:l.to,to:a.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(o){return({state:e,dispatch:s})=>{if(e.readOnly)return!1;let l=e.changeByRange(a=>{let{from:h,to:f}=a,u=e.doc.lineAt(h),p=!o&&h==f&&isBetweenBrackets(e,h);o&&(h=f=(f<=u.to?u:e.doc.lineAt(f)).to);let m=new IndentContext(e,{simulateBreak:h,simulateDoubleBreak:!!p}),g=getIndentation(m,h);for(g==null&&(g=countColumn(/^\s*/.exec(e.doc.lineAt(h).text)[0],e.tabSize));f<u.to&&/\s/.test(u.text[f-u.from]);)f++;p?{from:h,to:f}=p:h>u.from&&h<u.from+100&&!/\S/.test(u.text.slice(0,h))&&(h=u.from);let y=["",indentString(e,g)];return p&&y.push(indentString(e,m.lineIndent(u.from,-1))),{changes:{from:h,to:f,insert:Text.of(y)},range:EditorSelection.cursor(h+1+y[1].length)}});return s(e.update(l,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(o,e){let s=-1;return o.changeByRange(l=>{let a=[];for(let f=l.from;f<=l.to;){let u=o.doc.lineAt(f);u.number>s&&(l.empty||l.to>u.from)&&(e(u,a,l),s=u.number),f=u.to+1}let h=o.changes(a);return{changes:a,range:EditorSelection.range(h.mapPos(l.anchor,1),h.mapPos(l.head,1))}})}const indentSelection=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let s=Object.create(null),l=new IndentContext(o,{overrideIndentation:h=>{let f=s[h];return f??-1}}),a=changeBySelectedLine(o,(h,f,u)=>{let p=getIndentation(l,h.from);if(p==null)return;/\S/.test(h.text)||(p=0);let m=/^\s*/.exec(h.text)[0],g=indentString(o,p);(m!=g||u.from<h.from+m.length)&&(s[h.from]=p,f.push({from:h.from,to:h.from+m.length,insert:g}))});return a.changes.empty||e(o.update(a,{userEvent:"indent"})),!0},indentMore=({state:o,dispatch:e})=>o.readOnly?!1:(e(o.update(changeBySelectedLine(o,(s,l)=>{l.push({from:s.from,insert:o.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:o,dispatch:e})=>o.readOnly?!1:(e(o.update(changeBySelectedLine(o,(s,l)=>{let a=/^\s*/.exec(s.text)[0];if(!a)return;let h=countColumn(a,o.tabSize),f=0,u=indentString(o,Math.max(0,h-getIndentUnit(o)));for(;f<a.length&&f<u.length&&a.charCodeAt(f)==u.charCodeAt(f);)f++;l.push({from:s.from+f,to:s.from+a.length,insert:u.slice(f)})}),{userEvent:"delete.dedent"})),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(emacsStyleKeymap.map(o=>({mac:o.key,run:o.run,shift:o.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}].concat(standardKeymap);function crelt(){var o=arguments[0];typeof o=="string"&&(o=document.createElement(o));var e=1,s=arguments[1];if(s&&typeof s=="object"&&s.nodeType==null&&!Array.isArray(s)){for(var l in s)if(Object.prototype.hasOwnProperty.call(s,l)){var a=s[l];typeof a=="string"?o.setAttribute(l,a):a!=null&&(o[l]=a)}e++}for(;e<arguments.length;e++)add(o,arguments[e]);return o}function add(o,e){if(typeof e=="string")o.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)o.appendChild(e);else if(Array.isArray(e))for(var s=0;s<e.length;s++)add(o,e[s]);else throw new RangeError("Unsupported child node: "+e)}const basicNormalize=typeof String.prototype.normalize=="function"?o=>o.normalize("NFKD"):o=>o;class SearchCursor{constructor(e,s,l=0,a=e.length,h,f){this.test=f,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(l,a),this.bufferStart=l,this.normalize=h?u=>h(basicNormalize(u)):basicNormalize,this.query=this.normalize(s)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let s=fromCodePoint(e),l=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);let a=this.normalize(s);for(let h=0,f=l;;h++){let u=a.charCodeAt(h),p=this.match(u,f);if(h==a.length-1){if(p)return this.value=p,this;break}f==l&&h<s.length&&s.charCodeAt(h)==u&&f++}}}match(e,s){let l=null;for(let a=0;a<this.matches.length;a+=2){let h=this.matches[a],f=!1;this.query.charCodeAt(h)==e&&(h==this.query.length-1?l={from:this.matches[a+1],to:s+1}:(this.matches[a]++,f=!0)),f||(this.matches.splice(a,2),a-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?l={from:s,to:s+1}:this.matches.push(1,s)),l&&this.test&&!this.test(l.from,l.to,this.buffer,this.bufferPos)&&(l=null),l}}typeof Symbol<"u"&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const empty={from:-1,to:-1,match:/.*/.exec("")},baseFlags="gm"+(/x/.unicode==null?"":"u");class RegExpCursor{constructor(e,s,l,a=0,h=e.length){if(this.text=e,this.to=h,this.curLine="",this.done=!1,this.value=empty,/\\[sWDnr]|\n|\r|\[\^/.test(s))return new MultilineRegExpCursor(e,s,l,a,h);this.re=new RegExp(s,baseFlags+(l!=null&&l.ignoreCase?"i":"")),this.test=l==null?void 0:l.test,this.iter=e.iter();let f=e.lineAt(a);this.curLineStart=f.from,this.matchPos=toCharEnd(e,a),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let s=this.matchPos<=this.to&&this.re.exec(this.curLine);if(s){let l=this.curLineStart+s.index,a=l+s[0].length;if(this.matchPos=toCharEnd(this.text,a+(l==a?1:0)),l==this.curLineStart+this.curLine.length&&this.nextLine(),(l<a||l>this.value.to)&&(!this.test||this.test(l,a,s)))return this.value={from:l,to:a,match:s},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const flattened=new WeakMap;class FlattenedDoc{constructor(e,s){this.from=e,this.text=s}get to(){return this.from+this.text.length}static get(e,s,l){let a=flattened.get(e);if(!a||a.from>=l||a.to<=s){let u=new FlattenedDoc(s,e.sliceString(s,l));return flattened.set(e,u),u}if(a.from==s&&a.to==l)return a;let{text:h,from:f}=a;return f>s&&(h=e.sliceString(s,f)+h,f=s),a.to<l&&(h+=e.sliceString(a.to,l)),flattened.set(e,new FlattenedDoc(f,h)),new FlattenedDoc(s,h.slice(s-f,l-f))}}class MultilineRegExpCursor{constructor(e,s,l,a,h){this.text=e,this.to=h,this.done=!1,this.value=empty,this.matchPos=toCharEnd(e,a),this.re=new RegExp(s,baseFlags+(l!=null&&l.ignoreCase?"i":"")),this.test=l==null?void 0:l.test,this.flat=FlattenedDoc.get(e,a,this.chunkEnd(a+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,s=this.re.exec(this.flat.text);if(s&&!s[0]&&s.index==e&&(this.re.lastIndex=e+1,s=this.re.exec(this.flat.text)),s){let l=this.flat.from+s.index,a=l+s[0].length;if((this.flat.to>=this.to||s.index+s[0].length<=this.flat.text.length-10)&&(!this.test||this.test(l,a,s)))return this.value={from:l,to:a,match:s},this.matchPos=toCharEnd(this.text,a+(l==a?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});function validRegExp(o){try{return new RegExp(o,baseFlags),!0}catch{return!1}}function toCharEnd(o,e){if(e>=o.length)return e;let s=o.lineAt(e),l;for(;e<s.to&&(l=s.text.charCodeAt(e-s.from))>=56320&&l<57344;)e++;return e}function createLineDialog(o){let e=crelt("input",{class:"cm-textfield",name:"line"}),s=crelt("form",{class:"cm-gotoLine",onkeydown:a=>{a.keyCode==27?(a.preventDefault(),o.dispatch({effects:dialogEffect.of(!1)}),o.focus()):a.keyCode==13&&(a.preventDefault(),l())},onsubmit:a=>{a.preventDefault(),l()}},crelt("label",o.state.phrase("Go to line"),": ",e)," ",crelt("button",{class:"cm-button",type:"submit"},o.state.phrase("go")));function l(){let a=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!a)return;let{state:h}=o,f=h.doc.lineAt(h.selection.main.head),[,u,p,m,g]=a,y=m?+m.slice(1):0,w=p?+p:f.number;if(p&&g){let k=w/100;u&&(k=k*(u=="-"?-1:1)+f.number/h.doc.lines),w=Math.round(h.doc.lines*k)}else p&&u&&(w=w*(u=="-"?-1:1)+f.number);let x=h.doc.line(Math.max(1,Math.min(h.doc.lines,w))),b=EditorSelection.cursor(x.from+Math.max(0,Math.min(y,x.length)));o.dispatch({effects:[dialogEffect.of(!1),EditorView.scrollIntoView(b.from,{y:"center"})],selection:b}),o.focus()}return{dom:s}}const dialogEffect=StateEffect.define(),dialogField=StateField.define({create(){return!0},update(o,e){for(let s of e.effects)s.is(dialogEffect)&&(o=s.value);return o},provide:o=>showPanel.from(o,e=>e?createLineDialog:null)}),gotoLine=o=>{let e=getPanel(o,createLineDialog);if(!e){let s=[dialogEffect.of(!0)];o.state.field(dialogField,!1)==null&&s.push(StateEffect.appendConfig.of([dialogField,baseTheme$1$1])),o.dispatch({effects:s}),e=getPanel(o,createLineDialog)}return e&&e.dom.querySelector("input").focus(),!0},baseTheme$1$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),defaultHighlightOptions={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},highlightConfig=Facet.define({combine(o){return combineConfig(o,defaultHighlightOptions,{highlightWordAroundCursor:(e,s)=>e||s,minSelectionLength:Math.min,maxMatches:Math.min})}});function highlightSelectionMatches(o){let e=[defaultTheme,matchHighlighter];return o&&e.push(highlightConfig.of(o)),e}const matchDeco=Decoration.mark({class:"cm-selectionMatch"}),mainMatchDeco=Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(o,e,s,l){return(s==0||o(e.sliceDoc(s-1,s))!=CharCategory.Word)&&(l==e.doc.length||o(e.sliceDoc(l,l+1))!=CharCategory.Word)}function insideWord(o,e,s,l){return o(e.sliceDoc(s,s+1))==CharCategory.Word&&o(e.sliceDoc(l-1,l))==CharCategory.Word}const matchHighlighter=ViewPlugin.fromClass(class{constructor(o){this.decorations=this.getDeco(o)}update(o){(o.selectionSet||o.docChanged||o.viewportChanged)&&(this.decorations=this.getDeco(o.view))}getDeco(o){let e=o.state.facet(highlightConfig),{state:s}=o,l=s.selection;if(l.ranges.length>1)return Decoration.none;let a=l.main,h,f=null;if(a.empty){if(!e.highlightWordAroundCursor)return Decoration.none;let p=s.wordAt(a.head);if(!p)return Decoration.none;f=s.charCategorizer(a.head),h=s.sliceDoc(p.from,p.to)}else{let p=a.to-a.from;if(p<e.minSelectionLength||p>200)return Decoration.none;if(e.wholeWords){if(h=s.sliceDoc(a.from,a.to),f=s.charCategorizer(a.head),!(insideWordBoundaries(f,s,a.from,a.to)&&insideWord(f,s,a.from,a.to)))return Decoration.none}else if(h=s.sliceDoc(a.from,a.to).trim(),!h)return Decoration.none}let u=[];for(let p of o.visibleRanges){let m=new SearchCursor(s.doc,h,p.from,p.to);for(;!m.next().done;){let{from:g,to:y}=m.value;if((!f||insideWordBoundaries(f,s,g,y))&&(a.empty&&g<=a.from&&y>=a.to?u.push(mainMatchDeco.range(g,y)):(g>=a.to||y<=a.from)&&u.push(matchDeco.range(g,y)),u.length>e.maxMatches))return Decoration.none}}return Decoration.set(u)}},{decorations:o=>o.decorations}),defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),selectWord=({state:o,dispatch:e})=>{let{selection:s}=o,l=EditorSelection.create(s.ranges.map(a=>o.wordAt(a.head)||EditorSelection.cursor(a.head)),s.mainIndex);return l.eq(s)?!1:(e(o.update({selection:l})),!0)};function findNextOccurrence(o,e){let{main:s,ranges:l}=o.selection,a=o.wordAt(s.head),h=a&&a.from==s.from&&a.to==s.to;for(let f=!1,u=new SearchCursor(o.doc,e,l[l.length-1].to);;)if(u.next(),u.done){if(f)return null;u=new SearchCursor(o.doc,e,0,Math.max(0,l[l.length-1].from-1)),f=!0}else{if(f&&l.some(p=>p.from==u.value.from))continue;if(h){let p=o.wordAt(u.value.from);if(!p||p.from!=u.value.from||p.to!=u.value.to)continue}return u.value}}const selectNextOccurrence=({state:o,dispatch:e})=>{let{ranges:s}=o.selection;if(s.some(h=>h.from===h.to))return selectWord({state:o,dispatch:e});let l=o.sliceDoc(s[0].from,s[0].to);if(o.selection.ranges.some(h=>o.sliceDoc(h.from,h.to)!=l))return!1;let a=findNextOccurrence(o,l);return a?(e(o.update({selection:o.selection.addRange(EditorSelection.range(a.from,a.to),!1),effects:EditorView.scrollIntoView(a.to)})),!0):!1},searchConfigFacet=Facet.define({combine(o){return combineConfig(o,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new SearchPanel(e),scrollToMatch:e=>EditorView.scrollIntoView(e)})}});class SearchQuery{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||validRegExp(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(s,l)=>l=="n"?`
`:l=="r"?"\r":l=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(e,s=0,l){let a=e.doc?e:EditorState.create({doc:e});return l==null&&(l=a.doc.length),this.regexp?regexpCursor(this,a,s,l):stringCursor(this,a,s,l)}}class QueryType{constructor(e){this.spec=e}}function stringCursor(o,e,s,l){return new SearchCursor(e.doc,o.unquoted,s,l,o.caseSensitive?void 0:a=>a.toLowerCase(),o.wholeWord?stringWordTest(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function stringWordTest(o,e){return(s,l,a,h)=>((h>s||h+a.length<l)&&(h=Math.max(0,s-2),a=o.sliceString(h,Math.min(o.length,l+2))),(e(charBefore(a,s-h))!=CharCategory.Word||e(charAfter(a,s-h))!=CharCategory.Word)&&(e(charAfter(a,l-h))!=CharCategory.Word||e(charBefore(a,l-h))!=CharCategory.Word))}class StringQuery extends QueryType{constructor(e){super(e)}nextMatch(e,s,l){let a=stringCursor(this.spec,e,l,e.doc.length).nextOverlapping();return a.done&&(a=stringCursor(this.spec,e,0,s).nextOverlapping()),a.done?null:a.value}prevMatchInRange(e,s,l){for(let a=l;;){let h=Math.max(s,a-1e4-this.spec.unquoted.length),f=stringCursor(this.spec,e,h,a),u=null;for(;!f.nextOverlapping().done;)u=f.value;if(u)return u;if(h==s)return null;a-=1e4}}prevMatch(e,s,l){return this.prevMatchInRange(e,0,s)||this.prevMatchInRange(e,l,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,s){let l=stringCursor(this.spec,e,0,e.doc.length),a=[];for(;!l.next().done;){if(a.length>=s)return null;a.push(l.value)}return a}highlight(e,s,l,a){let h=stringCursor(this.spec,e,Math.max(0,s-this.spec.unquoted.length),Math.min(l+this.spec.unquoted.length,e.doc.length));for(;!h.next().done;)a(h.value.from,h.value.to)}}function regexpCursor(o,e,s,l){return new RegExpCursor(e.doc,o.search,{ignoreCase:!o.caseSensitive,test:o.wholeWord?regexpWordTest(e.charCategorizer(e.selection.main.head)):void 0},s,l)}function charBefore(o,e){return o.slice(findClusterBreak(o,e,!1),e)}function charAfter(o,e){return o.slice(e,findClusterBreak(o,e))}function regexpWordTest(o){return(e,s,l)=>!l[0].length||(o(charBefore(l.input,l.index))!=CharCategory.Word||o(charAfter(l.input,l.index))!=CharCategory.Word)&&(o(charAfter(l.input,l.index+l[0].length))!=CharCategory.Word||o(charBefore(l.input,l.index+l[0].length))!=CharCategory.Word)}class RegExpQuery extends QueryType{nextMatch(e,s,l){let a=regexpCursor(this.spec,e,l,e.doc.length).next();return a.done&&(a=regexpCursor(this.spec,e,0,s).next()),a.done?null:a.value}prevMatchInRange(e,s,l){for(let a=1;;a++){let h=Math.max(s,l-a*1e4),f=regexpCursor(this.spec,e,h,l),u=null;for(;!f.next().done;)u=f.value;if(u&&(h==s||u.from>h+10))return u;if(h==s)return null}}prevMatch(e,s,l){return this.prevMatchInRange(e,0,s)||this.prevMatchInRange(e,l,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(s,l)=>l=="$"?"$":l=="&"?e.match[0]:l!="0"&&+l<e.match.length?e.match[l]:s))}matchAll(e,s){let l=regexpCursor(this.spec,e,0,e.doc.length),a=[];for(;!l.next().done;){if(a.length>=s)return null;a.push(l.value)}return a}highlight(e,s,l,a){let h=regexpCursor(this.spec,e,Math.max(0,s-250),Math.min(l+250,e.doc.length));for(;!h.next().done;)a(h.value.from,h.value.to)}}const setSearchQuery=StateEffect.define(),togglePanel$1=StateEffect.define(),searchState=StateField.define({create(o){return new SearchState(defaultQuery(o).create(),null)},update(o,e){for(let s of e.effects)s.is(setSearchQuery)?o=new SearchState(s.value.create(),o.panel):s.is(togglePanel$1)&&(o=new SearchState(o.query,s.value?createSearchPanel:null));return o},provide:o=>showPanel.from(o,e=>e.panel)});class SearchState{constructor(e,s){this.query=e,this.panel=s}}const matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),searchHighlighter=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.decorations=this.highlight(o.state.field(searchState))}update(o){let e=o.state.field(searchState);(e!=o.startState.field(searchState)||o.docChanged||o.selectionSet||o.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:o,panel:e}){if(!e||!o.spec.valid)return Decoration.none;let{view:s}=this,l=new RangeSetBuilder;for(let a=0,h=s.visibleRanges,f=h.length;a<f;a++){let{from:u,to:p}=h[a];for(;a<f-1&&p>h[a+1].from-2*250;)p=h[++a].to;o.highlight(s.state,u,p,(m,g)=>{let y=s.state.selection.ranges.some(w=>w.from==m&&w.to==g);l.add(m,g,y?selectedMatchMark:matchMark)})}return l.finish()}},{decorations:o=>o.decorations});function searchCommand(o){return e=>{let s=e.state.field(searchState,!1);return s&&s.query.spec.valid?o(e,s):openSearchPanel(e)}}const findNext=searchCommand((o,{query:e})=>{let{to:s}=o.state.selection.main,l=e.nextMatch(o.state,s,s);if(!l)return!1;let a=EditorSelection.single(l.from,l.to),h=o.state.facet(searchConfigFacet);return o.dispatch({selection:a,effects:[announceMatch(o,l),h.scrollToMatch(a.main,o)],userEvent:"select.search"}),selectSearchInput(o),!0}),findPrevious=searchCommand((o,{query:e})=>{let{state:s}=o,{from:l}=s.selection.main,a=e.prevMatch(s,l,l);if(!a)return!1;let h=EditorSelection.single(a.from,a.to),f=o.state.facet(searchConfigFacet);return o.dispatch({selection:h,effects:[announceMatch(o,a),f.scrollToMatch(h.main,o)],userEvent:"select.search"}),selectSearchInput(o),!0}),selectMatches=searchCommand((o,{query:e})=>{let s=e.matchAll(o.state,1e3);return!s||!s.length?!1:(o.dispatch({selection:EditorSelection.create(s.map(l=>EditorSelection.range(l.from,l.to))),userEvent:"select.search.matches"}),!0)}),selectSelectionMatches=({state:o,dispatch:e})=>{let s=o.selection;if(s.ranges.length>1||s.main.empty)return!1;let{from:l,to:a}=s.main,h=[],f=0;for(let u=new SearchCursor(o.doc,o.sliceDoc(l,a));!u.next().done;){if(h.length>1e3)return!1;u.value.from==l&&(f=h.length),h.push(EditorSelection.range(u.value.from,u.value.to))}return e(o.update({selection:EditorSelection.create(h,f),userEvent:"select.search.matches"})),!0},replaceNext=searchCommand((o,{query:e})=>{let{state:s}=o,{from:l,to:a}=s.selection.main;if(s.readOnly)return!1;let h=e.nextMatch(s,l,l);if(!h)return!1;let f=[],u,p,m=[];if(h.from==l&&h.to==a&&(p=s.toText(e.getReplacement(h)),f.push({from:h.from,to:h.to,insert:p}),h=e.nextMatch(s,h.from,h.to),m.push(EditorView.announce.of(s.phrase("replaced match on line $",s.doc.lineAt(l).number)+"."))),h){let g=f.length==0||f[0].from>=h.to?0:h.to-h.from-p.length;u=EditorSelection.single(h.from-g,h.to-g),m.push(announceMatch(o,h)),m.push(s.facet(searchConfigFacet).scrollToMatch(u.main,o))}return o.dispatch({changes:f,selection:u,effects:m,userEvent:"input.replace"}),!0}),replaceAll=searchCommand((o,{query:e})=>{if(o.state.readOnly)return!1;let s=e.matchAll(o.state,1e9).map(a=>{let{from:h,to:f}=a;return{from:h,to:f,insert:e.getReplacement(a)}});if(!s.length)return!1;let l=o.state.phrase("replaced $ matches",s.length)+".";return o.dispatch({changes:s,effects:EditorView.announce.of(l),userEvent:"input.replace.all"}),!0});function createSearchPanel(o){return o.state.facet(searchConfigFacet).createPanel(o)}function defaultQuery(o,e){var s,l,a,h,f;let u=o.selection.main,p=u.empty||u.to>u.from+100?"":o.sliceDoc(u.from,u.to);if(e&&!p)return e;let m=o.facet(searchConfigFacet);return new SearchQuery({search:((s=e==null?void 0:e.literal)!==null&&s!==void 0?s:m.literal)?p:p.replace(/\n/g,"\\n"),caseSensitive:(l=e==null?void 0:e.caseSensitive)!==null&&l!==void 0?l:m.caseSensitive,literal:(a=e==null?void 0:e.literal)!==null&&a!==void 0?a:m.literal,regexp:(h=e==null?void 0:e.regexp)!==null&&h!==void 0?h:m.regexp,wholeWord:(f=e==null?void 0:e.wholeWord)!==null&&f!==void 0?f:m.wholeWord})}function getSearchInput(o){let e=getPanel(o,createSearchPanel);return e&&e.dom.querySelector("[main-field]")}function selectSearchInput(o){let e=getSearchInput(o);e&&e==o.root.activeElement&&e.select()}const openSearchPanel=o=>{let e=o.state.field(searchState,!1);if(e&&e.panel){let s=getSearchInput(o);if(s&&s!=o.root.activeElement){let l=defaultQuery(o.state,e.query.spec);l.valid&&o.dispatch({effects:setSearchQuery.of(l)}),s.focus(),s.select()}}else o.dispatch({effects:[togglePanel$1.of(!0),e?setSearchQuery.of(defaultQuery(o.state,e.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});return!0},closeSearchPanel=o=>{let e=o.state.field(searchState,!1);if(!e||!e.panel)return!1;let s=getPanel(o,createSearchPanel);return s&&s.dom.contains(o.root.activeElement)&&o.focus(),o.dispatch({effects:togglePanel$1.of(!1)}),!0},searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:!0}];class SearchPanel{constructor(e){this.view=e;let s=this.query=e.state.field(searchState).query.spec;this.commit=this.commit.bind(this),this.searchField=crelt("input",{value:s.search,placeholder:phrase(e,"Find"),"aria-label":phrase(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=crelt("input",{value:s.replace,placeholder:phrase(e,"Replace"),"aria-label":phrase(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:s.caseSensitive,onchange:this.commit}),this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:s.regexp,onchange:this.commit}),this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:s.wholeWord,onchange:this.commit});function l(a,h,f){return crelt("button",{class:"cm-button",name:a,onclick:h,type:"button"},f)}this.dom=crelt("div",{onkeydown:a=>this.keydown(a),class:"cm-search"},[this.searchField,l("next",()=>findNext(e),[phrase(e,"next")]),l("prev",()=>findPrevious(e),[phrase(e,"previous")]),l("select",()=>selectMatches(e),[phrase(e,"all")]),crelt("label",null,[this.caseField,phrase(e,"match case")]),crelt("label",null,[this.reField,phrase(e,"regexp")]),crelt("label",null,[this.wordField,phrase(e,"by word")]),...e.state.readOnly?[]:[crelt("br"),this.replaceField,l("replace",()=>replaceNext(e),[phrase(e,"replace")]),l("replaceAll",()=>replaceAll(e),[phrase(e,"replace all")])],crelt("button",{name:"close",onclick:()=>closeSearchPanel(e),"aria-label":phrase(e,"close"),type:"button"},["Ã—"])])}commit(){let e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:setSearchQuery.of(e)}))}keydown(e){runScopeHandlers(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?findPrevious:findNext)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),replaceNext(this.view))}update(e){for(let s of e.transactions)for(let l of s.effects)l.is(setSearchQuery)&&!l.value.eq(this.query)&&this.setQuery(l.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(searchConfigFacet).top}}function phrase(o,e){return o.state.phrase(e)}const AnnounceMargin=30,Break=/[\s\.,:;?!]/;function announceMatch(o,{from:e,to:s}){let l=o.state.doc.lineAt(e),a=o.state.doc.lineAt(s).to,h=Math.max(l.from,e-AnnounceMargin),f=Math.min(a,s+AnnounceMargin),u=o.state.sliceDoc(h,f);if(h!=l.from){for(let p=0;p<AnnounceMargin;p++)if(!Break.test(u[p+1])&&Break.test(u[p])){u=u.slice(p);break}}if(f!=a){for(let p=u.length-1;p>u.length-AnnounceMargin;p--)if(!Break.test(u[p-1])&&Break.test(u[p])){u=u.slice(0,p);break}}return EditorView.announce.of(`${o.state.phrase("current match")}. ${u} ${o.state.phrase("on line")} ${l.number}.`)}const baseTheme$2=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),searchExtensions=[searchState,Prec.low(searchHighlighter),baseTheme$2];class CompletionContext{constructor(e,s,l){this.state=e,this.pos=s,this.explicit=l,this.abortListeners=[]}tokenBefore(e){let s=syntaxTree(this.state).resolveInner(this.pos,-1);for(;s&&e.indexOf(s.name)<0;)s=s.parent;return s?{from:s.from,to:this.pos,text:this.state.sliceDoc(s.from,this.pos),type:s.type}:null}matchBefore(e){let s=this.state.doc.lineAt(this.pos),l=Math.max(s.from,this.pos-250),a=s.text.slice(l-s.from,this.pos-s.from),h=a.search(ensureAnchor(e,!1));return h<0?null:{from:l+h,to:this.pos,text:a.slice(h)}}get aborted(){return this.abortListeners==null}addEventListener(e,s){e=="abort"&&this.abortListeners&&this.abortListeners.push(s)}}function toSet$1(o){let e=Object.keys(o).join(""),s=/\w/.test(e);return s&&(e=e.replace(/\w/g,"")),`[${s?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(o){let e=Object.create(null),s=Object.create(null);for(let{label:a}of o){e[a[0]]=!0;for(let h=1;h<a.length;h++)s[a[h]]=!0}let l=toSet$1(e)+toSet$1(s)+"*$";return[new RegExp("^"+l),new RegExp(l)]}function completeFromList(o){let e=o.map(a=>typeof a=="string"?{label:a}:a),[s,l]=e.every(a=>/^\w+$/.test(a.label))?[/\w*$/,/\w+$/]:prefixMatch(e);return a=>{let h=a.matchBefore(l);return h||a.explicit?{from:h?h.from:a.pos,options:e,validFor:s}:null}}class Option{constructor(e,s,l,a){this.completion=e,this.source=s,this.match=l,this.score=a}}function cur(o){return o.selection.main.from}function ensureAnchor(o,e){var s;let{source:l}=o,a=e&&l[0]!="^",h=l[l.length-1]!="$";return!a&&!h?o:new RegExp(`${a?"^":""}(?:${l})${h?"$":""}`,(s=o.flags)!==null&&s!==void 0?s:o.ignoreCase?"i":"")}const pickedCompletion=Annotation.define();function insertCompletionText(o,e,s,l){let{main:a}=o.selection,h=s-a.from,f=l-a.from;return Object.assign(Object.assign({},o.changeByRange(u=>u!=a&&s!=l&&o.sliceDoc(u.from+h,u.from+f)!=o.sliceDoc(s,l)?{range:u}:{changes:{from:u.from+h,to:l==a.from?u.to:u.from+f,insert:e},range:EditorSelection.cursor(u.from+h+e.length)})),{userEvent:"input.complete"})}const SourceCache=new WeakMap;function asSource(o){if(!Array.isArray(o))return o;let e=SourceCache.get(o);return e||SourceCache.set(o,e=completeFromList(o)),e}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let s=0;s<e.length;){let l=codePointAt(e,s),a=codePointSize(l);this.chars.push(l);let h=e.slice(s,s+a),f=h.toUpperCase();this.folded.push(codePointAt(f==h?h.toLowerCase():f,0)),s+=a}this.astral=e.length!=this.chars.length}ret(e,s){return this.score=e,this.matched=s,!0}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return!1;let{chars:s,folded:l,any:a,precise:h,byWord:f}=this;if(s.length==1){let E=codePointAt(e,0),R=codePointSize(E),O=R==e.length?0:-100;if(E!=s[0])if(E==l[0])O+=-200;else return!1;return this.ret(O,[0,R])}let u=e.indexOf(this.pattern);if(u==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let p=s.length,m=0;if(u<0){for(let E=0,R=Math.min(e.length,200);E<R&&m<p;){let O=codePointAt(e,E);(O==s[m]||O==l[m])&&(a[m++]=E),E+=codePointSize(O)}if(m<p)return!1}let g=0,y=0,w=!1,x=0,b=-1,k=-1,S=/[a-z]/.test(e),P=!0;for(let E=0,R=Math.min(e.length,200),O=0;E<R&&y<p;){let T=codePointAt(e,E);u<0&&(g<p&&T==s[g]&&(h[g++]=E),x<p&&(T==s[x]||T==l[x]?(x==0&&(b=E),k=E+1,x++):x=0));let M,$=T<255?T>=48&&T<=57||T>=97&&T<=122?2:T>=65&&T<=90?1:0:(M=fromCodePoint(T))!=M.toLowerCase()?1:M!=M.toUpperCase()?2:0;(!E||$==1&&S||O==0&&$!=0)&&(s[y]==T||l[y]==T&&(w=!0)?f[y++]=E:f.length&&(P=!1)),O=$,E+=codePointSize(T)}return y==p&&f[0]==0&&P?this.result(-100+(w?-200:0),f,e):x==p&&b==0?this.ret(-200-e.length+(k==e.length?0:-100),[0,k]):u>-1?this.ret(-700-e.length,[u,u+this.pattern.length]):x==p?this.ret(-200+-700-e.length,[b,k]):y==p?this.result(-100+(w?-200:0)+-700+(P?0:-1100),f,e):s.length==2?!1:this.result((a[0]?-700:0)+-200+-1100,a,e)}result(e,s,l){let a=[],h=0;for(let f of s){let u=f+(this.astral?codePointSize(codePointAt(l,f)):1);h&&a[h-1]==f?a[h-1]=u:(a[h++]=f,a[h++]=u)}return this.ret(e-l.length,a)}}const completionConfig=Facet.define({combine(o){return combineConfig(o,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,compareCompletions:(e,s)=>e.label.localeCompare(s.label),interactionDelay:75},{defaultKeymap:(e,s)=>e&&s,closeOnBlur:(e,s)=>e&&s,icons:(e,s)=>e&&s,tooltipClass:(e,s)=>l=>joinClass(e(l),s(l)),optionClass:(e,s)=>l=>joinClass(e(l),s(l)),addToOptions:(e,s)=>e.concat(s)})}});function joinClass(o,e){return o?e?o+" "+e:o:e}function defaultPositionInfo(o,e,s,l,a){let h=o.textDirection==Direction.RTL,f=h,u=!1,p="top",m,g,y=e.left-a.left,w=a.right-e.right,x=l.right-l.left,b=l.bottom-l.top;if(f&&y<Math.min(x,w)?f=!1:!f&&w<Math.min(x,y)&&(f=!0),x<=(f?y:w))m=Math.max(a.top,Math.min(s.top,a.bottom-b))-e.top,g=Math.min(400,f?y:w);else{u=!0,g=Math.min(400,(h?e.right:a.right-e.left)-30);let k=a.bottom-e.bottom;k>=b||k>e.top?m=s.bottom-e.top:(p="bottom",m=e.bottom-s.top)}return{style:`${p}: ${m}px; max-width: ${g}px`,class:"cm-completionInfo-"+(u?h?"left-narrow":"right-narrow":f?"left":"right")}}function optionContent(o){let e=o.addToOptions.slice();return o.icons&&e.push({render(s){let l=document.createElement("div");return l.classList.add("cm-completionIcon"),s.type&&l.classList.add(...s.type.split(/\s+/g).map(a=>"cm-completionIcon-"+a)),l.setAttribute("aria-hidden","true"),l},position:20}),e.push({render(s,l,a){let h=document.createElement("span");h.className="cm-completionLabel";let f=s.displayLabel||s.label,u=0;for(let p=0;p<a.length;){let m=a[p++],g=a[p++];m>u&&h.appendChild(document.createTextNode(f.slice(u,m)));let y=h.appendChild(document.createElement("span"));y.appendChild(document.createTextNode(f.slice(m,g))),y.className="cm-completionMatchedText",u=g}return u<f.length&&h.appendChild(document.createTextNode(f.slice(u))),h},position:50},{render(s){if(!s.detail)return null;let l=document.createElement("span");return l.className="cm-completionDetail",l.textContent=s.detail,l},position:80}),e.sort((s,l)=>s.position-l.position).map(s=>s.render)}function rangeAroundSelected(o,e,s){if(o<=s)return{from:0,to:o};if(e<0&&(e=0),e<=o>>1){let a=Math.floor(e/s);return{from:a*s,to:(a+1)*s}}let l=Math.floor((o-e)/s);return{from:o-(l+1)*s,to:o-l*s}}class CompletionTooltip{constructor(e,s,l){this.view=e,this.stateField=s,this.applyCompletion=l,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:p=>this.placeInfo(p),key:this},this.space=null,this.currentClass="";let a=e.state.field(s),{options:h,selected:f}=a.open,u=e.state.facet(completionConfig);this.optionContent=optionContent(u),this.optionClass=u.optionClass,this.tooltipClass=u.tooltipClass,this.range=rangeAroundSelected(h.length,f,u.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",p=>{for(let m=p.target,g;m&&m!=this.dom;m=m.parentNode)if(m.nodeName=="LI"&&(g=/-(\d+)$/.exec(m.id))&&+g[1]<h.length){this.applyCompletion(e,h[+g[1]]),p.preventDefault();return}}),this.dom.addEventListener("focusout",p=>{let m=e.state.field(this.stateField,!1);m&&m.tooltip&&e.state.facet(completionConfig).closeOnBlur&&p.relatedTarget!=e.contentDOM&&e.dispatch({effects:closeCompletionEffect.of(null)})}),this.list=this.dom.appendChild(this.createListBox(h,a.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}mount(){this.updateSel()}update(e){var s,l,a;let h=e.state.field(this.stateField),f=e.startState.field(this.stateField);this.updateTooltipClass(e.state),h!=f&&(this.updateSel(),((s=h.open)===null||s===void 0?void 0:s.disabled)!=((l=f.open)===null||l===void 0?void 0:l.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!(!((a=h.open)===null||a===void 0)&&a.disabled)))}updateTooltipClass(e){let s=this.tooltipClass(e);if(s!=this.currentClass){for(let l of this.currentClass.split(" "))l&&this.dom.classList.remove(l);for(let l of s.split(" "))l&&this.dom.classList.add(l);this.currentClass=s}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),s=e.open;if((s.selected>-1&&s.selected<this.range.from||s.selected>=this.range.to)&&(this.range=rangeAroundSelected(s.options.length,s.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(s.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})),this.updateSelectedOption(s.selected)){this.destroyInfo();let{completion:l}=s.options[s.selected],{info:a}=l;if(!a)return;let h=typeof a=="string"?document.createTextNode(a):a(l);if(!h)return;"then"in h?h.then(f=>{f&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(f,l)}).catch(f=>logException(this.view.state,f,"completion info")):this.addInfoPane(h,l)}}addInfoPane(e,s){this.destroyInfo();let l=this.info=document.createElement("div");if(l.className="cm-tooltip cm-completionInfo",e.nodeType!=null)l.appendChild(e),this.infoDestroy=null;else{let{dom:a,destroy:h}=e;l.appendChild(a),this.infoDestroy=h||null}this.dom.appendChild(l),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let s=null;for(let l=this.list.firstChild,a=this.range.from;l;l=l.nextSibling,a++)l.nodeName!="LI"||!l.id?a--:a==e?l.hasAttribute("aria-selected")||(l.setAttribute("aria-selected","true"),s=l):l.hasAttribute("aria-selected")&&l.removeAttribute("aria-selected");return s&&scrollIntoView(this.list,s),s}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let s=this.dom.getBoundingClientRect(),l=this.info.getBoundingClientRect(),a=e.getBoundingClientRect(),h=this.space;if(!h){let f=this.dom.ownerDocument.defaultView||window;h={left:0,top:0,right:f.innerWidth,bottom:f.innerHeight}}return a.top>Math.min(h.bottom,s.bottom)-10||a.bottom<Math.max(h.top,s.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,s,a,l,h)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,s,l){const a=document.createElement("ul");a.id=s,a.setAttribute("role","listbox"),a.setAttribute("aria-expanded","true"),a.setAttribute("aria-label",this.view.state.phrase("Completions"));let h=null;for(let f=l.from;f<l.to;f++){let{completion:u,match:p}=e[f],{section:m}=u;if(m){let w=typeof m=="string"?m:m.name;if(w!=h&&(f>l.from||l.from==0))if(h=w,typeof m!="string"&&m.header)a.appendChild(m.header(m));else{let x=a.appendChild(document.createElement("completion-section"));x.textContent=w}}const g=a.appendChild(document.createElement("li"));g.id=s+"-"+f,g.setAttribute("role","option");let y=this.optionClass(u);y&&(g.className=y);for(let w of this.optionContent){let x=w(u,this.view.state,p);x&&g.appendChild(x)}}return l.from&&a.classList.add("cm-completionListIncompleteTop"),l.to<e.length&&a.classList.add("cm-completionListIncompleteBottom"),a}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function completionTooltip(o,e){return s=>new CompletionTooltip(s,o,e)}function scrollIntoView(o,e){let s=o.getBoundingClientRect(),l=e.getBoundingClientRect();l.top<s.top?o.scrollTop-=s.top-l.top:l.bottom>s.bottom&&(o.scrollTop+=l.bottom-s.bottom)}function score(o){return(o.boost||0)*100+(o.apply?10:0)+(o.info?5:0)+(o.type?1:0)}function sortOptions(o,e){let s=[],l=null,a=p=>{s.push(p);let{section:m}=p.completion;if(m){l||(l=[]);let g=typeof m=="string"?m:m.name;l.some(y=>y.name==g)||l.push(typeof m=="string"?{name:g}:m)}};for(let p of o)if(p.hasResult()){let m=p.result.getMatch;if(p.result.filter===!1)for(let g of p.result.options)a(new Option(g,p.source,m?m(g):[],1e9-s.length));else{let g=new FuzzyMatcher(e.sliceDoc(p.from,p.to));for(let y of p.result.options)if(g.match(y.label)){let w=y.displayLabel?m?m(y,g.matched):[]:g.matched;a(new Option(y,p.source,w,g.score+(y.boost||0)))}}}if(l){let p=Object.create(null),m=0,g=(y,w)=>{var x,b;return((x=y.rank)!==null&&x!==void 0?x:1e9)-((b=w.rank)!==null&&b!==void 0?b:1e9)||(y.name<w.name?-1:1)};for(let y of l.sort(g))m-=1e5,p[y.name]=m;for(let y of s){let{section:w}=y.completion;w&&(y.score+=p[typeof w=="string"?w:w.name])}}let h=[],f=null,u=e.facet(completionConfig).compareCompletions;for(let p of s.sort((m,g)=>g.score-m.score||u(m.completion,g.completion))){let m=p.completion;!f||f.label!=m.label||f.detail!=m.detail||f.type!=null&&m.type!=null&&f.type!=m.type||f.apply!=m.apply||f.boost!=m.boost?h.push(p):score(p.completion)>score(f)&&(h[h.length-1]=p),f=p.completion}return h}class CompletionDialog{constructor(e,s,l,a,h,f){this.options=e,this.attrs=s,this.tooltip=l,this.timestamp=a,this.selected=h,this.disabled=f}setSelected(e,s){return e==this.selected||e>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(s,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,s,l,a,h){let f=sortOptions(e,s);if(!f.length)return a&&e.some(p=>p.state==1)?new CompletionDialog(a.options,a.attrs,a.tooltip,a.timestamp,a.selected,!0):null;let u=s.facet(completionConfig).selectOnOpen?0:-1;if(a&&a.selected!=u&&a.selected!=-1){let p=a.options[a.selected].completion;for(let m=0;m<f.length;m++)if(f[m].completion==p){u=m;break}}return new CompletionDialog(f,makeAttrs(l,u),{pos:e.reduce((p,m)=>m.hasResult()?Math.min(p,m.from):p,1e8),create:completionTooltip(completionState,applyCompletion),above:h.aboveCursor},a?a.timestamp:Date.now(),u,!1)}map(e){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class CompletionState{constructor(e,s,l){this.active=e,this.id=s,this.open=l}static start(){return new CompletionState(none,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:s}=e,l=s.facet(completionConfig),h=(l.override||s.languageDataAt("autocomplete",cur(s)).map(asSource)).map(u=>(this.active.find(m=>m.source==u)||new ActiveSource(u,this.active.some(m=>m.state!=0)?1:0)).update(e,l));h.length==this.active.length&&h.every((u,p)=>u==this.active[p])&&(h=this.active);let f=this.open;f&&e.docChanged&&(f=f.map(e.changes)),e.selection||h.some(u=>u.hasResult()&&e.changes.touchesRange(u.from,u.to))||!sameResults(h,this.active)?f=CompletionDialog.build(h,s,this.id,f,l):f&&f.disabled&&!h.some(u=>u.state==1)&&(f=null),!f&&h.every(u=>u.state!=1)&&h.some(u=>u.hasResult())&&(h=h.map(u=>u.hasResult()?new ActiveSource(u.source,0):u));for(let u of e.effects)u.is(setSelectedEffect)&&(f=f&&f.setSelected(u.value,this.id));return h==this.active&&f==this.open?this:new CompletionState(h,this.id,f)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:baseAttrs}}function sameResults(o,e){if(o==e)return!0;for(let s=0,l=0;;){for(;s<o.length&&!o[s].hasResult;)s++;for(;l<e.length&&!e[l].hasResult;)l++;let a=s==o.length,h=l==e.length;if(a||h)return a==h;if(o[s++].result!=e[l++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"};function makeAttrs(o,e){let s={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":o};return e>-1&&(s["aria-activedescendant"]=o+"-"+e),s}const none=[];function getUserEvent(o){return o.isUserEvent("input.type")?"input":o.isUserEvent("delete.backward")?"delete":null}class ActiveSource{constructor(e,s,l=-1){this.source=e,this.state=s,this.explicitPos=l}hasResult(){return!1}update(e,s){let l=getUserEvent(e),a=this;l?a=a.handleUserEvent(e,l,s):e.docChanged?a=a.handleChange(e):e.selection&&a.state!=0&&(a=new ActiveSource(a.source,0));for(let h of e.effects)if(h.is(startCompletionEffect))a=new ActiveSource(a.source,1,h.value?cur(e.state):-1);else if(h.is(closeCompletionEffect))a=new ActiveSource(a.source,0);else if(h.is(setActiveEffect))for(let f of h.value)f.source==a.source&&(a=f);return a}handleUserEvent(e,s,l){return s=="delete"||!l.activateOnTyping?this.map(e.changes):new ActiveSource(this.source,1)}handleChange(e){return e.changes.touchesRange(cur(e.startState))?new ActiveSource(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new ActiveSource(this.source,this.state,e.mapPos(this.explicitPos))}}class ActiveResult extends ActiveSource{constructor(e,s,l,a,h){super(e,2,s),this.result=l,this.from=a,this.to=h}hasResult(){return!0}handleUserEvent(e,s,l){var a;let h=e.changes.mapPos(this.from),f=e.changes.mapPos(this.to,1),u=cur(e.state);if((this.explicitPos<0?u<=h:u<this.from)||u>f||s=="delete"&&cur(e.startState)==this.from)return new ActiveSource(this.source,s=="input"&&l.activateOnTyping?1:0);let p=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),m;return checkValid(this.result.validFor,e.state,h,f)?new ActiveResult(this.source,p,this.result,h,f):this.result.update&&(m=this.result.update(this.result,h,f,new CompletionContext(e.state,u,p>=0)))?new ActiveResult(this.source,p,m,m.from,(a=m.to)!==null&&a!==void 0?a:cur(e.state)):new ActiveSource(this.source,1,p)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new ActiveResult(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function checkValid(o,e,s,l){if(!o)return!1;let a=e.sliceDoc(s,l);return typeof o=="function"?o(a,s,l,e):ensureAnchor(o,!0).test(a)}const setActiveEffect=StateEffect.define({map(o,e){return o.map(s=>s.map(e))}}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create(){return CompletionState.start()},update(o,e){return o.update(e)},provide:o=>[showTooltip.from(o,e=>e.tooltip),EditorView.contentAttributes.from(o,e=>e.attrs)]});function applyCompletion(o,e){const s=e.completion.apply||e.completion.label;let l=o.state.field(completionState).active.find(a=>a.source==e.source);return l instanceof ActiveResult?(typeof s=="string"?o.dispatch(Object.assign(Object.assign({},insertCompletionText(o.state,s,l.from,l.to)),{annotations:pickedCompletion.of(e.completion)})):s(o,e.completion,l.from,l.to),!0):!1}function moveCompletionSelection(o,e="option"){return s=>{let l=s.state.field(completionState,!1);if(!l||!l.open||l.open.disabled||Date.now()-l.open.timestamp<s.state.facet(completionConfig).interactionDelay)return!1;let a=1,h;e=="page"&&(h=getTooltip(s,l.open.tooltip))&&(a=Math.max(2,Math.floor(h.dom.offsetHeight/h.dom.querySelector("li").offsetHeight)-1));let{length:f}=l.open.options,u=l.open.selected>-1?l.open.selected+a*(o?1:-1):o?0:f-1;return u<0?u=e=="page"?0:f-1:u>=f&&(u=e=="page"?f-1:0),s.dispatch({effects:setSelectedEffect.of(u)}),!0}}const acceptCompletion=o=>{let e=o.state.field(completionState,!1);return o.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<o.state.facet(completionConfig).interactionDelay?!1:applyCompletion(o,e.open.options[e.open.selected])},startCompletion=o=>o.state.field(completionState,!1)?(o.dispatch({effects:startCompletionEffect.of(!0)}),!0):!1,closeCompletion=o=>{let e=o.state.field(completionState,!1);return!e||!e.active.some(s=>s.state!=0)?!1:(o.dispatch({effects:closeCompletionEffect.of(null)}),!0)};class RunningQuery{constructor(e,s){this.active=e,this.context=s,this.time=Date.now(),this.updates=[],this.done=void 0}}const DebounceTime=50,MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of o.state.field(completionState).active)e.state==1&&this.startQuery(e)}update(o){let e=o.state.field(completionState);if(!o.selectionSet&&!o.docChanged&&o.startState.field(completionState)==e)return;let s=o.transactions.some(l=>(l.selection||l.docChanged)&&!getUserEvent(l));for(let l=0;l<this.running.length;l++){let a=this.running[l];if(s||a.updates.length+o.transactions.length>MaxUpdateCount&&Date.now()-a.time>MinAbortTime){for(let h of a.context.abortListeners)try{h()}catch(f){logException(this.view.state,f)}a.context.abortListeners=null,this.running.splice(l--,1)}else a.updates.push(...o.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(l=>l.state==1&&!this.running.some(a=>a.active.source==l.source))?setTimeout(()=>this.startUpdate(),DebounceTime):-1,this.composing!=0)for(let l of o.transactions)getUserEvent(l)=="input"?this.composing=2:this.composing==2&&l.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:o}=this.view,e=o.field(completionState);for(let s of e.active)s.state==1&&!this.running.some(l=>l.active.source==s.source)&&this.startQuery(s)}startQuery(o){let{state:e}=this.view,s=cur(e),l=new CompletionContext(e,s,o.explicitPos==s),a=new RunningQuery(o,l);this.running.push(a),Promise.resolve(o.source(l)).then(h=>{a.context.aborted||(a.done=h||null,this.scheduleAccept())},h=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,h)})}scheduleAccept(){this.running.every(o=>o.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),DebounceTime))}accept(){var o;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],s=this.view.state.facet(completionConfig);for(let l=0;l<this.running.length;l++){let a=this.running[l];if(a.done===void 0)continue;if(this.running.splice(l--,1),a.done){let f=new ActiveResult(a.active.source,a.active.explicitPos,a.done,a.done.from,(o=a.done.to)!==null&&o!==void 0?o:cur(a.updates.length?a.updates[0].startState:this.view.state));for(let u of a.updates)f=f.update(u,s);if(f.hasResult()){e.push(f);continue}}let h=this.view.state.field(completionState).active.find(f=>f.source==a.active.source);if(h&&h.state==1)if(a.done==null){let f=new ActiveSource(a.active.source,0);for(let u of a.updates)f=f.update(u,s);f.state!=1&&e.push(f)}else this.startQuery(h)}e.length&&this.view.dispatch({effects:setActiveEffect.of(e)})}},{eventHandlers:{blur(o){let e=this.view.state.field(completionState,!1);if(e&&e.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let s=e.open&&getTooltip(this.view,e.open.tooltip);(!s||!s.dom.contains(o.relatedTarget))&&this.view.dispatch({effects:closeCompletionEffect.of(null)})}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:startCompletionEffect.of(!1)}),20),this.composing=0}}}),baseTheme$1=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"Â·Â·Â·"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'Æ’'"}},".cm-completionIcon-class":{"&:after":{content:"'â—‹'"}},".cm-completionIcon-interface":{"&:after":{content:"'â—Œ'"}},".cm-completionIcon-variable":{"&:after":{content:"'ð‘¥'"}},".cm-completionIcon-constant":{"&:after":{content:"'ð¶'"}},".cm-completionIcon-type":{"&:after":{content:"'ð‘¡'"}},".cm-completionIcon-enum":{"&:after":{content:"'âˆª'"}},".cm-completionIcon-property":{"&:after":{content:"'â–¡'"}},".cm-completionIcon-keyword":{"&:after":{content:"'ðŸ”‘ï¸Ž'"}},".cm-completionIcon-namespace":{"&:after":{content:"'â–¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(o,e){let s=e.mapPos(o,-1,MapMode.TrackAfter);return s??void 0}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1;closedBracket.endSide=-1;const bracketState=StateField.define({create(){return RangeSet.empty},update(o,e){if(e.selection){let s=e.state.doc.lineAt(e.selection.main.head).from,l=e.startState.doc.lineAt(e.startState.selection.main.head).from;s!=e.changes.mapPos(l,-1)&&(o=RangeSet.empty)}o=o.map(e.changes);for(let s of e.effects)s.is(closeBracketEffect)&&(o=o.update({add:[closedBracket.range(s.value,s.value+1)]}));return o}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>";function closing(o){for(let e=0;e<definedClosing.length;e+=2)if(definedClosing.charCodeAt(e)==o)return definedClosing.charAt(e+1);return fromCodePoint(o<128?o:o+1)}function config(o,e){return o.languageDataAt("closeBrackets",e)[0]||defaults}const android=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of((o,e,s,l)=>{if((android?o.composing:o.compositionStarted)||o.state.readOnly)return!1;let a=o.state.selection.main;if(l.length>2||l.length==2&&codePointSize(codePointAt(l,0))==1||e!=a.from||s!=a.to)return!1;let h=insertBracket(o.state,l);return h?(o.dispatch(h),!0):!1}),deleteBracketPair=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let l=config(o,o.selection.main.head).brackets||defaults.brackets,a=null,h=o.changeByRange(f=>{if(f.empty){let u=prevChar(o.doc,f.head);for(let p of l)if(p==u&&nextChar(o.doc,f.head)==closing(codePointAt(p,0)))return{changes:{from:f.head-p.length,to:f.head+p.length},range:EditorSelection.cursor(f.head-p.length)}}return{range:a=f}});return a||e(o.update(h,{scrollIntoView:!0,userEvent:"delete.backward"})),!a},closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(o,e){let s=config(o,o.selection.main.head),l=s.brackets||defaults.brackets;for(let a of l){let h=closing(codePointAt(a,0));if(e==a)return h==a?handleSame(o,a,l.indexOf(a+a+a)>-1,s):handleOpen(o,a,h,s.before||defaults.before);if(e==h&&closedBracketAt(o,o.selection.main.from))return handleClose(o,a,h)}return null}function closedBracketAt(o,e){let s=!1;return o.field(bracketState).between(0,o.doc.length,l=>{l==e&&(s=!0)}),s}function nextChar(o,e){let s=o.sliceString(e,e+2);return s.slice(0,codePointSize(codePointAt(s,0)))}function prevChar(o,e){let s=o.sliceString(e-2,e);return codePointSize(codePointAt(s,0))==s.length?s:s.slice(1)}function handleOpen(o,e,s,l){let a=null,h=o.changeByRange(f=>{if(!f.empty)return{changes:[{insert:e,from:f.from},{insert:s,from:f.to}],effects:closeBracketEffect.of(f.to+e.length),range:EditorSelection.range(f.anchor+e.length,f.head+e.length)};let u=nextChar(o.doc,f.head);return!u||/\s/.test(u)||l.indexOf(u)>-1?{changes:{insert:e+s,from:f.head},effects:closeBracketEffect.of(f.head+e.length),range:EditorSelection.cursor(f.head+e.length)}:{range:a=f}});return a?null:o.update(h,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(o,e,s){let l=null,a=o.changeByRange(h=>h.empty&&nextChar(o.doc,h.head)==s?{changes:{from:h.head,to:h.head+s.length,insert:s},range:EditorSelection.cursor(h.head+s.length)}:l={range:h});return l?null:o.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(o,e,s,l){let a=l.stringPrefixes||defaults.stringPrefixes,h=null,f=o.changeByRange(u=>{if(!u.empty)return{changes:[{insert:e,from:u.from},{insert:e,from:u.to}],effects:closeBracketEffect.of(u.to+e.length),range:EditorSelection.range(u.anchor+e.length,u.head+e.length)};let p=u.head,m=nextChar(o.doc,p),g;if(m==e){if(nodeStart(o,p))return{changes:{insert:e+e,from:p},effects:closeBracketEffect.of(p+e.length),range:EditorSelection.cursor(p+e.length)};if(closedBracketAt(o,p)){let w=s&&o.sliceDoc(p,p+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:p,to:p+w.length,insert:w},range:EditorSelection.cursor(p+w.length)}}}else{if(s&&o.sliceDoc(p-2*e.length,p)==e+e&&(g=canStartStringAt(o,p-2*e.length,a))>-1&&nodeStart(o,g))return{changes:{insert:e+e+e+e,from:p},effects:closeBracketEffect.of(p+e.length),range:EditorSelection.cursor(p+e.length)};if(o.charCategorizer(p)(m)!=CharCategory.Word&&canStartStringAt(o,p,a)>-1&&!probablyInString(o,p,e,a))return{changes:{insert:e+e,from:p},effects:closeBracketEffect.of(p+e.length),range:EditorSelection.cursor(p+e.length)}}return{range:h=u}});return h?null:o.update(f,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(o,e){let s=syntaxTree(o).resolveInner(e+1);return s.parent&&s.from==e}function probablyInString(o,e,s,l){let a=syntaxTree(o).resolveInner(e,-1),h=l.reduce((f,u)=>Math.max(f,u.length),0);for(let f=0;f<5;f++){let u=o.sliceDoc(a.from,Math.min(a.to,a.from+s.length+h)),p=u.indexOf(s);if(!p||p>-1&&l.indexOf(u.slice(0,p))>-1){let g=a.firstChild;for(;g&&g.from==a.from&&g.to-g.from>s.length+p;){if(o.sliceDoc(g.to-s.length,g.to)==s)return!1;g=g.firstChild}return!0}let m=a.to==e&&a.parent;if(!m)break;a=m}return!1}function canStartStringAt(o,e,s){let l=o.charCategorizer(e);if(l(o.sliceDoc(e-1,e))!=CharCategory.Word)return e;for(let a of s){let h=e-a.length;if(o.sliceDoc(h,e)==a&&l(o.sliceDoc(h-1,h))!=CharCategory.Word)return h}return-1}function autocompletion(o={}){return[completionState,completionConfig.of(o),completionPlugin,completionKeymapExt,baseTheme$1]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],o=>o.facet(completionConfig).defaultKeymap?[completionKeymap]:[]));class SelectedDiagnostic{constructor(e,s,l){this.from=e,this.to=s,this.diagnostic=l}}class LintState{constructor(e,s,l){this.diagnostics=e,this.panel=s,this.selected=l}static init(e,s,l){let a=e,h=l.facet(lintConfig).markerFilter;h&&(a=h(a));let f=Decoration.set(a.map(u=>u.from==u.to||u.from==u.to-1&&l.doc.lineAt(u.from).to==u.from?Decoration.widget({widget:new DiagnosticWidget(u),diagnostic:u}).range(u.from):Decoration.mark({attributes:{class:"cm-lintRange cm-lintRange-"+u.severity+(u.markClass?" "+u.markClass:"")},diagnostic:u}).range(u.from,u.to)),!0);return new LintState(f,s,findDiagnostic(f))}}function findDiagnostic(o,e=null,s=0){let l=null;return o.between(s,1e9,(a,h,{spec:f})=>{if(!(e&&f.diagnostic!=e))return l=new SelectedDiagnostic(a,h,f.diagnostic),!1}),l}function hideTooltip(o,e){let s=o.startState.doc.lineAt(e.pos);return!!(o.effects.some(l=>l.is(setDiagnosticsEffect))||o.changes.touchesRange(s.from,s.to))}function maybeEnableLint(o,e){return o.field(lintState,!1)?e:e.concat(StateEffect.appendConfig.of(lintExtensions))}const setDiagnosticsEffect=StateEffect.define(),togglePanel=StateEffect.define(),movePanelSelection=StateEffect.define(),lintState=StateField.define({create(){return new LintState(Decoration.none,null,null)},update(o,e){if(e.docChanged){let s=o.diagnostics.map(e.changes),l=null;if(o.selected){let a=e.changes.mapPos(o.selected.from,1);l=findDiagnostic(s,o.selected.diagnostic,a)||findDiagnostic(s,null,a)}o=new LintState(s,o.panel,l)}for(let s of e.effects)s.is(setDiagnosticsEffect)?o=LintState.init(s.value,o.panel,e.state):s.is(togglePanel)?o=new LintState(o.diagnostics,s.value?LintPanel.open:null,o.selected):s.is(movePanelSelection)&&(o=new LintState(o.diagnostics,o.panel,s.value));return o},provide:o=>[showPanel.from(o,e=>e.panel),EditorView.decorations.from(o,e=>e.diagnostics)]}),activeMark=Decoration.mark({class:"cm-lintRange cm-lintRange-active"});function lintTooltip(o,e,s){let{diagnostics:l}=o.state.field(lintState),a=[],h=2e8,f=0;l.between(e-(s<0?1:0),e+(s>0?1:0),(p,m,{spec:g})=>{e>=p&&e<=m&&(p==m||(e>p||s>0)&&(e<m||s<0))&&(a.push(g.diagnostic),h=Math.min(p,h),f=Math.max(m,f))});let u=o.state.facet(lintConfig).tooltipFilter;return u&&(a=u(a)),a.length?{pos:h,end:f,above:o.state.doc.lineAt(h).to<f,create(){return{dom:diagnosticsTooltip(o,a)}}}:null}function diagnosticsTooltip(o,e){return crelt("ul",{class:"cm-tooltip-lint"},e.map(s=>renderDiagnostic(o,s,!1)))}const openLintPanel=o=>{let e=o.state.field(lintState,!1);(!e||!e.panel)&&o.dispatch({effects:maybeEnableLint(o.state,[togglePanel.of(!0)])});let s=getPanel(o,LintPanel.open);return s&&s.dom.querySelector(".cm-panel-lint ul").focus(),!0},closeLintPanel=o=>{let e=o.state.field(lintState,!1);return!e||!e.panel?!1:(o.dispatch({effects:togglePanel.of(!1)}),!0)},nextDiagnostic=o=>{let e=o.state.field(lintState,!1);if(!e)return!1;let s=o.state.selection.main,l=e.diagnostics.iter(s.to+1);return!l.value&&(l=e.diagnostics.iter(0),!l.value||l.from==s.from&&l.to==s.to)?!1:(o.dispatch({selection:{anchor:l.from,head:l.to},scrollIntoView:!0}),!0)},lintKeymap=[{key:"Mod-Shift-m",run:openLintPanel,preventDefault:!0},{key:"F8",run:nextDiagnostic}],lintConfig=Facet.define({combine(o){return Object.assign({sources:o.map(e=>e.source)},combineConfig(o.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,s)=>e?s?l=>e(l)||s(l):e:s}))}});function assignKeys(o){let e=[];if(o)e:for(let{name:s}of o){for(let l=0;l<s.length;l++){let a=s[l];if(/[a-zA-Z]/.test(a)&&!e.some(h=>h.toLowerCase()==a.toLowerCase())){e.push(a);continue e}}e.push("")}return e}function renderDiagnostic(o,e,s){var l;let a=s?assignKeys(e.actions):[];return crelt("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},crelt("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(l=e.actions)===null||l===void 0?void 0:l.map((h,f)=>{let u=!1,p=w=>{if(w.preventDefault(),u)return;u=!0;let x=findDiagnostic(o.state.field(lintState).diagnostics,e);x&&h.apply(o,x.from,x.to)},{name:m}=h,g=a[f]?m.indexOf(a[f]):-1,y=g<0?m:[m.slice(0,g),crelt("u",m.slice(g,g+1)),m.slice(g+1)];return crelt("button",{type:"button",class:"cm-diagnosticAction",onclick:p,onmousedown:p,"aria-label":` Action: ${m}${g<0?"":` (access key "${a[f]})"`}.`},y)}),e.source&&crelt("div",{class:"cm-diagnosticSource"},e.source))}class DiagnosticWidget extends WidgetType{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return crelt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class PanelItem{constructor(e,s){this.diagnostic=s,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=renderDiagnostic(e,s,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class LintPanel{constructor(e){this.view=e,this.items=[];let s=a=>{if(a.keyCode==27)closeLintPanel(this.view),this.view.focus();else if(a.keyCode==38||a.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(a.keyCode==40||a.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(a.keyCode==36)this.moveSelection(0);else if(a.keyCode==35)this.moveSelection(this.items.length-1);else if(a.keyCode==13)this.view.focus();else if(a.keyCode>=65&&a.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:h}=this.items[this.selectedIndex],f=assignKeys(h.actions);for(let u=0;u<f.length;u++)if(f[u].toUpperCase().charCodeAt(0)==a.keyCode){let p=findDiagnostic(this.view.state.field(lintState).diagnostics,h);p&&h.actions[u].apply(e,p.from,p.to)}}else return;a.preventDefault()},l=a=>{for(let h=0;h<this.items.length;h++)this.items[h].dom.contains(a.target)&&this.moveSelection(h)};this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:s,onclick:l}),this.dom=crelt("div",{class:"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>closeLintPanel(this.view)},"Ã—")),this.update()}get selectedIndex(){let e=this.view.state.field(lintState).selected;if(!e)return-1;for(let s=0;s<this.items.length;s++)if(this.items[s].diagnostic==e.diagnostic)return s;return-1}update(){let{diagnostics:e,selected:s}=this.view.state.field(lintState),l=0,a=!1,h=null;for(e.between(0,this.view.state.doc.length,(f,u,{spec:p})=>{let m=-1,g;for(let y=l;y<this.items.length;y++)if(this.items[y].diagnostic==p.diagnostic){m=y;break}m<0?(g=new PanelItem(this.view,p.diagnostic),this.items.splice(l,0,g),a=!0):(g=this.items[m],m>l&&(this.items.splice(l,m-l),a=!0)),s&&g.diagnostic==s.diagnostic?g.dom.hasAttribute("aria-selected")||(g.dom.setAttribute("aria-selected","true"),h=g):g.dom.hasAttribute("aria-selected")&&g.dom.removeAttribute("aria-selected"),l++});l<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)a=!0,this.items.pop();this.items.length==0&&(this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),a=!0),h?(this.list.setAttribute("aria-activedescendant",h.id),this.view.requestMeasure({key:this,read:()=>({sel:h.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:f,panel:u})=>{f.top<u.top?this.list.scrollTop-=u.top-f.top:f.bottom>u.bottom&&(this.list.scrollTop+=f.bottom-u.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),a&&this.sync()}sync(){let e=this.list.firstChild;function s(){let l=e;e=l.nextSibling,l.remove()}for(let l of this.items)if(l.dom.parentNode==this.list){for(;e!=l.dom;)s();e=l.dom.nextSibling}else this.list.insertBefore(l.dom,e);for(;e;)s()}moveSelection(e){if(this.selectedIndex<0)return;let s=this.view.state.field(lintState),l=findDiagnostic(s.diagnostics,this.items[e].diagnostic);l&&this.view.dispatch({selection:{anchor:l.from,head:l.to},scrollIntoView:!0,effects:movePanelSelection.of(l)})}static open(e){return new LintPanel(e)}}function svg(o,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(o)}</svg>')`}function underline(o){return svg(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${o}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const baseTheme=EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:underline("#d11")},".cm-lintRange-warning":{backgroundImage:underline("orange")},".cm-lintRange-info":{backgroundImage:underline("#999")},".cm-lintRange-hint":{backgroundImage:underline("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),lintExtensions=[lintState,EditorView.decorations.compute([lintState],o=>{let{selected:e,panel:s}=o.field(lintState);return!e||!s||e.from==e.to?Decoration.none:Decoration.set([activeMark.range(e.from,e.to)])}),hoverTooltip(lintTooltip,{hideOn:hideTooltip}),baseTheme],basicSetup=(()=>[lineNumbers(),highlightActiveLineGutter(),highlightSpecialChars(),history(),foldGutter(),drawSelection(),dropCursor(),EditorState.allowMultipleSelections.of(!0),indentOnInput(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0}),bracketMatching(),closeBrackets(),autocompletion(),rectangularSelection(),crosshairCursor(),highlightActiveLine(),highlightSelectionMatches(),keymap.of([...closeBracketsKeymap,...defaultKeymap,...searchKeymap,...historyKeymap,...foldKeymap,...completionKeymap,...lintKeymap])])();class Stack{constructor(e,s,l,a,h,f,u,p,m,g=0,y){this.p=e,this.stack=s,this.state=l,this.reducePos=a,this.pos=h,this.score=f,this.buffer=u,this.bufferBase=p,this.curContext=m,this.lookAhead=g,this.parent=y}toString(){return`[${this.stack.filter((e,s)=>s%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,s,l=0){let a=e.parser.context;return new Stack(e,[],s,l,l,0,[],0,a?new StackContext(a,a.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,s){this.stack.push(this.state,s,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var s;let l=e>>19,a=e&65535,{parser:h}=this.p,f=h.dynamicPrecedence(a);if(f&&(this.score+=f),l==0){this.pushState(h.getGoto(this.state,a,!0),this.reducePos),a<h.minRepeatTerm&&this.storeNode(a,this.reducePos,this.reducePos,4,!0),this.reduceContext(a,this.reducePos);return}let u=this.stack.length-(l-1)*3-(e&262144?6:0),p=u?this.stack[u-2]:this.p.ranges[0].from,m=this.reducePos-p;m>=2e3&&!(!((s=this.p.parser.nodeSet.types[a])===null||s===void 0)&&s.isAnonymous)&&(p==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=m):this.p.lastBigReductionSize<m&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=p,this.p.lastBigReductionSize=m));let g=u?this.stack[u-1]:0,y=this.bufferBase+this.buffer.length-g;if(a<h.minRepeatTerm||e&131072){let w=h.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(a,p,w,y+4,!0)}if(e&262144)this.state=this.stack[u];else{let w=this.stack[u-3];this.state=h.getGoto(w,a,!0)}for(;this.stack.length>u;)this.stack.pop();this.reduceContext(a,p)}storeNode(e,s,l,a=4,h=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let f=this,u=this.buffer.length;if(u==0&&f.parent&&(u=f.bufferBase-f.parent.bufferBase,f=f.parent),u>0&&f.buffer[u-4]==0&&f.buffer[u-1]>-1){if(s==l)return;if(f.buffer[u-2]>=s){f.buffer[u-2]=l;return}}}if(!h||this.pos==l)this.buffer.push(e,s,l,a);else{let f=this.buffer.length;if(f>0&&this.buffer[f-4]!=0)for(;f>0&&this.buffer[f-2]>l;)this.buffer[f]=this.buffer[f-4],this.buffer[f+1]=this.buffer[f-3],this.buffer[f+2]=this.buffer[f-2],this.buffer[f+3]=this.buffer[f-1],f-=4,a>4&&(a-=4);this.buffer[f]=e,this.buffer[f+1]=s,this.buffer[f+2]=l,this.buffer[f+3]=a}}shift(e,s,l){let a=this.pos;if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=l,this.shiftContext(s,a),s<=this.p.parser.maxNode&&this.buffer.push(s,a,l,4);else{let h=e,{parser:f}=this.p;(l>this.pos||s<=f.maxNode)&&(this.pos=l,f.stateFlag(h,1)||(this.reducePos=l)),this.pushState(h,a),this.shiftContext(s,a),s<=f.maxNode&&this.buffer.push(s,a,l,4)}}apply(e,s,l){e&65536?this.reduce(e):this.shift(e,s,l)}useNode(e,s){let l=this.p.reused.length-1;(l<0||this.p.reused[l]!=e)&&(this.p.reused.push(e),l++);let a=this.pos;this.reducePos=this.pos=a+e.length,this.pushState(s,a),this.buffer.push(l,a,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,s=e.buffer.length;for(;s>0&&e.buffer[s-2]>e.reducePos;)s-=4;let l=e.buffer.slice(s),a=e.bufferBase+s;for(;e&&a==e.bufferBase;)e=e.parent;return new Stack(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,l,a,this.curContext,this.lookAhead,e)}recoverByDelete(e,s){let l=e<=this.p.parser.maxNode;l&&this.storeNode(e,this.pos,s,4),this.storeNode(0,this.pos,s,l?8:4),this.pos=this.reducePos=s,this.score-=190}canShift(e){for(let s=new SimulatedStack(this);;){let l=this.p.parser.stateSlot(s.state,4)||this.p.parser.hasAction(s.state,e);if(l==0)return!1;if(!(l&65536))return!0;s.reduce(l)}}recoverByInsert(e){if(this.stack.length>=300)return[];let s=this.p.parser.nextStates(this.state);if(s.length>8||this.stack.length>=120){let a=[];for(let h=0,f;h<s.length;h+=2)(f=s[h+1])!=this.state&&this.p.parser.hasAction(f,e)&&a.push(s[h],f);if(this.stack.length<120)for(let h=0;a.length<8&&h<s.length;h+=2){let f=s[h+1];a.some((u,p)=>p&1&&u==f)||a.push(s[h],f)}s=a}let l=[];for(let a=0;a<s.length&&l.length<4;a+=2){let h=s[a+1];if(h==this.state)continue;let f=this.split();f.pushState(h,this.pos),f.storeNode(0,f.pos,f.pos,4,!0),f.shiftContext(s[a],this.pos),f.score-=200,l.push(f)}return l}forceReduce(){let{parser:e}=this.p,s=e.stateSlot(this.state,5);if(!(s&65536))return!1;if(!e.validAction(this.state,s)){let l=s>>19,a=s&65535,h=this.stack.length-l*3;if(h<0||e.getGoto(this.stack[h],a,!1)<0){let f=this.findForcedReduction();if(f==null)return!1;s=f}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(s),!0}findForcedReduction(){let{parser:e}=this.p,s=[],l=(a,h)=>{if(!s.includes(a))return s.push(a),e.allActions(a,f=>{if(!(f&393216))if(f&65536){let u=(f>>19)-h;if(u>1){let p=f&65535,m=this.stack.length-u*3;if(m>=0&&e.getGoto(this.stack[m],p,!1)>=0)return u<<19|65536|p}}else{let u=l(f,h+1);if(u!=null)return u}})};return l(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let s=0;s<this.stack.length;s+=3)if(this.stack[s]!=e.stack[s])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,s){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(s)))}reduceContext(e,s){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(s)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let s=new StackContext(this.curContext.tracker,e);s.hash!=this.curContext.hash&&this.emitContext(),this.curContext=s}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class StackContext{constructor(e,s){this.tracker=e,this.context=s,this.hash=e.strict?e.hash(s):0}}class SimulatedStack{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let s=e&65535,l=e>>19;l==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(l-1)*3;let a=this.start.p.parser.getGoto(this.stack[this.base-3],s,!0);this.state=a}}class StackBufferCursor{constructor(e,s,l){this.stack=e,this.pos=s,this.index=l,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,s=e.bufferBase+e.buffer.length){return new StackBufferCursor(e,s,s-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}function decodeArray(o,e=Uint16Array){if(typeof o!="string")return o;let s=null;for(let l=0,a=0;l<o.length;){let h=0;for(;;){let f=o.charCodeAt(l++),u=!1;if(f==126){h=65535;break}f>=92&&f--,f>=34&&f--;let p=f-32;if(p>=46&&(p-=46,u=!0),h+=p,u)break;h*=46}s?s[a++]=h:s=new e(h)}return s}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(e,s){this.input=e,this.ranges=s,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=s[0].from,this.range=s[0],this.end=s[s.length-1].to,this.readNext()}resolveOffset(e,s){let l=this.range,a=this.rangeIndex,h=this.pos+e;for(;h<l.from;){if(!a)return null;let f=this.ranges[--a];h-=l.from-f.to,l=f}for(;s<0?h>l.to:h>=l.to;){if(a==this.ranges.length-1)return null;let f=this.ranges[++a];h+=f.from-l.to,l=f}return h}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let s of this.ranges)if(s.to>e)return Math.max(e,s.from);return this.end}peek(e){let s=this.chunkOff+e,l,a;if(s>=0&&s<this.chunk.length)l=this.pos+e,a=this.chunk.charCodeAt(s);else{let h=this.resolveOffset(e,1);if(h==null)return-1;if(l=h,l>=this.chunk2Pos&&l<this.chunk2Pos+this.chunk2.length)a=this.chunk2.charCodeAt(l-this.chunk2Pos);else{let f=this.rangeIndex,u=this.range;for(;u.to<=l;)u=this.ranges[++f];this.chunk2=this.input.chunk(this.chunk2Pos=l),l+this.chunk2.length>u.to&&(this.chunk2=this.chunk2.slice(0,u.to-l)),a=this.chunk2.charCodeAt(0)}}return l>=this.token.lookAhead&&(this.token.lookAhead=l+1),a}acceptToken(e,s=0){let l=s?this.resolveOffset(s,-1):this.pos;if(l==null||l<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=l}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:s}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=s,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),s=this.pos+e.length;this.chunk=s>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,s){if(s?(this.token=s,s.start=e,s.lookAhead=e+1,s.value=s.extended=-1):this.token=nullToken,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,s){if(e>=this.chunkPos&&s<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,s-this.chunkPos);if(e>=this.chunk2Pos&&s<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,s-this.chunk2Pos);if(e>=this.range.from&&s<=this.range.to)return this.input.read(e,s);let l="";for(let a of this.ranges){if(a.from>=s)break;a.to>e&&(l+=this.input.read(Math.max(a.from,e),Math.min(a.to,s)))}return l}}class TokenGroup{constructor(e,s){this.data=e,this.id=s}token(e,s){let{parser:l}=s.p;readToken(this.data,e,s,this.id,l.data,l.tokenPrecTable)}}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;function readToken(o,e,s,l,a,h){let f=0,u=1<<l,{dialect:p}=s.p.parser;e:for(;u&o[f];){let m=o[f+1];for(let x=f+3;x<m;x+=2)if((o[x+1]&u)>0){let b=o[x];if(p.allows(b)&&(e.token.value==-1||e.token.value==b||overrides(b,e.token.value,a,h))){e.acceptToken(b);break}}let g=e.next,y=0,w=o[f+2];if(e.next<0&&w>y&&o[m+w*3-3]==65535&&o[m+w*3-3]==65535){f=o[m+w*3-1];continue e}for(;y<w;){let x=y+w>>1,b=m+x+(x<<1),k=o[b],S=o[b+1]||65536;if(g<k)w=x;else if(g>=S)y=x+1;else{f=o[b+2],e.advance();continue e}}break}}function findOffset(o,e,s){for(let l=e,a;(a=o[l])!=65535;l++)if(a==s)return l-e;return-1}function overrides(o,e,s,l){let a=findOffset(s,l,e);return a<0||findOffset(s,l,o)<a}const verbose=typeof process<"u"&&process.env&&/\bparse\b/.test({}.LOG);let stackIDs=null;function cutAt(o,e,s){let l=o.cursor(IterMode.IncludeAnonymous);for(l.moveTo(e);;)if(!(s<0?l.childBefore(e):l.childAfter(e)))for(;;){if((s<0?l.to<e:l.from>e)&&!l.type.isError)return s<0?Math.max(0,Math.min(l.to-1,e-25)):Math.min(o.length,Math.max(l.from+1,e+25));if(s<0?l.prevSibling():l.nextSibling())break;if(!l.parent())return s<0?0:o.length}}class FragmentCursor{constructor(e,s){this.fragments=e,this.nodeSet=s,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?cutAt(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?cutAt(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let s=this.trees.length-1;if(s<0)return this.nextFragment(),null;let l=this.trees[s],a=this.index[s];if(a==l.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let h=l.children[a],f=this.start[s]+l.positions[a];if(f>e)return this.nextStart=f,null;if(h instanceof Tree){if(f==e){if(f<this.safeFrom)return null;let u=f+h.length;if(u<=this.safeTo){let p=h.prop(NodeProp.lookAhead);if(!p||u+p<this.fragment.to)return h}}this.index[s]++,f+h.length>=Math.max(this.safeFrom,e)&&(this.trees.push(h),this.start.push(f),this.index.push(0))}else this.index[s]++,this.nextStart=f+h.length}}}class TokenCache{constructor(e,s){this.stream=s,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(l=>new CachedToken)}getActions(e){let s=0,l=null,{parser:a}=e.p,{tokenizers:h}=a,f=a.stateSlot(e.state,3),u=e.curContext?e.curContext.hash:0,p=0;for(let m=0;m<h.length;m++){if(!(1<<m&f))continue;let g=h[m],y=this.tokens[m];if(!(l&&!g.fallback)&&((g.contextual||y.start!=e.pos||y.mask!=f||y.context!=u)&&(this.updateCachedToken(y,g,e),y.mask=f,y.context=u),y.lookAhead>y.end+25&&(p=Math.max(y.lookAhead,p)),y.value!=0)){let w=s;if(y.extended>-1&&(s=this.addActions(e,y.extended,y.end,s)),s=this.addActions(e,y.value,y.end,s),!g.extend&&(l=y,s>w))break}}for(;this.actions.length>s;)this.actions.pop();return p&&e.setLookAhead(p),!l&&e.pos==this.stream.end&&(l=new CachedToken,l.value=e.p.parser.eofTerm,l.start=l.end=e.pos,s=this.addActions(e,l.value,l.end,s)),this.mainToken=l,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let s=new CachedToken,{pos:l,p:a}=e;return s.start=l,s.end=Math.min(l+1,a.stream.end),s.value=l==a.stream.end?a.parser.eofTerm:0,s}updateCachedToken(e,s,l){let a=this.stream.clipPos(l.pos);if(s.token(this.stream.reset(a,e),l),e.value>-1){let{parser:h}=l.p;for(let f=0;f<h.specialized.length;f++)if(h.specialized[f]==e.value){let u=h.specializers[f](this.stream.read(e.start,e.end),l);if(u>=0&&l.p.parser.dialect.allows(u>>1)){u&1?e.extended=u>>1:e.value=u>>1;break}}}else e.value=0,e.end=this.stream.clipPos(a+1)}putAction(e,s,l,a){for(let h=0;h<a;h+=3)if(this.actions[h]==e)return a;return this.actions[a++]=e,this.actions[a++]=s,this.actions[a++]=l,a}addActions(e,s,l,a){let{state:h}=e,{parser:f}=e.p,{data:u}=f;for(let p=0;p<2;p++)for(let m=f.stateSlot(h,p?2:1);;m+=3){if(u[m]==65535)if(u[m+1]==1)m=pair(u,m+2);else{a==0&&u[m+1]==2&&(a=this.putAction(pair(u,m+2),s,l,a));break}u[m]==s&&(a=this.putAction(pair(u,m+1),s,l,a))}return a}}class Parse{constructor(e,s,l,a){this.parser=e,this.input=s,this.ranges=a,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new InputStream(s,a),this.tokens=new TokenCache(e,this.stream),this.topTerm=e.top[1];let{from:h}=a[0];this.stacks=[Stack.start(this,e.top[0],h)],this.fragments=l.length&&this.stream.end-h>e.bufferLength*4?new FragmentCursor(l,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,s=this.minStackPos,l=this.stacks=[],a,h;if(this.bigReductionCount>300&&e.length==1){let[f]=e;for(;f.forceReduce()&&f.stack.length&&f.stack[f.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let f=0;f<e.length;f++){let u=e[f];for(;;){if(this.tokens.mainToken=null,u.pos>s)l.push(u);else{if(this.advanceStack(u,l,e))continue;{a||(a=[],h=[]),a.push(u);let p=this.tokens.getMainToken(u);h.push(p.value,p.end)}}break}}if(!l.length){let f=a&&findFinished(a);if(f)return verbose&&console.log("Finish with "+this.stackID(f)),this.stackToTree(f);if(this.parser.strict)throw verbose&&a&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+s);this.recovering||(this.recovering=5)}if(this.recovering&&a){let f=this.stoppedAt!=null&&a[0].pos>this.stoppedAt?a[0]:this.runRecovery(a,h,l);if(f)return verbose&&console.log("Force-finish "+this.stackID(f)),this.stackToTree(f.forceAll())}if(this.recovering){let f=this.recovering==1?1:this.recovering*3;if(l.length>f)for(l.sort((u,p)=>p.score-u.score);l.length>f;)l.pop();l.some(u=>u.reducePos>s)&&this.recovering--}else if(l.length>1){e:for(let f=0;f<l.length-1;f++){let u=l[f];for(let p=f+1;p<l.length;p++){let m=l[p];if(u.sameState(m)||u.buffer.length>500&&m.buffer.length>500)if((u.score-m.score||u.buffer.length-m.buffer.length)>0)l.splice(p--,1);else{l.splice(f--,1);continue e}}}l.length>12&&l.splice(12,l.length-12)}this.minStackPos=l[0].pos;for(let f=1;f<l.length;f++)l[f].pos<this.minStackPos&&(this.minStackPos=l[f].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,s,l){let a=e.pos,{parser:h}=this,f=verbose?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&a>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let m=e.curContext&&e.curContext.tracker.strict,g=m?e.curContext.hash:0;for(let y=this.fragments.nodeAt(a);y;){let w=this.parser.nodeSet.types[y.type.id]==y.type?h.getGoto(e.state,y.type.id):-1;if(w>-1&&y.length&&(!m||(y.prop(NodeProp.contextHash)||0)==g))return e.useNode(y,w),verbose&&console.log(f+this.stackID(e)+` (via reuse of ${h.getName(y.type.id)})`),!0;if(!(y instanceof Tree)||y.children.length==0||y.positions[0]>0)break;let x=y.children[0];if(x instanceof Tree&&y.positions[0]==0)y=x;else break}}let u=h.stateSlot(e.state,4);if(u>0)return e.reduce(u),verbose&&console.log(f+this.stackID(e)+` (via always-reduce ${h.getName(u&65535)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let p=this.tokens.getActions(e);for(let m=0;m<p.length;){let g=p[m++],y=p[m++],w=p[m++],x=m==p.length||!l,b=x?e:e.split();if(b.apply(g,y,w),verbose&&console.log(f+this.stackID(b)+` (via ${g&65536?`reduce of ${h.getName(g&65535)}`:"shift"} for ${h.getName(y)} @ ${a}${b==e?"":", split"})`),x)return!0;b.pos>a?s.push(b):l.push(b)}return!1}advanceFully(e,s){let l=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>l)return pushStackDedup(e,s),!0}}runRecovery(e,s,l){let a=null,h=!1;for(let f=0;f<e.length;f++){let u=e[f],p=s[f<<1],m=s[(f<<1)+1],g=verbose?this.stackID(u)+" -> ":"";if(u.deadEnd&&(h||(h=!0,u.restart(),verbose&&console.log(g+this.stackID(u)+" (restarted)"),this.advanceFully(u,l))))continue;let y=u.split(),w=g;for(let x=0;y.forceReduce()&&x<10&&(verbose&&console.log(w+this.stackID(y)+" (via force-reduce)"),!this.advanceFully(y,l));x++)verbose&&(w=this.stackID(y)+" -> ");for(let x of u.recoverByInsert(p))verbose&&console.log(g+this.stackID(x)+" (via recover-insert)"),this.advanceFully(x,l);this.stream.end>u.pos?(m==u.pos&&(m++,p=0),u.recoverByDelete(p,m),verbose&&console.log(g+this.stackID(u)+` (via recover-delete ${this.parser.getName(p)})`),pushStackDedup(u,l)):(!a||a.score<u.score)&&(a=u)}return a}stackToTree(e){return e.close(),Tree.build({buffer:StackBufferCursor.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let s=(stackIDs||(stackIDs=new WeakMap)).get(e);return s||stackIDs.set(e,s=String.fromCodePoint(this.nextStackID++)),s+e}}function pushStackDedup(o,e){for(let s=0;s<e.length;s++){let l=e[s];if(l.pos==o.pos&&l.sameState(o)){e[s].score<o.score&&(e[s]=o);return}}e.push(o)}class Dialect{constructor(e,s,l){this.source=e,this.flags=s,this.disabled=l}allows(e){return!this.disabled||this.disabled[e]==0}}class LRParser extends Parser{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let s=e.nodeNames.split(" ");this.minRepeatTerm=s.length;for(let u=0;u<e.repeatNodeCount;u++)s.push("");let l=Object.keys(e.topRules).map(u=>e.topRules[u][1]),a=[];for(let u=0;u<s.length;u++)a.push([]);function h(u,p,m){a[u].push([p,p.deserialize(String(m))])}if(e.nodeProps)for(let u of e.nodeProps){let p=u[0];typeof p=="string"&&(p=NodeProp[p]);for(let m=1;m<u.length;){let g=u[m++];if(g>=0)h(g,p,u[m++]);else{let y=u[m+-g];for(let w=-g;w>0;w--)h(u[m++],p,y);m++}}}this.nodeSet=new NodeSet(s.map((u,p)=>NodeType.define({name:p>=this.minRepeatTerm?void 0:u,id:p,props:a[p],top:l.indexOf(p)>-1,error:p==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(p)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=DefaultBufferLength;let f=decodeArray(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let u=0;u<this.specializerSpecs.length;u++)this.specialized[u]=this.specializerSpecs[u].term;this.specializers=this.specializerSpecs.map(getSpecializer),this.states=decodeArray(e.states,Uint32Array),this.data=decodeArray(e.stateData),this.goto=decodeArray(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(u=>typeof u=="number"?new TokenGroup(f,u):u),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,s,l){let a=new Parse(this,e,s,l);for(let h of this.wrappers)a=h(a,e,s,l);return a}getGoto(e,s,l=!1){let a=this.goto;if(s>=a[0])return-1;for(let h=a[s+1];;){let f=a[h++],u=f&1,p=a[h++];if(u&&l)return p;for(let m=h+(f>>1);h<m;h++)if(a[h]==e)return p;if(u)return-1}}hasAction(e,s){let l=this.data;for(let a=0;a<2;a++)for(let h=this.stateSlot(e,a?2:1),f;;h+=3){if((f=l[h])==65535)if(l[h+1]==1)f=l[h=pair(l,h+2)];else{if(l[h+1]==2)return pair(l,h+2);break}if(f==s||f==0)return pair(l,h+1)}return 0}stateSlot(e,s){return this.states[e*6+s]}stateFlag(e,s){return(this.stateSlot(e,0)&s)>0}validAction(e,s){return!!this.allActions(e,l=>l==s?!0:null)}allActions(e,s){let l=this.stateSlot(e,4),a=l?s(l):void 0;for(let h=this.stateSlot(e,1);a==null;h+=3){if(this.data[h]==65535)if(this.data[h+1]==1)h=pair(this.data,h+2);else break;a=s(pair(this.data,h+1))}return a}nextStates(e){let s=[];for(let l=this.stateSlot(e,1);;l+=3){if(this.data[l]==65535)if(this.data[l+1]==1)l=pair(this.data,l+2);else break;if(!(this.data[l+2]&1)){let a=this.data[l+1];s.some((h,f)=>f&1&&h==a)||s.push(this.data[l],a)}}return s}configure(e){let s=Object.assign(Object.create(LRParser.prototype),this);if(e.props&&(s.nodeSet=this.nodeSet.extend(...e.props)),e.top){let l=this.topRules[e.top];if(!l)throw new RangeError(`Invalid top rule name ${e.top}`);s.top=l}return e.tokenizers&&(s.tokenizers=this.tokenizers.map(l=>{let a=e.tokenizers.find(h=>h.from==l);return a?a.to:l})),e.specializers&&(s.specializers=this.specializers.slice(),s.specializerSpecs=this.specializerSpecs.map((l,a)=>{let h=e.specializers.find(u=>u.from==l.external);if(!h)return l;let f=Object.assign(Object.assign({},l),{external:h.to});return s.specializers[a]=getSpecializer(f),f})),e.contextTracker&&(s.context=e.contextTracker),e.dialect&&(s.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(s.strict=e.strict),e.wrap&&(s.wrappers=s.wrappers.concat(e.wrap)),e.bufferLength!=null&&(s.bufferLength=e.bufferLength),s}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let s=this.dynamicPrecedences;return s==null?0:s[e]||0}parseDialect(e){let s=Object.keys(this.dialects),l=s.map(()=>!1);if(e)for(let h of e.split(" ")){let f=s.indexOf(h);f>=0&&(l[f]=!0)}let a=null;for(let h=0;h<s.length;h++)if(!l[h])for(let f=this.dialects[s[h]],u;(u=this.data[f++])!=65535;)(a||(a=new Uint8Array(this.maxTerm+1)))[u]=1;return new Dialect(e,l,a)}static deserialize(e){return new LRParser(e)}}function pair(o,e){return o[e]|o[e+1]<<16}function findFinished(o){let e=null;for(let s of o){let l=s.p.stoppedAt;(s.pos==s.p.stream.end||l!=null&&s.pos>l)&&s.p.parser.stateFlag(s.state,2)&&(!e||e.score<s.score)&&(e=s)}return e}function getSpecializer(o){if(o.external){let e=o.extend?1:0;return(s,l)=>o.external(s,l)<<1|e}return o.get}let flag=()=>new NodeProp({deserialize:o=>!0});const coll$2=flag(),prefixColl=flag(),prefixEdge=flag(),sameEdge=flag(),prefixContainer=flag();var props=Object.freeze({__proto__:null,coll:coll$2,prefixColl,prefixEdge,sameEdge,prefixContainer});const spec_Symbol={__proto__:null,true:136,false:136,nil:138,def:147,defn:147,"defn-":147,defmacro:147,definline:147,defonce:147,deftest:147,defcard:147,ns:155},parser=LRParser.deserialize({version:14,states:"-zQ]QPOOP!pOPOOOOQO'#C`'#C`OOQO'#Cb'#CbO]QPO'#CcO]QPO'#CeO]QPO'#CgO]QPO'#CiO]QPO'#CkO]OPO'#CtO]OPO'#CvO!uOQO'#C|OOQO'#Dm'#DmQ]QPOOO$hQPO'#CqO$oQPO'#DUO$vQPO'#DXO$}OSO'#DZO%cOPO'#D]O%hOPO'#D`O%mOPO'#DbO%uOWO'#DdO]QPO'#DgO]QPO'#DhO%zQPO'#DjOOQO'#Dq'#DqP&SQPO'#C^POOO)C?e)C?eOOQO,58},58}OOQO,59P,59POOQO,59R,59ROOQO,59T,59TOOQO,59V,59VOOQO,59`,59`OOQO,59b,59bOOQO,59h,59hO'gOPO,59hOOQO-E7k-E7kOOQO'#Cr'#CrO!}QPO'#CsOOQO'#Dv'#DvO'lQPO'#D|O'sQPO'#DuOOQO'#DO'#DOOOQO'#Dz'#DzO'sQPO'#DyOOQO'#DQ'#DQOOQO'#D}'#D}O'lQPO'#D|OOQO'#Dt'#DtO(OQPO,59]O(TQPO,59pOOQO,59p,59pO([QPO,59sOOQO,59s,59sOOQO,59u,59uOOOO,59x,59xOOQO,59y,59yOOQO,5:Q,5:QOOQO,5:T,5:TOOQO,5:V,5:VOOQO,59w,59wOOQO,59z,59zOOQO,59|,59|OOQO,5:O,5:OOOQO,5:R,5:ROOQO,5:S,5:SOOQO,5:U,5:UPOOO,58x,58xOOQO1G/S1G/SOOQO,59_,59_OOQO,59k,59kOOQO,59m,59mOOQO'#Cx'#CxO'sQPO'#CyOOQO'#Dx'#DxO(cQPO,5:aO(jQPO,5:eO(qQPO,5:hOOQO1G.w1G.wOOQO1G/[1G/[OOQO1G/_1G/_OOQO,59e,59eO(xQPO'#CzO*`QPO1G/{O]QPO1G/{OOQO'#Cz'#CzO*gQPO1G0PO*gQPO1G0PO*nQPO7+%gO*uQPO7+%kP&SQPO'#CcP&SQPO'#CeP&SQPO'#CgP&SQPO'#CiP&SQPO'#CkP*|OPO'#DbP&SQPO'#DgP&SQPO'#Dh",stateData:"+[~O!dOSPOSRPQ~OTiOWSOYTO[UO^VO`WOaiObiOd^OiXOkYOoZOw_Oz`O|iO!OaO!TcO!VdO!XeO!fQO!gRO~ORjO~OosOqtO~OT!OOWSOYTO[UO^VO`WOaiObiOd^OiXOkYOoZOw_Oz`O|iO!OaO!TcO!VdO!XeO!fQO!gRO!kvO!o{O~Oc!pP~P!}Ov!UO~P]Oy!WO~P]Od^OoZOz`O!r!YO!t!]O!u!^O~Oz`O~OT!`O~OWSOd^O~O!s!bO~Ow_Oz`O~OTiOW!}OY#OO[#PO^#QO`#ROaiObiOd^OiXOkYOoZOw_Oz`O|iO!OaO!TcO!V#SO!XeO!fQO!gRO~Oo!gO~Oc!pX~P]OT!kOiXOkYO~Oc!qO~Ov!rO~P]Oy!sO~P]Oc!ia~P]Oc!ma~P]Oc!pa~P]OTnXWnXYnX[nX^nX`nXanXbnXc!eXdnXinXknXonXwnXznX|nX!OnX!TnX!VnX!XnX!fnX!gnX~Oc!ii~P]Oc!mi~P]Oc!iq~P]Oc!mq~P]OW!}Od^O~Oa!u!tT!t~",goto:"/]!rPP!sP!vP!v#nP!vP!vP!vP!vPPPPP$j%i%i%mP%mP&n&n&sP&yP'x'x'|'|PP(QPP({P!vP!v)|!v!vP!vP!vP!v!v!v*t!v+nP,fPPP-^PP.j.m.pP.v.m/PP.m/VRkP!kiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#U!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UT!ad#S!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ![aT!ad#STx^w!UfOSTUVWXY]_`fgy!Q!T!V!n!o!p!v!w!y!z!{!|Sw^wU!lz}!la#Tj!}#O#P#Q#R#T#UV!mz}!lQ!w!nR!z!o!fiOSTUVWXY]^_`fgjwy!Q!T!V!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ!ZaQ!u!nR!x!oT|^wT!P^w!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UR!eh!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ!XaQ!_bR!eh!kbOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#U!YgOSTUVWXY]^_`fgwy!Q!T!V!n!o!p!v!w!y!z!{!|a#Uj!}#O#P#Q#R#T#U!khOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ]Obu]y!T!V!p!v!y!{!|Qy^Q!T_Q!V`Q!p!QQ!v!nQ!y!oQ!{!wR!|!zt[O]^_`y!Q!T!V!n!o!p!v!w!y!z!{!|SlS!}SmT#OSnU#PSoV#QSpW#RQqXQrYU!cfw#TS!dg#UR!fjR!S^R!R^Qz^R!hwQ!nzQ!o}R!t!lQ}^R!iwQ!Q^R!jw",nodeNames:"âš  LineComment Discard #_ Boolean Symbol Nil Deref @ Quote ' SyntaxQuote ` Unquote ~ UnquoteSplice ~@ Number Keyword ) ( List DefLike Meta Metadata ^ ReaderMetadata #^ VarName Meta DocString \" String StringContent NS Meta Operator Meta ] [ Vector } { Map Character Set # NamespacedMap KeywordPrefix RegExp Var #' ReaderConditional #? SymbolicValue ## AnonymousFunction Meta TaggedLiteral ReaderTag ConstructorCall ConstructorPrefix Program",maxTerm:83,nodeProps:[[prefixEdge,-14,3,8,10,12,14,16,25,27,46,48,51,53,55,61,""],[prefixColl,-13,7,9,11,13,15,24,26,45,47,49,50,52,56,""],["openedBy",19,"(",31,'"',38,"[",41,"{"],["closedBy",20,")",31,'"',39,"]",42,"}"],[coll$2,-3,21,40,43,""],[prefixContainer,-7,23,29,35,37,57,58,60,""],[sameEdge,31,""]],skippedNodes:[0,1,2,3],repeatNodeCount:1,tokenData:"#6x~R![OX$wX^%n^p$wpq%nqr'grs,Tst,Ytu/Yuv'gvw'gwx6Vxy6jyz6}z{'g{|7b|}%n}!O7b!O!P9t!P!Q)v!Q!R!8[!R![!>t![!]!Cp!]!^!J]!^!_'g!_!`'g!`!a'g!a!b'g!b!c!Kr!c!}/Y!}#O!LV#O#P!Lj#P#Q#3w#Q#R#4[#R#S/Y#S#T#4o#T#o/Y#o#p#5S#p#q$w#q#r#5g#r#s#5z#s#y$w#y#z%n#z$f$w$f$g%n$g##l/Y##l#BY$w#BY#BZ%n#BZ$IS$w$IS$I_%n$I_$I|$w$I|$JO%n$JO$JT$w$JT$JU%n$JU$KV$w$KV$KW%n$KW&FU$w&FU&FV%n&FV~$wQ$|SqQOr$ws#O$w#O#P%Y#P~$wQ%_TqQOr$wrs$ws#O$w#O#P%Y#P~$wR%ujqQ!dPOX$wX^%n^p$wpq%nqr$ws|$w|}%n}#O$w#O#P%Y#P#y$w#y#z%n#z$f$w$f$g%n$g#BY$w#BY#BZ%n#BZ$IS$w$IS$I_%n$I_$I|$w$I|$JO%n$JO$JT$w$JT$JU%n$JU$KV$w$KV$KW%n$KW&FU$w&FU&FV%n&FV~$w_'rpqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q!['g![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$wZ*PpqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$w~,YOo~R,a[!OPqQOr$wst-Vtw$wwx-jx!a$w!a!b-}!b#O$w#O#P%Y#P#Q$w#Q#R.b#R#S.u#S~$wR-^S!XPqQOr$ws#O$w#O#P%Y#P~$wR-qS!TPqQOr$ws#O$w#O#P%Y#P~$wR.US!VPqQOr$ws#O$w#O#P%Y#P~$wR.iSkPqQOr$ws#O$w#O#P%Y#P~$wR.|SRPqQOr$ws#O$w#O#P%Y#P~$w_/epqQ!sW!tSTPOq$wqr'gst)vtu/Yuv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P1i!P!Q'g!Q![/Y![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}/Y!}#O$w#O#P%Y#P#R$w#R#S/Y#S#T$w#T#o/Y#o$g$w$g##l/Y##l~$w_1rpqQ!sWTPOq$wqr)vst)vtu3vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!}3v!}#O$w#O#P%Y#P#R$w#R#S3v#S#T$w#T#o3v#o$g$w$g##l3v##l~$w_4RpqQ!sW!uSTPOq$wqr)vst)vtu3vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P1i!P!Q)v!Q![3v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!}3v!}#O$w#O#P%Y#P#R$w#R#S3v#S#T$w#T#o3v#o$g$w$g##l3v##l~$wR6^SYPqQOr$ws#O$w#O#P%Y#P~$wV6qSdTqQOr$ws#O$w#O#P%Y#P~$wR7UScPqQOr$ws#O$w#O#P%Y#P~$w_7mqqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P9t!P!Q'g!Q!RHO!R![!&|![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$wZ9}pqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![<R![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZ<^tqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![<R![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!g)v!g!h>n!h!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#X)v#X#Y>n#Y#o)v#o$g$w$g##l)v##l~$wZ>wpqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|@{|}$w}!O@{!O!P)v!P!Q)v!Q![CY![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZAUpqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![CY![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZCerqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![CY![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!o)v!o!pEo!p!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZEzpqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$w_H]yqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!PJ|!P!Q!![!Q![!&|![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!g'g!g!h!)t!h!o'g!o!p!0{!p!q!0{!q!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#X'g#X#Y!)t#Y#l'g#l#m!3^#m#o'g#o$g$w$g##l'g##l~$wZKXvqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![J|![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!g)v!g!h>n!h!o)v!o!pMo!p!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#X)v#X#Y>n#Y#o)v#o$g$w$g##l)v##l~$wZMztqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!g)v!g!h>n!h!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#X)v#X#Y>n#Y#o)v#o$g$w$g##l)v##l~$w_!!gpqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!$k![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!$xpqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!$k![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!'ZwqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!PJ|!P!Q!![!Q![!&|![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!g'g!g!h!)t!h!o'g!o!p!0{!p!q!0{!q!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#X'g#X#Y!)t#Y#o'g#o$g$w$g##l'g##l~$w_!*PpqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|!,T|}$w}!O!,T!O!P)v!P!Q'g!Q![!.d![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!,`pqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!.d![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!.qrqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!.d![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!o'g!o!p!0{!p!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!1YpqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q!['g![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!3irqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!5s![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!i!5s!i!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#Z!5s#Z#o'g#o$g$w$g##l'g##l~$w_!6QrqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!5s![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!i!5s!i!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#Z!5s#Z#o'g#o$g$w$g##l'g##l~$wR!8ceqQaPOr$ws!O$w!O!P!9t!P!Q!=r!Q![!>t![!g$w!g!h!:q!h!o$w!o!p!<n!p!q!<n!q#O$w#O#P%Y#P#U$w#U#V!?z#V#X$w#X#Y!:q#Y#c$w#c#d!AS#d#l$w#l#m!BU#m~$wR!9{[qQaPOr$ws!Q$w!Q![!9t![!g$w!g!h!:q!h!o$w!o!p!=R!p#O$w#O#P%Y#P#X$w#X#Y!:q#Y~$wR!:vYqQOr$ws{$w{|!;f|}$w}!O!;f!O!Q$w!Q![!;}![#O$w#O#P%Y#P~$wR!;kUqQOr$ws!Q$w!Q![!;}![#O$w#O#P%Y#P~$wR!<UWqQaPOr$ws!Q$w!Q![!;}![!o$w!o!p!<n!p#O$w#O#P%Y#P~$wR!<uSqQaPOr$ws#O$w#O#P%Y#P~$wR!=YWqQaPOr$ws!g$w!g!h!:q!h#O$w#O#P%Y#P#X$w#X#Y!:q#Y~$wR!=wUqQOr$ws!Q$w!Q![!>Z![#O$w#O#P%Y#P~$wR!>bUqQaPOr$ws!Q$w!Q![!>Z![#O$w#O#P%Y#P~$wR!>{_qQaPOr$ws!O$w!O!P!9t!P!Q!=r!Q![!>t![!g$w!g!h!:q!h!o$w!o!p!<n!p!q!<n!q#O$w#O#P%Y#P#X$w#X#Y!:q#Y~$wR!@PVqQOr$ws!Q$w!Q!R!@f!R!S!@f!S#O$w#O#P%Y#P~$wR!@mVqQaPOr$ws!Q$w!Q!R!@f!R!S!@f!S#O$w#O#P%Y#P~$wR!AXUqQOr$ws!Q$w!Q!Y!Ak!Y#O$w#O#P%Y#P~$wR!ArUqQaPOr$ws!Q$w!Q!Y!Ak!Y#O$w#O#P%Y#P~$wR!BZYqQOr$ws!Q$w!Q![!By![!c$w!c!i!By!i#O$w#O#P%Y#P#T$w#T#Z!By#Z~$wR!CQYqQaPOr$ws!Q$w!Q![!By![!c$w!c!i!By!i#O$w#O#P%Y#P#T$w#T#Z!By#Z~$wV!CyobPqQ!rSOq$wqr!Ezst$wtu!Ezuv!Ezvw!Ezwz$wz{!Ez{|!Ez|}$w}!O!Ez!O!P!Ez!P!Q!Ez!Q![$w![!]!HX!]!^$w!^!_!Ez!_!`!Ez!`!a!Ez!a!b!Ez!b!c$w!c!}!Ez!}#O$w#O#P%Y#P#R$w#R#S!Ez#S#T$w#T#o!Ez#o$g$w$g##l!Ez##l~$wV!FTpbPqQ!rSOq$wqr!Ezst!Eztu!Ezuv!Ezvw!Ezwx!Ezxz$wz{!Ez{|!Ez|}$w}!O!Ez!O!P!Ez!P!Q!Ez!Q![!Ez![!]!Ez!]!^$w!^!_!Ez!_!`!Ez!`!a!Ez!a!b!Ez!b!c$w!c!}!Ez!}#O$w#O#P%Y#P#R$w#R#S!Ez#S#T$w#T#o!Ez#o$g$w$g##l!Ez##l~$wV!HbmbPqQ!rSOq$wqr!Ezst$wtu!Ezuv!Ezvw!Ezwz$wz{!Ez{|!Ez|}$w}!O!Ez!O!P!Ez!P!Q!Ez!Q!^$w!^!_!Ez!_!`!Ez!`!a!Ez!a!b!Ez!b!c$w!c!}!Ez!}#O$w#O#P%Y#P#R$w#R#S!Ez#S#T$w#T#o!Ez#o$g$w$g##l!Ez##l~$wR!JdVPPqQOY!J]YZ$wZr!J]rs!Jys#O!J]#O#P!KU#P~!J]P!KOQPPOY!JyZ~!JyR!K]VPPqQOY!J]YZ$wZr!J]rs!J]s#O!J]#O#P!KU#P~!J]R!KySWPqQOr$ws#O$w#O#P%Y#P~$wR!L^SwPqQOr$ws#O$w#O#P%Y#P~$wR!LocqQOY!MzYZ$wZr!Mzrs!Mzs#O!Mz#O#P!N_#P#U!Mz#U#V!Nu#V#Y!Mz#Y#Z#$w#Z#b!Mz#b#c#(b#c#d#*{#d#f!Mz#f#g#,m#g#h#/W#h#i#/q#i#j#0s#j~!MzR!NRS|PqQOr$ws#O$w#O#P%Y#P~$wR!NfT|PqQOr$wrs$ws#O$w#O#P%Y#P~$wR!N|U|PqQOr$ws#O$w#O#P%Y#P#T$w#T#U# `#U~$wR# eUqQOr$ws#O$w#O#P%Y#P#V$w#V#W# w#W~$wR# |UqQOr$ws#O$w#O#P%Y#P#_$w#_#`#!`#`~$wR#!eUqQOr$ws#O$w#O#P%Y#P#g$w#g#h#!w#h~$wR#!|UqQOr$ws#O$w#O#P%Y#P#d$w#d#e##`#e~$wR##eUqQOr$ws#O$w#O#P%Y#P#T$w#T#U##w#U~$wR##|UqQOr$ws#O$w#O#P%Y#P#V$w#V#W#$`#W~$wR#$eUqQOr$ws#O$w#O#P%Y#P#X$w#X#Y!Mz#Y~$wR#%OU|PqQOr$ws#O$w#O#P%Y#P#c$w#c#d#%b#d~$wR#%gUqQOr$ws#O$w#O#P%Y#P#f$w#f#g#%y#g~$wR#&OUqQOr$ws#O$w#O#P%Y#P#a$w#a#b#&b#b~$wR#&gUqQOr$ws#O$w#O#P%Y#P#Y$w#Y#Z#&y#Z~$wR#'OUqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#'b#Y~$wR#'gUqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#'y#Y~$wR#(OUqQOr$ws#O$w#O#P%Y#P#W$w#W#X!Mz#X~$wR#(iU|PqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#({#Y~$wR#)QUqQOr$ws#O$w#O#P%Y#P#k$w#k#l#)d#l~$wR#)iUqQOr$ws#O$w#O#P%Y#P#`$w#`#a#){#a~$wR#*QUqQOr$ws#O$w#O#P%Y#P#]$w#]#^#*d#^~$wR#*iUqQOr$ws#O$w#O#P%Y#P#b$w#b#c#$`#c~$wR#+SV|PqQOr$ws!Q$w!Q!U#+i!U!Y#,S!Y#O$w#O#P%Y#P~$wR#+pU|PqQOr$ws!Q$w!Q!Y#,S!Y#O$w#O#P%Y#P~$wR#,ZU|PqQOr$ws!Q$w!Q!Y!Mz!Y#O$w#O#P%Y#P~$wR#,tU|PqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#-W#Y~$wR#-]UqQOr$ws#O$w#O#P%Y#P#h$w#h#i#-o#i~$wR#-tUqQOr$ws#O$w#O#P%Y#P#i$w#i#j#.W#j~$wR#.]UqQOr$ws#O$w#O#P%Y#P#f$w#f#g#.o#g~$wR#.tUqQOr$ws#O$w#O#P%Y#P#b$w#b#c!Mz#c~$wR#/_U|PqQOr$ws#O$w#O#P%Y#P#d$w#d#e##`#e~$wR#/xU|PqQOr$ws#O$w#O#P%Y#P#T$w#T#U#0[#U~$wR#0aUqQOr$ws#O$w#O#P%Y#P#U$w#U#V!Mz#V~$wR#0zY|PqQOr$ws!Q$w!Q![#1j![!c$w!c!i#1j!i#O$w#O#P%Y#P#T$w#T#Z#1j#Z~$wR#1oYqQOr$ws!Q$w!Q![#2_![!c$w!c!i#2_!i#O$w#O#P%Y#P#T$w#T#Z#2_#Z~$wR#2dYqQOr$ws!Q$w!Q![#3S![!c$w!c!i#3S!i#O$w#O#P%Y#P#T$w#T#Z#3S#Z~$wR#3XYqQOr$ws!Q$w!Q![!Mz![!c$w!c!i!Mz!i#O$w#O#P%Y#P#T$w#T#Z!Mz#Z~$wR#4OSvPqQOr$ws#O$w#O#P%Y#P~$wR#4cSiPqQOr$ws#O$w#O#P%Y#P~$wR#4vS[PqQOr$ws#O$w#O#P%Y#P~$wV#5ZSzTqQOr$ws#O$w#O#P%Y#P~$wR#5nSyPqQOr$ws#O$w#O#P%Y#P~$wR#6RU^PqQOr$ws!b$w!b!c#6e!c#O$w#O#P%Y#P~$wR#6lS`PqQOr$ws#O$w#O#P%Y#P~$w",tokenizers:[0,1,2,3],topRules:{Program:[0,62]},dynamicPrecedences:{22:1,34:2},specialized:[{term:5,get:o=>spec_Symbol[o]||-1}],tokenPrec:466});function _println(){console.log.apply(console,arguments)}function _pr_str(o,e){typeof e>"u"&&(e=!0);var s=e,l=_obj_type(o);switch(l){case"lazy-range":return"(0 1 2 3 4 5 6 7 8 9 10 ...)";case"lazy-seq":var h=[...o].map(function(u){return _pr_str(u,s)});return"("+h.join(" ")+")";case"lazy-iterable":var h=[...o].map(function(u){return _pr_str(u,s)});return"("+h.join(" ")+")";case"iterate":return"#iterate["+o.f+"]";case"cycle":return"#cycle["+o.coll+"]";case"list":var h=o.map(function(u){return _pr_str(u,s)});return"("+h.join(" ")+")";case"vector":var h=o.map(function(u){return _pr_str(u,s)});return"["+h.join(" ")+"]";case"hash-map":var h=[];for(const[u,p]of o)h.push(_pr_str(u,s),_pr_str(p,s));return"{"+h.join(" ")+"}";case"set":var a=Array.from(o),h=a.map(function(u){return _pr_str(u,s)});return"#{"+h.join(" ")+"}";case"string":return o[0]==="Êž"?":"+o.slice(1):s?'"'+o.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':o;case"keyword":return":"+o.slice(1);case"nil":return"nil";case"function":return o.__meta__?o._ismacro_?"#macro["+o.__meta__.get(_keyword("name"))+"]":"#function["+o.__meta__.get(_keyword("name"))+"]":o._ismacro_?"#macro[]":"#function[]";case"regex":const f=o.toString();return'#"'+f.substring(1,f.length-2)+'"';case"ratio":return o.s===-1?"-"+o.n+"/"+o.d:o.n+"/"+o.d;case"atom":return"(atom "+_pr_str(o.val,s)+")";default:return o.toString()}}const zip=`(ns clj.zip)\r
\r
(defn zip/from-trail [tree last]\r
  (if (= (nth last 0) "left")\r
    {:value (nth last 1), :left tree, :right (nth last 2)}\r
    {:value (nth last 1), :left (nth last 2), :right tree}))\r
\r
(defn zip/from-tree [tree]\r
  {:tree tree :trail []})\r
\r
(defn zip/value [z]\r
  (:value (:tree z)))\r
\r
(defn zip/zipper [tree trail]\r
  {:tree tree :trail trail})\r
\r
(defn zip/left [z]\r
  (when (:left (:tree z))\r
    (zip/zipper (:left (:tree z))\r
                (conj [["left" (:value (:tree z)) (:right (:tree z))]]\r
                      (:trail z)))))\r
(defn zip/right [z]\r
  (when (:right (:tree z))\r
    (zip/zipper (:right (:tree z))\r
                (conj [["right" (:value (:tree z)) (:left (:tree z))]]\r
                      (:trail z)))))\r
\r
(defn zip/rebuild-tree [tree trail]\r
  (if (= 0 (count trail))\r
    tree\r
    (recur (zip/from-trail tree (first trail)) (fnext trail))))\r
\r
(defn zip/to-tree [z]\r
  (zip/rebuild-tree (:tree z) (:trail z)))\r
\r
(defn zip/up [z]\r
  (when-not (zero? (count (:trail z)))\r
    (zip/zipper (zip/from-trail (:tree z) (first (:trail z)))\r
                (fnext (:trail z)))))\r
\r
(defn zip/set-value [z value]\r
  (zip/zipper {:value value,\r
               :left  (:left (:tree z)),\r
               :right (:right (:tree z))}\r
              (:trail z)))\r
\r
(defn zip/set-left [z left]\r
  (zip/zipper {:value (:value (:tree z)),\r
               :left  left,\r
               :right (:right (:tree z))}\r
              (:trail z)))\r
\r
(defn zip/set-right [z right]\r
  (zip/zipper {:value (:value (:tree z)),\r
               :left  (:left (:tree z)),\r
               :right right}\r
              (:trail z)))`;let sq1Stream$1=[],sq2Stream$1=[],triStream$1=[],noiseStream$1=[];function setSq1Stream(o){sq1Stream$1=o}function setSq2Stream(o){sq2Stream$1=o}function setTriStream(o){triStream$1=o}function setNoiseStream(o){noiseStream$1=o}function assembleStream(o){const e=o.sort((l,a)=>l.get("Êžtime")-a.get("Êžtime"));let s=[];for(let l=0;l<e.length;l++){e[l].get("Êžtime");let a=e[l].get("Êžlength");s.push(a+128),s.push(e[l].get("Êžpitch")-33)}return s}function make_download(o,e){var s=URL.createObjectURL(bufferToWave(e,e.length)),l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download",o),document.body.appendChild(l),l.click(),l.remove()}function bufferToWave(o,e){var s=o.numberOfChannels,l=e*s*2+44,a=new ArrayBuffer(l),h=new DataView(a),f=[],u,p,m=0,g=0;for(w(1179011410),w(l-8),w(1163280727),w(544501094),w(16),y(1),y(s),w(o.sampleRate),w(o.sampleRate*2*s),y(s*2),y(16),w(1635017060),w(l-g-4),u=0;u<o.numberOfChannels;u++)f.push(o.getChannelData(u));for(;g<l;){for(u=0;u<s;u++)p=Math.max(-1,Math.min(1,f[u][m])),p=(.5+p<0?p*32768:p*32767)|0,h.setInt16(g,p,!0),g+=2;m++}return new Blob([a],{type:"audio/wav"});function y(x){h.setUint16(g,x,!0),g+=2}function w(x){h.setUint32(g,x,!0),g+=4}}function dpcm_seq(o){const e=o.reduce((h,f)=>h.get("Êžtime")>f.get("Êžtime")?h:f),s=e.get("Êžbuffer").getChannelData(0).length,l=Math.ceil(ctx.sampleRate*e.get("Êžtime")+s);let a=Array(l).fill(0);for(let h=0;h<o.length;h++){const f=Math.floor(o[h].get("Êžtime")*ctx.sampleRate);let u=o[h].get("Êžbuffer").getChannelData(0).length;o[h].get("Êžlength")&&(u=o[h].get("Êžlength")*ctx.sampleRate);for(let p=0;p<u;p++)a[f+p]=o[h].get("Êžbuffer").getChannelData(0)[p]}return audioBuffer(a)}function mix$1(o){const e=Math.max(...o.map(a=>a.length)),s=[...o.map(a=>a.getChannelData(0))];let l=[];for(let a=0;a<e;a++){let h=0;for(let f=0;f<s.length;f++)s[f].length>=a&&(h+=s[f][a]);l.push(h)}return audioBuffer(l)}const nsfDriver=[78,69,83,77,26,1,1,1,0,128,0,128,9,128,83,111,117,110,100,32,101,110,103,105,110,101,32,100,101,109,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,66,111,98,98,105,32,84,111,119,101,114,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,50,48,50,52,32,66,111,98,98,105,32,84,111,119,101,114,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,64,0,0,0,0,0,0,0,0,29,78,3,0,0,0,0,0,32,15,128,169,0,32,61,128,96,32,168,128,96,243,131,169,15,141,21,64,169,0,141,0,2,169,255,141,3,2,141,4,2,169,48,141,5,2,141,9,2,141,17,2,169,128,141,13,2,96,169,0,141,21,64,169,1,141,0,2,96,141,1,2,10,168,185,13,128,133,0,185,14,128,133,1,160,0,177,0,141,2,2,200,177,0,170,200,177,0,157,27,2,240,60,200,177,0,157,33,2,200,177,0,157,63,2,200,177,0,157,51,2,200,177,0,157,39,2,200,177,0,157,45,2,200,177,0,157,81,2,169,255,157,87,2,169,1,157,93,2,157,99,2,169,0,157,57,2,157,105,2,157,111,2,200,173,1,2,157,21,2,206,2,2,208,173,96,173,0,2,208,49,32,33,128,162,0,189,27,2,41,1,240,29,189,87,2,24,125,81,2,157,87,2,144,14,222,93,2,208,9,189,99,2,157,93,2,32,223,128,32,151,129,232,224,6,208,215,32,12,130,96,189,39,2,133,0,189,45,2,133,1,160,0,177,0,16,28,201,160,144,12,32,126,129,200,189,27,2,41,1,208,237,96,41,127,157,99,2,157,93,2,200,76,235,128,141,2,2,189,33,2,201,3,208,6,32,82,129,76,62,129,173,2,2,140,1,2,24,125,111,2,10,168,185,113,130,157,69,2,185,114,130,157,75,2,172,1,2,169,0,157,57,2,32,104,129,169,0,157,57,2,200,152,24,125,39,2,157,39,2,144,3,254,45,2,96,173,2,2,41,16,240,8,173,2,2,9,128,141,2,2,173,2,2,157,69,2,96,177,0,201,94,208,7,189,27,2,9,2,208,5,189,27,2,41,253,157,27,2,96,140,1,2,56,233,160,10,168,185,47,131,133,2,185,48,131,133,3,172,1,2,200,108,2,0,189,33,2,10,10,168,32,178,129,169,8,153,6,2,189,69,2,153,7,2,189,75,2,153,8,2,96,140,1,2,189,51,2,10,168,185,118,131,133,0,185,119,131,133,1,188,57,2,177,0,201,255,208,6,222,57,2,76,196,129,141,2,2,224,2,208,9,173,2,2,208,4,169,128,48,8,189,63,2,41,240,13,2,2,172,1,2,153,5,2,254,57,2,189,27,2,41,2,240,16,189,33,2,201,2,240,4,169,48,208,2,169,128,153,5,2,96,173,5,2,141,0,64,173,6,2,141,1,64,173,7,2,141,2,64,173,8,2,205,3,2,240,6,141,3,64,141,3,2,173,9,2,141,4,64,173,10,2,141,5,64,173,11,2,141,6,64,173,12,2,205,4,2,240,6,141,7,64,141,4,2,173,13,2,141,8,64,173,15,2,141,10,64,173,16,2,141,11,64,173,17,2,141,12,64,173,19,2,141,14,64,173,20,2,141,15,64,96,241,7,128,7,19,7,173,6,77,6,243,5,157,5,77,5,0,5,184,4,117,4,53,4,248,3,191,3,137,3,86,3,38,3,249,2,206,2,166,2,127,2,92,2,58,2,26,2,251,1,223,1,196,1,171,1,147,1,124,1,103,1,81,1,63,1,45,1,28,1,12,1,253,0,239,0,226,0,210,0,201,0,189,0,179,0,169,0,159,0,150,0,142,0,134,0,126,0,119,0,112,0,106,0,100,0,94,0,89,0,84,0,79,0,75,0,70,0,66,0,63,0,59,0,56,0,52,0,49,0,47,0,44,0,41,0,39,0,37,0,35,0,33,0,31,0,29,0,27,0,26,0,24,0,23,0,21,0,20,0,19,0,18,0,17,0,16,0,15,0,14,0,13,0,12,0,12,0,11,0,10,0,10,0,9,0,8,0,0,0,55,131,80,131,101,131,112,131,189,27,2,41,254,157,27,2,189,33,2,201,2,240,4,169,48,208,2,169,128,157,63,2,96,177,0,157,39,2,200,177,0,157,45,2,133,1,189,39,2,133,0,160,255,96,177,0,157,51,2,169,0,157,57,2,96,177,0,157,63,2,96,138,131,146,131,169,131,190,131,198,131,209,131,215,131,221,131,227,131,233,131,15,14,13,12,9,5,0,255,1,1,2,2,3,3,4,4,7,7,8,8,10,10,12,12,13,13,14,14,15,15,255,13,13,13,12,11,0,0,0,0,0,0,0,0,0,6,6,6,5,4,0,255,15,11,9,8,7,6,0,255,11,11,10,9,8,7,6,6,6,5,255,15,14,12,10,0,255,15,14,12,10,9,255,9,8,6,4,0,255,9,8,6,4,3,255,14,9,8,6,4,3,2,1,0,255,4,0,1,0,176,6,14,132,255,1,1,1,48,6,19,132,255,2,1,2,129,6,24,132,255,3,0,153,31,161,14,132,153,19,161,19,132,153,31,161,24,132,24,94,161,29,132],dutyCycles=[[0,1,0,0,0,0,0,0],[0,1,1,0,0,0,0,0],[0,1,1,1,1,0,0,0],[1,0,0,1,1,1,1,1]],lengthLoadValues=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30],triangleSteps=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],noiseLoadValues=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],dmcLoadValues=[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54];let outputValues=new Float32Array(29781),outputOffset=0,frameCounter=0,interruptInhibit=!1,step5Mode=!1,enableNoise=!1,enableTriangle=!1,enablePulse2=!1,enablePulse1=!1,p1Timer=0,p1TimerValue=0,p1Duty=0,p1DutyIndex=0,p1Output=0,p1CounterHalt=!1,p1Counter=0,p1Volume=0,p1ConstantVolume=!1,p1Decay=0,p1EnvelopeCounter=0,p1EnvelopeStart=!1,p1SweepEnabled=!1,p1SweepPeriod=0,p1SweepNegate=!1,p1SweepShift=0,p1SweepTimer=0,p1SweepTarget=0,p1SweepMuting=!0,p1SweepReload=!1,p2Timer=0,p2TimerValue=0,p2Duty=0,p2DutyIndex=0,p2Output=0,p2CounterHalt=!1,p2Counter=0,p2Volume=0,p2ConstantVolume=!1,p2Decay=0,p2EnvelopeCounter=0,p2EnvelopeStart=!1,p2SweepEnabled=!1,p2SweepPeriod=0,p2SweepNegate=!1,p2SweepShift=0,p2SweepTimer=0,p2SweepTarget=0,p2SweepMuting=!0,p2SweepReload=!1,triTimer=0,triTimerValue=0,triStepIndex=0,triOutput=0,triCounterHalt=!1,triCounter=0,triLinearCounter=0,triReloadLinear=!1,triLinearReload=0,noiseTimer=0,noiseTimerValue=0,noiseShift=1,noiseTonal=!1,noiseOutput=0,noiseCounterHalt=!1,noiseCounter=0,noiseVolume=0,noiseConstantVolume=!1,noiseDecay=0,noiseEnvelopeCounter=0,noiseEnvelopeStart=!1,dmcInterrupt=!1,dmcLoop=!1,dmcTimer=0,dmcTimerValue=0,dmcOutput=0,dmcSampleAddress=49152,dmcAddress=49152,dmcSample=0,dmcSampleLength=0,dmcSampleEmpty=!0,dmcBytesLeft=0,dmcShifter=0,dmcBitsLeft=8,dmcSilent=!0,frameIrqWanted$1=!1,dmcIrqWanted$1=!1;function reset$2(){outputValues=new Float32Array(29781),outputOffset=0,frameCounter=0,interruptInhibit=!1,step5Mode=!1,enableNoise=!1,enableTriangle=!1,enablePulse2=!1,enablePulse1=!1,p1Timer=0,p1TimerValue=0,p1Duty=0,p1DutyIndex=0,p1Output=0,p1CounterHalt=!1,p1Counter=0,p1Volume=0,p1ConstantVolume=!1,p1Decay=0,p1EnvelopeCounter=0,p1EnvelopeStart=!1,p1SweepEnabled=!1,p1SweepPeriod=0,p1SweepNegate=!1,p1SweepShift=0,p1SweepTimer=0,p1SweepTarget=0,p1SweepMuting=!0,p1SweepReload=!1,p2Timer=0,p2TimerValue=0,p2Duty=0,p2DutyIndex=0,p2Output=0,p2CounterHalt=!1,p2Counter=0,p2Volume=0,p2ConstantVolume=!1,p2Decay=0,p2EnvelopeCounter=0,p2EnvelopeStart=!1,p2SweepEnabled=!1,p2SweepPeriod=0,p2SweepNegate=!1,p2SweepShift=0,p2SweepTimer=0,p2SweepTarget=0,p2SweepMuting=!0,p2SweepReload=!1,triTimer=0,triTimerValue=0,triStepIndex=0,triOutput=0,triCounterHalt=!1,triCounter=0,triLinearCounter=0,triReloadLinear=!1,triLinearReload=0,noiseTimer=0,noiseTimerValue=0,noiseShift=1,noiseTonal=!1,noiseOutput=0,noiseCounterHalt=!1,noiseCounter=0,noiseVolume=0,noiseConstantVolume=!1,noiseDecay=0,noiseEnvelopeCounter=0,noiseEnvelopeStart=!1,dmcInterrupt=!1,dmcLoop=!1,dmcTimer=0,dmcTimerValue=0,dmcOutput=0,dmcSampleAddress=49152,dmcAddress=49152,dmcSample=0,dmcSampleLength=0,dmcSampleEmpty=!0,dmcBytesLeft=0,dmcShifter=0,dmcBitsLeft=8,dmcSilent=!0}function cycle$2(){(frameCounter===29830&&!step5Mode||frameCounter===37282)&&(frameCounter=0),frameCounter++,handleFrameCounter(),cycleTriangle(),cyclePulse1(),cyclePulse2(),cycleNoise(),cycleDmc(),outputValues[outputOffset++]=mix(),outputOffset===29781&&(outputOffset=29780)}function cyclePulse1(){p1TimerValue!==0?p1TimerValue--:(p1TimerValue=p1Timer*2+1,p1DutyIndex++,p1DutyIndex&=7),dutyCycles[p1Duty][p1DutyIndex]===0||p1SweepMuting||p1Counter===0?p1Output=0:p1Output=p1ConstantVolume?p1Volume:p1Decay}function cyclePulse2(){p2TimerValue!==0?p2TimerValue--:(p2TimerValue=p2Timer*2+1,p2DutyIndex++,p2DutyIndex&=7),dutyCycles[p2Duty][p2DutyIndex]===0||p2SweepMuting||p2Counter===0?p2Output=0:p2Output=p2ConstantVolume?p2Volume:p2Decay}function cycleTriangle(){triTimerValue!==0?triTimerValue--:(triTimerValue=triTimer,triCounter!==0&&triLinearCounter!==0&&(triOutput=triangleSteps[triStepIndex++],triTimer<2&&(triOutput=7.5),triStepIndex&=31))}function cycleNoise(){if(noiseTimerValue!==0)noiseTimerValue--;else{noiseTimerValue=noiseTimer;let o=noiseShift&1;noiseTonal?o^=(noiseShift&64)>>6:o^=(noiseShift&2)>>1,noiseShift>>=1,noiseShift|=o<<14}noiseCounter===0||(noiseShift&1)===1?noiseOutput=0:noiseOutput=noiseConstantVolume?noiseVolume:noiseDecay}function cycleDmc(){dmcTimerValue!==0?dmcTimerValue--:(dmcTimerValue=dmcTimer,dmcSilent||(dmcShifter&1?dmcOutput<=125&&(dmcOutput+=2):dmcOutput>=2&&(dmcOutput-=2)),dmcShifter>>=1,dmcBitsLeft--,dmcBitsLeft===0&&(dmcBitsLeft=8,dmcSampleEmpty?dmcSilent=!0:(dmcSilent=!1,dmcShifter=dmcSample,dmcSampleEmpty=!0))),dmcBytesLeft>0&&dmcSampleEmpty&&(dmcSampleEmpty=!1,dmcSample=read(dmcAddress),dmcAddress++,dmcAddress===65536&&(dmcAddress=32768),dmcBytesLeft--,dmcBytesLeft===0&&dmcLoop?(dmcBytesLeft=dmcSampleLength,dmcAddress=dmcSampleAddress):dmcBytesLeft===0&&dmcInterrupt&&(dmcIrqWanted$1=!0))}function updateSweepP1(){let o=p1Timer>>p1SweepShift;p1SweepNegate&&(o=-o-1),p1SweepTarget=p1Timer+o,p1SweepTarget>2047||p1Timer<8?p1SweepMuting=!0:p1SweepMuting=!1}function updateSweepP2(){let o=p2Timer>>p2SweepShift;p2SweepNegate&&(o=-o),p2SweepTarget=p2Timer+o,p2SweepTarget>2047||p2Timer<8?p2SweepMuting=!0:p2SweepMuting=!1}function clockQuarter(){triReloadLinear?triLinearCounter=triLinearReload:triLinearCounter!==0&&triLinearCounter--,triCounterHalt||(triReloadLinear=!1),p1EnvelopeStart?(p1EnvelopeStart=!1,p1Decay=15,p1EnvelopeCounter=p1Volume):p1EnvelopeCounter!==0?p1EnvelopeCounter--:(p1EnvelopeCounter=p1Volume,p1Decay!==0?p1Decay--:p1CounterHalt&&(p1Decay=15)),p2EnvelopeStart?(p2EnvelopeStart=!1,p2Decay=15,p2EnvelopeCounter=p2Volume):p2EnvelopeCounter!==0?p2EnvelopeCounter--:(p2EnvelopeCounter=p2Volume,p2Decay!==0?p2Decay--:p2CounterHalt&&(p2Decay=15)),noiseEnvelopeStart?(noiseEnvelopeStart=!1,noiseDecay=15,noiseEnvelopeCounter=noiseVolume):noiseEnvelopeCounter!==0?noiseEnvelopeCounter--:(noiseEnvelopeCounter=noiseVolume,noiseDecay!==0?noiseDecay--:noiseCounterHalt&&(noiseDecay=15))}function clockHalf(){!p1CounterHalt&&p1Counter!==0&&p1Counter--,!p2CounterHalt&&p2Counter!==0&&p2Counter--,!triCounterHalt&&triCounter!==0&&triCounter--,!noiseCounterHalt&&noiseCounter!==0&&noiseCounter--,p1SweepTimer===0&&p1SweepEnabled&&!p1SweepMuting&&p1SweepShift>0&&(p1Timer=p1SweepTarget,updateSweepP1()),p1SweepTimer===0||p1SweepReload?(p1SweepTimer=p1SweepPeriod,p1SweepReload=!1):p1SweepTimer--,p2SweepTimer===0&&p2SweepEnabled&&!p2SweepMuting&&p2SweepShift>0&&(p2Timer=p2SweepTarget,updateSweepP2()),p2SweepTimer===0||p2SweepReload?(p2SweepTimer=p2SweepPeriod,p2SweepReload=!1):p2SweepTimer--}function mix(){let o=159.79/(1/(triOutput/8227+noiseOutput/12241+dmcOutput/22638)+100),e=95.88/(8128/(p1Output+p2Output)+100);return(o+e)*2-1}function handleFrameCounter(){frameCounter===7457?clockQuarter():frameCounter===14913?(clockQuarter(),clockHalf()):frameCounter===22371?clockQuarter():frameCounter===29829&&!step5Mode?(clockQuarter(),clockHalf(),interruptInhibit||(frameIrqWanted$1=!0)):frameCounter===37281&&(clockQuarter(),clockHalf())}function getOutput(){let o=[outputOffset,outputValues];return outputOffset=0,o}function peek$2(o){if(o===16405){let e=0;return e|=p1Counter>0?1:0,e|=p2Counter>0?2:0,e|=triCounter>0?4:0,e|=noiseCounter>0?8:0,e|=dmcBytesLeft>0?16:0,e|=frameIrqWanted$1?64:0,e|=dmcIrqWanted$1?128:0,e}return 0}function read$2(o){if(o===16405){let e=0;return e|=p1Counter>0?1:0,e|=p2Counter>0?2:0,e|=triCounter>0?4:0,e|=noiseCounter>0?8:0,e|=dmcBytesLeft>0?16:0,e|=frameIrqWanted$1?64:0,e|=dmcIrqWanted$1?128:0,frameIrqWanted$1=!1,e}return 0}function write$2(o,e){switch(o){case 16384:{p1Duty=(e&192)>>6,p1Volume=e&15,p1CounterHalt=(e&32)>0,p1ConstantVolume=(e&16)>0;break}case 16385:{p1SweepEnabled=(e&128)>0,p1SweepPeriod=(e&112)>>4,p1SweepNegate=(e&8)>0,p1SweepShift=e&7,p1SweepReload=!0,updateSweepP1();break}case 16386:{p1Timer&=1792,p1Timer|=e,updateSweepP1();break}case 16387:{p1Timer&=255,p1Timer|=(e&7)<<8,p1DutyIndex=0,enablePulse1&&(p1Counter=lengthLoadValues[(e&248)>>3]),p1EnvelopeStart=!0,updateSweepP1();break}case 16388:{p2Duty=(e&192)>>6,p2Volume=e&15,p2CounterHalt=(e&32)>0,p2ConstantVolume=(e&16)>0;break}case 16389:{p2SweepEnabled=(e&128)>0,p2SweepPeriod=(e&112)>>4,p2SweepNegate=(e&8)>0,p2SweepShift=e&7,p2SweepReload=!0,updateSweepP2();break}case 16390:{p2Timer&=1792,p2Timer|=e,updateSweepP2();break}case 16391:{p2Timer&=255,p2Timer|=(e&7)<<8,p2DutyIndex=0,enablePulse2&&(p2Counter=lengthLoadValues[(e&248)>>3]),p2EnvelopeStart=!0,updateSweepP2();break}case 16392:{triCounterHalt=(e&128)>0,triLinearReload=e&127;break}case 16394:{triTimer&=1792,triTimer|=e;break}case 16395:{triTimer&=255,triTimer|=(e&7)<<8,enableTriangle&&(triCounter=lengthLoadValues[(e&248)>>3]),triReloadLinear=!0;break}case 16396:{noiseCounterHalt=(e&32)>0,noiseConstantVolume=(e&16)>0,noiseVolume=e&15;break}case 16398:{noiseTonal=(e&128)>0,noiseTimer=noiseLoadValues[e&15]-1;break}case 16399:{enableNoise&&(noiseCounter=lengthLoadValues[(e&248)>>3]),noiseEnvelopeStart=!0;break}case 16400:{dmcInterrupt=(e&128)>0,dmcLoop=(e&64)>0,dmcTimer=dmcLoadValues[e&15]-1,dmcInterrupt||(dmcIrqWanted$1=!1);break}case 16401:{dmcOutput=e&127;break}case 16402:{dmcSampleAddress=49152|e<<6;break}case 16403:{dmcSampleLength=(e<<4)+1;break}case 16405:{enableNoise=(e&8)>0,enableTriangle=(e&4)>0,enablePulse2=(e&2)>0,enablePulse1=(e&1)>0,enablePulse1||(p1Counter=0),enablePulse2||(p2Counter=0),enableTriangle||(triCounter=0),enableNoise||(noiseCounter=0),(e&16)>0?dmcBytesLeft===0&&(dmcBytesLeft=dmcSampleLength,dmcAddress=dmcSampleAddress):dmcBytesLeft=0,dmcIrqWanted$1=!1;break}case 16407:{step5Mode=(e&128)>0,interruptInhibit=(e&64)>0,interruptInhibit&&(frameIrqWanted$1=!1),frameCounter=0,step5Mode&&(clockQuarter(),clockHalf());break}}}let banked,origBanks,loadAdr,banks=new Uint8Array(8),data,romData,maxBanks=1,prgRam=new Uint8Array(8192);function set_data(o){data=o}function set_loadAdr(o){loadAdr=o}function set_banked(o){banked=o}function set_banks(o){banks=o,origBanks=o}function reset$1(){for(let o=0;o<prgRam.length;o++)prgRam[o]=0;for(let o=0;o<8;o++)banks[o]=origBanks[o];if(banked){loadAdr&=4095;let o=data.length-128+loadAdr;maxBanks=Math.ceil(o/4096),romData=new Uint8Array(maxBanks*4096);for(let e=loadAdr;e<romData.length&&!(128+(e-loadAdr)>=data.length);e++)romData[e]=data[128+(e-loadAdr)]}else{romData=new Uint8Array(32768);for(let o=loadAdr;o<65536&&!(128+(o-loadAdr)>=data.length);o++)romData[o-32768]=data[128+(o-loadAdr)]}}function read$1(o){if(o<24576)return 0;if(o<32768)return prgRam[o&8191];if(banked){let e=(o>>12)-8;return romData[banks[e]*4096+(o&4095)]}else return romData[o&32767]}function write$1(o,e){if(!(o<24568)){if(o<24576){banks[o-24568]=e%maxBanks;return}if(o<32768){prgRam[o&8191]=e;return}}}let sq1Index=0,sq2Index=0,triIndex=0,noiseIndex=0;function resetNSF(){sq1Index=0,sq2Index=0,triIndex=0,noiseIndex=0}const IMP=0,IMM=1,ZP=2,ZPX=3,ZPY=4,IZX=5,IZY=6,ABS=7,ABX=8,ABY=9,IND=11,REL=12,IZYr=13,ABXr=14,ABYr=15,A=0,X=1,Y=2,SP=3,PC=0;let r=new Uint8Array(4),br=new Uint16Array(1);function set_pc(o){br[0]=o}let n$1=!1,v=!1,d=!1,i=!0,z=!1,c=!1;function setIrqWanted(o){irqWanted=o}let irqWanted=!1,nmiWanted=!1,cyclesLeft=7;function reset(){r[A]=0,r[X]=0,r[Y]=0,r[SP]=253,br[PC]=read(65532)|read(65533)<<8,n$1=!1,v=!1,d=!1,i=!0,z=!1,c=!1,irqWanted=!1,nmiWanted=!1,cyclesLeft=7}const addressingModes=[IMP,IZX,IMP,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZYr,IMP,IZY,ZPX,ZPX,ZPX,ZPX,IMP,ABYr,IMP,ABY,ABXr,ABXr,ABX,ABX,ABS,IZX,IMP,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZYr,IMP,IZY,ZPX,ZPX,ZPX,ZPX,IMP,ABYr,IMP,ABY,ABXr,ABXr,ABX,ABX,IMP,IZX,IMP,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZYr,IMP,IZY,ZPX,ZPX,ZPX,ZPX,IMP,ABYr,IMP,ABY,ABXr,ABXr,ABX,ABX,IMP,IZX,IMP,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,IND,ABS,ABS,ABS,REL,IZYr,IMP,IZY,ZPX,ZPX,ZPX,ZPX,IMP,ABYr,IMP,ABY,ABXr,ABXr,ABX,ABX,IMM,IZX,IMM,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZY,IMP,IZY,ZPX,ZPX,ZPY,ZPY,IMP,ABY,IMP,ABY,ABX,ABX,ABY,ABY,IMM,IZX,IMM,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZYr,IMP,IZYr,ZPX,ZPX,ZPY,ZPY,IMP,ABYr,IMP,ABYr,ABXr,ABXr,ABYr,ABYr,IMM,IZX,IMM,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZYr,IMP,IZY,ZPX,ZPX,ZPX,ZPX,IMP,ABYr,IMP,ABY,ABXr,ABXr,ABX,ABX,IMM,IZX,IMM,IZX,ZP,ZP,ZP,ZP,IMP,IMM,IMP,IMM,ABS,ABS,ABS,ABS,REL,IZYr,IMP,IZY,ZPX,ZPX,ZPX,ZPX,IMP,ABYr,IMP,ABY,ABXr,ABXr,ABX,ABX],cycles=[7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7];function cycle$1(){if(cyclesLeft===0){let o=read(br[PC]++),e=addressingModes[o];cyclesLeft=cycles[o],(nmiWanted||irqWanted&&!i)&&(br[PC]--,nmiWanted?(nmiWanted=!1,o=256):o=257,e=IMP,cyclesLeft=7);let s=getAdr(e);s<32768?setRamCdl(s,1):setRomCdl(s,1),handleNotes(o,s),functions[o].call(null,s,o)}cyclesLeft--}function handleNotes(o,e){o===16&&e===28&&(r[A]<128?(r[X]===0&&(sq1Stream$1.length===sq1Index?r[A]=94:(r[A]=sq1Stream$1[sq1Index],sq1Index++)),r[X]===1&&(sq2Stream$1.length===sq2Index?r[A]=94:(r[A]=sq2Stream$1[sq2Index],sq2Index++)),r[X]===2&&(triStream$1.length===triIndex?r[A]=94:(r[A]=triStream$1[triIndex],triIndex++)),r[X]===3&&(noiseStream$1.length===noiseIndex?r[A]=94:(r[A]=noiseStream$1[noiseIndex],noiseIndex++))):r[A]<160&&(r[X]===0&&(sq1Stream$1.length===sq1Index?r[A]=138:(r[A]=sq1Stream$1[sq1Index],sq1Index++)),r[X]===1&&(sq2Stream$1.length===sq2Index?r[A]=138:(r[A]=sq2Stream$1[sq2Index],sq2Index++)),r[X]===2&&(triStream$1.length===triIndex?r[A]=138:(r[A]=triStream$1[triIndex],triIndex++)),r[X]===3&&(noiseStream$1.length===noiseIndex?r[A]=138:(r[A]=noiseStream$1[noiseIndex],noiseIndex++))))}function getP(o){let e=0;return e|=n$1?128:0,e|=v?64:0,e|=d?8:0,e|=i?4:0,e|=z?2:0,e|=c?1:0,e|=32,e|=o?16:0,e}function setP(o){n$1=(o&128)>0,v=(o&64)>0,d=(o&8)>0,i=(o&4)>0,z=(o&2)>0,c=(o&1)>0}function setZandN(o){o&=255,z=o===0,n$1=o>127}function getSigned(o){return o>127?-(256-o):o}function doBranch(o,e){o&&(cyclesLeft++,br[PC]>>8!==br[PC]+e>>8&&cyclesLeft++,br[PC]+=e)}function getAdr(o){switch(o){case IMP:return 0;case IMM:return br[PC]++;case ZP:return read(br[PC]++);case ZPX:return read(br[PC]++)+r[X]&255;case ZPY:return read(br[PC]++)+r[Y]&255;case IZX:{let e=read(br[PC]++)+r[X]&255;return read(e)|read(e+1&255)<<8}case IZY:{let e=read(br[PC]++);return(read(e)|read(e+1&255)<<8)+r[Y]&65535}case IZYr:{let e=read(br[PC]++),s=read(e)|read(e+1&255)<<8;return s>>8<s+r[Y]>>8&&cyclesLeft++,s+r[Y]&65535}case ABS:{let e=read(br[PC]++);return e|=read(br[PC]++)<<8,e}case ABX:{let e=read(br[PC]++);return e|=read(br[PC]++)<<8,e+r[X]&65535}case ABXr:{let e=read(br[PC]++);return e|=read(br[PC]++)<<8,e>>8<e+r[X]>>8&&cyclesLeft++,e+r[X]&65535}case ABY:{let e=read(br[PC]++);return e|=read(br[PC]++)<<8,e+r[Y]&65535}case ABYr:{let e=read(br[PC]++);return e|=read(br[PC]++)<<8,e>>8<e+r[Y]>>8&&cyclesLeft++,e+r[Y]&65535}case IND:{let e=read(br[PC]++),s=read(br[PC]++),l=read(e|s<<8);return l|=read(e+1&255|s<<8)<<8,l}case REL:{let e=read(br[PC]++);return getSigned(e)}}}function uni(o,e){}function ora(o){r[A]|=read(o),setZandN(r[A])}function and(o){r[A]&=read(o),setZandN(r[A])}function eor(o){r[A]^=read(o),setZandN(r[A])}function adc(o){let e=read(o),s=r[A]+e+(c?1:0);c=s>255,v=(r[A]&128)===(e&128)&&(e&128)!==(s&128),r[A]=s,setZandN(r[A])}function sbc(o){let e=read(o)^255,s=r[A]+e+(c?1:0);c=s>255,v=(r[A]&128)===(e&128)&&(e&128)!==(s&128),r[A]=s,setZandN(r[A])}function cmp(o){let e=read(o)^255,s=r[A]+e+1;c=s>255,setZandN(s&255)}function cpx(o){let e=read(o)^255,s=r[X]+e+1;c=s>255,setZandN(s&255)}function cpy(o){let e=read(o)^255,s=r[Y]+e+1;c=s>255,setZandN(s&255)}function dec(o){let e=read(o)-1&255;setZandN(e),write(o,e)}function dex(o){r[X]--,setZandN(r[X])}function dey(o){r[Y]--,setZandN(r[Y])}function inc(o){let e=read(o)+1&255;setZandN(e),write(o,e)}function inx(o){r[X]++,setZandN(r[X])}function iny(o){r[Y]++,setZandN(r[Y])}function asla(o){let e=r[A]<<1;c=e>255,setZandN(e),r[A]=e}function asl(o){let e=read(o)<<1;c=e>255,setZandN(e),write(o,e)}function rola(o){let e=r[A]<<1|(c?1:0);c=e>255,setZandN(e),r[A]=e}function rol(o){let e=read(o)<<1|(c?1:0);c=e>255,setZandN(e),write(o,e)}function lsra(o){let e=r[A]&1,s=r[A]>>1;c=e>0,setZandN(s),r[A]=s}function lsr(o){let e=read(o),s=e&1,l=e>>1;c=s>0,setZandN(l),write(o,l)}function rora(o){let e=r[A]&1,s=r[A]>>1|(c?1:0)<<7;c=e>0,setZandN(s),r[A]=s}function ror(o){let e=read(o),s=e&1,l=e>>1|(c?1:0)<<7;c=s>0,setZandN(l),write(o,l)}function lda(o){r[A]=read(o),setZandN(r[A])}function sta(o){write(o,r[A])}function ldx(o){r[X]=read(o),setZandN(r[X])}function stx(o){write(o,r[X])}function ldy(o){r[Y]=read(o),setZandN(r[Y])}function sty(o){write(o,r[Y])}function tax(o){r[X]=r[A],setZandN(r[X])}function txa(o){r[A]=r[X],setZandN(r[A])}function tay(o){r[Y]=r[A],setZandN(r[Y])}function tya(o){r[A]=r[Y],setZandN(r[A])}function tsx(o){r[X]=r[SP],setZandN(r[X])}function txs(o){r[SP]=r[X]}function pla(o){r[A]=read(256+(++r[SP]&255)),setZandN(r[A])}function pha(o){write(256+r[SP]--,r[A])}function plp(o){setP(read(256+(++r[SP]&255)))}function php(o){write(256+r[SP]--,getP(!0))}function bpl(o){doBranch(!n$1,o)}function bmi(o){doBranch(n$1,o)}function bvc(o){doBranch(!v,o)}function bvs(o){doBranch(v,o)}function bcc(o){doBranch(!c,o)}function bcs(o){doBranch(c,o)}function bne(o){doBranch(!z,o)}function beq(o){doBranch(z,o)}function brk(o){let e=br[PC]+1&65535;write(256+r[SP]--,e>>8),write(256+r[SP]--,e&255),write(256+r[SP]--,getP(!0)),i=!0,br[PC]=read(65534)|read(65535)<<8}function rti(o){setP(read(256+(++r[SP]&255)));let e=read(256+(++r[SP]&255));e|=read(256+(++r[SP]&255))<<8,br[PC]=e}function jsr(o){let e=br[PC]-1&65535;write(256+r[SP]--,e>>8),write(256+r[SP]--,e&255),br[PC]=o}function rts(o){let e=read(256+(++r[SP]&255));e|=read(256+(++r[SP]&255))<<8,br[PC]=e+1}function jmp(o){br[PC]=o}function bit(o){let e=read(o);n$1=(e&128)>0,v=(e&64)>0,z=(r[A]&e)===0}function clc(o){c=!1}function sec(o){c=!0}function cld(o){d=!1}function sed(o){d=!0}function cli(o){i=!1}function sei(o){i=!0}function clv(o){v=!1}function nop(o){}function irq(o){let e=br[PC];write(256+r[SP]--,e>>8),write(256+r[SP]--,e&255),write(256+r[SP]--,getP(!1)),i=!0,br[PC]=read(65534)|read(65535)<<8}function nmi(o){let e=br[PC];write(256+r[SP]--,e>>8),write(256+r[SP]--,e&255),write(256+r[SP]--,getP(!1)),i=!0,br[PC]=read(65530)|read(65531)<<8}function kil(o){br[PC]--}function slo(o){let e=read(o)<<1;c=e>255,write(o,e),r[A]|=e,setZandN(r[A])}function rla(o){let e=read(o)<<1|(c?1:0);c=e>255,write(o,e),r[A]&=e,setZandN(r[A])}function sre(o){let e=read(o),s=e&1,l=e>>1;c=s>0,write(o,l),r[A]^=l,setZandN(r[A])}function rra(o){let e=read(o),s=e&1,l=e>>1|(c?1:0)<<7;write(o,l);let a=r[A]+l+s;c=a>255,v=(r[A]&128)===(l&128)&&(l&128)!==(a&128),r[A]=a,setZandN(r[A])}function sax(o){write(o,r[A]&r[X])}function lax(o){r[A]=read(o),r[X]=r[A],setZandN(r[X])}function dcp(o){let e=read(o)-1&255;write(o,e),e^=255;let s=r[A]+e+1;c=s>255,setZandN(s&255)}function isc(o){let e=read(o)+1&255;write(o,e),e^=255;let s=r[A]+e+(c?1:0);c=s>255,v=(r[A]&128)===(e&128)&&(e&128)!==(s&128),r[A]=s,setZandN(r[A])}function anc(o){r[A]&=read(o),setZandN(r[A]),c=n$1}function alr(o){r[A]&=read(o);let e=r[A]&1,s=r[A]>>1;c=e>0,setZandN(s),r[A]=s}function arr(o){r[A]&=read(o);let e=r[A]>>1|(c?1:0)<<7;setZandN(e),c=(e&64)>0,v=(e&64^(e&32)<<1)>0,r[A]=e}function axs(o){let e=read(o)^255,l=(r[A]&r[X])+e+1;c=l>255,r[X]=l,setZandN(r[X])}const functions=[brk,ora,kil,slo,nop,ora,asl,slo,php,ora,asla,anc,nop,ora,asl,slo,bpl,ora,kil,slo,nop,ora,asl,slo,clc,ora,nop,slo,nop,ora,asl,slo,jsr,and,kil,rla,bit,and,rol,rla,plp,and,rola,anc,bit,and,rol,rla,bmi,and,kil,rla,nop,and,rol,rla,sec,and,nop,rla,nop,and,rol,rla,rti,eor,kil,sre,nop,eor,lsr,sre,pha,eor,lsra,alr,jmp,eor,lsr,sre,bvc,eor,kil,sre,nop,eor,lsr,sre,cli,eor,nop,sre,nop,eor,lsr,sre,rts,adc,kil,rra,nop,adc,ror,rra,pla,adc,rora,arr,jmp,adc,ror,rra,bvs,adc,kil,rra,nop,adc,ror,rra,sei,adc,nop,rra,nop,adc,ror,rra,nop,sta,nop,sax,sty,sta,stx,sax,dey,nop,txa,uni,sty,sta,stx,sax,bcc,sta,kil,uni,sty,sta,stx,sax,tya,sta,txs,uni,uni,sta,uni,uni,ldy,lda,ldx,lax,ldy,lda,ldx,lax,tay,lda,tax,uni,ldy,lda,ldx,lax,bcs,lda,kil,lax,ldy,lda,ldx,lax,clv,lda,tsx,uni,ldy,lda,ldx,lax,cpy,cmp,nop,dcp,cpy,cmp,dec,dcp,iny,cmp,dex,axs,cpy,cmp,dec,dcp,bne,cmp,kil,dcp,nop,cmp,dec,dcp,cld,cmp,nop,dcp,nop,cmp,dec,dcp,cpx,sbc,nop,isc,cpx,sbc,inc,isc,inx,sbc,nop,sbc,cpx,sbc,inc,isc,beq,sbc,kil,isc,nop,sbc,inc,isc,sed,sbc,nop,isc,nop,sbc,inc,isc,nmi,irq];function read(o){return o&=65535,o<8192?ram[o&2047]:o<16368?0:o<16384?callArea[o&15]:o<16416?o===16404||o===16406||o===16407?0:read$2(o):read$1(o)}function write(o,e){if(o&=65535,o<8192){ram[o&2047]=e;return}if(!(o<16384)){if(o<16416){if(o===16404||o===16406)return;write$2(o,e);return}write$1(o,e)}}var out_buffer="";function appendBuffer(o){out_buffer=out_buffer+o}function clearBuffer(){out_buffer=""}function _print(o){appendBuffer(o)}function _pr(o){arguments.length>1?appendBuffer(Array.from(arguments).join(" ")):appendBuffer(o)}function mal_throw(o){throw new Error(o)}function pr_str(){return Array.prototype.map.call(arguments,function(o){return _pr_str(o,!0)}).join(" ")}function str(){const o=Array.from(arguments).filter(e=>e!==null);return Array.prototype.map.call(o,function(e){return _pr_str(e,!1)}).join("")}function prn(o){arguments.length>1?appendBuffer(Array.from(arguments).join(" ")+`
`):appendBuffer(o+`
`)}function println(){_println.apply({},Array.prototype.map.call(arguments,function(o){return appendBuffer(o+`
`),_pr_str(o,!1)}))}function consolePrint(){_println.apply({},Array.prototype.map.call(arguments,function(o){return _pr_str(o,!1)}))}function slurp(o){if(typeof require<"u")return require("fs").readFileSync(o,"utf-8");var e=new XMLHttpRequest;if(e.open("GET",o,!1),e.send(),e.status==200)return e.responseText;throw new Error("Failed to slurp file: "+o)}function time_ms(){return new Date().getTime()}function assoc(o){o===null&&(o=new Map);var e=_clone(o),s=[e].concat(Array.prototype.slice.call(arguments,1));return _assoc_BANG.apply(null,s)}function dissoc(o){var e=_clone(o),s=[e].concat(Array.prototype.slice.call(arguments,1));return _dissoc_BANG.apply(null,s)}function get(o,e,s){if(_vector_Q(o)||_string_Q(o))return o[e];if(_hash_map_Q(o)){for(const[l,a]of o)if(_equal_Q(l,e))return a;return s}return o!=null?o.get(e)||s:null}function contains_Q(o,e){if(o===null)return!1;if(_hash_map_Q(o)){for(const[s,l]of o)if(_equal_Q(s,e))return!0}if(_set_Q(o)){for(const s of o)if(_equal_Q(s,e))return!0;return!1}return e in o}function keys(o){return Array.from(o.keys())}function vals(o){return Array.from(o.values())}function cons(o,e){return e!=null&&e.name==="LazySeq"?lazyCons(o,e):[o].concat(e)}function lazyCons(o,e){return lazy(function*(){yield o,yield*iterable(e)})}function concat(o){return o=o||[],o.concat.apply(o,Array.prototype.slice.call(arguments,1))}function vec(o){if(_list_Q(o)){var e=Array.prototype.slice.call(o,0);return e.__isvector__=!0,e}else return o}function re_matches(o,e){let s=o.exec(e);if(s&&e===s[0])return s.length===1?s[0]:s}function re_find(o,e){let s=o.exec(e);if(s)return s.length===1?s[0]:s}function re_seq(o,e){if(e===null)return null;const l=[...e.matchAll(o)].map(a=>a[0]);return l.length===0?null:l}function nth(o,e,s){if(_lazy_iterable_Q(o)){if(o){var l=void 0;if(o instanceof Array)l=o[e];else{let a=iterable(o),h=0;for(let f of a)if(h++==e){l=f;break}}if(l!==void 0)return l}return s}return e<o.length?o[e]:s}function first(o){return _lazy_range_Q(o)?0:o===null||o.length===0?null:seq(o)[0]}function second(o){return o===null||o.length===0?null:seq(o)[1]}function last(o){return o===null||o.length===0?null:seq(o)[seq(o).length-1]}function rest(o){return _lazy_iterable_Q(o)||_lazy_seq_Q(o)?lazy(function*(){let e=!0;for(const s of iterable(coll))e?e=!1:yield s}):o==null||o.length===0?[]:seq(o).slice(1)}function empty_Q(o){return _set_Q(o)||_hash_map_Q(o)?o.size===0:o?o.length===0:!0}function count(o){return _hash_map_Q(o)?o.size:Array.isArray(o)?o.length:_set_Q(o)?o.size:o===null?0:Object.keys(o).length}function conj(o){if(_iterate_Q(o))return"TODO: implement iterate on conj";if(_list_Q(o))return Array.prototype.slice.call(arguments,1).reverse().concat(o);if(_vector_Q(o)){var e=o.concat(Array.prototype.slice.call(arguments,1));return e.__isvector__=!0,e}else{if(_set_Q(o))return o.add(arguments[1]);if(_hash_map_Q(o)){if(arguments.length===2&&arguments[1].size===0)return o;var s=new Map(o);const a=Array.prototype.slice.call(arguments,1);let h=[];for(const f of a)_hash_map_Q(f)?h=h.concat(seq(f)):h.push(f);for(var l=0;l<h.length;l++)s.set(h[l][0],h[l][1]);return s}}}function re_pattern(o){return new RegExp(o,"g")}function split(o,e){return o.split(e)}function seq(o){return _list_Q(o)?o.length>0?o:null:_iterate_Q(o)?o.realized:_vector_Q(o)?o.length>0?Array.prototype.slice.call(o,0):null:_string_Q(o)?o.length>0?o.split(""):null:_hash_map_Q(o)?o.size>0?[...o.entries()]:null:_set_Q(o)?Array.from(o):o===null?null:o}function apply(o){var e=Array.prototype.slice.call(arguments,1);return o.apply(o,e.slice(0,e.length-1).concat(e[e.length-1]))}function with_meta(o,e){var s=_clone(o);return s.__meta__=e,s}function meta(o){if(!_sequential_Q(o)&&!_hash_map_Q(o)&&!_function_Q(o)&&!_symbol_Q(o))throw new Error("attempt to get metadata from: "+_obj_type(o));return o.__meta__}function deref(o){return o.val}function reset_BANG(o,e){return o.val=e}function swap_BANG(o,e){var s=[o.val].concat(Array.prototype.slice.call(arguments,2));return o.val=e.apply(e,s),o.val}function js_eval(str){return js_to_mal(eval(str.toString()))}function js_method_call(o){var e=Array.prototype.slice.call(arguments,1),s=resolve_js(o),l=s[0],a=s[1],h=a.apply(l,e);return js_to_mal(h)}function toSet(o){var e=new Set;for(const s of seq(o))contains_Q(e,s)||e.add(s);return e}function _union(o,e){const s=new Set(o);for(const l of e)contains_Q(s,l)||s.add(l);return s}function _intersection(o,e){const s=new Set;for(const l of e)contains_Q(o,l)&&s.add(l);return s}function setDelete(o,e){var s=new Set;for(const l of o)_equal_Q(l,e)||s.add(l);return s}function symmetricDifference(o,e){var s=new Set(o);for(const l of e)contains_Q(s,l)?s=setDelete(s,l):s.add(l);return s}function _difference(o,e){var s=new Set(o);for(const l of e)s=setDelete(s,l);return s}function _disj(o){var e=Array.from(arguments).slice(1),s=_clone(o);for(let l=0;l<e.length;l++)s.delete(e[l]);return s}function _is(o){return!!o}function resolve_js(str){if(str.match(/\./)){var re=/^(.*)\.[^\.]*$/,match=re.exec(str);return[eval(match[1]),eval(str)]}else return[GLOBAL,eval(str)]}function js_to_mal(o){if(o==null)return null;var e=[],s=JSON.stringify(o,function(l,a){if(typeof a=="object"&&a!==null){if(e.indexOf(a)!==-1)return;e.push(a)}return a});return e=null,JSON.parse(s)}function int(o){return _number_Q(o)?Math.floor(o):o[0]==="\\"?o.charCodeAt(1):o.charCodeAt(0)}function double(o){return o}function char(o){return String.fromCharCode(o)}function filter(o,e){return _lazy_iterable_Q(e)?lazy(function*(){for(const s of iterable(coll))pred(s)&&(yield s)}):_iterate_Q(e)?"TODO: filter iterate object":!e||e.length===0?[]:_set_Q(o)?seq(e).filter(function(s){return o.has(s)}):seq(e).filter(function(s){return o(s)})}function min(){return Math.min.apply(null,arguments)}function max(){return Math.max.apply(null,arguments)}function _pow(o,e){return Math.pow(o,e)}function _abs(o){return Math.abs(o)}function sum(){if(Array.from(arguments).length===0)return 0;var o=Array.from(arguments).reduce((e,s)=>e+s,0);return Array.from(arguments).every(function(e){return _ratio_Q()})&&(o=o),o}function subtract(){if(arguments.length===1)return subtract(0,arguments[0]);var o=Array.from(arguments).slice(1).reduce((e,s)=>e-s,arguments[0]);return Array.from(arguments).every(function(e){return _ratio_Q()})&&(o=o),o}function product(){if(arguments.length===0)return 1;var o=Array.from(arguments).reduce((e,s)=>e*s,1);return Array.from(arguments).every(function(e){return _ratio_Q()})&&(o=o),o}function divide(o,e){return o/e}class LazyIterable{constructor(e){this.name="LazyIterable",this.gen=e}[Symbol.iterator](){return this.gen()}}function lazy(o){return new LazyIterable(o)}function seqable_QMARK_(o){return typeof o=="string"||o===null||o===void 0||Symbol.iterator in o}function iterable(o){return o==null?[]:seqable_QMARK_(o)?o:Object.entries(o)}class LazySeq{constructor(e){this.name="LazySeq",this.f=e}*[Symbol.iterator](){yield*iterable(this.f())}}function take(o,e){if(empty_Q(e))return[];if(_lazy_range_Q(e))return range(0,o);if(_lazy_seq_Q(e)||_lazy_iterable_Q(e))return lazy(function*(){let s=o-1;for(const l of iterable(e))if(s-->=0&&(yield l),s<0)return});if(_iterate_Q(e)){for(let s=0;s<o;s++)e.next();return e.realized.slice(0,-1)}if(_cycle_Q(e)){const s=Math.floor(o/e.coll.length),l=o%e.coll.length;let a=[];for(let h=0;h<s;h++)a=a.concat(e.coll);return l!=0&&(a=a.concat(e.coll.slice(0,l))),a}return seq(e).slice(0,o)}function drop(o,e){return e===null?[]:empty_Q(e)?[]:seq(e).slice(o)}function repeat(o,e){return Array(o).fill(e)}function*makeRangeIterator(o=0,e=1/0,s=1){let l=0;for(let a=o;a<e;a+=s)l++,yield a;return l}function range(o,e,s){if(arguments.length===0){var l=makeRangeIterator();return l.name="lazyRange",l}if(s<0){var a=[];for(let f=o;f>e;f+=s)a.push(f);return a}if(!e)return o===0?[]:range(0,o);var a=[];if(s){for(let h=o;h<e;h+=s)a.push(h);return a}for(let h=o;h<e;h++)a.push(h);return a}function iterate(o,e){var s=e;return lazy(function*(){for(;;)yield s,s=o(s)})}class Cycle{constructor(e){this.name="Cycle",this.coll=e}}function cycle(o){return new Cycle(o)}function mod(o,e){return o%e}function sort(o){if(_string_Q(o))return o.split("").sort().join("");if(_list_Q(o))return o.sort(subtract);if(_hash_map_Q(o))return new Map(Array.from(o).sort(subtract));if(_set_Q(o))return new Set(Array.from(o).sort(subtract));var e=o.sort(subtract);return e.__isvector__=!0,e}function makeComparator(o){return function(e,s){let l=o(e,s);return _number_Q(l)?l:l?-1:o(s,e)?1:0}}function sort_by(){if(arguments.length===2)var o=arguments[0],e=arguments[1],s=subtract;if(arguments.length===3)var o=arguments[0],s=makeComparator(arguments[1]),e=arguments[2];if(_keyword_Q(o))var l=(h,f)=>s(get(h,o),get(f,o));else var l=(f,u)=>s(o(f),o(u));if(_string_Q(e))return e.split("").sort(l).join("");if(_list_Q(e))return e.sort(l);if(_hash_map_Q(e))return new Map(Array.from(e).sort(l));if(_set_Q(e))return new Set(Array.from(e).sort(l));var a=e.sort(l);return a.__isvector__=!0,a}function pop(o){if(_list_Q(o))return o.slice(1);var e=o.slice(0,-1);return e.__isvector__=!0,e}function peek$1(o){return _list_Q(o)?o[0]:o[o.length-1]}function upperCase(o){return o.toUpperCase()}function lowerCase(o){return o.toLowerCase()}function int_Q(o){return Number.isInteger(o)}function _join(o,e){return e?e.join(o):o.join("")}function _replace(o,e,s){return o.replace(e,s)}function rand_int(){return Math.floor(Math.random()*arguments[0])}function rand_nth(){const o=Math.floor(Math.random()*arguments[0].length);return arguments[0][o]}function _round(o){return Math.round(o)}function _sin(o){return Math.sin(o)}function _sqrt(o){return Math.sqrt(o)}function _substring(o,e,s){return s?o.substring(e,s):o.substring(e,o.length)}function dec2bin(o){return(o>>>0).toString(2)}function repeatedly(o,e){let s=[];for(let l=0;l<o;l++)s.push(e());return s}function _subvec(o,e,s){return o.slice(e,s)}function _trim(o){return o.trim()}function printEnv(){console.log(repl_env)}function _require(o){switch(o){case"zip":evalString("(do "+zip+")");break;case"set":evalString("(do "+clj_set+")");break}}function downloadObjectAsJson(o,e){var s="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(o)),l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download",e),document.body.appendChild(l),l.click(),l.remove()}function spit_json(o,e){return downloadObjectAsJson(e,o)}function map_indexed(o,e){let s=[],l=0;for(const a of e)s.push(o(l,a)),l++;return s}function _isNaN(o){return!!isNaN(o)}function _map(o,e){var s=o,l=e.length,a=[...Array(l).keys()],h=a.map(b=>_symbol("s"+b)),f=e.map(b=>seq(b)),u=a.flatMap(b=>{var k=f[b];k.__isvector__=!0;var S=[h[b],k];return S.__isvector__=!0,S}),p=[];p.__isvector__=!0,u.push(_symbol("res"),p),u.__isvector__=!0;var m=[_symbol("or")].concat(h.map(b=>[_symbol("empty?"),b])),g=[_symbol("recur")].concat(h.map(b=>[_symbol("rest"),b])),y=[_symbol("conj"),_symbol("res")];y.push([s].concat(h.map(b=>[_symbol("first"),b])));var w=g.concat([y]),x=[_symbol("loop")];return x.push(u),x.push([_symbol("if"),m,[_symbol("apply"),_symbol("list"),_symbol("res")],w]),EVAL(x,repl_env)}function appendPath(o,e,s,l,a){var h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",o),h.style.stroke=e||"black",h.style.strokeWidth="1",h.style.fill="lightgreen",a?h.setAttribute("transform","translate("+s.toString()+","+l.toString()+") scale("+a+")"):typeof s=="number"&&h.setAttribute("transform","translate("+s.toString()+","+l.toString()+")"),svgGroup.appendChild(h)}function clearSVG(){svgGroup.innerHTML=""}function hex2bin(o){return parseInt(o,16).toString(2).padStart(8,"0")}function hex2DPCM(o){return o.match(/../g).map(l=>l.split("").reverse().join("")).map(l=>hex2bin(l)).join("")}function loopDPCM(o,e){return hex2DPCM(o).repeat(e).split("").map(s=>parseInt(s,10))}function dpcm2pcm(o,e){let s=[];for(let h=0;h<o.length;h++)s.push(Math.floor(h*e));let l=32,a=[32];for(let h=0;h<o.length*e;h++){h===s[0]&&(o.shift(),s.shift());let f=o[0]==0?l-1:l+1;f>1&&f<63&&(l=f),a.push(l)}return scalePCM(a)}function scalePCM(o){let e=[];for(let s=0;s<o.length;s++)e.push(o[s]/64*2-1);return e}const sample0=document.getElementById("dpcm0"),sample1=document.getElementById("dpcm1"),sample2=document.getElementById("dpcm2"),sample3=document.getElementById("dpcm3");let dpcm_0,dpcm_1,dpcm_2,dpcm_3;sample0.onchange=o=>{const e=sample0.files[0];var s=new FileReader;s.readAsArrayBuffer(e),s.onload=l=>{var a=new Uint8Array(l.target.result),h=Array.from(a).map(f=>f.toString(16).padStart(2,"0")).join("").toUpperCase();dpcm_0=h}};sample1.onchange=o=>{const e=sample1.files[0];var s=new FileReader;s.readAsArrayBuffer(e),s.onload=l=>{var a=new Uint8Array(l.target.result),h=Array.from(a).map(f=>f.toString(16).padStart(2,"0")).join("").toUpperCase();dpcm_1=h}};sample2.onchange=o=>{const e=sample2.files[0];var s=new FileReader;s.readAsArrayBuffer(e),s.onload=l=>{var a=new Uint8Array(l.target.result),h=Array.from(a).map(f=>f.toString(16).padStart(2,"0")).join("").toUpperCase();dpcm_2=h}};sample3.onchange=o=>{const e=sample3.files[0];var s=new FileReader;s.readAsArrayBuffer(e),s.onload=l=>{var a=new Uint8Array(l.target.result),h=Array.from(a).map(f=>f.toString(16).padStart(2,"0")).join("").toUpperCase();dpcm_3=h}};function dpcm0(){return dpcm_0}function dpcm1(){return dpcm_1}function dpcm2(){return dpcm_2}function dpcm3(){return dpcm_3}function playNSF(){resetNSF(),loadRom(nsfDriver)}function sq1Stream(o){return setSq1Stream(assembleStream(o)),sq1Stream$1}function sq2Stream(o){return setSq2Stream(assembleStream(o)),sq2Stream$1}function triStream(o){return setTriStream(assembleStream(o)),triStream$1}function noiseStream(o){return setNoiseStream(assembleStream(o)),noiseStream$1}var ns={env:printEnv,play:void 0,"play-nsf":playNSF,"sq1-stream":sq1Stream,"sq2-stream":sq2Stream,"tri-stream":triStream,"noise-stream":noiseStream,mix:mix$1,"dpcm-0":dpcm0,"dpcm-1":dpcm1,"dpcm-2":dpcm2,"dpcm-3":dpcm3,"dpcm-seq":dpcm_seq,"tri-seq":void 0,"drum-seq":void 0,"pulse0-seq":void 0,hex2bin,dec2bin,hex2dpcm:hex2DPCM,"loop-dpcm":loopDPCM,dpcm2pcm,"pulse1-seq":void 0,"pulse2-seq":void 0,"pulse3-seq":void 0,"channel-data":void 0,"midi->freq":void 0,"spit-wav":make_download,"append-path":appendPath,"clear-svg":clearSVG,"console-print":consolePrint,_map,print:_print,"Integer/parseInt":parseInt,"js/parseInt":parseInt,"js/Number.POSITIVE_INFINITY":Number.POSITIVE_INFINITY,"js/Number.NEGATIVE_INFINITY":Number.NEGATIVE_INFINITY,"nan?":_isNaN,pr:_pr,"spit-json":spit_json,LazySeq,"lazy-cons":lazyCons,require:_require,type:_obj_type,"=":allEqual,"==":allEqual,throw:mal_throw,"nil?":_nil_Q,"true?":_true_Q,is:_is,"false?":_false_Q,"ratio?":_ratio_Q,"number?":_number_Q,"string?":_string_Q,symbol:_symbol,"symbol?":_symbol_Q,"set?":_set_Q,keyword:_keyword,"keyword?":_keyword_Q,"map-entry?":_mapEntry_Q,"re-matches":re_matches,"re-find":re_find,"fn?":_fn_Q,"macro?":_macro_Q,char,"int?":int_Q,repeatedly,"rand-int":rand_int,"rand-nth":rand_nth,"Math/round":_round,"Math/sqrt":_sqrt,"Math/pow":_pow,"Math/abs":_abs,sin:_sin,abs:_abs,"Integer/toBinaryString":dec2bin,"str/trim":_trim,cycle,"str/split":split,"re-pattern":re_pattern,double,"pr-str":pr_str,str,prn,println,"read-string":read_str,slurp,lt:function(o,e){return o<e},lte:function(o,e){return o<=e},gt:function(o,e){return o>e},gte:function(o,e){return o>=e},"+":sum,"-":subtract,"*":product,"/":divide,inc:function(o){return o+1},"time-ms":time_ms,max,min,range,sort,peek:peek$1,pop,"lower-case":lowerCase,"upper-case":upperCase,"str/lower-case":lowerCase,"str/upper-case":upperCase,subs:_substring,subvec:_subvec,"map-indexed":map_indexed,list:_list,"list?":_list_Q,vector:_vector,"vector?":_vector_Q,"hash-map":_hash_map,"map?":_hash_map_Q,assoc,dissoc,get,"re-seq":re_seq,"contains?":contains_Q,keys,vals,int,rem:mod,iterate,walk,"sort-by":sort_by,"sequential?":_sequential_Q,cons,concat,vec,nth,first,second,rest,last,take,drop,"empty?":empty_Q,count,"apply*":apply,repeat,join:_join,"str/join":_join,"str/replace":_replace,conj,seq,filter,"with-meta":with_meta,meta,atom:_atom,"atom?":_atom_Q,deref,"reset!":reset_BANG,"swap!":swap_BANG,"js-eval":js_eval,".":js_method_call,set:toSet,disj:_disj,"set/union":_union,"set/intersection":_intersection,"set/symmetric-difference":symmetricDifference,"set/difference":_difference};function _obj_type(o){if(_symbol_Q(o))return"symbol";if(_hash_map_Q(o))return"hash-map";if(_list_Q(o))return"list";if(_vector_Q(o))return"vector";if(_lazy_range_Q(o))return"lazy-range";if(_lazy_iterable_Q(o))return"lazy-iterable";if(_lazy_seq_Q(o))return"lazy-seq";if(_iterate_Q(o))return"iterate";if(_cycle_Q(o))return"cycle";if(_function_Q(o))return"function";if(_set_Q(o))return"set";if(_nil_Q(o))return"nil";if(_regex_Q(o))return"regex";if(_true_Q(o))return"true";if(_false_Q(o))return"false";if(_atom_Q(o))return"atom";switch(typeof o){case"number":return"number";case"function":return"function";case"object":return"object";case"string":return o[0]=="Êž"?"keyword":"string";default:throw new Error("Unknown type '"+typeof o+"'")}}function _iterate_Q(o){return o===null?!1:typeof o=="object"?Object.hasOwn(o,"name")&&o.name==="Iterate":!1}function _cycle_Q(o){return o===null?!1:typeof o=="object"?Object.hasOwn(o,"name")&&o.name==="Cycle":!1}function _lazy_range_Q(o){return o===null?!1:typeof o=="object"?Object.hasOwn(o,"name")&&o.name==="lazyRange":!1}function _lazy_iterable_Q(o){return o===null?!1:typeof o=="object"?Object.hasOwn(o,"name")&&o.name==="LazyIterable":!1}function _lazy_seq_Q(o){return o===null?!1:typeof o=="object"?Object.hasOwn(o,"name")&&o.name==="LazySeq":!1}function _sequential_Q(o){return _list_Q(o)||_vector_Q(o)}function _equal_Q(o,e){var s=_obj_type(o),l=_obj_type(e);if(!(s===l||_sequential_Q(o)&&_sequential_Q(e)))return!1;switch(s){case"symbol":return o.value===e.value;case"set":return o.size===e.size&&[...o].every(u=>{for(const p of e)if(_equal_Q(p,u))return!0;return!1});case"list":case"vector":if(o.length!==e.length)return!1;for(var a=0;a<o.length;a++)if(!_equal_Q(o[a],e[a]))return!1;return!0;case"hash-map":if(o.size!==e.size)return!1;for(var[h,f]of o)if(!contains_Q(e,h)||!_equal_Q(get(o,h),get(e,h)))return!1;return!0;case"ratio":return o.equals(e);default:return o===e}}function allEqual(){const o=Array.from(arguments);return o.every(e=>_equal_Q(e,o[0]))}function _clone(o){var e;switch(_obj_type(o)){case"list":e=o.slice(0);break;case"vector":e=o.slice(0),e.__isvector__=!0;break;case"hash-map":e=new Map(o);break;case"function":e=o.clone();break;case"lazy-iterable":e=iterable(o);break;case"set":e=new Set(o);break;case"symbol":e=_symbol(o.value);break;default:throw new Error("clone of non-collection: "+_obj_type(o))}return Object.defineProperty(e,"__meta__",{enumerable:!1,writable:!0}),e}function _nil_Q(o){return o===null}function _true_Q(o){return o===!0}function _false_Q(o){return o===!1}function _number_Q(o){return typeof o=="number"}function _string_Q(o){return typeof o=="string"&&o[0]!=="Êž"}function Symbol$1(o){return this.value=o,this}Symbol$1.prototype.toString=function(){return this.value};function _symbol(o,e){return e?o===null?new Symbol$1(e):new Symbol$1(o+"/"+e):new Symbol$1(o)}function _symbol_Q(o){return o instanceof Symbol$1}function _ratio(o){return o}function _ratio_Q(o){return!1}function _keyword(o,e){return e?o===null?"Êž"+e:"Êž"+o+"/"+e:(e=o,typeof e=="string"&&e[0]==="Êž"?e:"Êž"+e)}function _keyword_Q(o){return typeof o=="string"&&o[0]==="Êž"}function _mapEntry_Q(o){return Object.hasOwn(o,"__mapEntry__")&&o.__mapEntry__===!0}function _regex_Q(o){return o instanceof RegExp}function walk(o,e,s){if(typeof s>"u")return null;if(_list_Q(s))return e(s.map(o));if(s===null)return null;if(_vector_Q(s)){let l=e(s.map(o));return l.__isvector__=!0,l}else if(s.__mapEntry__){const l=o(s[0]),a=o(s[1]);let h=[l,a];return h.__mapEntry__=!0,e(h)}else if(_hash_map_Q(s)){let l=new Map;return s.forEach((a,h,f)=>l.set(h,o(a))),e(l)}else return e(s)}function postwalk(o,e){return walk(s=>postwalk(o,s),o,e)}function hasLoop(o){let e=[];return postwalk(s=>s.value==_symbol("loop")||s.value==_symbol("loop*")?(e.push(!0),!0):s,o),e.length>0}function hasRecur(o){let e=[];return postwalk(s=>s.value==_symbol("recur")?(e.push(!0),!0):s,o),e.length>0}function _function(o,e,s,l,a){var h=function(){return o(s,new e(l,a,arguments))};return h.__meta__=null,h.__ast__=s,h.__gen_env__=function(f){return new e(l,a,f)},h._ismacro_=!1,h}function findVariadic(o){for(let e=0;e<o.length;e++)if(o[e][0].toString().includes("&"))return o[e]}function findFixedArity(o,e){for(let s=0;s<e.length;s++)if(e[s][0].length===o&&!e[s][0].toString().includes("&"))return e[s]}function multifn(o,e,s,l){var a=function(){var h=arguments.length,f=findFixedArity(h,s)||findVariadic(s);return o(f[1],new e(l,f[0],arguments))};return a.__meta__=null,a.__multifn__=!0,a.__ast__=function(h){var f=h.length,u=findFixedArity(f,s)||findVariadic(s);return u[1]},a.__gen_env__=function(h){var f=h.length,u=findFixedArity(f,s)||findVariadic(s);return new e(l,u[0],h)},a._ismacro_=!1,a}function _function_Q(o){return typeof o=="function"}Function.prototype.clone=function(){var o=this,e=function(){return o.apply(this,arguments)};for(var s in this)e[s]=this[s];return e};function _fn_Q(o){return _function_Q(o)&&!o._ismacro_}function _macro_Q(o){return _function_Q(o)&&!!o._ismacro_}function _list(){return Array.prototype.slice.call(arguments,0)}function _list_Q(o){return Array.isArray(o)&&!o.__isvector__}function _vector(){var o=Array.prototype.slice.call(arguments,0);return o.__isvector__=!0,o}function _vector_Q(o){return Array.isArray(o)&&!!o.__isvector__}function _hash_map(){if(arguments.length%2===1)throw new Error("Odd number of hash map arguments");var e=[new Map].concat(Array.prototype.slice.call(arguments,0));return _assoc_BANG.apply(null,e)}function _hash_map_Q(o){return typeof o=="object"&&o instanceof Map}function _assoc_BANG(o){if(arguments.length%2!==1)throw new Error("Odd number of assoc arguments");if(_vector_Q(o)){for(let f=0;f<arguments.length;f++){var e=arguments[f],s=arguments[f+1];o[e]=s}return o}var l=new Set;for(let f=1;f<arguments.length;f+=2)l.add(arguments[f]);var a=new Map;for(const[f,u]of o)contains_Q(l,f)||a.set(f,u);for(var h=1;h<arguments.length;h+=2){var e=arguments[h],s=arguments[h+1];a.set(e,s)}return a}function _dissoc_BANG(o){for(var e=1;e<arguments.length;e++){var s=arguments[e];o.delete(s)}return o}function _set(){return new Set(arguments)}function _set_Q(o){return typeof o=="object"&&o instanceof Set}function Atom(o){this.val=o}function _atom(o){return new Atom(o)}function _atom_Q(o){return o instanceof Atom}function Reader(o){this.tokens=o.map(function(e){return e}),this.position=0}Reader.prototype.next=function(){return this.tokens[this.position++]};Reader.prototype.peek=function(){return this.tokens[this.position]};function tokenize(o){var e=/[\s,]*(~@|#{|[\[\]{}()'`~^@]|"(?:\\.|[^\\"])*"?|;.*|[^\s\[\]{}('"`,;)]*)/g,s=[];let l="";for(;(l=e.exec(o)[1])!="";)l[0]!==";"&&s.push(l);return s}const int_pattern=/^([-+]?)(?:(0)|([1-9][0-9]*)|0[xX]([0-9A-Fa-f]+)|0([0-7]+)|([1-9][0-9]?)[rR]([0-9A-Za-z]+)|0[0-9]+)(N)?$/,float_pattern=/([-+]?[0-9]+(\.[0-9]*)?([eE][-+]?[0-9]+)?)(M)?/;function matchInt(o){const e=o.match(int_pattern);if(e[2])return 0;let s;e[3]?s=[e[3],10]:e[4]?s=[e[4],16]:e[5]?s=[e[5],8]:e[7]?s=[e[7],parseInt(e[6])]:s=[null,null];const l=s[0];let a=parseInt(l,s[1]);return e[1]==="-"&&(a=a*-1),a}function matchFloat(o){const e=o.match(float_pattern);return e[4]?parseFloat(e[1]):parseFloat(o)}function char_code(o,e){const s=parseInt(o,e);return isNaN(s)?-1:s}function read_unicode_char(o,e,s,l){const a=e+s;let h=0;for(let f=e;f<a+1;f++){if(f===a)return String.fromCharCode(h);let u=char_code(o[f],l);if(u===-1)throw new Error("Invalid Unicode digit '"+o[f]+"' in "+o);h=h*l+u}}function read_char(o){if(o.length===2)return o[1];if(o[1]==="u")return read_unicode_char(o.slice(1),1,4,16);if(o[1]==="o")return read_unicode_char(o.slice(1),1,o.length-2,8);if(o==="\\newline")return"\\n";if(o==="\\space")return" ";if(o==="\\tab")return"\\t";if(o==="\\backspace")return"\\b";if(o==="\\formfeed")return"\\f";if(o==="\\return")return"\\r";throw new Error("Unsupported character: '"+o+"'")}function read_atom(o){var e=o.next();if(e.match(int_pattern))return matchInt(e);if(e.match(/^([-+]?[0-9]+)\/([0-9]+)$/))return e.split("/");if(e[0]==="\\")return read_char(e);if(e.match(/^([-+]?[0-9]+(\.[0-9]*)?([eE][-+]?[0-9]+)?)(M)?$/))return matchFloat(e);if(e.match(/^"(?:\\.|[^\\"])*"$/))return e.slice(1,e.length-1).replace(/\\(.)/g,function(s,l){return l==="n"?`
`:l});if(e[0]==='"')throw new Error(`expected '"', got EOF`);return e[0]===":"?_keyword(e.slice(1)):e==="nil"?null:e==="true"?!0:e==="false"?!1:e==="##NaN"?Number.NaN:e==="##Inf"?Number.POSITIVE_INFINITY:e==="##-Inf"?Number.NEGATIVE_INFINITY:_symbol(e)}function read_list(o,e,s){e=e||"(",s=s||")";var l=[],a=o.next();if(a!==e)throw new Error("expected '"+e+"'");for(;(a=o.peek())!==s;){if(!a)throw new Error("expected '"+s+"', got EOF");l.push(read_form(o))}return o.next(),l}function read_vector(o){var e=read_list(o,"[","]");return _vector.apply(null,e)}function read_hash_map(o){var e=read_list(o,"{","}");return _hash_map.apply(null,e)}function read_set(o){var e=read_list(o,"#{","}");return _set.apply(null,e)}function read_form(o){var e=o.peek();switch(e){case";":return null;case"'":return o.next(),[_symbol("quote"),read_form(o)];case"`":return o.next(),[_symbol("quasiquote"),read_form(o)];case"~":return o.next(),[_symbol("unquote"),read_form(o)];case"~@":return o.next(),[_symbol("splice-unquote"),read_form(o)];case"^":o.next();var s=read_form(o);return[_symbol("with-meta"),read_form(o),s];case"@":return o.next(),[_symbol("deref"),read_form(o)];case"#":return o.next(),[_symbol("dispatch"),read_form(o)];case"#_":return o.next(),[_symbol("discard-form"),read_form(o)];case")":throw new Error("unexpected ')'");case"(":return read_list(o);case"]":throw new Error("unexpected ']'");case"[":return read_vector(o);case"#{":return read_set(o);case"}":throw new Error("unexpected '}'");case"{":return read_hash_map(o);default:return read_atom(o)}}function BlankException(o){}function read_str(o){var e=tokenize(o);if(e.length===0)throw new BlankException;return read_form(new Reader(e))}function Env(o,e,s){if(this.data={},this.outer=o||null,e&&s)for(var l=0;l<e.length;l++)if(e[l].value==="&"){this.data[e[l+1].value]=Array.prototype.slice.call(s,l);break}else this.data[e[l].value]=s[l];return this}Env.prototype.find=function(o){return o.value in this.data?this:this.outer?this.outer.find(o):null};Env.prototype.set=function(o,e){return this.data[o.value]=e,e};Env.prototype.get=function(o){var e=this.find(o);if(!e)throw new Error("'"+o.value+"' not found");return e.data[o.value]};const core_clj=`(ns core {:clj-kondo/ignore true})\r
\r
(defmacro or\r
  "Evaluates exprs one at a time, from left to right. If a form\r
    returns a logical true value, or returns that value and doesn't\r
    evaluate any of the other expressions, otherwise it returns the\r
    value of the last expression. (or) returns nil."\r
  [& xs]\r
  (if (empty? xs) nil\r
      (if (= 1 (count xs))\r
        (first xs)\r
        (let* [condvar (gensym)]\r
              \`(let* [~condvar ~(first xs)]\r
                     (if ~condvar ~condvar (or ~@(rest xs))))))))\r
\r
(defmacro and\r
  "Evaluates exprs one at a time, from left to right. If a form\r
    returns logical false (nil or false), and returns that value and\r
    doesn't evaluate any of the other expressions, otherwise it returns\r
    the value of the last expr. (and) returns true."\r
  [& xs]\r
  (cond (empty? xs)      true\r
        (= 1 (count xs)) (first xs)\r
        :else\r
        (let* [condvar (gensym)]\r
              \`(let* [~condvar ~(first xs)]\r
                     (if ~condvar (and ~@(rest xs)) ~condvar)))))\r
\r
(defmacro when\r
  "Evaluates test. If logical true, evaluates body in an implicit do."\r
  [x & xs]\r
  (list 'if x (cons 'do xs)))\r
\r
(defmacro cond\r
  "Takes a set of test/expr pairs. It evaluates each test one at a\r
time.  If a test returns logical true, cond evaluates and returns\r
the value of the corresponding expr and doesn't evaluate any of the\r
other tests or exprs. (cond) returns nil."\r
  [& xs]\r
  (when (gt (count xs) 0)\r
    (list 'if (first xs)\r
          (if (gt (count xs) 1)\r
            (nth xs 1)\r
            (throw "odd number of forms to cond"))\r
          (cons 'cond (rest (rest xs))))))\r
\r
(def spread (fn* [arglist]\r
                 (cond\r
                   (nil? arglist) nil\r
                   (nil? (next arglist)) (seq (first arglist))\r
                   :else (cons (first arglist) (spread (next arglist))))))\r
\r
(def list*\r
  (with-meta\r
    (fn*\r
     ([args] (seq args))\r
     ([a args] (cons a args))\r
     ([a b args] (cons a (cons b args)))\r
     ([a b c args] (cons a (cons b (cons c args))))\r
     ([a b c d & more]\r
      (cons a (cons b (cons c (cons d (spread more)))))))\r
    {:doc      "Creates a new seq containing the items prepended to the rest, the\r
last of which will be treated as a sequence."\r
     :arglists '([args] [a args] [a b args] [a b c args] [a b c d & more])}))\r
\r
(def apply\r
  (with-meta\r
    (fn*\r
     ([f args]\r
      (if (keyword? f)\r
        (get args f)\r
        (apply* f args)))\r
     ([f x args]\r
      (apply f (list* x args)))\r
     ([f x y args]\r
      (apply f (list* x y args)))\r
     ([f x y z args]\r
      (apply f (list* x y z args)))\r
     ([f a b c d & args]\r
      (apply f (cons a (cons b (cons c (cons d (spread args))))))))\r
    {:doc "Applies fn f to the argument list formed by prepending intervening arguments to args."\r
     :arglists '([f args] [f x args] [f x y args] [f x y z args] [f a b c d & args])}))\r
\r
(defmacro lazy-seq\r
  "Takes a body of expressions that returns an ISeq or nil, and yields\r
    a Seqable object that will invoke the body only the first time seq\r
    is called, and will cache the result and return it on all subsequent\r
    seq calls. See also - realized?"\r
  [& body]\r
  \`(new LazySeq (fn* [] ~@body)))\r
\r
;; Clojure's lazy map, doesn't work yet\r
\r
(def map-step\r
  (fn*\r
   [cs]\r
   (lazy-seq\r
    (let [ss (map seq cs)]\r
      (when (every? identity ss)\r
        (cons (map first ss) (map-step (map rest ss))))))))\r
\r
#_(def map\r
  (fn*\r
   ([f coll]\r
    (lazy-seq\r
     (when-let [s (seq coll)]\r
       (cons (f (first s)) (map f (rest s))))))\r
   ([f c1 c2]\r
    (lazy-seq\r
     (let [s1 (seq c1) s2 (seq c2)]\r
       (when (and s1 s2)\r
         (cons (f (first s1) (first s2))\r
               (map f (rest s1) (rest s2)))))))\r
   ([f c1 c2 c3]\r
    (lazy-seq\r
     (let [s1 (seq c1) s2 (seq c2) s3 (seq c3)]\r
       (when (and  s1 s2 s3)\r
         (cons (f (first s1) (first s2) (first s3))\r
               (map f (rest s1) (rest s2) (rest s3)))))))\r
   ([f c1 c2 c3 & colls]\r
      (map #(apply f %) (map-step (conj colls c3 c2 c1))))))\r
\r
(def map\r
  (with-meta\r
    (fn* \r
     ([f coll]\r
      (loop* [s (seq coll) res []]\r
             (if (empty? s) (apply list res)\r
                 (recur (rest s)\r
                        (conj res (if (keyword? f) (get (first s) f) (f (first s))))))))\r
     ([f c1 c2]\r
      (loop* [s1 (seq c1) s2 (seq c2) res []]\r
             (if (or (empty? s1) (empty? s2)) (apply list res)\r
                 (recur (rest s1) (rest s2)\r
                        (conj res (f (first s1) (first s2)))))))\r
     ([f c1 c2 c3]\r
      (loop* [s1 (seq c1) s2 (seq c2) s3 (seq c3) res []]\r
             (if (or (empty? s1) (empty? s2) (empty? s3)) (apply list res)\r
                 (recur (rest s1) (rest s2) (rest s3)\r
                        (conj res (f (first s1) (first s2) (first s3)))))))\r
     ([f c1 c2 c3 c4]\r
      (loop* [s1 (seq c1) s2 (seq c2) s3 (seq c3) s4 (seq c4) res []]\r
             (if (or (empty? s1) (empty? s2) (empty? s3) (empty? s4)) (apply list res)\r
                 (recur (rest s1) (rest s2) (rest s3) (rest s4)\r
                        (conj res (f (first s1) (first s2) (first s3) (first s4)))))))\r
     ([f c0 c1 c2 & colls]\r
      (_map f (list* c0 c1 c2 colls))))\r
      {:doc "Returns a sequence consisting of the result of applying f to\r
            the set of first items of each coll, followed by applying f to the\r
            set of second items in each coll, until any one of the colls is\r
            exhausted.  Any remaining items in other colls are ignored. Function\r
            f should accept number-of-colls arguments."\r
       :arglists '([f coll] [f c1 c2] [f c1 c2 c3] [f c1 c2 c3 c4] [f c0 c1 c2 & colls])}))\r
\r
(def seq? \r
  (with-meta\r
    (fn* [x] (list? x))\r
    {:doc "Returns true if x can be sequenced"\r
     :arglists '([x])}))\r
\r
(def gensym-counter\r
  (atom 0))\r
\r
(def gensym \r
  (with-meta\r
    (fn* \r
     ([] (symbol (str "G__" (swap! gensym-counter inc))))\r
     ([prefix]\r
      (symbol (str prefix (swap! gensym-counter inc)))))\r
    {:doc      "Returns a new symbol with a unique name. If a prefix string is\r
supplied, the name is prefix# where # is some unique number. If\r
prefix is not supplied, the prefix is 'G__'."\r
     :arglists '([] [prefix])}))\r
\r
;; prints elapsed time twice for some reason\r
(defmacro time [exp]\r
  (let* [start (gensym)\r
         ret   (gensym)]\r
        \`(let* [~start (time-ms)\r
                       ~ret   ~exp]\r
               (do\r
                 (println "Elapsed time:" (- (time-ms) ~start) "msecs")\r
                 ~ret))))\r
\r
;; first define let, loop, fn without destructuring\r
\r
(defmacro let [bindings & body]\r
  \`(let* ~bindings ~@body))\r
\r
(defmacro loop [& decl]\r
   (cons 'loop* decl))\r
\r
(defmacro fn [& sigs]\r
  (let [name (if (symbol? (first sigs)) (first sigs) nil)\r
        sigs (if name (next sigs) sigs)\r
        sigs (if (vector? (first sigs))\r
               (list sigs)\r
               (if (seq? (first sigs))\r
                 sigs\r
                 (throw (if (seq sigs)\r
                          (str "Parameter declaration "\r
                               (first sigs)\r
                               " should be a vector")\r
                          (str "Parameter declaration missing")))))\r
        psig (fn* [sig]\r
                  sig)\r
        new-sigs (map psig sigs)]\r
    (if name\r
      (list* 'fn* name new-sigs)\r
      (cons 'fn* new-sigs))))\r
\r
(def next\r
  (with-meta\r
   (fn [coll]\r
    (if (or (= 1 (count coll)) (= 0 (count coll)))\r
      nil\r
      (rest coll)))\r
    {:doc "Returns a seq of the items after the first. Calls seq on its\r
argument.  If there are no more items, returns nil."\r
     :arglists '([coll])}))\r
\r
(def sigs\r
  (fn [fdecl]\r
    (let [asig\r
          (fn [fdecl]\r
            (let [arglist (first fdecl)\r
                  body (next fdecl)]\r
              (if (map? (first body))\r
                (if (next body)\r
                  (with-meta arglist (conj (if (meta arglist) (meta arglist) {}) (first body)))\r
                  arglist)\r
                arglist)))]\r
      (if (seq? (first fdecl))\r
        (loop [ret [] fdecls fdecl]\r
          (if fdecls\r
            (recur (conj ret (asig (first fdecls))) (next fdecls))\r
            (seq ret)))\r
        (list (asig fdecl))))))\r
\r
(defmacro defn\r
  "Same as (def name (fn [params* ] exprs*)) or (def\r
  name (fn ([params* ] exprs*)+)) with any doc-string or attrs added\r
  to the var metadata."\r
  [name & fdecl]\r
  (let* [m (if (string? (first fdecl))\r
             {:doc  (first fdecl)\r
              :name (str name)}\r
             {:name (str name)})\r
         fdecl (if (string? (first fdecl))\r
                 (next fdecl)\r
                 fdecl)\r
         m (if (map? (first fdecl))\r
             (conj m (first fdecl))\r
             m)\r
         fdecl (if (map? (first fdecl))\r
                 (next fdecl)\r
                 fdecl)\r
         fdecl (if (vector? (first fdecl))\r
                 (list fdecl)\r
                 fdecl)\r
         m (if (map? (last fdecl))\r
             (conj m (last fdecl))\r
             m)\r
         fdecl (if (map? (last fdecl))\r
                 (butlast fdecl)\r
                 fdecl)\r
         m (conj {:arglists (list 'quote (sigs fdecl))} m)\r
         m (conj (if (meta name) (meta name) {}) m)]\r
    \`(def ~(with-meta name m) (with-meta (fn ~@fdecl) ~m))))\r
\r
(defmacro defn-\r
  "Same as defn, yielding non-public def"\r
  [name & decls]\r
   (list* \`defn (with-meta name (assoc (meta name) :private true)) decls))\r
\r
(defn load-file [f]\r
  (eval\r
   (read-string\r
    (str "(do " (slurp f) ")"))))\r
\r
(defn not\r
  "Returns true if x is logical false, false otherwise."\r
  [a]\r
  (if a false true))\r
\r
(defn not=\r
  "Same as (not (= obj1 obj2))"\r
  [a b]\r
  (not (= a b)))\r
\r
(defn dec\r
  "Returns a number one less than n."\r
  [n]\r
  (- n 1))\r
\r
(defn zero?\r
  "Returns true if num is zero, else false"\r
  [n]\r
  (= 0 n))\r
\r
(defn identity\r
  "Returns its argument."\r
  [x]\r
  x)\r
\r
(defn nnext\r
  "Same as (next (next x))"\r
  [s]\r
  (next (next s)))\r
\r
(defn reduce\r
  "f should be a function of 2 arguments. If val is not supplied,\r
returns the result of applying f to the first 2 items in coll, then\r
applying f to that result and the 3rd item, etc. If coll contains no\r
items, f must accept no arguments as well, and reduce returns the\r
result of calling f with no arguments. If coll has only 1 item, it\r
is returned and f is not called.  If val is supplied, returns the\r
result of applying f to val and the first item in coll, then\r
applying f to that result and the 2nd item, etc. If coll contains no\r
items, returns val and f is not called."\r
  ([f xs] (reduce f (first xs) (rest xs)))\r
  ([f init xs]\r
   (if (empty? xs)\r
     init\r
     (reduce f (f init (first xs)) (rest xs)))))\r
\r
(defn reductions\r
  "Returns a sequence of the intermediate values of the reduction (as\r
per reduce) of coll by f, starting with init."\r
  [f init xs]\r
  (loop* [s xs acc init res [init]]\r
    (if (empty? s)\r
      res\r
      (recur (rest s)\r
             (f acc (first s))\r
             (conj res (f acc (first s)))))))\r
\r
(defn reverse\r
  "Returns a seq of the items in coll in reverse order. Not lazy."\r
  [coll]\r
  (reduce conj '() coll))\r
\r
(defmacro if-not\r
  "Evaluates test. If logical false, evaluates and returns then expr, \r
otherwise else expr, if supplied, else nil."\r
  [test then else]\r
  (if else\r
    \`(if (not ~test) ~then ~else)\r
    \`(if-not ~test ~then nil)))\r
\r
(defn sorted-map\r
  "Returns a new sorted map with supplied mappings. If any keys are\r
equal, they are handled as if by repeated uses of assoc."\r
  [& keyvals]\r
  (into\r
   (with-meta {} {:sorted-map true})\r
   (sort (partition 2 keyvals))))\r
\r
(defn sorted-set\r
  "Returns a new sorted set with supplied keys.  Any equal keys are\r
handled as if by repeated uses of conj."\r
  [& keys]\r
  (into\r
   (with-meta #{} {:sorted-set true})\r
   (sort keys)))\r
\r
(defn merge-with\r
  "Returns a map that consists of the rest of the maps conj-ed onto\r
the first.  If a key occurs in more than one map, the mapping(s)\r
from the latter (left-to-right) will be combined with the mapping in\r
the result by calling (f val-in-result val-in-latter)."\r
  [f & maps]\r
  (when (some identity maps)\r
    (let [merge-entry (fn* [m e]\r
                        (let [k (key e) v (val e)]\r
                          (if (contains? m k)\r
                            (assoc m k (f (get m k) v))\r
                            (assoc m k v))))\r
          merge2 (fn* [m1 m2]\r
                   (reduce merge-entry (or m1 {}) (seq m2)))]\r
      (reduce merge2 maps))))\r
\r
(defn str/escape\r
  "Return a new string, using cmap to escape each character ch\r
 from s"\r
  [s cmap]\r
  (loop* [index  0\r
         buffer ""]\r
    (if (= (count s) index) buffer\r
        (recur (inc index) \r
               (str buffer (get cmap (nth s index) (nth s index)))))))\r
\r
(defn juxt\r
  "Takes a set of functions and returns a fn that is the juxtaposition\r
of those fns.  The returned fn takes a variable number of args, and\r
returns a vector containing the result of applying each fn to the\r
args (left-to-right). Example: ((juxt a b c) x) => [(a x) (b x) (c x)]"\r
  ([f]\r
   (fn*\r
     ([] [(f)])\r
     ([x] [(f x)])\r
     ([x y] [(f x y)])\r
     ([x y z] [(f x y z)])\r
     ([x y z & args] [(apply f x y z args)])))\r
  ([f g]\r
   (fn*\r
     ([] [(f) (g)])\r
     ([x] [(f x) (g x)])\r
     ([x y] [(f x y) (g x y)])\r
     ([x y z] [(f x y z) (g x y z)])\r
     ([x y z & args] [(apply f x y z args) (apply g x y z args)])))\r
  ([f g h]\r
   (fn*\r
     ([] [(f) (g) (h)])\r
     ([x] [(f x) (g x) (h x)])\r
     ([x y] [(f x y) (g x y) (h x y)])\r
     ([x y z] [(f x y z) (g x y z) (h x y z)])\r
     ([x y z & args] [(apply f x y z args) (apply g x y z args) (apply h x y z args)])))\r
  ([f g h & fs]\r
   (let [fs (list* f g h fs)]\r
     (fn*\r
       ([] (reduce #(conj %1 (%2)) [] fs))\r
       ([x] (reduce #(conj %1 (%2 x)) [] fs))\r
       ([x y] (reduce #(conj %1 (%2 x y)) [] fs))\r
       ([x y z] (reduce #(conj %1 (%2 x y z)) [] fs))\r
       ([x y z & args] (reduce #(conj %1 (apply %2 x y z args)) [] fs))))))\r
\r
(defn comp\r
  "Takes a set of functions and returns a fn that is the composition\r
of those fns.  The returned fn takes a variable number of args,\r
applies the rightmost of fns to the args, the next\r
fn (right-to-left) to the result, etc."\r
  ([] identity)\r
  ([f] f)\r
  ([f g]\r
   (fn*\r
     ([] (f (g)))\r
     ([x] (f (g x)))\r
     ([x y] (f (g x y)))\r
     ([x y z] (f (g x y z)))\r
     ([x y z & args] (f (apply g x y z args)))))\r
  ([f g & fs]\r
   (reduce comp (list* f g fs))))\r
\r
(defn .toUpperCase\r
  "Converts string to all upper-case."\r
  [s]\r
  (. (str "'" s "'" ".toUpperCase")))\r
\r
(defn .toLowerCase\r
  "Converts string to all lower-case."\r
  [s]\r
  (. (str "'" s "'" ".toLowerCase")))\r
\r
(defn _iter-> [acc form]\r
  (if (list? form)\r
    \`(~(first form) ~acc ~@(rest form))\r
    (list form acc)))\r
\r
(defmacro ->\r
  "Threads the expr through the forms. Inserts x as the\r
second item in the first form, making a list of it if it is not a\r
list already. If there are more forms, inserts the first form as the\r
second item in second form, etc."\r
  [x & xs]\r
  (reduce _iter-> x xs))\r
\r
(defn _iter->> [acc form]\r
  (if (list? form)\r
    \`(~(first form) ~@(rest form) ~acc) (list form acc)))\r
\r
(defmacro ->>\r
  "Threads the expr through the forms. Inserts x as the\r
last item in the first form, making a list of it if it is not a\r
list already. If there are more forms, inserts the first form as the\r
last item in second form, etc."\r
  [x & xs]\r
  (reduce _iter->> x xs))\r
\r
(defn memoize\r
  "Returns a memoized version of a referentially transparent function. The\r
memoized version of the function keeps a cache of the mapping from arguments\r
to results and, when calls with the same arguments are repeated often, has\r
higher performance at the expense of higher memory use."\r
  [f]\r
  (let* [mem (atom {})]\r
        (fn* [& args]\r
          (let* [key (str args)]\r
                (if (contains? @mem key)\r
                  (get @mem key)\r
                  (let* [ret (apply f args)]\r
                        (do (swap! mem assoc key ret)\r
                            ret)))))))\r
\r
(defn partial\r
  "Takes a function f and fewer than the normal arguments to f, and\r
returns a fn that takes a variable number of additional args. When\r
called, the returned function calls f with args + additional args."\r
  [pfn & args]\r
  (fn* [& args-inner]\r
    (apply pfn (concat args args-inner))))\r
\r
(defn every?\r
  "Returns true if (pred x) is logical true for every x in coll, else\r
false."\r
  [pred xs]\r
  (cond (empty? xs)       true\r
        (pred (first xs)) (every? pred (rest xs))\r
        true              false))\r
\r
(defn postwalk\r
  "Performs a depth-first, post-order traversal of form.  Calls f on\r
each sub-form, uses f's return value in place of the original.\r
Recognizes all Clojure data structures. Consumes seqs as with doall."\r
  [f form]\r
  (walk (partial postwalk f) f form))\r
\r
(defn prewalk\r
  "Like postwalk, but does pre-order traversal."\r
  [f form]\r
  (walk (partial prewalk f) identity (f form)))\r
\r
(defn postwalk-replace\r
  "Recursively transforms form by replacing keys in smap with their\r
values. Like clojure/replace but works on any data structure. Does\r
replacement at the leaves of the tree first."\r
  [smap form]\r
  (postwalk (fn* [x] (if (contains? smap x) (smap x) x)) form))\r
\r
(defn not-every?\r
  "Returns false if (pred x) is logical true for every x in\r
coll, else true."\r
  [pred xs]\r
  (not (every? pred xs)))\r
\r
(defmacro if-not\r
  "Evaluates test. If logical false, evaluates and returns then expr, \r
otherwise else expr, if supplied, else nil."\r
  [test then else]\r
  \`(if (not ~test) ~then ~else))\r
\r
(defmacro when-not\r
  "Evaluates test. If logical false, evaluates body in an implicit do."\r
  [test & body]\r
  (list 'if test nil (cons 'do body)))\r
\r
(defn fnext\r
  "Same as (first (next x))"\r
  [x]\r
  (first (next x)))\r
\r
(defn ffirst\r
  "Same as (first (first x))"\r
  [x]\r
  (first (first x)))\r
\r
(defn second\r
  "Same as (first (next x))"\r
  [l] (nth l 1))\r
\r
(defn some\r
  "Returns the first logical true value of (pred x) for any x in coll,\r
else nil.  One common idiom is to use a set as pred, for example\r
this will return :fred if :fred is in the sequence, otherwise nil:\r
(some #{:fred} coll)"\r
  [pred xs]\r
  (if (set? pred)\r
    (if (empty? xs) nil\r
      (or (when (contains? pred (first xs))\r
            (first xs))\r
          (some pred (rest xs))))\r
    (if (map? pred)\r
      (if (empty? xs) nil\r
          (or (when (contains? pred (first xs))\r
                (get pred (first xs)))\r
              (some pred (rest xs))))\r
      (if (empty? xs) nil\r
        (or (pred (first xs))\r
            (some pred (rest xs)))))))\r
\r
(defn not-any?\r
  "Returns false if (pred x) is logical true for any x in coll,\r
else true."\r
  [pred coll]\r
  (not (some pred coll)))\r
\r
(defn quot\r
  "quot[ient] of dividing numerator by denominator."\r
  [n d]\r
  (int (double (/ n d))))\r
\r
(defn pos?\r
  "Returns true if num is greater than zero, else false"\r
  [n]\r
  (> n 0))\r
\r
(defn neg?\r
  "Returns true if num is less than zero, else false"\r
  [n]\r
  (> 0 n))\r
\r
(defn even?\r
  "Returns true if n is even, throws an exception if n is not an integer"\r
  [n]\r
  (zero? (mod n 2)))\r
\r
(defn odd?\r
  "Returns true if n is odd, throws an exception if n is not an integer"\r
  [n]\r
  (not (zero? (mod n 2))))\r
\r
(defn complement\r
  "Takes a fn f and returns a fn that takes the same arguments as f,\r
has the same effects, if any, and returns the opposite truth value."\r
  [f]\r
  (fn*\r
    ([] (not (f)))\r
    ([x] (not (f x)))\r
    ([x y] (not (f x y)))\r
    ([x y & zs] (not (apply f x y zs)))))\r
\r
(defn mapcat\r
  "Returns the result of applying concat to the result of applying map\r
to f and colls.  Thus function f should return a collection."\r
  [f & colls]\r
  (apply concat (apply map f colls)))\r
\r
(defn remove\r
  "Returns a lazy sequence of the items in coll for which\r
(pred item) returns logical false. pred must be free of side-effects."\r
  [pred coll]\r
  (filter (complement pred) coll))\r
\r
(defn tree-seq\r
  "Returns a lazy sequence of the nodes in a tree, via a depth-first walk.\r
 branch? must be a fn of one arg that returns true if passed a node\r
 that can have children (but may not).  children must be a fn of one\r
 arg that returns a sequence of the children. Will only be called on\r
 nodes for which branch? returns true. Root is the root node of the\r
tree."\r
  [branch? children node]\r
  (remove nil?\r
          (cons node\r
                (when (branch? node)\r
                  (mapcat (fn* [x] (tree-seq branch? children x))\r
                          (children node))))))\r
\r
(defn flatten\r
  "Takes any nested combination of sequential things (lists, vectors,\r
etc.) and returns their contents as a single, flat lazy sequence.\r
(flatten nil) returns an empty sequence."\r
  [x]\r
  (filter (complement sequential?)\r
          (rest (tree-seq sequential? seq x))))\r
\r
(defn mod\r
  "Modulus of num and div. Truncates toward negative infinity."\r
  [num div]\r
  (let* [m (rem num div)]\r
        (if (or (zero? m) (= (pos? num) (pos? div)))\r
          m\r
          (+ m div))))\r
\r
(defn take-while\r
  "Returns a lazy sequence of successive items from coll while\r
(pred item) returns logical true. pred must be free of side-effects."\r
  [pred coll]\r
  (loop* [s (seq coll) res []]\r
    (if (empty? s) res\r
        (if (pred (first s))\r
          (recur (rest s) (conj res (first s)))\r
          res))))\r
\r
(defn drop-while\r
  "Returns a lazy sequence of the items in coll starting from the\r
first item for which (pred item) returns logical false."\r
  [pred coll]\r
  (loop* [s   (seq coll)]\r
    (if (empty? s) s\r
        (if (and s (pred (first s)))\r
          (recur (rest s))\r
          s))))\r
\r
(defn partition\r
  "Returns a lazy sequence of lists of n items each, at offsets step\r
apart. If step is not supplied, defaults to n, i.e. the partitions\r
do not overlap. If a pad collection is supplied, use its elements as\r
necessary to complete last partition upto n items. In case there are\r
not enough padding elements, return a partition with less than n items."\r
  ([n coll]\r
   (partition n n coll))\r
  ([n step coll]\r
     (loop* [s coll p []]\r
       (if (= 0 (count s))\r
         (filter #(= n (count %)) p)\r
         (recur (drop step s) (conj p (take n s))))))\r
  ([n step pad coll]\r
     (loop* [s coll p []]\r
           (if (= n (count (take n s)))\r
             (recur (drop step s) (conj p (take n s)))\r
             (conj p (concat (take n s) pad))))))\r
\r
(defn boolean\r
  "Coerce to boolean"\r
  [x]\r
  (if x true false))\r
\r
(defn split-at\r
  "Returns a vector of [(take n coll) (drop n coll)]"\r
  [n coll]\r
  [(take n coll) (drop n coll)])\r
\r
(defn split-with\r
  "Returns a vector of [(take-while pred coll) (drop-while pred coll)]"\r
  [pred coll]\r
  [(take-while pred coll) (drop-while pred coll)])\r
\r
(defn str/split-lines\r
  "Splits s on \\\\n or \\\\r\\\\n."\r
  [s]\r
  (str/split s #"\\r?\\n"))\r
\r
(defn partition-all\r
  "Returns a lazy sequence of lists like partition, but may include\r
partitions with fewer than n items at the end."\r
  ([n coll]\r
   (partition-all n n coll))\r
  ([n step coll]\r
     (loop* [s coll p []]\r
            (if (= 0 (count s)) p\r
                (recur (drop step s)\r
                       (conj p (take n s)))))))\r
\r
(defn partition-by\r
  "Applies f to each value in coll, splitting it each time f returns a\r
 new value.  Returns a sequenc of partitions."\r
  [f coll]\r
  (loop* [s (seq coll) res []]\r
    (if (= 0 (count s)) res\r
        (recur (drop (count (take-while (fn* [x] (= (f (first s)) (f x))) s)) s)\r
               (conj res (take-while (fn* [x] (= (f (first s)) (f x))) s))))))\r
\r
(defn coll?\r
  "Returns true if x is a list, vector, set or map"\r
  [x]\r
  (or (list? x) (vector? x) (set? x) (map? x)))\r
\r
(defn group-by\r
  "Returns a map of the elements of coll keyed by the result of\r
f on each element. The value at each key will be a vector of the\r
corresponding elements, in the order they appeared in coll."\r
  [f coll]\r
  (reduce\r
   (fn* [ret x]\r
     (let* [k (f x)]\r
           (assoc ret k (conj (get ret k []) x))))\r
   {} coll))\r
\r
(defn fromCharCode\r
  "Returns a string created from the specified sequence of UTF-16 code units."\r
  [int]\r
  (js-eval (str "String.fromCharCode(" int ")")))\r
\r
(defn Character/isAlphabetic\r
  "Returns true if char code represents a letter."\r
  [int]\r
  (not= (upper-case (fromCharCode int))\r
        (lower-case (fromCharCode int))))\r
\r
(defn Character/digit\r
  "Returns the numerical value of char using radix r."\r
  [char r]\r
  (Integer/parseInt (first char) r))\r
\r
(defn Character/isLetter\r
  "Returns true if char is a letter."\r
  [char]\r
  (not= (upper-case char)\r
        (lower-case char)))\r
\r
(defn Character/isUpperCase\r
  "Takes a character or a code point. Returns true if x is uppercase."\r
  [x]\r
  (if (int? x)\r
    (and (Character/isLetter (fromCharCode x))\r
         (= (fromCharCode x)\r
            (upper-case (fromCharCode x))))\r
    (and (Character/isLetter x)\r
         (= x (upper-case x)))))\r
\r
(defn Character/isLowerCase\r
  "Takes a character or a code point. Returns true if x is lowercase."\r
  [x]\r
  (if (int? x)\r
    (and (Character/isLetter (fromCharCode x))\r
         (= (fromCharCode x)\r
            (lower-case (fromCharCode x))))\r
    (and (Character/isLetter x)\r
         (= x (lower-case x)))))\r
\r
(defn zipmap\r
  "Returns a map with the keys mapped to the corresponding vals."\r
  [keys vals]\r
  (loop* [map {}\r
         ks (seq keys)\r
         vs (seq vals)]\r
    (if-not (and ks vs) map\r
            (recur (assoc map (first ks) (first vs))\r
                   (next ks)\r
                   (next vs)))))\r
\r
(defn empty\r
  "Returns an empty collection of the same category as coll, or nil"\r
  [coll]\r
  (cond\r
    (list? coll) '()\r
    (vector? coll) []\r
    (set? coll) #{}\r
    (map? coll) {}\r
    (string? coll) ""))\r
\r
(defn mapv\r
  "Returns a vector consisting of the result of applying f to the\r
set of first items of each coll, followed by applying f to the set\r
of second items in each coll, until any one of the colls is\r
exhausted.  Any remaining items in other colls are ignored. Function\r
f should accept number-of-colls arguments."\r
  ([f coll]\r
   (-> (reduce (fn [v o] (conj v (f o))) [] coll)))\r
  ([f c1 c2]\r
   (into [] (map f c1 c2)))\r
  ([f c1 c2 c3]\r
   (into [] (map f c1 c2 c3)))\r
  ([f c1 c2 c3 & colls]\r
   (into [] (apply map f c1 c2 c3 colls))))\r
\r
(defn drop-last\r
  "Return a sequence of all but the last n (default 1) items in coll"\r
  [n coll]\r
  (if-not coll\r
    (drop-last 1 n)\r
    (map (fn* [x _] x) coll (drop n coll))))\r
\r
(defn interleave\r
  "Returns a seq of the first item in each coll, then the second etc."\r
  [c1 c2]\r
  (loop* [s1  (seq c1)\r
         s2  (seq c2)\r
         res []]\r
    (if (or (empty? s1) (empty? s2))\r
      res\r
      (recur (rest s1)\r
             (rest s2)\r
             (conj res (first s1) (first s2))))))\r
\r
(defn interpose\r
  "Returns a seq of the elements of coll separated by sep."\r
  [sep coll]\r
  (drop 1 (interleave (repeat (count coll) sep) coll)))\r
\r
(defn into\r
  "Returns a new coll consisting of to-coll with all of the items of\r
from-coll conjoined."\r
  [to from]\r
  (reduce conj to from))\r
\r
(defmacro if-let\r
    "If test is true, evaluates then with binding-form bound to the value of \r
  test, if not, yields else"\r
  [bindings then else & oldform]\r
  (if-not else\r
    \`(if-let ~bindings ~then nil)\r
    (let* [form (get bindings 0) tst (get bindings 1)\r
           temp# (gensym)]\r
          \`(let [temp# ~tst]\r
             (if temp#\r
               (let [~form temp#]\r
                 ~then)\r
               ~else)))))\r
\r
\r
(defn frequencies\r
  "Returns a map from distinct items in coll to the number of times\r
they appear."\r
  [coll]\r
  (reduce (fn* [counts x]\r
            (assoc counts x (inc (get counts x 0))))\r
          {} coll))\r
\r
(defn constantly\r
  "Returns a function that takes any number of arguments and returns x."\r
  [x]\r
  (fn* [& args] x))\r
\r
(defn str/capitalize\r
  "Converts first character of the string to upper-case, all other\r
characters to lower-case."\r
  [s]\r
  (let* [s (str s)]\r
        (if (< (count s) 2)\r
          (upper-case s)\r
          (str (upper-case (subs s 0 1))\r
               (lower-case (subs s 1))))))\r
\r
(defn keep\r
  "Returns a sequence of the non-nil results of (f item). Note,\r
this means false return values will be included.  f must be free of\r
side-effects."\r
  [s]\r
  (remove nil? s))\r
\r
(defn not-empty\r
  "If coll is empty, returns nil, else coll"\r
  [coll]\r
  (when (seq coll) coll))\r
\r
(defn reduce-kv\r
  "Reduces an associative collection. f should be a function of 3\r
arguments. Returns the result of applying f to init, the first key\r
and the first value in coll, then applying f to that result and the\r
2nd key and value, etc. If coll contains no entries, returns init\r
and f is not called. Note that reduce-kv is supported on vectors,\r
where the keys will be the ordinals."\r
  [f init coll]\r
  (reduce (fn* [ret kv] (f ret (first kv) (last kv))) init coll))\r
\r
(defn merge\r
  "Returns a map that consists of the rest of the maps conj-ed onto\r
the first.  If a key occurs in more than one map, the mapping from\r
the latter (left-to-right) will be the mapping in the result."\r
  [& maps]\r
  (loop* [maps (mapcat seq maps) res {}]\r
    (if-not (some identity maps) res\r
            (recur (rest maps) (conj res (first maps))))))\r
\r
(defmacro when-let\r
  "When test is true, evaluates body with binding-form bound to the value of test"\r
  [bindings & body]\r
  (let* [form (get bindings 0) tst (get bindings 1)\r
         temp# (gensym)]\r
        \`(let* [temp# ~tst]\r
               (when temp#\r
                 (let* [~form temp#]\r
                       ~@body)))))\r
\r
(defmacro when-first\r
  "Roughly the same as (when (seq xs) (let [x (first xs)] body)) but xs is evaluated only once."\r
  [bindings & body]\r
  (let* [x   (first bindings)\r
         xs  (last bindings)\r
         xs# (gensym)]\r
        \`(when-let [xs# (seq ~xs)]\r
           (let* [~x (first xs#)]\r
                 ~@body))))\r
  \r
(defmacro as->\r
  "Binds name to expr, evaluates the first form in the lexical context\r
of that binding, then binds name to that result, repeating for each\r
successive form, returning the result of the last form."\r
  [expr name & forms]\r
  \`(let* [~name ~expr\r
          ~@(interleave (repeat (count forms) name) (butlast forms))]\r
         ~(if (empty? forms)\r
            name\r
            (last forms))))\r
\r
(defmacro some->\r
  "When expr is not nil, threads it into the first form (via ->),\r
and when that result is not nil, through the next etc"\r
  [expr & forms]\r
  (let [g (gensym)\r
        steps (map (fn [step] \`(if (nil? ~g) nil (-> ~g ~step)))\r
                   forms)]\r
    \`(let [~g ~expr\r
           ~@(interleave (repeat (count forms) g) (butlast steps))]\r
       ~(if (empty? steps)\r
          g\r
          (last steps)))))\r
\r
(defmacro some->>\r
  "When expr is not nil, threads it into the first form (via ->>),\r
and when that result is not nil, through the next etc"\r
  [expr & forms]\r
  (let [g (gensym)\r
        steps (map (fn [step] \`(if (nil? ~g) nil (->> ~g ~step)))\r
                   forms)]\r
    \`(let [~g ~expr\r
           ~@(interleave (repeat (count forms) g) (butlast steps))]\r
       ~(if (empty? steps)\r
          g\r
          (last steps)))))\r
\r
(defn distinct?\r
  "Returns true if no two of the arguments are ="\r
  [x y & more]\r
  (if-not more\r
    (if-not y\r
      true\r
      (not (= x y)))\r
    (if (not= x y)\r
      (loop* [s (set [x y]) xs more]\r
        (if xs\r
          (if (contains? s (first xs))\r
            false\r
            (recur (conj s (first xs)) (next xs)))\r
          true))\r
      false)))\r
\r
(defn distinct\r
  "Returns a sequence of the elements of coll with duplicates removed."\r
  [coll]\r
  (into (empty coll) (set coll)))\r
\r
(defn parseInt\r
  "Parses a string argument and returns an integer of the specified radix."\r
  [s r]\r
  (Integer/parseInt s r))\r
\r
(defn Math/floor\r
  "Rounds down and returns the largest integer less than or equal to a given number."\r
  [x]\r
  (js-eval (str "Math.floor(" x ")")))\r
\r
(defn Math/ceil\r
  "Rounds up and returns the smallest integer greater than or equal to a given number."\r
  [x]\r
  (js-eval (str "Math.ceil(" x ")")))\r
\r
(defn get-in\r
  "Returns the value in a nested associative structure,\r
where ks is a sequence of keys. Returns nil if the key\r
is not present, or the not-found value if supplied."\r
  [m ks]\r
  (reduce #(get % %2) m ks))\r
\r
(defn some?\r
  "Returns true if x is not nil, false otherwise."\r
  [x]\r
  (not (nil? x)))\r
\r
(defn nthnext\r
  "Returns the nth next of coll, (seq coll) when n is 0."\r
  [coll n]\r
  (loop [n n xs (seq coll)]\r
    (if (and xs (pos? n))\r
      (recur (dec n) (next xs))\r
      xs)))\r
\r
(defn update\r
  "'Updates' a value in an associative structure, where k is a\r
key and f is a function that will take the old value\r
and any supplied args and return the new value, and returns a new\r
structure.  If the key does not exist, nil is passed as the old value."\r
  ([m k f]\r
   (assoc m k (f (get m k))))\r
  ([m k f x]\r
   (assoc m k (f (get m k) x)))\r
  ([m k f x y]\r
   (assoc m k (f (get m k) x y)))\r
  ([m k f x y z]\r
   (assoc m k (f (get m k) x y z)))\r
  ([m k f x y z & more]\r
   (assoc m k (apply f (get m k) x y z more))))\r
\r
(defn emit-for [bindings body-expr]\r
  (let [giter (gensym "iter__")\r
        gxs (gensym "s__")\r
        iterys# (gensym "iterys__")\r
        fs#     (gensym "fs__")\r
        ;; TODO: create named lambdas so won't need to do this\r
        do-mod (defn do-mod [mod]\r
                 (cond\r
                   (= (ffirst mod) :let) \`(let ~(second (first mod)) \r
                                            ~(do-mod (next mod)))\r
                   (= (ffirst mod) :while) \`(when ~(second (first mod)) \r
                                              ~(do-mod (next mod)))\r
                   (= (ffirst mod) :when) \`(if ~(second (first mod))\r
                                             ~(do-mod (next mod))\r
                                             (recur (rest ~gxs)))\r
                   (keyword?  (ffirst mod)) (throw (str "Invalid 'for' keyword " (ffirst mod)))\r
                   (next bindings)\r
                   \`(let [~iterys# ~(emit-for (next bindings) body-expr)\r
                          ~fs# (seq (~iterys# ~(second (first (next bindings)))))]\r
                      (if ~fs#\r
                        (concat ~fs# (~giter (rest ~gxs)))\r
                        (recur (rest ~gxs))))\r
                   :else \`(cons ~body-expr (~giter (rest ~gxs)))))]\r
    (if (next bindings)\r
      \`(defn ~giter [~gxs]\r
         (loop [~gxs ~gxs]\r
           (when-first [~(ffirst bindings) ~gxs]\r
             ~(do-mod (subvec (first bindings) 2)))))\r
      \`(defn ~giter [~gxs]\r
         (loop [~gxs ~gxs]\r
           (when-let [~gxs (seq ~gxs)]\r
             (let [~(ffirst bindings) (first ~gxs)]\r
               ~(do-mod (subvec (first bindings) 2)))))))))\r
\r
(defmacro for\r
  "List comprehension. Takes a vector of one or more\r
 binding-form/collection-expr pairs, each followed by zero or more\r
 modifiers, and yields a lazy sequence of evaluations of expr.\r
 Collections are iterated in a nested fashion, rightmost fastest,\r
 and nested coll-exprs can refer to bindings created in prior\r
 binding-forms.  Supported modifiers are: :let [binding-form expr ...],\r
 :while test, :when test. Example:\r
 (take 100 (for [x (range 100000000) y (range 1000000) :while (< y x)] [x y]))"\r
  [seq-exprs body-expr]\r
  (let [body-expr* body-expr\r
        iter#      (gensym)\r
        to-groups  (fn* [seq-exprs]\r
                        (reduce (fn* [groups kv]\r
                                     (if (keyword? (first kv))\r
                                       (conj (pop groups) \r
                                             (conj (peek groups) [(first kv) (last kv)]))\r
                                       (conj groups [(first kv) (last kv)])))\r
                                [] (partition 2 seq-exprs)))]\r
    \`(let [~iter# ~(emit-for (to-groups seq-exprs) body-expr)]\r
       (remove nil?\r
               (~iter# ~(second seq-exprs))))))\r
\r
(defn key\r
  "Returns the key of the map entry."\r
  [e]\r
  (first e))\r
\r
(defn val\r
  "Returns the value of the map entry."\r
  [e]\r
  (last e))\r
\r
(defn butlast\r
  "Return a seq of all but the last item in coll, in linear time"\r
  [s]\r
  (loop* [ret []\r
         s   s]\r
    (if (next s)\r
      (recur (conj ret (first s)) (next s))\r
      (seq ret))))\r
\r
(defn assoc-in\r
  "Associates a value in a nested associative structure, where ks is a\r
sequence of keys and v is the new value and returns a new nested structure.\r
If any levels do not exist, hash-maps will be created."\r
  [m ks v]\r
  (if (next ks)\r
    (assoc m (first ks) (assoc-in (get m (first ks)) (rest ks) v))\r
    (assoc m (first ks) v)))\r
\r
(defn str/includes?\r
  "Returns true if s includes substr."\r
  [s substr]\r
  (js-eval (str "'" s "'" ".includes(" "'" substr "'" ")")))\r
\r
(defn take-nth\r
  "Returns a seq of every nth item in coll."\r
  [n coll]\r
  (loop* [s coll res []]\r
    (if (empty? s) res\r
        (recur (drop n s) (conj res (first s))))))\r
\r
(defn namespace\r
  "Returns the namespace String of a symbol or keyword, or nil if not present."\r
  [x]\r
  (when (str/includes? x "/")\r
    (first (str/split (str x) "/"))))\r
\r
(defn name\r
  "Returns the name String of a string, symbol or keyword."\r
  [x]\r
  (if (keyword? x)\r
    (subs (str x) 1)\r
    (str x)))\r
\r
(defn comment\r
  "Ignores body, yields nil"\r
  [& forms])\r
\r
(defn pvec [bvec b val]\r
  (let [gvec (gensym "vec__")\r
        gseq (gensym "seq__")\r
        gfirst (gensym "first__")\r
        has-rest (some #{'&} b)]\r
        (loop* [ret (let [ret (conj bvec gvec val)]\r
                         (if has-rest\r
                           (conj ret gseq (list seq gvec))\r
                           ret))\r
               n 0\r
               bs b\r
               seen-rest? false]\r
          (if (seq bs)\r
            (let [firstb (first bs)]\r
                  (cond\r
                    (= firstb '&) (recur (pb ret (second bs) gseq)\r
                                         n\r
                                         (nnext bs)\r
                                         true)\r
                    (= firstb :as) (pb ret (second bs) gvec)\r
                    :else (if seen-rest?\r
                            (throw "Unsupported binding form, only :as can follow & parameter")\r
                            (recur (pb (if has-rest\r
                                         (conj ret\r
                                               gfirst \`(~first ~gseq)\r
                                               gseq \`(~next ~gseq))\r
                                         ret)\r
                                       firstb\r
                                       (if has-rest\r
                                         gfirst\r
                                         (list 'nth gvec n nil)))\r
                                   (inc n)\r
                                   (next bs)\r
                                   seen-rest?))))\r
            ret))))\r
\r
(defn pmap [bvec b v]\r
  (let* [gmap (gensym "map__")\r
         defaults (:or b)]\r
        (loop* [ret (-> bvec (conj gmap) (conj v)\r
                       (conj gmap) (conj gmap)\r
                       ((fn* [ret]\r
                          (if (:as b)\r
                            (conj ret (:as b) gmap)\r
                            ret))))\r
               bes (let* [transforms\r
                          (reduce\r
                           (fn* [transforms mk]\r
                             (if (keyword? mk)\r
                               (let* [mkns (namespace mk)\r
                                      mkn (name mk)]\r
                                     (cond (= mkn "keys") (assoc transforms mk (fn* [k] (keyword (or mkns (namespace k)) (name k))))\r
                                           (= mkn "syms") (assoc transforms mk (fn* [k] (list \`quote (symbol (or mkns (namespace k)) (name k)))))\r
                                           (= mkn "strs") (assoc transforms mk str)\r
                                           :else transforms))\r
                               transforms))\r
                           {}\r
                           (keys b))]\r
                         (reduce\r
                          (fn* [bes entry] (reduce (fn* [a b] (assoc a b ((val entry) b))) (dissoc bes (key entry)) (get bes (key entry))))\r
                          (dissoc b :as :or)\r
                          transforms))]\r
          bes\r
          (if (seq bes)\r
            (let* [bb (key (first bes))\r
                   bk (val (first bes))\r
                   local bb\r
                   bv (if (contains? defaults local)\r
                        (list \`get gmap bk (get defaults local))\r
                        (list \`get gmap bk))]\r
                  (recur\r
                   (if (or (keyword? bb) (symbol? bb))\r
                     (-> ret (conj local bv))\r
                     (pb ret bb bv))\r
                   (next bes)))\r
            ret))))\r
\r
(defn pb [bvec b v]\r
  (cond\r
    (symbol? b) (-> bvec (conj (if (namespace b)\r
                                 (symbol (name b)) b)) (conj v))\r
    (keyword? b) (-> bvec (conj (symbol (name b))) (conj v))\r
    (vector? b) (pvec bvec b v)\r
    (map? b) (pmap bvec b v)\r
    :else (throw (str "Unsupported binding form: " b))))\r
\r
(defn destructure\r
  "Takes a binding form and outputs bindings with all destructuring forms expanded."\r
  [bindings]\r
  (let* [bents (partition 2 bindings)\r
         process-entry (fn* [bvec b] (pb bvec (first b) (second b)))]\r
        (if (every? symbol? (map first bents))\r
          bindings\r
          (if-let [kwbs (seq (filter #(keyword? (first %)) bents))]\r
            (throw (str "Unsupported binding key: " (ffirst kwbs)))\r
            (reduce process-entry [] bents)))))\r
\r
(defmacro let\r
    "Evaluates the exprs in a lexical context in which the symbols in\r
  the binding-forms are bound to their respective init-exprs or parts\r
  therein."\r
  [bindings & body]\r
  \`(let* ~(destructure bindings) ~@body))\r
\r
(defmacro loop\r
  "Evaluates the exprs in a lexical context in which the symbols in\r
the binding-forms are bound to their respective init-exprs or parts\r
therein. Acts as a recur target."\r
  [bindings & body]\r
  (let [db (destructure bindings)]\r
    (if (= db bindings)\r
      \`(loop* ~bindings ~@body)\r
      (let [vs (take-nth 2 (drop 1 bindings))\r
            bs (take-nth 2 bindings)\r
            gs (map (fn [b] (if (symbol? b) b (gensym))) bs)\r
            bfs (reduce (fn [ret [b v g]]\r
                           (if (symbol? b)\r
                             (conj ret g v)\r
                             (conj ret g v b g)))\r
                         [] (map vector bs vs gs))]\r
        \`(let ~bfs\r
           (loop* ~(vec (interleave gs gs))\r
                  (let ~(vec (interleave bs gs))\r
                    ~@body)))))))\r
\r
(defn maybe-destructured [params body]\r
  (if (every? symbol? params)\r
    (cons params body)\r
    (loop* [params params\r
           new-params (with-meta [] (meta params))\r
           lets []]\r
      (if params\r
        (if (symbol? (first params))\r
          (recur (next params) (conj new-params (first params)) lets)\r
          (let [gparam (gensym "p__")]\r
            (recur (next params) (conj new-params gparam)\r
                   (-> lets (conj (first params)) (conj gparam)))))\r
        \`(~new-params\r
          (let ~lets\r
            ~@body))))))\r
\r
;redefine fn with destructuring\r
(defmacro fn\r
  "Defines a function."\r
  [& sigs]\r
  (let [name (if (symbol? (first sigs)) (first sigs) nil)\r
        sigs (if name (next sigs) sigs)\r
        sigs (if (vector? (first sigs))\r
               (list sigs)\r
               (if (seq? (first sigs))\r
                 sigs\r
                 (throw (if (seq sigs)\r
                          (str "Parameter declaration "\r
                               (first sigs)\r
                               " should be a vector")\r
                          (str "Parameter declaration missing")))))\r
        psig (fn* [sig]\r
                  (let [[params & body] sig]\r
                    (maybe-destructured params body)))\r
        new-sigs (map psig sigs)]\r
    (if name\r
      (list* 'fn* name new-sigs)\r
      (cons 'fn* new-sigs))))\r
\r
(defmacro cond->\r
  "Takes an expression and a set of test/form pairs. Threads expr (via ->)\r
through each form for which the corresponding test\r
expression is true. Note that, unlike cond branching, cond-> threading does\r
not short circuit after the first true test expression."\r
  [expr & clauses]\r
  (let [g (gensym)\r
        steps (map (fn [[test step]] \`(if ~test (-> ~g ~step) ~g))\r
                   (partition 2 clauses))]\r
    \`(let [~g ~expr\r
           ~@(interleave (repeat (count clauses) g) (butlast steps))]\r
       ~(if (empty? steps)\r
          g\r
          (last steps)))))\r
\r
(defmacro cond->>\r
  "Takes an expression and a set of test/form pairs. Threads expr (via ->>)\r
through each form for which the corresponding test expression\r
is true.  Note that, unlike cond branching, cond->> threading does not short circuit\r
after the first true test expression."\r
  [expr & clauses]\r
  (let [g (gensym)\r
        steps (map (fn [[test step]] \`(if ~test (->> ~g ~step) ~g))\r
                   (partition 2 clauses))]\r
    \`(let [~g ~expr\r
           ~@(interleave (repeat (count clauses) g) (butlast steps))]\r
       ~(if (empty? steps)\r
          g\r
          (last steps)))))\r
\r
(defn update-in* [m ks f args]\r
  (let [[k & ks] ks]\r
    (if ks\r
      (assoc m k (update-in* (get m k) ks f args))\r
      (assoc m k (apply f (get m k) args)))))\r
\r
(defn update-in\r
  "'Updates' a value in a nested associative structure, where ks is a\r
sequence of keys and f is a function that will take the old value\r
and any supplied args and return the new value, and returns a new\r
nested structure.  If any levels do not exist, hash-maps will be\r
created."\r
  ([m ks f & args]\r
     (update-in* m ks f args)))\r
\r
(defmacro condp\r
  "Takes a binary predicate, an expression, and a set of clauses.\r
   For each clause, (pred test-expr expr) is evaluated. If it returns\r
logical true, the clause is a match. If a binary clause matches, the\r
result-expr is returned, if a ternary clause matches, its result-fn,\r
which must be a unary function, is called with the result of the\r
predicate as its argument, the result of that call being the return\r
value of condp. A single default expression can follow the clauses,\r
and its value will be returned if no clause matches. If no default\r
expression is provided and no clause matches, an exception is thrown."\r
  [pred expr & clauses]\r
  (let [gpred (gensym "pred__")\r
        gexpr (gensym "expr__")\r
        emit-condp (defn emit-condp [pred expr args]\r
               (let [[[a b c :as clause] more]\r
                     (split-at (if (= :>> (second args)) 3 2) args)\r
                     n (count clause)]\r
                 (cond\r
                   (= 0 n) \`(throw (str "No matching clause: " ~expr))\r
                   (= 1 n) a\r
                   (= 2 n) \`(if (~pred ~a ~expr)\r
                              ~b\r
                              ~(emit-condp pred expr more))\r
                   :else \`(if-let [p# (~pred ~a ~expr)]\r
                            (~c p#)\r
                            ~(emit-condp pred expr more)))))]\r
    \`(let [~gpred ~pred\r
           ~gexpr ~expr]\r
       ~(emit-condp gpred gexpr clauses))))\r
\r
(defn Math/log\r
  "Returns the natural logarithm (base e) of a number."\r
  [n]\r
  (js-eval (str "Math.log(" n ")")))\r
\r
(def Integer/MIN_VALUE\r
  (js-eval "Number.MIN_VALUE"))\r
\r
(def Integer/MAX_VALUE\r
  (js-eval "Number.MAX_VALUE"))\r
\r
(defn bit-shift-left\r
  "Bitwise shift left"\r
  [x n]\r
  (js-eval (str x " << " n)))\r
\r
(defn bit-shift-right\r
  "Bitwise shift right"\r
  [x n]\r
  (js-eval (str x " >> " n)))\r
\r
(defn bit-test\r
  "Test bit at index n"\r
  [x n]\r
  (js-eval (str "((" x " >> " n ") % 2 != 0)")))\r
\r
(defn bit-set\r
  "Set bit at index n"\r
  [x n]\r
  (js-eval (str x " | 1 << " n)))\r
\r
(defn bit-clear\r
  "Clear bit at index n"\r
  [x n]\r
  (js-eval (str x " & ~(1 << " n ")")))\r
\r
(defn bit-flip\r
  "Flip bit at index n"\r
  [x n]\r
  (if (bit-test x n)\r
    (bit-clear x n)\r
    (bit-set x n)))\r
\r
(defn bit-and\r
  "Bitwise and"\r
  [x y]\r
  (js-eval (str x " & " y)))\r
\r
(defn str/starts-with?\r
  "Returns true if s starts with substr."\r
  [s substr]\r
  (js-eval (str "'" s "'" ".startsWith ('" substr "')")))\r
\r
\r
(defn <\r
  "Returns non-nil if nums are in monotonically increasing order,\r
  otherwise false."\r
  ([x] true)\r
  ([x y] (lt x y))\r
  ([x y & more]\r
   (if (< x y)\r
     (if (next more)\r
       (recur y (first more) (next more))\r
       (< y (first more)))\r
     false)))\r
\r
(defn <=\r
  "Returns non-nil if nums are in monotonically non-decreasing order,\r
  otherwise false."\r
  ([x] true)\r
  ([x y] (lte x y))\r
  ([x y & more]\r
   (if (<= x y)\r
     (if (next more)\r
       (recur y (first more) (next more))\r
       (<= y (first more)))\r
     false)))\r
\r
\r
(defn >\r
  "Returns non-nil if nums are in monotonically decreasing order,\r
  otherwise false."\r
  ([x] true)\r
  ([x y] (gt x y))\r
  ([x y & more]\r
   (if (> x y)\r
     (if (next more)\r
       (recur y (first more) (next more))\r
       (> y (first more)))\r
     false)))\r
\r
(defn >=\r
  "Returns non-nil if nums are in monotonically non-increasing order,\r
  otherwise false."\r
  ([x] true)\r
  ([x y] (gte x y))\r
  ([x y & more]\r
   (if (>= x y)\r
     (if (next more)\r
       (recur y (first more) (next more))\r
       (>= y (first more)))\r
     false)))`,pprint=`(ns pprint {:clj-kondo/ignore true})\r
\r
(defn spaces- [indent]\r
     (if (> indent 0)\r
       (str " " (spaces- (dec indent)))\r
       ""))\r
\r
(defn pp-seq- [obj indent]\r
  ;; set char length threshold for newlines\r
  (if (> (count (str obj)) 65)\r
    (apply str (pp- (first obj) 0)\r
           (map (fn [x] (str "\\n" (spaces- (inc indent))\r
                             (pp- x (inc indent))))\r
                (rest obj)))\r
    (apply str (pp- (first obj) 0)\r
           (map (fn [x] (str " " (pp- x (inc indent))))\r
                (rest obj)))))\r
\r
;; old pp-seq function\r
#_(defn pp-seq- [obj indent]\r
  (apply str (pp- (first obj) 0)\r
         (map (fn [x] (str "\\n" (spaces- (inc indent))\r
                           (pp- x (inc indent))))\r
              (rest obj))))\r
\r
(defn pp-map- [obj indent]\r
     (let* [ks (keys obj)\r
            kindent (+ 1 indent)\r
            kwidth (count (seq (str (first ks))))\r
            vindent (+ 1 (+ kwidth kindent))]\r
           (apply str (pp- (first ks) 0)\r
                  " "\r
                  (pp- (get obj (first ks)) 0)\r
                  (map (fn [k] (str "\\n" (spaces- kindent)\r
                                     (pp- k kindent)\r
                                     " "\r
                                     (pp- (get obj k) vindent)))\r
                       (rest (keys obj))))))\r
\r
(defn pp- [obj indent]\r
  (do #_(console-print "[pp-]" obj)\r
      (cond\r
        (= "" obj) "\\"\\""\r
        (empty? obj) (str obj)\r
        (list? obj)   \r
        (do #_(console-print "[pp-]" "list" obj)\r
         (str "(" (pp-seq- obj indent) ")"))\r
        (vector? obj) \r
        (do #_(console-print "[pp-]" "vector" obj)\r
         (str "[" (pp-seq- obj indent) "]"))\r
        (set? obj) (str "#{" (pp-seq- obj indent) "}")\r
        (map? obj)    (str "{" (pp-map- obj indent) "}")\r
        :else         (pr-str obj))))\r
\r
(defn pprint [obj]\r
  (if (nil? obj) "nil"\r
      (do #_(console-print "[pprint]" obj)\r
          (cond \r
            (= "" obj) "\\"\\""\r
            (empty? obj) (str obj)\r
            :else (pp- obj 0)))))`;function READ(o){return read_str(o)}function qqLoop(o,e){return _list_Q(e)&&e.length&&_symbol_Q(e[0])&&e[0].value=="splice-unquote"?[_symbol("concat"),e[1],o]:[_symbol("cons"),quasiquote(e),o]}function quasiquote(o){return _list_Q(o)&&0<o.length&&_symbol_Q(o[0])&&o[0].value=="unquote"?o[1]:_list_Q(o)?o.reduceRight(qqLoop,[]):_vector_Q(o)?[_symbol("vec"),o.reduceRight(qqLoop,[])]:_symbol_Q(o)||_hash_map_Q(o)?[_symbol("quote"),o]:o}function is_macro_call(o,e){return _list_Q(o)&&_symbol_Q(o[0])&&e.find(o[0])&&e.get(o[0])._ismacro_}function macroexpand(o,e){for(;is_macro_call(o,e);){var s=e.get(o[0]);o=s.apply(s,o.slice(1))}return o}function eval_ast(o,e){if(_symbol_Q(o))return e.get(o);if(_list_Q(o))return o.map(function(u){return EVAL(u,e)});if(_set_Q(o)){var s=new Set;for(const u of o)s.add(EVAL(u,e));return s}else if(_vector_Q(o)){var l=o.map(function(u){return EVAL(u,e)});return l.__isvector__=!0,l}else if(_hash_map_Q(o)){var a=new Map;for(var[h,f]of o)a.set(EVAL(h,e),EVAL(o.get(h),e));return a}else return o}function _EVAL(o,e){for(;;){if(!_list_Q(o)||(o=macroexpand(o,e),!_list_Q(o)))return eval_ast(o,e);if(o.length===0)return o;var s=o[0],l=o[1],a=o[2],h=o[3];if(_keyword_Q(s))return EVAL([_symbol("get"),l,s],e);if(_hash_map_Q(s))return EVAL([_symbol("get"),s,l],e);if(_vector_Q(s))return EVAL([_symbol("get"),s,l],e);if(_set_Q(s))return EVAL([_symbol("contains?"),s,l],e);switch(s.value){case"ns":case"discard-form":return null;case"dispatch":if(_string_Q(l))return new RegExp(l,"g");if(_list_Q(l)){var f=Array.from(new Set(o.toString().match(/%\d?/g))),u=f.sort((_,B)=>parseInt(_.substring(1))-parseInt(B.substring(1))),T=u.map(_=>_symbol(_));return _function(EVAL,Env,l,e,T)}case"def":var b=EVAL(a,e);return e.set(l,b),b;case"let*":for(var p=new Env(e),m=0;m<l.length;m+=2)p.set(l[m],EVAL(l[m+1],p));o=a,e=p;break;case"loop*":for(var g=[_symbol("do")].concat(o.slice(2)),y=new Env(e),w=[],m=0;m<l.length;m+=2)w.push(l[m],EVAL(l[m+1],y));for(let D=0;D<w.length;D+=2)y.set(l[D],w[D+1]);o=g,e=y;break;case"recur":w.__isvector__=!0;var x=o.slice(1).flatMap(D=>[D,D]);for(let D=1;D<x.length;D+=2){let _=x[D];w[D]=_}o=[_symbol("loop*")].concat([w,g]);break;case"deftest":var b=o.slice(2).map(D=>EVAL(D,e));return e.set(l,b),b;case"testing":return EVAL(a,e);case"quote":return l;case"quasiquoteexpand":return quasiquote(l);case"quasiquote":o=quasiquote(l);break;case"defmacro":if(_string_Q(a)){var k=[_symbol("do")].concat(o.slice(4)),S=_function(EVAL,Env,k,e,h);S._ismacro_=!0;var P=new Map;return S.__meta__=P,P.set("Êždoc",a),P.set("Êžname",l),P.set("Êžarglists",h),e.set(l,S)}else{var k=[_symbol("do")].concat(o.slice(3)),S=_function(EVAL,Env,k,e,a);S._ismacro_=!0;var P=new Map;return S.__meta__=P,P.set("Êžname",l),P.set("Êžarglists",a),e.set(l,S)}case"macroexpand":return macroexpand(l,e);case"try":try{return EVAL(l,e)}catch(D){if(a&&a[0].value==="catch")return D instanceof Error&&(D=D.message),EVAL(a[2],new Env(e,[a[1]],[D]));throw D}case"do":eval_ast(o.slice(1,-1),e),o=o[o.length-1];break;case"if":var E=EVAL(l,e);E===null||E===!1?o=typeof h<"u"?h:null:o=a;break;case"fn*":if(hasRecur(o)){let D=[];for(const _ of o.slice(1))if(hasRecur(_)&&!hasLoop(_)){var R=_[0].flatMap(B=>B.value!="&"?[B,B]:[]);R.__isvector__=!0,D.push(_.slice(0,1).concat([[_symbol("loop*"),R,[_symbol("do")].concat(_.slice(1))]]))}else D.push(_);return multifn(EVAL,Env,D,e)}return _list_Q(l)?multifn(EVAL,Env,o.slice(1),e):_function(EVAL,Env,a,e,l);case"new":var O=EVAL(l,e),T=EVAL([_symbol("do")].concat(o.slice(2)),e);return new O(T);default:var M=eval_ast(o,e),$=M[0];if($.__multifn__)o=$.__ast__(M.slice(1)),e=$.__gen_env__(M.slice(1));else if($.__ast__)o=$.__ast__,e=$.__gen_env__(M.slice(1));else{if(_set_Q($)||_keyword_Q($)||_vector_Q($)||_hash_map_Q($))return EVAL([$].concat(M.slice(1)),e);var b=$.apply($,M.slice(1));return b}}}}function EVAL(o,e){var s=_EVAL(o,e);return typeof s<"u"?s:null}function PRINT(o){return _pr_str(o,!0)}var repl_env=new Env;const evalString=function(o){return PRINT(EVAL(READ(o),repl_env))};for(var n in ns)repl_env.set(_symbol(n),ns[n]);repl_env.set(_symbol("eval"),function(o){return EVAL(o,repl_env)});repl_env.set(_symbol("*ARGV*"),[]);evalString("(do "+core_clj+")");evalString("(do "+pprint+")");const repp=function(o){return evalString("(do "+o+")")};function addDoc(o,e,s){var l=new Map;l.set("Êždoc",s),l.set("Êžarglists",READ(e)),repl_env.data[o].__meta__=l}addDoc("iterate","[f x]","Returns a lazy sequence of x, (f x), (f (f x)) etc. f must be free of side-effects");addDoc("true?","[x]","Returns true if x is the value true, false otherwise.");addDoc("false?","[x]","Returns true if x is the value false, false otherwise.");addDoc("ratio?","[n]","Returns true if n is a Ratio");addDoc("number?","[x]","Returns true if x is a Number");addDoc("string?","[x]","Return true if x is a String");addDoc("symbol","([name] [ns name])","Returns a Symbol with the given namespace and name. Arity-1 works on strings, keywords, and vars.");addDoc("symbol?","[x]","Return true if x is a Symbol");addDoc("set?","[x]","Returns true if x is a set");addDoc("keyword","([name] [ns name])","Returns a Keyword with the given namespace and name.  Do not use `:` in the keyword strings, it will be added automatically.");addDoc("keyword?","[x]","Returns true if x is a keyword");addDoc("map-entry?","[x]","Returns true if x is a map entry");addDoc("re-matches","[re s]","Returns the match, if any, of string to pattern");addDoc("re-find","([m] [re s])","Returns the next regex match, if any, of string to pattern");addDoc("fn?","[x]","Returns true if x is a function (not a macro)");addDoc("macro?","[x]","Returns true if x is a macro");addDoc("char","[x]","Coerce to char");addDoc("int?","[x]","Return true if x is a fixed precision integer");addDoc("repeatedly","[n f]","Takes a function of no args, presumably with side effects, and returns a sequence of length n of calls to it");addDoc("rand-int","[n]","Returns a random integer between 0 (inclusive) and n (exclusive).");addDoc("rand-nth","[coll]","Return a random element of the (sequential) collection. Will have the same performance characteristics as nth for the given collection.");addDoc("Math/round","[n]","Returns the value of a number rounded to the nearest integer");addDoc("Math/sqrt","[n]","Returns the square root of a number.");addDoc("Math/pow","[b n]","Returns the value of base b raised to the power of n.");addDoc("Integer/toBinaryString","[n]","Returns a string representation of the integer argument as an unsigned integer in base 2.");addDoc("str/trim","[s]","Removes whitespace from both ends of string.");addDoc("cycle","[coll]","Returns a lazy (infinite!) sequence of repetitions of the items in coll.");addDoc("str/split","[s re]","Splits string on a regular expression. Returns vector of the splits.");addDoc("re-pattern","[s]","Returns a regular expression from string s.");addDoc("double","[x]","Coerce to double");addDoc("pr-str","([x] [x & more])","Prints the object(s) as a string, separated by spaces if there is more than one.");addDoc("str","([] [x] [x & ys])","With no args, returns the empty string. With one arg x, returns x.toString().  (str nil) returns the empty string. With more than one arg, returns the concatenation of the str values of the args.");addDoc("prn","[& more]","Same as pr followed by (newline).");addDoc("println","[& more]","Outputs the args as a string followed by a newline.");addDoc("read-string","[s]","Reads one object from string s and outputs a form");addDoc("slurp","[f]","Opens a reader on f and reads all its contents, returning a string.");addDoc("+","([] [x] [x y] [x y & more])","Returns the sum of nums. (+) returns 0.");addDoc("-","([] [x] [x y] [x y & more])","If no ys are supplied, returns the negation of x, else subtracts the ys from x and returns the result.");addDoc("*","([] [x] [x y] [x y & more])","Returns the product of nums. (*) returns 1.");addDoc("/","([] [x] [x y] [x y & more])","If no denominators are supplied, returns 1/numerator, else returns numerator divided by all of the denominators.");addDoc("inc","[x]","Returns a number one greater than num.");addDoc("time","[expr]","Evaluates expr and prints the time it took.  Returns the value of expr.");addDoc("max","([x] [x y] [x y & more])","Returns the greatest of the nums.");addDoc("min","([x] [x y] [x y & more])","Returns the least of the nums.");addDoc("range","([] [end] [start end] [start end step])","Returns a seq of nums from start (inclusive) to end (exclusive), by step, where start defaults to 0, step to 1, and end to infinity. When step is equal to 0, returns an infinite sequence of start. When start is equal to end, returns empty list.");addDoc("sort","([coll] [comp coll])","Returns a sorted sequence of the items in coll. If no comparator is supplied, uses default comparator.");addDoc("peek","[coll]","For a list, same as first, for a vector, same as last. If the collection is empty, returns nil.");addDoc("pop","[coll]","For a list, returns a new list without the first item, for a vector, returns a new vector without the last item.");addDoc("lower-case","[coll]","Converts string to all lower-case.");addDoc("upper-case","[coll]","Converts string to all upper-case.");addDoc("str/lower-case","[coll]","Converts string to all lower-case.");addDoc("str/upper-case","[coll]","Converts string to all upper-case.");addDoc("subs","([s start] [s start end])","Returns the substring of s beginning at start inclusive, and ending at end (defaults to length of string), exclusive.");addDoc("subvec","([v start] [v start end])","Returns a vector of the items in vector from start (inclusive) to end (exclusive).  If end is not supplied, defaults to (count vector).");addDoc("map-indexed","([f] [f coll])","Returns a lazy sequence consisting of the result of applying f to 0 and the first item of coll, followed by applying f to 1 and the second item in coll, etc, until coll is exhausted. Thus function f should accept 2 arguments, index and item.");addDoc("list","[& items]","Creates a new list containing the items.");addDoc("list?","[x]","Returns true if x is a list");addDoc("vector","([] [a] [a b] [a b c] [a b c d] [a b c d e] [a b c d e f] [a b c d e f & args])","Creates a new vector containing the args.");addDoc("vector?","[x]","Returns true if x is a vector");addDoc("hash-map","[& keyvals]","Returns a new hash map with supplied mappings.  If any keys are equal, they are handled as if by repeated uses of assoc.");addDoc("map?","[x]","Returns true if x is a map");addDoc("assoc","([map key val] [map key val & kvs])","assoc[iate]. When applied to a map, returns a new map of the same (hashed/sorted) type, that contains the mapping of key(s) to val(s). When applied to a vector, returns a new vector that contains val at index. Note - index must be <= (count vector).");addDoc("dissoc","([map] [map key] [map key & ks])","dissoc[iate]. Returns a new map of the same (hashed/sorted) type, that does not contain a mapping for key(s).");addDoc("get","([map key] [map key not-found])","Returns the value mapped to key, not-found or nil if key not present.");addDoc("re-seq","[re s]","Returns a sequence of successive matches of pattern re in string");addDoc("contains?","[coll key]","Returns true if key is present in the given collection, otherwise returns false. Note that for numerically indexed collections like vectors, this tests if the numeric key is within the range of indexes.");addDoc("keys","[map]","Returns a sequence of the map's keys, in the same order as (seq map).");addDoc("vals","[map]","Returns a sequence of the map's values, in the same order as (seq map).");addDoc("int","[x]","Coerce to int");addDoc("rem","[num div]","Remainder of dividing numerator by denominator.");addDoc("walk","[inner outer form]","Traverses form, an arbitrary data structure.  inner and outer are functions.  Applies inner to each element of form, building up a data structure of the same type, then applies outer to the result. Recognizes all data structures. Consumes seqs as with doall.");addDoc("sort-by","([keyfn coll] [keyfn comp coll])","Returns a sorted sequence of the items in coll, where the sort order is determined by comparing (keyfn item).  If no comparator is supplied, uses the default comparator.");addDoc("sequential?","[coll]","Returns true if coll is a list or a vector.");addDoc("cons","[x seq]","Returns a new seq where x is the first element and seq is the rest.");addDoc("concat","([] [x] [x y] [x y & zs])","Returns a lazy seq representing the concatenation of the elements in the supplied colls.");addDoc("vec","[coll]","Creates a new vector containing the contents of coll.");addDoc("nth","([coll index] [coll index not-found])","Returns the value at the index. get returns nil if index out of bounds, nth throws an exception unless not-found is supplied.");addDoc("first","[coll]","Returns the first item in the collection. Calls seq on its argument. If coll is nil, returns nil.");addDoc("second","[x]","Same as (first (next x))");addDoc("rest","[coll]","Returns a possibly empty seq of the items after the first. Calls seq on its argument.");addDoc("last","[coll]","Return the last item in coll");addDoc("take","([n] [n coll])","Returns a sequence of the first n items in coll, or all items if there are fewer than n.");addDoc("drop","([n] [n coll])","Returns a sequence of all but the first n items in coll.");addDoc("empty?","[coll]","Returns true if coll has no items - same as (not (seq coll)).");addDoc("count","[coll]","Returns the number of items in the collection. (count nil) returns 0.  Also works on strings and maps");addDoc("repeat","[n x]","Returns a sequence of length n of xs.");addDoc("join","([coll] [separator coll])","Returns a string of all elements in coll, as returned by (seq coll), separated by an optional separator.");addDoc("str/join","([coll] [separator coll])","Returns a string of all elements in coll, as returned by (seq coll), separated by an optional separator.");addDoc("str/replace","[s match replacement]","Replaces all instance of match with replacement in s.");addDoc("conj","([coll x] [coll x & xs])","conj[oin]. Returns a new collection with the xs 'added'. (conj nil item) returns (item).  The 'addition' may happen at different 'places' depending on the concrete type.");addDoc("seq","[coll]","Returns a seq on the collection. If the collection is empty, returns nil.  (seq nil) returns nil. seq also works on strings and any iterable object.");addDoc("filter","[pred coll]","Returns a sequence of the items in coll for which (pred item) returns logical true. pred must be free of side-effects.");addDoc("with-meta","[obj m]","Returns an object of the same type and value as obj, with map m as its metadata.");addDoc("meta","[obj]","Returns the metadata of obj, returns nil if there is no metadata.");addDoc("atom","[x]","Creates and returns an Atom with an initial value of x.");addDoc("atom?","[x]","Returns true if x is an atom type.");addDoc("deref","[ref]","Returns the current state of an atom.");addDoc("reset!","[atom newval]","Sets the value of atom to newval without regard for the current value. Returns newval.");addDoc("swap!","([atom f] [atom f x] [atom f x y] [atom f x y & args])","Atomically swaps the value of atom to be: (apply f current-value-of-atom args). Note that f may be called multiple times, and thus should be free of side effects.  Returns the value that was swapped in.");addDoc("js-eval","[s]","Evaluates an arbitrary string of JavaScript.");addDoc("set","[coll]","Returns a set of the distinct elements of coll.");addDoc("disj","([set] [set key] [set key & ks])","disj[oin]. Returns a new set of the same (hashed/sorted) type, that does not contain key(s).");addDoc("set/union","([] [s1] [s1 s2] [s1 s2 & sets])","Return a set that is the union of the input sets");addDoc("set/intersection","([s1] [s1 s2] [s1 s2 & sets])","Return a set that is the intersection of the input sets");addDoc("set/difference","([s1] [s1 s2] [s1 s2 & sets])","Return a set that is the first set without elements of the remaining sets");addDoc("set/symmetric-difference","[s1 s2]","Returns a set that is the symmetric difference of the input sets.");addDoc("dpcm2pcm","[values rate]","Takes a sequence of DPCM inputs consisting of zeros and ones, and a rate by which to detune the resulting sequence of PCM values. A rate of 1 outputs the sample unchanged, and a rate of 2 will play it at half speed.");addDoc("loop-dpcm","[hex n]","Takes a string of hex bytes representing little-endian binary values, and outputs a sequence of zeros and ones looped n times.");const up=o=>o.parent,isTopType=o=>o.isTop,isTop=o=>isTopType(o.type),mainSelection=o=>o.selection.asSingle().ranges[0],tree=(o,e,s)=>syntaxTree(o).resolveInner(e,s),nearestTouching=(o,e)=>tree(o,e,-1),parents=(o,e)=>isTop(o)?e:parents(up(o),e.concat(o)),rangeStr=(o,e)=>o.doc.slice(e.from,e.to).toString(),uppermostEdge=(o,e)=>{const s=parents(e,[]).filter(l=>o==l.to&&o==e.to);return s[s.length-1]||e},nodeAtCursor=o=>{const e=mainSelection(o).from,s=nearestTouching(o,e);return uppermostEdge(e,s)};let posAtFormEnd=0;const topLevelNode=o=>{const e=mainSelection(o).from,s=parents(nearestTouching(o,e),[]);return s.length===0?nodeAtCursor(o):s[s.length-1]},cursorNodeString=o=>rangeStr(o,nodeAtCursor(o)),topLevelString=o=>rangeStr(o,topLevelNode(o));var evalResult="",codeBeforeEval="",testCodeBeforeEval="",posBeforeEval=0,testPosBeforeEval=0,lastEditorEvaluated;const updateEditor=(o,e,s)=>{var l=o.dom.parentElement.id,a=o.state.doc.toString();const h=a.length;l==="app"&&(codeBeforeEval=a,posBeforeEval=o.state.selection.main.head,o.dispatch({changes:{from:0,to:h,insert:e},selection:{anchor:s,head:s}})),l==="test"&&(testCodeBeforeEval=a,testPosBeforeEval=o.state.selection.main.head,o.dispatch({changes:{from:0,to:h,insert:e},selection:{anchor:s,head:s}}))};function tryEval(o){try{return repp(o)}catch(e){return console.log(e),`
Error: `+e.message}}const docBar=document.getElementById("results"),docBar2=document.getElementById("doc");function updateDocBar(o){var e=o.state.selection.main.head,s=cursorNodeString(o.state);if(syntaxTree(o.state).resolveInner(e,-1).name==="Symbol"&&Object.hasOwn(repl_env.data,s)&&Object.hasOwn(repl_env.data[s],"__meta__")&&repl_env.data[s].__meta__!=null){var l=repl_env.data[s].__meta__.get("Êždoc");if(repl_env.data[s].__meta__.has("Êžarglists")){var a=repl_env.data[s].__meta__.get("Êžarglists");docBar.innerHTML=s+" "+(PRINT(a)||"")}else docBar.innerHTML=s;docBar.style.color="#0437F2",docBar2.innerHTML=l||"",docBar2.style.color="#0437F2"}else docBar.innerHTML="",docBar2.innerHTML=""}const clearEval=o=>{o.state.selection.main.head,updateDocBar(o);const e=o.dom.parentElement.id;if(e==="app"&&lastEditorEvaluated==="app"){var s=codeBeforeEval,l=posBeforeEval;evalResult.length!=0&&(evalResult="",updateEditor(o,s,l))}if(e==="test"&&lastEditorEvaluated==="test"){var a=testCodeBeforeEval,h=testPosBeforeEval;evalResult.length!=0&&(evalResult="",updateEditor(o,a,h))}};function clearAll(o){clearEval(o),docBar.innerHTML="",docBar2.innerHTML=""}const evalAtCursor=o=>{var e=o.dom.parentElement.id;clearEval(o);var s=o.state.doc.toString();if(e==="app"){codeBeforeEval=s,posBeforeEval=o.state.selection.main.head;var l=codeBeforeEval.slice(0,posBeforeEval),a=codeBeforeEval.slice(posBeforeEval,codeBeforeEval.length);evalResult=tryEval(cursorNodeString(o.state));var h=l+` =>
`+out_buffer+evalResult+" "+a;return updateEditor(o,h,posBeforeEval),o.dispatch({selection:{anchor:posBeforeEval,head:posBeforeEval}}),clearBuffer(),lastEditorEvaluated="app",!0}if(e==="test"){testCodeBeforeEval=s,testPosBeforeEval=o.state.selection.main.head;var l=codeBeforeEval.slice(0,posBeforeEval),a=codeBeforeEval.slice(posBeforeEval,codeBeforeEval.length);evalResult=tryEval(cursorNodeString(o.state));var h=l+` =>
`+out_buffer+evalResult+" "+a;return updateEditor(o,h,posBeforeEval),o.dispatch({selection:{anchor:posBeforeEval,head:posBeforeEval}}),clearBuffer(),lastEditorEvaluated="test",!0}},evalTopLevel=o=>{var e=o.dom.parentElement.id;clearEval(o),posAtFormEnd=topLevelNode(o.state).to;var s=o.state.doc.toString();if(e==="app"){posBeforeEval=o.state.selection.main.head,codeBeforeEval=s;var l=codeBeforeEval.slice(0,posAtFormEnd),a=codeBeforeEval.slice(posAtFormEnd,codeBeforeEval.length);evalResult=tryEval(topLevelString(o.state));const h=l+`
=> 
`+out_buffer+evalResult+" "+a;return updateEditor(o,h,posBeforeEval),clearBuffer(),lastEditorEvaluated="app",!0}if(e==="test"){testPosBeforeEval=o.state.selection.main.head,testCodeBeforeEval=s;var l=testCodeBeforeEval.slice(0,posAtFormEnd),a=testCodeBeforeEval.slice(posAtFormEnd,testCodeBeforeEval.length);evalResult=tryEval(topLevelString(o.state));const u=l+`
=> 
`+out_buffer+evalResult+" "+a;return updateEditor(o,u,testPosBeforeEval),clearBuffer(),lastEditorEvaluated="test",!0}},evalCell=o=>{var e=o.dom.parentElement.id;clearEval(o);var s=o.state.doc.toString();if(e==="app"){posBeforeEval=o.state.selection.main.head,evalResult=tryEval("(do "+o.state.doc.toString()+")");var l=s+`
=> 
`+out_buffer+evalResult;return updateEditor(o,l,posBeforeEval),clearBuffer(),lastEditorEvaluated="app",!0}if(e==="test"){testPosBeforeEval=o.state.selection.main.head,evalResult=tryEval("(do "+o.state.doc.toString()+")");var l=s+`
=> 
`+out_buffer+evalResult;return updateEditor(o,l,testPosBeforeEval),clearBuffer(),lastEditorEvaluated="test",!0}},alpha=Array.from(Array(58)).map((o,e)=>e+65),alphabet=alpha.map(o=>String.fromCharCode(o));let letterKeys=[];for(let o=0;o<alphabet.length;o++)letterKeys=letterKeys.concat({key:alphabet[o],run:clearEval});const evalExtension=Prec.highest(keymap.of([{key:"Alt-Enter",run:evalCell},{key:"Mod-Enter",run:evalAtCursor},{key:"Shift-Enter",run:evalTopLevel},{key:"Escape",run:clearAll},{key:"ArrowLeft",run:clearEval},{key:"ArrowRight",run:clearEval},{key:"ArrowUp",run:clearEval},{key:"ArrowDown",run:clearEval},{key:"Backspace",run:clearEval},{key:"Enter",run:clearEval},{key:"Tab",run:clearEval},{key:"Delete",run:clearEval},{key:"0",run:clearEval},{key:"1",run:clearEval},{key:"2",run:clearEval},{key:"3",run:clearEval},{key:"4",run:clearEval},{key:"5",run:clearEval},{key:"6",run:clearEval},{key:"7",run:clearEval},{key:"8",run:clearEval},{key:"9",run:clearEval},{key:"!",run:clearEval},{key:"@",run:clearEval},{key:"#",run:clearEval},{key:"$",run:clearEval},{key:"%",run:clearEval},{key:"^",run:clearEval},{key:"&",run:clearEval},{key:"*",run:clearEval},{key:"-",run:clearEval},{key:"=",run:clearEval},{key:"+",run:clearEval},{key:"/",run:clearEval},{key:"`",run:clearEval},{key:'"',run:clearEval},{key:"'",run:clearEval},{key:";",run:clearEval},{key:":",run:clearEval},{key:"[",run:clearEval},{key:"]",run:clearEval},{key:"{",run:clearEval},{key:"}",run:clearEval},{key:"(",run:clearEval},{key:")",run:clearEval},{key:"Space",run:clearEval}].concat(letterKeys))),{coll:coll$1}=props,clojureLanguage=LRLanguage.define({parser:parser.configure({props:[styleTags({NS:tags$1.keyword,DefLike:tags$1.keyword,"Operator/Symbol":tags$1.keyword,"VarName/Symbol":tags$1.definition(tags$1.variableName),Boolean:tags$1.atom,"DocString/...":tags$1.emphasis,"Discard!":tags$1.comment,Number:tags$1.number,StringContent:tags$1.string,'"\\""':tags$1.string,Keyword:tags$1.atom,Nil:tags$1.null,LineComment:tags$1.lineComment,RegExp:tags$1.regexp}),indentNodeProp.add(o=>e=>{let{pos:s,unit:l,node:a,state:h,baseIndent:f,textAfter:u}=e;if(o.prop(coll$1)){let p=e.column(a.firstChild.to);return o.name=="List"&&["NS","DefLike","Operator"].includes(a.firstChild.nextSibling.type.name)?p+1:p}else return 0}),foldNodeProp.add({"Vector Map List":foldInside})]}),languageData:{commentTokens:{line:";;"}}});function getCompletions(o){let e=[{label:"macroexpand"},{label:"defmacro"}];for(const s of Object.keys(repl_env.data))e.push({label:s});return e}function myCompletions(o){let e=o.matchBefore(/\w*/);return e.from==e.to&&!o.explicit?null:{from:e.from,options:getCompletions()}}function clojure(){return new LanguageSupport(clojureLanguage,[clojureLanguage.data.of({autocomplete:myCompletions}),evalExtension])}function el$1(o){return document.getElementById(o)}function getRomAdr(o){return o&16383}function getWordRep$1(o){return("000"+o.toString(16)).slice(-4).toUpperCase()}function getByteRep(o){return o?("0"+o.toString(16)).slice(-2).toUpperCase():"00"}let disScroll=0;const opLengths=[1,2,2,2,2,2,2,3,3,3,0,3,2,2,3,3],opNames=["brk","ora","kil","slo","nop","ora","asl","slo","php","ora","asl","anc","nop","ora","asl","slo","bpl","ora","kil","slo","nop","ora","asl","slo","clc","ora","nop","slo","nop","ora","asl","slo","jsr","and","kil","rla","bit","and","rol","rla","plp","and","rol","anc","bit","and","rol","rla","bmi","and","kil","rla","nop","and","rol","rla","sec","and","nop","rla","nop","and","rol","rla","rti","eor","kil","sre","nop","eor","lsr","sre","pha","eor","lsr","alr","jmp","eor","lsr","sre","bvc","eor","kil","sre","nop","eor","lsr","sre","cli","eor","nop","sre","nop","eor","lsr","sre","rts","adc","kil","rra","nop","adc","ror","rra","pla","adc","ror","arr","jmp","adc","ror","rra","bvs","adc","kil","rra","nop","adc","ror","rra","sei","adc","nop","rra","nop","adc","ror","rra","nop","sta","nop","sax","sty","sta","stx","sax","dey","nop","txa","uni","sty","sta","stx","sax","bcc","sta","kil","uni","sty","sta","stx","sax","tya","sta","txs","uni","uni","sta","uni","uni","ldy","lda","ldx","lax","ldy","lda","ldx","lax","tay","lda","tax","uni","ldy","lda","ldx","lax","bcs","lda","kil","lax","ldy","lda","ldx","lax","clv","lda","tsx","uni","ldy","lda","ldx","lax","cpy","cmp","nop","dcp","cpy","cmp","dec","dcp","iny","cmp","dex","axs","cpy","cmp","dec","dcp","bne","cmp","kil","dcp","nop","cmp","dec","dcp","cld","cmp","nop","dcp","nop","cmp","dec","dcp","cpx","sbc","nop","isc","cpx","sbc","inc","isc","inx","sbc","nop","sbc","cpx","sbc","inc","isc","beq","sbc","kil","isc","nop","sbc","inc","isc","sed","sbc","nop","isc","nop","sbc","inc","isc"];function peek(o){return o&=65535,o<8192?ram[o&2047]:o<16416&&o>=16384?peek$2(o):read$1(o)}function instrStr(o){let e=o,s=peek(e),l=peek(e+1&65535),a=l|peek(e+2&65535)<<8,h=addressingModes[s],f=opNames[s],u=l>127?l-256:l;switch(u+=e+2,h){case 0:return`${f}`;case 1:return`${f} #$${getByteRep(l)}`;case 2:return`${f} $${getByteRep(l)}`;case 3:return`${f} $${getByteRep(l)},x`;case 4:return`${f} $${getByteRep(l)},y`;case 5:return`${f} ($${getByteRep(l)},x)`;case 6:return`${f} ($${getByteRep(l)}),y`;case 7:return`${f} $${getWordRep$1(a)}`;case 8:return`${f} $${getWordRep$1(a)},x`;case 9:return`${f} $${getWordRep$1(a)},y`;case 10:return"?";case 11:return`${f} ($${getWordRep$1(a)})`;case 12:return`${f} $${getWordRep$1(u)}`;case 13:return`${f} ($${getByteRep(l)}),y`;case 14:return`${f} $${getWordRep$1(a)},x`;case 15:return`${f} $${getWordRep$1(a)},y`}}function changeScrollPos(o){let e=disScroll,s=disScroll+o;s=s<0?0:s,disScroll=s,s!==e&&drawDissasembly()}el$1("disassembly").onwheel=function(o){changeScrollPos(Math.floor(o.deltaY*.3)),o.preventDefault()};function drawDissasembly(){let o=el$1("disassembly");o.textContent="";let e=disScroll,s=0,l=!0;for(;e<65536;){let a=peek(e),h=opLengths[addressingModes[a]],f;if(e<32768)f=ramCdl[e];else{let p=getRomAdr(e);f=romCdl[p]}let u=e===br[0]?">":" ";if(f&&instrStr(e)!="brk"?(o.textContent+=`${u} ${getWordRep$1(e)}: ${instrStr(e)}
`,e+=h,l=!0,s++):(l&&(o.textContent+=`  ${getWordRep$1(e)}: -- UNIDENTIFIED BLOCK --
`,l=!1,s++),e++),s===32)break}for(let a=s;a<32;a++)o.textContent+=`
`}let inputReadPos=0,inputBufferPos=0,inputBuffer=new Float32Array(4096);function process$1(o){inputReadPos+2048>inputBufferPos&&(inputReadPos=inputBufferPos-2048),inputReadPos+4096<inputBufferPos&&(inputReadPos+=2048);let e=o.outputBuffer.getChannelData(0);for(let s=0;s<2048;s++)e[s]=inputBuffer[inputReadPos++&4095]}const actx=new AudioContext,samplesPerFrame=actx.sampleRate/60;let sampleBuffer=new Float32Array(samplesPerFrame);function resume(){actx.resume()}function nextBuffer(){for(let o=0;o<samplesPerFrame;o++){let e=sampleBuffer[o];inputBuffer[inputBufferPos++&4095]=e}}function AudioHandler(){this.start=function(){this.sourceNode=actx.createBufferSource(),this.sourceNode.buffer=actx.createBuffer(1,actx.sampleRate,actx.sampleRate),this.scriptNode=actx.createScriptProcessor(2048,1,1),this.scriptNode.onaudioprocess=function(o){process$1(o)},this.biquadFilter=actx.createBiquadFilter(),this.biquadFilter.type="highpass",this.biquadFilter.frequency.setValueAtTime(37,actx.currentTime),this.sourceNode.connect(this.scriptNode),this.scriptNode.connect(this.biquadFilter),this.biquadFilter.connect(actx.destination),this.sourceNode.start()},this.stop=function(){this.sourceNode&&(this.sourceNode.stop(),this.sourceNode.disconnect()),this.scriptNode&&this.scriptNode.disconnect(),inputBufferPos=0,inputReadPos=0}}let editorState=EditorState.create({doc:`(def tempo 1)

(defn zeldabass1 [time note]
  [{:time time  :length 20 :pitch note}
   {:time (+ 1 time) :length 20 :pitch note}
   {:time (+ 2 time) :length 20 :pitch (+ note 7)}
   {:time (+ 3 time) :length 20 :pitch (+ note 7)}
   {:time (+ 4 time) :length 20 :pitch (+ note 12)}
   {:time (+ 5 time) :length 20 :pitch (+ note 12)}
   {:time (+ 6 time) :length 20 :pitch (+ note 12)}
   {:time (+ 7 time) :length 20 :pitch (+ note 12)}])

(defn zeldabass2 [time]
  (apply concat
      (for [[beat note] [[0 46] [8 44] [16 42] [24 41]]]
        (zeldabass1 (+ time beat) note))))

(defn zeldalead1 [time]
       [{:time (+ time 0) :length 20 :pitch 70}
        {:time (+ time 0.1) :length 20 :pitch 70}
        {:time (+ time 0.2) :length 20 :pitch 70}
        {:time (+ time 0.3) :length 20 :pitch 70}
        {:time (+ time 0.4) :length 20 :pitch 70}
        {:time (+ time 0.6) :length 20 :pitch 65}
        {:time (+ time 1) :length 20 :pitch 65}
        {:time (+ time 1.1) :length 20 :pitch 70}
        {:time (+ time 1.2) :length 10 :pitch 68}
        {:time (+ time 1.3) :length 10 :pitch 66}
        {:time (+ time 6.5) :length 20 :pitch 68}
        {:time (+ time 6.6) :length 20 :pitch 68}
        {:time (+ time 6.7) :length 20 :pitch 68}
        {:time (+ time 6.8) :length 20 :pitch 68}
        {:time (+ time 6.9) :length 20 :pitch 68}
        {:time (+ time 7) :length 20 :pitch 68}
        {:time (+ time 7.1) :length 20 :pitch 68}
        {:time (+ time 7.4) :length 20 :pitch 70}
        {:time (+ time 7.5) :length 20 :pitch 70}
        {:time (+ time 7.6) :length 20 :pitch 70}
        {:time (+ time 7.7) :length 20 :pitch 70}
        {:time (+ time 7.8) :length 20 :pitch 70}
        {:time (+ time 10.5) :length 20 :pitch 66}
        {:time (+ time 11) :length 20 :pitch 66}
        {:time (+ time 11.5) :length 20 :pitch 70}
        {:time (+ time 12) :length 10 :pitch 69}
        {:time (+ time 12.25) :length 10 :pitch 67}
        {:time (+ time 12.5) :length 20 :pitch 69}
        {:time (+ time 12.6) :length 20 :pitch 69}
        {:time (+ time 12.7) :length 20 :pitch 69}
        {:time (+ time 12.8) :length 20 :pitch 69}
        {:time (+ time 12.9) :length 20 :pitch 69}
        {:time (+ time 13.6) :length 20 :pitch 69}
        {:time (+ time 13.7) :length 20 :pitch 69}])

(tri-stream (zeldabass2 0))
(sq1-stream (zeldalead1 0))

(play-nsf)`,extensions:[basicSetup,clojure()]}),view=new EditorView({state:editorState,parent:document.querySelector("#app")});document.querySelector("#app").onclick=o=>updateDocBar(view);let audio=new AudioHandler,ram=new Uint8Array(2048),callArea=new Uint8Array(16),totalSongs=0,startSong=0,tags={name:"",artist:"",copyright:""},playReturned=!0,frameIrqWanted=!1,dmcIrqWanted=!1,paused=!1,loaded=!1,loopId=0;function log(o){el("log").innerHTML+=o+"<br>",el("log").scrollTop=el("log").scrollHeight}function el(o){return document.getElementById(o)}let currentSong=1;el("rom").onchange=function(o){resume();let e=new FileReader;e.onload=function(){let s=e.result,l=new Uint8Array(s);loadRom(l)},e.readAsArrayBuffer(o.target.files[0])};el("pause").onclick=function(o){paused&&loaded?(loopId=requestAnimationFrame(update),audio.start(),paused=!1,el("pause").innerText="Pause"):(cancelAnimationFrame(loopId),audio.stop(),paused=!0,el("pause").innerText="Unpause")};el("reset").onclick=function(o){loaded&&playSong(currentSong)};el("nextsong").onclick=function(o){loaded&&(currentSong++,currentSong=currentSong>totalSongs?totalSongs:currentSong,playSong(currentSong))};el("prevsong").onclick=function(o){loaded&&(currentSong--,currentSong=currentSong<1?1:currentSong,playSong(currentSong))};let ramCdl=new Uint8Array(32768),romCdl=new Uint8Array(16384);function setRamCdl(o,e){ramCdl[o]=e}function setRomCdl(o,e){romCdl[o]=e}function loadRom(o){loadNsf(o)&&(!loaded&&!paused&&(loopId=requestAnimationFrame(update),audio.start()),ramCdl=new Uint8Array(32768),romCdl=new Uint8Array(16384),loaded=!0,currentSong=startSong)}function getWordRep(o){return("000"+o.toString(16)).slice(-4).toUpperCase()}function loadNsf(o){if(o.length<128||o[0]!==78||o[1]!==69||o[2]!==83||o[3]!==77||o[4]!==26)return log("Invalid NSF loaded"),!1;if(o[5]!==1)return log("Unknown NSF version: "+o[5]),!1;totalSongs=o[6],log(totalSongs+" total songs"),startSong=o[7],log("Start song: "+startSong);let e=o[8]|o[9]<<8;if(log("Load address: $"+getWordRep(e)),e<32768)return log("Load address less than 0x8000 is not supported"),!1;let s=o[10]|o[11]<<8;log("Init address: $"+getWordRep(s));let l=o[12]|o[13]<<8;log("Play address: $"+getWordRep(l));for(let u=0;u<32&&o[14+u]!==0;u++)tags.name+=String.fromCharCode(o[14+u]);for(let u=0;u<32&&o[46+u]!==0;u++)tags.artist+=String.fromCharCode(o[46+u]);for(let u=0;u<32&&o[78+u]!==0;u++)tags.copyright+=String.fromCharCode(o[78+u]);let a=[0,0,0,0,0,0,0,0],h=0;for(let u=0;u<8;u++)a[u]=o[112+u],h+=o[112+u];log("Bankswitch init values: "+a);let f=h>0;return set_data(o),set_loadAdr(e),set_banked(f),set_banks(a),reset$1(),callArea[0]=32,callArea[1]=s&255,callArea[2]=s>>8,callArea[3]=234,callArea[4]=234,callArea[5]=234,callArea[6]=234,callArea[7]=234,callArea[8]=32,callArea[9]=l&255,callArea[10]=l>>8,callArea[11]=234,callArea[12]=234,callArea[13]=234,callArea[14]=234,callArea[15]=234,playSong(startSong),log("Loaded NSF file"),!0}function playSong(o){for(let s=0;s<ram.length;s++)ram[s]=0;playReturned=!0,reset$2(),reset(),reset$1(),frameIrqWanted=!1,dmcIrqWanted=!1;for(let s=16384;s<=16403;s++)write$2(s,0);write$2(16405,0),write$2(16405,15),write$2(16407,64),br[0]=16368,r[0]=o-1,r[1]=0;let e=0;for(;e<297800&&(cycle$1(),cycle$2(),br[0]!==16373);)e++}function update(){runFrame(),loopId=requestAnimationFrame(update)}function runFrame(){playReturned&&set_pc(16376),playReturned=!1;let o=0;for(;o<29780;)setIrqWanted(dmcIrqWanted||frameIrqWanted),playReturned||cycle$1(),cycle$2(),br[0]===16381&&(playReturned=!0),o++;getSamples(sampleBuffer,samplesPerFrame),nextBuffer()}function getSamples(o,e){let s=getOutput(),l=29780/e,a=0,h=0;for(let f=0;f<e;f++){h+=l;let u=0,p=h&65535;for(let m=a;m<a+p;m++)u+=s[1][m];o[f]=u/p,a+=p,h-=p}}
